<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.16.0","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="一个小学生的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Lightchaser">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Lightchaser">
<meta property="og:description" content="一个小学生的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Keke Liu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Lightchaser</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Lightchaser</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">三人行，必有我师</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Keke Liu</p>
  <div class="site-description" itemprop="description">一个小学生的博客</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/stemdkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;stemdkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:257198@whut.edu.cn" title="E-Mail → mailto:257198@whut.edu.cn" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/11/09/18-48-23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/09/18-48-23/" class="post-title-link" itemprop="url">6.1 USPEX</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-11-09 18:48:23" itemprop="dateCreated datePublished" datetime="2023-11-09T18:48:23+08:00">2023-11-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-12-15 09:01:00" itemprop="dateModified" datetime="2023-12-15T09:01:00+08:00">2023-12-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="一、USPEX-简介"><a href="#一、USPEX-简介" class="headerlink" title="一、USPEX 简介"></a>一、USPEX 简介</h1><p>USPEX: Universal Structure Predictor: Evolutionary Xtallography. USPEX 代码能够通过仅仅只知道材料的化学成分来预测具有任意 P-T 条件的晶体结构。在全世界有6000多名研究人员使用它，它的出现极大的促进了相关领域的发展。而它的发明者：Oganov教授，通过这个软件做出了一系列漂亮的结果。</p>
<p>而 CALYPSO 的主要是由吉林大学的马琰铭教授主导开发的。</p>
<h1 id="二、-下载安装"><a href="#二、-下载安装" class="headerlink" title="二、 下载安装"></a>二、 下载安装</h1><ol>
<li><p>浏览器进入：<a target="_blank" rel="noopener" href="https://uspex-team.org/en/uspex/downloads%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%98%AF">https://uspex-team.org/en/uspex/downloads，这个是</a> USPEX 下载地址和官方手册。点击红色标记的 register 进行注册和登录即可免费下载。<br>USPEX-9.4.4 是 USPEX 最经典的版本，体积最小，而最新的版本的体积急剧膨胀，相对老的版本，最新版本是Oganov教授团队采用 Python 将 USPEX-9.4.4 (MATLAB)改写了一遍，无大的新功能增加，发布时间较短，质量无法得到保证。更主要的是，USPEX-9.4.4 有中文文档！</p>
</li>
<li><p>确保机器上有 MATLAB 或者Octave，假如都没有，并且机器与外网隔离的情况下，可以参考这个安装 MATLAB( https: &#x2F;&#x2F;blog.csdn.net&#x2F;pihuanwan3227&#x2F;article&#x2F;details&#x2F;84849969 ), 参考这个安装Octave (<a target="_blank" rel="noopener" href="https://www.cnblogs.com/freeweb/p/7124589.html)%E3%80%82">https://www.cnblogs.com/freeweb/p/7124589.html)。</a></p>
</li>
<li><p>接下进行安装: .&#x2F;install.sh，。接下来会提示让填写安装地址(如果机器里面 Octave 已经安装好，会显示 Octave。当然 MATLAB 安装好，也会显示 MATLAB)</p>
</li>
<li><p>接下来还有重要的最后三步（这个就是设置环境变量，能够当前用户能够直接调用 USPEX）：</p>
</li>
</ol>
<ul>
<li>vi  ~&#x2F;.bashrc  </li>
<li>export PATH&#x3D;$PATH: &#x2F;home&#x2F;xiaoming&#x2F;EDU&#x2F;USPEX  </li>
<li>export USPEXPATH&#x3D;&#x2F;home&#x2F;xiaoming&#x2F;EDU&#x2F;USPEX&#x2F;src</li>
</ul>
<p>其中&#x2F;home&#x2F;xiaoming&#x2F;EDU&#x2F;USPEX为USPEX安装目录。</p>
<h1 id="三、进行计算"><a href="#三、进行计算" class="headerlink" title="三、进行计算"></a>三、进行计算</h1><p>在上一步中已经成功安装好 USPEX 了，这时候可以使用 USPEX 进行计算了，本教程使用的是最主流的软件组合：USPEX+VASP，本教程需要 VASP 已安装好，至于 VASP 懂不懂并不影响本教程的使用。</p>
<h2 id="3-1-准备输入文件"><a href="#3-1-准备输入文件" class="headerlink" title="3.1 准备输入文件"></a>3.1 准备输入文件</h2><p>首先建立一个名为&#x2F;La-H&#x2F;0GPa的文件夹，进入这个文件之后，在终端输入命令： USPEX –g,然后查看文件夹 0GPa，会发现多了四个文件夹：AntiSeeds、Seeds、Specific、Submission。</p>
<p>其中，AntiSeeds 和 Seeds 文件夹中里面的存放的的是结构文件，由于本教程使用的是VASP进行计算，故这两个文件夹放的是 POSCARS 的文件（至于为什么是POSCARS，等下解释）。而 Specific 文件夹里面放的是 VASP 进行计算时，需要的和赝势文件，而 Submission 文件夹里面放的是 USPEX 各种方式提交任务的脚本。这 4 个文件夹是 USPEX 程序自动生成的，因而需要进入每个文件夹里面进行修改或者准备所需要的输入文件。接下来我们一个个文件来进行详细说明（划重点）。</p>
<p>a. AntiSeeds 文件夹，这个文件顾名思义，就是禁止 USPEX 生成的结构的种子文件，与 Seeds 文件夹作用相反，并且这个功能不常使用，本教程 AntiSeeds 文件夹就不设置，不用管它，直接考虑 Seeds 文件夹。</p>
<p>b. Seeds文件夹，这个文件夹就是USPEX计算时，需要种子文件存放的地方。好了，既然需要种子文件，那么我们来准备种子文件吧。本教程要进行搜索的是 La-H 体系，那么开始准备La、H结构文件吧。首先到日本晶体结构数据NIMS网站(<a target="_blank" rel="noopener" href="https://crystdb.nims.go.jp/crystdb/search-materials">https://crystdb.nims.go.jp/crystdb/search-materials</a>: 免费注册且免费下载，并且里面结构文件多数有其引用的相关文献)上找结构。</p>
<pre><code>1）、 把这两种元素的cif结构文件全部下载下来；

2）、用VESTA 
(http://www.jp-minerals.org/vesta/en/download.html：下载后解压即可使用，功能很强大的软件) 打开，另存为VASP5 格式的POSCAR文件；

3）、打包上传到机器上刚刚建立的/La-H/0GPa /Seeds文件下；

4）、包把La和H的POSCAR文件合并为一个文件，并命名为POSCARS (1、可以使用cat 命令合并，如：cat POSCAR_La* POSCAR_H &gt;&gt; POSCARS，2、建议查看一下POSCARS文件格式，假如有类似乱码的东西，dos2unix POSCARS百度了解一下)。
</code></pre>
<p>c. Specific文件夹,这个文件夹主要存放的是USPEX控制的VASP进行计算的输入文件，由于本教程是La-H体系在0 GPa的变组分结构搜索，主要是用VASP计算USPEX生成结构的能量，因而这个文件内主要是POSCAR进行结构优化的文件：<br>INCAR_1-5: 这样设置的主要原因：考虑有你的初始结构通常远离局部最小点，在这种情况下，</p>
<p>INCAR_1，2首先应该在保持体积固定的情况下（ISIF&#x3D;4）弛豫原子和晶胞形状，然后在INCAR_3，4中做完全弛豫（ISIF&#x3D;3），在INCAR_5中完成非常精确的单点计算（ISIF&#x3D;2，NSW&#x3D;0）（至于更具体的细节问题，手册上有详细的描述，请查看手册第3章第3.4小节）。值得注意的是：K点设置由USPEX自动生成了，无需考虑。</p>
<p>d. Submission文件夹, 这个文件夹主要是USPEX来提交计算任务和检查计算任务的情况的一些脚本。一般情况下，提交计算任务都是通过登陆到服务器上进行提交，那么这时候需要修改submitJob_local.m和checkStatus_local.m这两个脚本。</p>
<p>e. INPUT.txt</p>
<p>USPEX 自动生成的4个文件夹已经处理好了，那么接下来就是控制USPEX计算的输入文件：INPUT.txt  (固定名字的文件)，在&#x2F;La-H&#x2F;0GPa文件通过文本编辑器(vi INPUT.txt)，把上面的内容输入进去，并并保存，下面来解释每行代表的意思，这是超级重重点。</p>
<p>上图都是USPEX计算输入控制文件：INPUT.txt主要内容，棕黄色的数字标志是行数，只是为了显示方便，不是需要输入的内容。</p>
<pre><code>1-3行、为注释说明行。
第4行、为选择计算类型行，主要是选择什么样的计算方法进行不同类型的计算，目前USPEX支持四种计算方法分别为：USPEX、VCNEB、META、PSO等。但目前采用变组分结构搜索的话，选用其王牌类型，USPEX就行，其他方法请参阅手册
第5行、需要计算的结构类型、是否为分子和是否为变组分计算，301：3代表了三维块状结构，0代表了不是分子，1代表了采用变组分。
第6行、1是代表了进行结构搜索最稳定结构时采用了生成焓作为筛选标准，当然还有其他标准：体积，硬度，结构有序度等等，详情参阅手册。
第7行、1代表了设置允许系统自动进行进化的变分操作，这个设置能加快运算。
第9-11行、是设置需要计算的体系，本教程是La-H体系，所以在第10行输入La H, 当然你也可以在第10行输入 La H 的原子序数：57 1 ，这样也是被允许的。
第13-16行、设置上面你设置的体系原子的个数之比，表示着：LaxHy，也就是说任意x个La和任意y个H的结构都是可以生成的。假如需要生成任意x个La和任意2y个H的结构怎么设置？
第17-24行、设置关于生成结构的数目，第20行populationSize设置除了第一代，其余以后每代生成的结构的数目，第21行initialPopSize设置第一代生成的结构的数目，第22行numGenerations，设置总共计算的最大代数。第23行stopCrit设置多少代的最好结构结构都一样就停止USPEX计算。第24行是设置是否重新优化幸存的结构，默认是0，意思就是不重新优化。（需要注意的是，这里的设置的大小，大致上决定你需要优化的结构的数目）
第25-29行、设置允许生成LaxHy结构中8&lt;=x+y&lt;=18，这样设置能够更好锁定搜索结构的范围，当然越小计算量越少了，这个主要看个人选择了，但是minAt和maxAt不要相差太大，太大容易出错或者最后结果漏掉一些结构，手册上有推荐选择范围，自己参阅考虑。
第30-37行、设置遗传变分操作的具体细节的，主要设置各个操作的所占比例，fracGene:基因遗传占的比例，fracRand：随机生成的占比例，fracAtomsMut:原子摄动占的比例，fracTrans：晶格转变占的比例，fracLatMut：点阵摄动占的比例。注意：所有比例之和必须为1。
第39行、这行是设置体系的压强大小，单位是GPa, 0是不施加外压。当然了前面提到的文章，压力有150 GPa 和 300 GPa，在相应的压力下进行搜索时，应该此处改为150 或 300。
第41-46行、是设置调用的外部程序执行具体计算用的，1代表了调用VASP，1 1 1 1 1  跟Specific 文件夹里面INCAR_1、INCAR_2、INCAR_3、INCAR_4、INCAR_5遥相呼应，表示一个结构需要优化5次得到精确的能量值。
第48行、设置USPEX一次总共提交多少个任务，
第49行、设置提交任务方式，1设置为local，毕竟USPEX一般都是安装在服务器上面的。
第51-56行、设置重新启动USPEX运算，这个设置应该好好琢磨一下，尤其是第54行pickUpYN，0是不进行计算，1是进行重新计算，第55行pickUpGen根据你的结果文件夹results*里面的generation*的数目进行设置，第56行pickUpFolder是根据哪个结果文件夹results*进行重新计算，这3行一定要配合使用，是相关联的。当然本教程是进行新计算，都设置为0，即可，这个弄明白了，重新计算时，可以节省大量时间。
</code></pre>
<p>好了，La-H 体系不同压强下变组分结构搜索的INPUT.txt的主要设置内容介绍完毕。</p>
<p>f. 最后一项设置，就是提交整个USPEX的脚本了，很简单的shell脚本，任何一个机器上提交USPEX任务，都可以用这个，只是切记一定要把这个脚本命名好。如果在自己机器上使用了MATLAB把 –o 去掉就行了，-o的意思是使用octave。</p>
<h2 id="3-2-提交USPEX任务"><a href="#3-2-提交USPEX任务" class="headerlink" title="3.2 提交USPEX任务"></a>3.2 提交USPEX任务</h2><p>如果前面一切输入文件准备好了之后，那么我们可以开始了神奇的USPEX变组分结构搜索之旅了。终端输入命令：n nohup .&#x2F;uspex_Lah0.sh &gt;&gt; log &amp;（其中uspex_Lah0.sh就是1.f中提到的提交USPEX任务的脚本）。</p>
<h1 id="四、官方算例1（EX01-3D-Si-vasp）"><a href="#四、官方算例1（EX01-3D-Si-vasp）" class="headerlink" title="四、官方算例1（EX01-3D_Si_vasp）"></a>四、官方算例1（EX01-3D_Si_vasp）</h1><p>案例1，0 GPa下的Si( 一个晶胞里面8个原子)<br>我们先把案例1拷贝到当前目录下：USPEX –c 1</p>
<h2 id="1、输入文件"><a href="#1、输入文件" class="headerlink" title="1、输入文件"></a>1、输入文件</h2><p>其中reference里面是案例1的计算结果，属于参考答案，等下我们来分析一下里面的文件。现在我们先考虑一下，USPEX计算需要哪些文件夹？这里是不是还少了一些文件夹？少哪些了？答案很简单嘛：USPEX –g ，然后我们看看INPUT.txt，了解一下这个案例是做什么的。</p>
<pre><code>第5行、calculationMethod （计算方法）：USPEX（遗传演化算法，也就是遗传、变异遗传算法那套原理的改进版）。
第6行、calculationType（计算类型）：300 （3：三维、0：非分子、0：非变组分）
第7行、optType（优化类型）：1（焓值）
第8行、AutoFrac ？？：我也不记得了。。。不要怕，前面不是讲过怎么查看参数嘛！USPEX -p AutoFrac
第11行、Si：计算的体系的原子类型
第15行、8：计算的体系的原子类型的个数为8
第20行、populationSize (每代多少结构)：20
第21行、numGenerations（要计算多少代）：25 (这个代数，是最多要计算的代数，假如达到收敛的条件，可以在提前结束)
第22行、stopCrit（收敛的条件）：8 （单位：代。意思就是假如连续有8代的最优结构的优化类型（本例中为焓值）是一样，那么证明计算收敛了，可以停止计算了）
第23行、bestFrac（上一代用于生成下一代结构的比例）：0.6 （这个值默认值是0.7，在0.6-0.8之间是合理的）
第27行、fracGene（本代由遗传生产结构的比例）：0.5
第28行、fracRand（本代由晶体对称性随机产生结构的比例）：0.2
第29行、fracAtomsMut（本代由较小的突变产生结构的比例）：0.2
第30行、fracLatMut（本代由点阵突变产生结构的比例）：0.1
特别需要注意的是：fracGene+ fracRand+ fracAtomsMut+ fracLatMut = 1
第35行、计算总能软件的代码：1 1 1 1 1（VASP、采用5步优化，那么Specific应该有哪些文件了？请到入门教程找找）
第39行、计算总能的K点密度设置：0.13 0.11 0.10 0.08 0.06（这个值越低、K点越密集）具体描述如下：USPEX -p KresolStart 。不懂哪个参数就USPEX -p
第43行、运行总能计算软件的指令：一般建议不在这个设置这个参数，直接在Submission文件夹里面提交计算任务的脚本里面改就可以了。
第46行、whichCluster(采用什么计算方式)：一般采用1，同第43行原理。
第47行、numParallelCalcs（并行计算数）：10 (意思就是一次提交10个总能计算任务)
第48行、ExternalPressure（计算外压）：0.00001 (GPa、老朋友啦，不解释了)
</code></pre>
<p>把这个INPUT.txt读完以后，案例1就是搜索包含8个Si原子的晶胞在大气压最稳定的结构。</p>
<p>返回INPUT.txt目录，USPEX计算4大准备目录：AntiSeeds、Seeds、Specific、Submission和提交任务脚本EX01-3D_Si_vasp.sh。</p>
<pre><code>a、AntiSeeds文件夹没特别需要，不用理它；
b、Seeds文件夹，需要从NIMS下载所有稳定的Si结构，最后做成一个POSCARS，具体操作，读者需要自己动动手了，参考入门教程；
c、Specific文件夹本案例中已经准备好了；
d、Submission文件夹，读者需要自己动动手了，参考入门教程。
f、EX01-3D_Si_vasp.sh：本案例已经准备好了，需要注意的一点就是USPEX –r –o &gt;&gt; log / USPEX –r &gt;&gt;log : (Octave/ MATLAB用哪个自己修改)。
</code></pre>
<h2 id="2、计算"><a href="#2、计算" class="headerlink" title="2、计算"></a>2、计算</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup ./EX01-3D_Si_vasp.sh &gt;&gt; log &amp; </span><br></pre></td></tr></table></figure>

<p>在计算的过程中会出现一个重要的文件夹results1，results1里面放的就是计算结果，随着计算的时间的增长，里面会有文件夹generation1、generation2、generation3…，还有一些其他文件。但是肯定包括reference(参考答案)里面的文件，文件夹reference包含了计算结果，但是笔者先提醒一下，本次计算的目的：搜索8个Si原子的晶胞在大气压下最稳定的结构。<br>那么带着目的和INPUT.txt，我们来看一下计算结果。</p>
<h2 id="3、输出文件"><a href="#3、输出文件" class="headerlink" title="3、输出文件"></a>3、输出文件</h2><p>我们先来看最需要的答案：BESTgatheredPOSCARS和BESTIndividuals，这两个文件是定组分变胞计算的最最重要的文件，并且相互对应。</p>
<ul>
<li><p>先看看BESTIndividuals：顾名思义，这个文件里面存着每一代最稳定的结构！</p>
<p>  第1行标题，Gen是generation的缩写，USPEX计算时种群的代数；ID是USPEX计算时给每个结构做的标记，这个数值一般就是整个USPEX计算时产生第几个结构；Origin表示这个结构由什么遗传算法操作产生的；Composition成分；Enthalpy焓值；Volume、Density、KPOINTS这三个看字面意思就能明白了，SYMM代表空间群对称性，这个数字代表1-230个空间群代表；Fitness、Q_entr、A_order 、S_order这些都是代表晶胞有序度相关的量，都是根据fingerprint这篇文章里面定义的(doi:10.1107&#x2F;S0108767310026395)！</p>
</li>
<li><p>好了，我们把标题了解完了，来查看结果：焓值越低，结构越稳定！显然可见第13代（第15行）的ID301结构最稳定，而这个结构是从第12代ID276结构继承来（Origin: keptBest）,那么可以从这个文件里面看到USPEX计算过程中，最稳定的结构一代代遗传演化过程！</p>
</li>
<li><p>既然我们已经得到最稳定的结构的ID是301，那么它的具体原子坐标了？这时候该BESTgatheredPOSCARS出马了！从文件名字意思可以猜出这是最好的结构的原子坐标的集合，当然POSCAR这个就可以看出是以VASP的POSCAR形式存储的。既然我们有ID&#x3D;301这个目标，看一下这个结构在文件里面哪一行？</p>
<p>  <code>grep 301 -n BESTgatheredPOSCARS</code></p>
<p> 在文件里面的193行，现在我们打开文件，定位到这一行。</p>
</li>
<li><p>整个文件是VASP5格式的POSCAR集合，打开文件定位到这一行的时候，ID&#x3D;301这个结构是位于文件的最后，而上一个结构是EA276，上上一个结构是EA254…而EA301是第13代最稳定的结构，EA276是第12代最稳定的结构，EA254是第11代最稳定的结构。。。可以看出BESTgatheredPOSCARS的结构原子坐标和BESTIndividuals每一代的最稳定的结构是一一对应的，那么BESTgatheredPOSCARS里面的结构原子坐标也是一代代最稳定的结构步步演化过程。</p>
</li>
<li><p>把BESTIndividuals和BESTgatheredPOSCARS理解透彻了，其余的文件根据文件名字也能知道里面存放的具体数据是什么。比如文件Individuals里面放的是所有结构的焓值、体积、密度和有序度等信息，gatheredPOSCARS里面放的是所有的结构的原子坐标，Parameters.txt就是INPUT.txt的副本。余下的文件里面值得注意的就是OUTPUT.txt，这个文件是USPEX计算过程的软件自身的log文件。</p>
<p> 里面包含了对于整个USPEX计算的解释，随着每一代计算的结束，OUTPUT.txt。这个文件里面也会有对于这一代计算的总结，整个计算结束以后，USPEX也会做出总结。总而言之，OUTPUT.txt就是log文件，假如不明白USPEX怎么计算的，或者USPEX计算过程出错了，在这里都能找到原因。</p>
</li>
</ul>
<h1 id="五、官方算例2（2-8）"><a href="#五、官方算例2（2-8）" class="headerlink" title="五、官方算例2（2-8）"></a>五、官方算例2（2-8）</h1><h2 id="案例2"><a href="#案例2" class="headerlink" title="案例2"></a>案例2</h2><ul>
<li><p>主要目标：在100 GPa，MgAl2O4（28个原子的单胞）使用GULP(General Utility Lattice Program，<a target="_blank" rel="noopener" href="http://gulp.curtin.edu.au/gulp/%EF%BC%8C%E4%BD%BF%E7%94%A8%E5%8A%9B%E5%9C%BA%E6%96%B9%E6%B3%95%E8%BF%9B%E8%A1%8C%E8%AE%A1%E7%AE%97%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%8C%85%EF%BC%8C%E9%87%8C%E9%9D%A2%E6%9C%89%E5%BE%88%E5%A4%9A%E6%9C%89%E6%84%8F%E6%80%9D%E7%83%AD%E5%8A%9B%E5%AD%A6%E8%AE%A1%E7%AE%97%E5%8A%9F%E8%83%BD%EF%BC%8C%E6%9C%89%E6%9C%BA%E4%BC%9A%E5%86%8D%E4%BB%8B%E7%BB%8D">http://gulp.curtin.edu.au/gulp/，使用力场方法进行计算的软件包，里面有很多有意思热力学计算功能，有机会再介绍</a>) -采用Buckingham势-进行变胞计算。这个案例直接揭示了地球内部物理现象，但是由于力场方法精确性不如DFT方法，所以想要更精确的结果，可以改用VASP一类的软件，同时计算时间会增长不少！</p>
</li>
<li><p>看完案例的简单介绍，我们来读一下INPUT.txt，复习一下定成分变胞计算怎么设置参数。</p>
<p>第4行、 calculationMethod （计算方法）：USPEX（遗传演化算法，也就是遗传、变异遗传算法那套原理的改进版）。<br>第5行、calculationType（计算类型）：300 （3：三维、0：非分子、0：非变组分）<br>第6行、optType（优化类型）：1（焓值）<br>第7行、AutoFrac：1（允许系统自动变异演化，比用户自定义的快2倍）。一般建议设置为1即可。<br>第10行、Mg  Al  O：计算的体系的原子类型<br>第14行、4  8  16：计算的体系的Mg、Al、O的个数分别为4、8、16，也就是体系的原子总数为28的MgAl2O4。<br>第19行、populationSize (每代多少结构)：40<br>第20行、numGenerations（要计算多少代）：60 (这个代数，是最多要计算的代数，假如达到收敛的条件，可以在提前结束)<br>第21行、stopCrit（收敛的条件）：30（单位：代。意思就是假如连续有30代的最优结构的优化类型（本例中为焓值）是一样，那么证明计算收敛了，可以停止计算了）<br>第22行、bestFrac（上一代用于生成下一代结构的比例）：0.6 （这个值默认值是0.7，在0.6-0.8之间是合理的）<br>第26行、fracGene（本代由遗传生产结构的比例）：0.5<br>第27行、fracRand（本代由晶体对称性随机产生结构的比例）：0.2<br>第28行、fracPerm（本代由置换产生结构的比例）：0.1<br>第29行、fracAtomsMut（本代由较小的突变产生结构的比例）：0.2<br>特别需要注意的是：fracGene+ fracRand+ fracPerm+ fracAtomsMut &#x3D; 1<br>第35行、计算总能软件的代码：3 3 3 3 （GULP、采用4步优化，那么Specific应该有哪些文件了？等下介绍）</p>
<p>以上就是USPEX所有用于结构优化的软件包<br>第39行、运行总能计算软件的指令：一般建议不在这个设置这个参数，直接在Submission文件夹里面提交计算任务的脚本里面改就可以了。<br>第43行、numParallelCalcs（并行计算数）：1(意思就是一次提交1个总能计算任务，计算效率太低，建议设置16个左右)。<br>第44行、whichCluster(采用什么计算方式)：一般采用1，同第43行原理。<br>第45行、ExternalPressure（计算外压）：100 (GPa)</p>
<p>把INPUT.txt读完以后，案例2和案例1计算类型和参数设置几乎都是一样，但是需要注意的这次是采用GULP来计算的，那么问题来了！</p>
<p><strong>问题1. Seeds 和AntiSeeds里面的种子文件采用的是GULP格式的吗？</strong></p>
</li>
</ul>
<p>答：不是！还是VASP5 格式的POSCARS。另外提醒一下，种子文件都是POSCARS的形式，跟采用何种结构优化软件包无关！</p>
<p>  <strong>问题2. Specific里面的文件怎么设置？</strong></p>
<ul>
<li><p>GULP计算时，ginput 和goptions一一对应，文件夹里面的文件还和INPUT.txt里面的4次结构优化对应。<br> 文件夹Submission的文件需要读者自己根据自己机器去修改了，然后假如读者机器里面有GULP的话，可以提交任务计算结果和reference对比一下。笔者在此不多说，直接看reference文件夹。</p>
<p>里面的文件和案例2的文件都是一样的，可见定成分变胞计算结果都是由这些文件组成的。现在我们看看结果文件BESTIndividuals和BESTgatheredPOSCARS，其余文件就不再介绍了。</p>
<p>从文件BESTIndividuals中可以看出到了第34代计算停止，之前30代的结构的焓值计算是一样，与INPUT.txt中stopCrit参数值30是对应的。既然有第34代最稳定结构的ID&#x3D;1562，那么根据ID&#x3D;1562去BESTgatheredPOSCARS中找结构，直接到文件最后找一下，另存ID&#x3D;1562的结构信息为一个文本文件，然后拖到VESTA，可以很直观的看到计算出的最稳定的结构究竟长什么样！</p>
</li>
</ul>
<h2 id="官方算例3"><a href="#官方算例3" class="headerlink" title="官方算例3"></a>官方算例3</h2><p>案例3：MgSiO3（每个单胞有20个原子）使用GULP(采用Buckingham势)在知道结构参数的条件下进行结构预测。这个结构的晶格参数和后钙钛矿一致。后钙钛矿的发现（Oganov &amp; Ono, Nature 2004; Murakami et al., Science 2004）在地球科学领域是一个重大突破。<br>我们直接来来读一下INPUT.txt：</p>
<pre><code>第11-13行、symmetries：16-74。第一次出现，设置生成结构的晶体对称性。三维晶体的取值范围：2-230。
第42-44行、Latticevalues：2.474 8.121 6.138 90.0 90.0 90.0 = b, c, alpha, beta, and gamma values。此参数仅用作初始猜测，仅影响第一代，USPEX计算的每个结构都经过充分优化，并采用与（自由）能量最小值相对应的晶体参数。INPUT.txt中其他的参数都在案例2中讲解过一次了，就不再解释了。下面我们来继续看一下结果！
</code></pre>
<p>可以看出，案例3总共计算20代，共626个结构，得到最稳定的结构的原子结构之后，可以去计算MgSiO3其他的性质。</p>
<h2 id="其他算例解释"><a href="#其他算例解释" class="headerlink" title="其他算例解释"></a>其他算例解释</h2><p><strong>案例4</strong>：预测16个C原子的最稳定的晶胞，但是使用LAMMPS优化结构计算能量，跟案例2、案例3基本上一样的，就不多介绍了!</p>
<p><strong>案例5</strong>：预测8个Si原子的最稳定的晶胞，但是ATK里面的tight binding近似方法来优化结构计算总能，不多解释啦！</p>
<p><strong>案例6</strong>：预测10 GPa下8个C原子的最稳定的晶胞，但是使用CASTEP优化结构计算能量，你懂的!</p>
<p><strong>案例7</strong>：预测8个Si原子构成的二维晶体在0 GPa下最稳定的结构。<br>这个案例有点不一样，我们来直接看一下INPUT.txt，再讲一下不一样的参数怎么构成不一样的计算。</p>
<pre><code>第5行、calculationType：-200。
这个为什么是-2，没这个维数取值呀？不懂直接USPEX –p calculationType！

可以看到2是表面结构，而-2是二维晶体结构，至于二维晶体和表面结构有什么区别？这个问题笔者不能很通俗易懂告诉大家，只能告诉你在USPEX中，二维晶体计算既不需要端点参考能也不需要衬底，而只需设置二维初始结构的厚度即可，而表面计算需要！

第7行、thicknessS：3.0。初始层厚度，最后一个是大写的S，因为是Start的缩写。


第10-12行、vacuumSize：8 9 10 12（20）？。设置真空层厚度，这是二维晶体和表面计算必须要设置的，不然的话，没有真空层，就会有作用力，计算的也就不是二维晶体。而这个参数，这里貌似设置错误了，少了1个参数。
</code></pre>
<p><strong>既然，我们读完INPUT.txt，那么有一个问题出来了：Seeds里面的文件怎么去设置了？还是POSCARS，里面还是放所有稳定的Si原子结构！</strong></p>
<p>我们现在来看一下结果！总共计算了13代共295个结构。那么最后一代稳定的结构长什么样了？显然POSCAR的原子坐标，根本看不出什么，而单胞结构示意图也看不出是二维晶体，做一个3x3x3的超胞，可以看出这就是一个二维晶体！USPEX多么神奇！</p>
<p><strong>案例8</strong>： 36个Mo原子的纳米粒子结构预测。使用Lennard-Jones对势函数的GULP进行结构优化。<br>这个案例值得看一下INPUT.txt。</p>
<pre><code>第5行、calculationType：000。纳米颗粒结构计算。

第36-38行、vacuumSize：10 10 11 12 12。真空厚度，案例7已经提到了，显然这个案例中真空层厚度值设置正确了。

这个计算结果，显示在第7代一下突然找到低焓值的结构，然后一直持续到了26代，总共有20代的最稳定的结构的焓值是一样。所以到了第26代计算结束了。而我们查看第26代最稳定的结构示意图如下，也真是纳米颗粒结构！
</code></pre>
<p><strong>总结</strong>：</p>
<pre><code>案例2：在100 GPa，MgAl2O4（28个原子的单胞）使用GULP采用Buckingham势-进行变胞计算。（calculationType：300）
案例3：MgSiO3（每个单胞有20个原子）使用GULP(采用Buckingham势)在知道结构参数的条件下进行结构预测。（calculationType：300）
案例4：预测16个C原子的最稳定的晶胞，但是使用LAMMPS优化结构计算能量。（calculationType：300）
案例5：预测8个Si原子的最稳定的晶胞，但是ATK里面的tight binding近似方法来优化结构计算总能。（calculationType：300）
案例6：预测10 GPa下8个C原子的最稳定的晶胞，但是使用CASTEP优化结构计算能量。（calculationType：300）
案例7：预测8个Si原子构成的二维晶体在0 GPa下最稳定的结构。（calculationType： -200）
案例8：36个Mo原子的纳米粒子结构预测。使用Lennard-Jones对势函数的GULP进行结构优化。（calculationType： 000）
</code></pre>
<p>其实可以看出，USPEX刚开始开发的时候，主要是用于定组分变胞的三维晶体最稳定的结构预测，后来功能慢慢的扩展开来，能够预测二维晶体、纳米粒子结构以及后面要讲案例中有关分子结构的预测、进化准动力学方法、表面结构预测、三元变组分结构预测方面的内容。</p>
<h1 id="六、官方算例（9-13）"><a href="#六、官方算例（9-13）" class="headerlink" title="六、官方算例（9-13）"></a>六、官方算例（9-13）</h1><p><strong>案例9</strong>：预测有4个甲烷分子的单胞在20 GPa下最稳定结构，结构优化采用的是VASP。<br>分子？这个我们还是第一次遇到，现在来看看怎么一回事？</p>
<p>可以看到案例9多出一个MOL_1的文件，现在我们先看看这个MOL_1文件有些什么：<br>这个文件在手册里面第5章里面有介绍，也可以在线观看（<a target="_blank" rel="noopener" href="https://uspex-team.org/online_utilities/uspex_manual_release/ChineseVersion/uspex_manual_chinese_V10.2/sect0029.html%EF%BC%89%EF%BC%8C%E9%87%8C%E9%9D%A2%E8%BF%98%E4%BB%8B%E7%BB%8D%E6%80%8E%E4%B9%88%E9%80%9A%E8%BF%87XYZ%E5%9D%90%E6%A0%87%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%96%87%E4%BB%B6%E6%9D%A5%E5%88%9B%E5%BB%BAUSPEX%E4%BD%BF%E7%94%A8%E7%9A%84MOL%E6%96%87%E4%BB%B6%E3%80%82%E6%89%8B%E5%86%8C%E4%B8%8A%E9%9D%A2%E8%BF%99%E5%9D%97%E8%AE%B2%E7%9A%84%E6%8C%BA%E9%BA%BB%E7%83%A6%E7%9A%84%EF%BC%8C%E8%AE%A9%E7%AC%94%E8%80%85%E6%91%B8%E4%B8%8D%E7%9D%80%E5%A4%B4%E8%84%91%EF%BC%8C%E6%AF%95%E7%AB%9F%E7%AC%94%E8%80%85%E5%AF%B9%E4%BA%8E%E5%88%86%E5%AD%90%E6%8E%A5%E8%A7%A6%E7%9A%84%E5%B0%91%E3%80%82%E4%BD%86%E6%98%AF%E4%BB%8E%E6%9C%B1%E5%BC%BA%E5%8D%9A%E5%A3%AB%E7%9B%B8%E5%85%B3%E8%AE%BA%E6%96%87%E4%B8%AD%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AF%BB%E5%88%B0%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6%E8%AE%BE%E7%BD%AE%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9A%E5%9C%A8USPEX%E4%BA%A7%E7%94%9F%E5%88%86%E5%AD%90%E7%BB%93%E6%9E%84%E7%9A%84%E6%97%B6%E5%80%99%E8%BF%9B%E8%A1%8C%E7%BA%A6%E6%9D%9F%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%A4%A7%E5%A4%A7%E9%99%8D%E4%BD%8E%E6%90%9C%E7%B4%A2%E7%A9%BA%E9%97%B4%EF%BC%8C%E5%87%8F%E5%B0%91%E8%AE%A1%E7%AE%97%E9%87%8F%EF%BC%9B%E5%85%B6%E6%AC%A1%EF%BC%8C%E4%BB%BB%E4%BD%95%E5%88%86%E5%AD%90%E7%9A%84%E8%83%BD%E9%87%8F%E5%80%BC%EF%BC%8C%E9%83%BD%E8%A6%81%E6%AF%94%E5%85%B6%E5%88%86%E8%A7%A3%E4%B8%BA%E6%B0%B4%E5%92%8C%E7%9B%90%E7%9A%84%E5%8C%96%E5%90%88%E7%89%A9%E7%9A%84%E8%83%BD%E9%87%8F%E5%80%BC%E4%BD%8E%E3%80%82">https://uspex-team.org/online_utilities/uspex_manual_release/ChineseVersion/uspex_manual_chinese_V10.2/sect0029.html），里面还介绍怎么通过XYZ坐标格式的文件来创建USPEX使用的MOL文件。手册上面这块讲的挺麻烦的，让笔者摸不着头脑，毕竟笔者对于分子接触的少。但是从朱强博士相关论文中，可以读到这个文件设置的作用：在USPEX产生分子结构的时候进行约束，这样大大降低搜索空间，减少计算量；其次，任何分子的能量值，都要比其分解为水和盐的化合物的能量值低。</a></p>
<p>进行分子结构预测时的INPUT.txt又需要注意哪些呢？</p>
<pre><code>第5行、calculationType：310 三维分子定组分。
第14行、numSpecies：1 4，这个官方案例有点问题，少了一个1，知道为啥不？
第35-38行、IonDistances，设置不同原子类型之间的最小原子间距离矩阵，而低于离子距离低于这个距离都被认为没有物理意义的，将被忽略！这里只有两种原子，所以只设置两行就行！第36行的2.0，表示C原子和C原子之间的最小距离，1.7表示C原子和H原子之间的最小距离；第37行的0.7表示H原子和H原子之间的最小距离。这些值都要比真实健值要小！

第40-42行、MolCenters，设置分子中心之间最小距离的矩阵，而任何低于这值的距离都表明分子有很大的重叠，是没有物理意义的，将被严格避免！第41行的2.8表示CH4的最小距离，单位为埃。进行分子结构预测时，这个必须设置！

INPUT.txt其余的参数在前面的案例中，已经介绍了。可以看出结构优化时，计算CH4结构的能量采用的是VASP，那么Specific文件夹里面就是INCAR五部曲和C、H原子的赝势！当然进行计算时，Seeds文件夹依旧是POSCARS，里面放的是C、H原子的最稳定的结构！可以看到除了多了MOL_1文件和INPUT.txt部分参数不一样外，分子结构预测跟其他晶体预测设置不一样？
</code></pre>
<p>下面我们来看看参考结果的reference文件夹：</p>
<p>里面也有MOL_1文件，这个是从之前的那个MOL_1拷贝过来的。其余的文件格式和内容与之前介绍的定成分计算的文件格式和内容都是一样！</p>
<p>案例9总共计算了9代197个结构，其中最稳定的结构也是这个对称性最低的CH4。</p>
<p><strong>案例10</strong>：预测有8个甲烷分子的单胞在常压下最稳定结构，结构优化采用的是DMACRYS；跟案例9类似，就不介绍了！</p>
<p><strong>案例11</strong>：预测有2个尿素分子的单胞在常压下最稳定结构，结构优化采用的是TINKER；跟案例9、10类似，就不介绍了！</p>
<p><strong>案例12</strong>：预测Mo-B二元体系常用最稳定的结构，变组分的结构预测，结构优化是采用Lennard-Jones对势的GULP做的。<br>案例12跟入门教程的La-H二元体系变组分结构预测是相似的，只是结构优化软件的软件包是不一样的，所以INPUT.txt就不介绍了。而在La-H二元变组分结构预测中，没来得及对计算结果进行分析，这次就在本教程对变组分的结果进行详细讨论。</p>
<p>我们先看参考答案reference文件夹里面有哪些文件：</p>
<p>这次文件夹里面有很多文件，又有些文件和定组分不同，但是对于变组分结构预测而言，只有extended_convex_hull、extended_convex_hull_POSCARS、extendedConvexHull.pdf和OUTPUT.txt这四个文件最重要，彻底掌握了这四个文件就掌握了变组分结构预测的结果分析。</p>
<p>下面先来看看老朋友OUTPUT.txt，看一下Mo-B变组分运算过程的信息：</p>
<p>可以看到总共计算了60代共5287个结构，最后列出来最稳定的成分，也就是凸包线点：Mo4、B6、MoB14、Mo4B8、Mo4B4、Mo2B6。（ps: 凸包线上稳定的单胞）。那么现在读者肯定很想知道凸包线是什么？直接打开extendedConvexHull.pdf！</p>
<p>图中绿色的点就是本次计算的结构的，而最下面的那条黑色就是凸包线，位于这条线上的点就是热力学上稳定的结构。在本图中从左到右总共有6个落在线上的点，和OUTPUT.txt里面的6个稳定的成分是相对应的。读者应该知道能够很清楚的知道X轴代表什么意思，怎么计算的。而Y轴形成焓（Enthalpy of formation，eV&#x2F;atom）是由下面公式计算出来的：<br>Y &#x3D; (E(AxBy)-x<em>E(A)-y</em>E(B))&#x2F;(x+y)<br>在案例12中，x: Mo原子的个数，y:B原子的个数。</p>
<p>而凸包线画法麻烦一点，先从两个端点开始，连接焓值最低点，然后找到端点到焓值最低点这段直线中下方最远的点，连线。迭代下去，直到没有一个点位于凸包线下面！<br>这条线的做法决定了稳定的结构都位于凸包线上。 假如有一个稳定的点在凸包线上方，那么它很容易分解为距离这个点最近的凸包线上的两个稳定点，有点类似直线方程的意思。</p>
<p>读者需要仔细体会上面一段内容，因为理解了上面的观点也就明白了变组分结构预测中凸包线的意思，那么一大堆相关论文也就会明白了。<br>既然我们得到知道稳定的成分，那么它们具体的结构是什么了？先看一下extended_convex_hull文件：</p>
<p>这个文件有些意思，第1-4行解释了extended_convex_hull文件的X、Y和Fitness这些标题的含义，其中X、Y和extendedConvexHull.pdf中X、Y轴是一一对应的，而Fitness这个就是结构离凸包线的距离，值为0意思就是在凸包线上，而值大于0就是在为凸包线上方，那么一个小小的思考题来了：为什么这个文件中没有Fitness值小于0的？（提示：思考凸包线的画法）</p>
<p>现在我们把注意放在第7-12行，因为它们Fitness的值为0，也就是说它们就是凸包线上的点。再看一下它们的Compositions和Enthalpies值，与OUTPUT.txt里面的值是一一对应的，综合以上信息，可以确定以上6个结构就是我们要找的稳定结构。从第13行往后就是根据Fitness从小到大排下去的，也可以认为这是根据稳定性排下去的，当然大部分情况下，这些结构都是不需要考虑的！既然我们知道要找到的稳定结构，那么怎么找到这些结构的原子坐标？这就需要看看extended_convex_hull_POSCARS了：</p>
<p>整个文件就是POSCAR的集合，并且每个结构的表头和之前的BESTgatheredPOSCARS是一样的，再加上第1行和第25行的ID，与extended_convex_hull里面前两个稳定结构的ID是一一对应的，那么显而易见extended_convex_hull_POSCARS文件和extended_convex_hull文件里面的结构是一一对应的。</p>
<p>既然知道这些预测出的稳定新结构了，就可以继续通过DFT计算它们的性质，然后得到数据，发Paper了，这还不简单？<br>这就是变组分结构预测需要了解和处理的文件：extended_convex_hull、extended_convex_hull_POSCARS、extendedConvexHull.pdf和OUTPUT.txt。除了凸包线画法需要用心体会，其余很简单吧！</p>
<p><strong>案例13</strong>：USPEX能很容易地找到最无序的合金结构。这个案例只是为了演示TixCo(1-x)O。您需要在&#x2F;Seeds&#x2F;POSCARS中指定初始结构，并且只使用置换突变操作。（在这种情况下，不需要使用任何外部代码。在这个例子中，我们优化（最小化）结构有序度（Oganov and Valle（2009）；Lyakhov Oganov Valle（2010））而不需要进行结构优化（abinitioCode&#x3D;0）。种子结构（Ti-Co-O结构的超级细胞）中的Ti原子和Co原子被置换，以寻找具有最小的有序度。在这种情况下最小化有序度，我们得到了“特殊准随机结构”的广义形式。）</p>
<p>这个案例的说明比较饶舌，还是直接看INPUT.txt吧：</p>
<pre><code>第6行、optType: -4，寻找有序最小的结构！因为4是寻找有序度最大的结构，所以-4是相反的意思。
第30行、howManySwaps：15，设置为这个值，是因为在第29行设置本次计算的子代结构都是通过交换父代结构中的原子产生的。本次计算的Co16Ti16O64的单胞，总共有96个原子，这个值占比15%左右。

第32-34行、specificSwaps：

1 2，指明只有Co、Ti原子能进行置换。
</code></pre>
<p>其余没有什么新鲜的参数要介绍了，不过读者可能会注意到，本次并没有进行结构优化，或者说是调用外部软件进行计算。都是USPEX通过自己的Fingerprint算法来计算有序度，这个具体是怎么一回事？可以参考这个在线网址(<a target="_blank" rel="noopener" href="https://uspex-team.org/online_utilities/fingerprints2/)%E3%80%82">https://uspex-team.org/online_utilities/fingerprints2/)。</a></p>
<p>好了，再把Seeds&#x2F;POSCARS文件准备好：放入Co、Ti、O原子所有稳定的结构信息进去就OK了。至于计算，本地计算就可以。我们先来看看结果吧（由于这次是300计算，结果只是需要关注BESTIndividuals、BESTgatheredPOSCARS、OUTPUT.txt），先看一下BESTIndividuals文件：</p>
<p>可见BESTIndividuals文件还是跟以前，到文件末尾总共有50代 (本图志截取到19代 )，那么问题又来了，我们需要预测的结构长什么样了？我们接着打开BESTgatheredPOSCARS文件：可以看出这个结构还是比较复杂的，有点无序的感觉，有点高熵合金的感觉。</p>
<p><strong>总结</strong>：</p>
<pre><code>案例9：预测有4个甲烷分子的单胞在20 GPa下最稳定结构，结构优化采用的是VASP。310
案例10：预测有8个甲烷分子的单胞在常压下最稳定结构，结构优化采用的是DMACRYS； 310
案例11：预测有2个尿素分子的单胞在常压下最稳定结构，结构优化采用的是TINKER； 310
这三个都是分子结构预测：310类型的，所以只详细的介绍了310。

案例12：预测Mo-B二元体系常用最稳定的结构，变组分的结构预测，结构优化是采用Lennard-Jones对势的GULP做的。301
这个案例主要是介绍了结果分析，其中关于凸包线的那段值得读者思考一下，弄明白了，很多Paper都能理解了。

案例13：预测最无序的TixCo(1-x)O合金结构。300
这个案例主要介绍无序结构预测，有点准随机的感觉，目前笔者感觉其在高熵合金方面有潜在用途。
</code></pre>
<h1 id="七、官方案例讲解（14-15）"><a href="#七、官方案例讲解（14-15）" class="headerlink" title="七、官方案例讲解（14-15）"></a>七、官方案例讲解（14-15）</h1><p><strong>案例14</strong>：通过进化准动力学(Evolutionary metadynamics)预测下常压下Si的低能亚稳结构，结构优化采用的是VASP。<br>这个案例就是为了展示Evolutionary Metadynamics强大的威力，其实最近为了演示水分子结晶问题这一科学热点问题，Metadynamics出了很大一把力。下面还是闲话少说，我们来看看怎么设置计算和分析结果的。<br>先看一下INPUT.txt</p>
<pre><code>第1行、calculationMethod: META，第一次看到不是USPEX，而是META(Evolutionary metadynamics)。
第8行、minVectorLength: 2.0，设置生成的子代结构最短的健长

第9行、maxVectorLength：8.0，这个值是Evolutionary metadynamics独有的，是设置最大的健长，假如在进化准动力学计算中，单胞的健长没有处在最小健长和最大健长之间，那么在计算时，软件会自动校正，使晶胞进入正常的范围。


第15行、mutationDegree：3.0、设置软模突变(softmutation)的程度，单位为埃。简单一点的意思就是设置晶格某个原子位置方向的突变距离。在Evolutionary metadynamics算法中，晶胞都是通过软模突变生成子代结构的。


第16行、：GaussianHeight：250.0，进化准动力学专门的参数，用来促进晶胞相变，具体的值跟晶格常数和剪切模量相关。

第17行、GaussianWidth：0.3。有高斯高度，那么肯定会有一个高斯宽度了！作用和GaussianHeight一样，但是这个参数只和晶胞最小长度有关。

第18行、FullRelax：2，metadynamics原理是晶胞在某个方向上，长度发生变化，然后进行固定体积结构优化。而这个FullRelax就是设置结构优化的程度，可以理解为精度，0：精度最低，1：精度一般，2：精度可靠，大部分计算都采用2。
</code></pre>
<p>好了，进化准动力学参数介绍就介绍了到这里了。但是读者可能会有点好奇，这里为什么我们没有设置体系？ 因为不需要！META计算类型，计算很特别的:</p>
<p>不需要设置Seeds&#x2F;POSCARS文件，因为计算时一般采用POSCAR_1作为初始结构，然后通过软模突变(softmutation)生成子代结构，然后结构优化，选择最稳定结构迭代下去，另一个需要注意的是这个计算截止条件是INPUT.txt里面设置的代数。</p>
<p>好了我们来处理一下结果，这里需要提一句的就是，进化准动力学是寻找跟初始结构相差不是很大的亚稳结构，因而每一代焓值最低的结构都要考虑。我们来看一下参考文件夹reference</p>
<p>这里面有很多文件很熟悉，看着名字也能猜出文件里面放的是什么，那么META(进化准动力学) 最重要的文件就是BESTIndividuals_relaxed 和BESTgatheredPOSCARS_relaxed这两个文件，不过我们先看一下BestEnthalpy.pdf</p>
<p>这个图片，绿色的点连成的红色虚线是未完全弛豫的最好结构的焓值，而蓝色的线则是完全弛豫结构的焓值。<br>接着打开BESTIndividuals_relaxed，熟悉的味道：</p>
<p>打开BESTgatheredPOSCARS_relaxed也还是熟悉的味道，就不多解释了。</p>
<p>不过这样打开展示结果并不是一个很好的方式，也许在BestEnthalpy.pdf的图片中添加亚稳结构的示意图会更有意思，更直观，但是不在这个教程演示了，会在案例21：EX21-META_MgO_gulp里面展示，并总结一下META方法和USPEX方法之间的对比。</p>
<p>BESTgatheredPOSCARS_relaxed就是案例9计算最后得到的亚稳结构，在研究中，所有的这些结构都需要考虑。也许有人会感觉这个META方法有点鸡肋，但是在研究相变的时候，尤其是水分子结晶过程，这个方法很有用！</p>
<p><strong>案例15</strong>：通过VCNEB (variable-cell nudged elastic band)预测下常压下Ar的fcc-hcp的转变过程，结构优化采用的是GULP，并采用Lennard-Jones对势。<br>闲话少说，我们先看看INPUT.txt是怎么一回事：</p>
<pre><code>第18行、vcnebType：111，指定VCNEB计算的类型。此变量由三个指标组成：计算选项（1：VCNEB方法，2：没有VCNEB计算的结构优化模式）、虚像结构数目的可变性（0：VCNEB虚像结构的数目是固定的，1：VCNEB虚像结构的数目是固定的是可变的）和弹簧常数的可变性（0：固定的弹性常数，1：可变的弹性的常数）；111，一般是推荐在重构相变（reconstructive phase transitions）上使用。重构相变：在热力学上，重构相变在相变压力/温度下呈现出焓和体积 “跳跃”变化的特征，其中，由于原子位置的变化，自由能一阶导数（熵和体积）存在不连续性。

第19行、numImages：15，执行VCNEB的初始虚像的结构的数目。
第20行、numSteps：500，执行VCNEB计算相变路径优化时的最大步数，由于VCNEB计算的过程收敛比较慢，所以一般推荐设置为500。
第21行、optimizerType：1，结构优化采用的算法：1、最速下降法，2、FIRE (Fast Inertial Relaxation Engine)。
第22行、optReadImages：2，虚像结构文件（Images）类型读取选项：0，文件中包含了所有的虚像结构，1，文件中只包含初始和最后的虚像结构，2，文件包含了初始、最后和特别指定中间虚像结构。其中选项1，2其余的虚像结构都是通过线性插值获得。
第23行、optRelaxType：3，结构优化的模式，选项：1，晶胞固定只优化原子位置，经典的NEB的方法；2，只优化晶胞点阵大小（仅仅用作测试）；3，晶胞点阵大小和原子位置都优化（变胞优化）。
第24行、dt：0.25，结构优化的时间步，设置的值太小时收敛很慢，设置很大的时候经常产生没意义的相变路径。
第25行、ConvThreshold：0.003，整个VCNEB计算收敛的标准：RMS（Root Mean Square forces）。
第29行、VarPathLength：0.3，变虚像结构方法的虚像结构的路径长度批判准则。当两个相邻虚像结构之间的长度大于VarPathLength的1.5倍时，将使用线性插值方法在两个虚像结构之间添加一个新虚像结构；当长度小于该值的0.5时，将删除第二个虚像结构。
第30行、K_min：3，单位：eV/A^2，最小的弹性常数，只在变弹性常数的VCNEB中使用。
第31行、K_max：6，单位：eV/A^2，最大的弹性常数，只在变弹性常数的VCNEB中使用。
第32行、optFreezing：0，达到收敛标准时，虚像结构是否还变动，0：变，1：不变。
第33行、optMethodCIDI：0，是否采用Climbing-Image (CI)/ Downing-Image (DI)方法，推荐使用0：CI/DI方法不采用。具体讲解如下：
</code></pre>
<p>到此案例15的VCNEB计算参数介绍也算完成了，VCNEB就是用来研究固体相变和反应路径的，比NEB更高级一点。<br>设置完了INPUT.txt，就可以准备计算了，但是需要注意VCNEB计算不需要设置种子文字Seeds，需要设置一个Images的文件，也就是虚像结构文件，包括初始虚像结构和最终虚像结构，（VCNEB就是计算初始结构和最终结构之间的相变路径的），其采用的是VASP4的POSCAR形式，如下图所示：</p>
<p>计算完之后，我们来看看结果!</p>
<p>里面有很多文件，我们不认识，但是没关系的，很多文件通过文字名字也能了解很多，我们一般只熟悉EnergyBarrier.pdf和transitionPath_POSCARs即可，因为EnergyBarrier.pdf里面放的是反应路径中虚像结构和能量的图，而transitionPath_POSCARs则是这个反应路径中对应的虚像结构的POSCAR文件。综合EnergyBarrier.pdf和transitionPath_POSCARs这两个文件，可以得到如下漂亮的结果：</p>
<p>图中，展示了初始、最终和中间鞍点的Ar结构，其余结构就没多做演示了。但是从这个这个图可以看出VCNEB计算相变路径的强大的能力。但是为什么选择这个路径了？从计算结果文件里面查看PATH这个文件夹内容，就会发现有500个相变路径（和INPUT.txt的参数numSteps对应），但是最后还是找到EnergyBarrier的反应路径（step 434），因为这个是实际情况最接近了，也可以从SelectedEnergyBarrier.pdf文件里面直观看出来为什么选择step 434：</p>
<p>从初始的fcc-Ar结构怎么变成了最后的hcp-Ar结构了？VCNEB给出最佳路径和中间反应的一系列的结构是不是真实的？从这个方法的程序编写者钱博士（虽然他现在不从事科研，去做人工智能创业）的PPT中可以看到VCNEB还是比较有用的：</p>
<p>上面讲了很多VCNEB在USPEX程序中的参数设置和简单的结果的文件分析，但是这个VCNEB方法跟NEB有什么区别了？或者说它的原理是什么了？可以看出在Update Images这个过程当中使用的进化算法进行迭代，其余过程和NEB计算过程都差不多。还有一个特别值得一提的是：VCNEB能够给出一个相对可靠的相变路径，但是结合TPS（Transition Path Sampling）方法，能够给出更可靠的相变路径，这是这个方法存在的意义！</p>
<p><strong>总结</strong>：</p>
<pre><code>案例14：通过进化准动力学(Evolutionary metadynamics)预测下常压下Si的一系列低能亚稳结构，结构优化采用的是VASP。
案例15：通过VCNEB (variable-cell nudged elastic band)预测下常压下Ar的fcc-hcp的相变路径，结构优化采用的是GULP，并采用Lennard-Jones对势。
</code></pre>
<p>这两个案例比较特殊，分别介绍了META、VCNEB两个计算方法，虽然目前这两个方法用的人比较少，但是笔者相信，这两个方法对于某些工作绝对是一个有力的工具。</p>
<h1 id="八、官方案例讲解（16-18）"><a href="#八、官方案例讲解（16-18）" class="headerlink" title="八、官方案例讲解（16-18）"></a>八、官方案例讲解（16-18）</h1><p><strong>案例16</strong>：变胞定组分预测SrTiO3（50 原子&#x2F;单胞 ）0 GPa下稳定的结构，结构优化采用的是GULP（采用Buckingham势）。（这个案例存在的意义就是为了吊打XtalOpt：也是遗传算法的结构预测软件，USPEX大体系的成功率大于90%，而XtalOpt只有7-12%）。<br>案例16是300类型，我们的老朋友了，就不介绍INPUT.txt了，直接来看结果吧。300类型的计算，结果需要看哪些文件了？BESTIndividuals和BESTgatheredPOSCARS！</p>
<p>从BESTIndividuals可以看到本次计算了42代结构，计算了大概1400多个结构，最后得到如下的稳定结构：</p>
<p>可见对于单胞50个原子这么大的结构，USPEX也能很快得到稳定的结果，而其中执行结构优化的GULP也功不可没呐。</p>
<p><strong>案例17</strong>：以最高德拜温度为目的变胞定组分预测单胞8个C原子的稳定结构，结构优化采用VASP软件包。</p>
<p>案例17还是300类型的计算，但是这次是预测具有最高德拜温度的温度结构，那么也只需要在optType参数中，将我们通用的以焓值为优化目的改为以德拜温度为目的就行了。其余的话，参数设置和一般300类型类似。但是这次需要对Specific文件里面的INCAR做一次了解，因为根据INCAR也能猜测出USPEX究竟怎么计算的。</p>
<p>Specific文件里面有5个INCAR，可以看出第一次和第二次是定体积的结构优化，而第三次和第四次结构优化是变体积的，经过这四步结构优化得到最小能量和相应的构型，最后才做弹性常数计算，因为德拜温度和弹性常数计算相关（当然这些计算是在VASP当中完成的）。</p>
<p>从OUT.txt中可以看出USPEX总共计算了15代共351个结构，这样计算量并不大，因为这个案例是作为演示用的，INPUT.txt里面设置的代数和每代个数并不多。</p>
<p>300计算类型的还需要看的就是BESTIndividuals和BESTgatheredPOSCARS这两个文件。先来看看BESTIndividuals这个文件：</p>
<p>由于这次是根据德拜温度为目标进行稳定结构预测，那么就是根据Fitness大小程度来筛选德拜温度最高的稳定结构，Fitness负的越大的结构，德拜温度更高，接下来我们来看看这个德拜温度最高的稳定结构长什么样？</p>
<p>可以看出只需要在optType参数里面修改优化参数就能获得具有相应特殊性质的稳定结构，这些特殊性质包括：</p>
<p><strong>案例18</strong>：三元体系Zn-O-H的变成分结构预测，结构优化还是采用GULP软件进行的。</p>
<p>由于变组分结构预测这方面非常非常重要，我们前面也介绍过两次了，但是这次准备继续再一次仔细介绍一下，因为大部分USPEX文章都是靠这个变组分结构预测方法产生。先来看看INPUT.txt文件：</p>
<pre><code>第4-17行是设置整个大的计算类型和体系，也就是让软件知道采用USPEX方法进行301计算，以焓值最低为目的进行优化（焓值越低越稳定）。而计算哪个体系？Zn-O-H，这三个元素以任意比例构成的结构。
第21-25行是设置USPEX遗传算法种群大小和代数。
第29-33行是设置遗传算法的产生子代结构的具体操作。
第37-46行是设置外挂的第一性原理软件。
</code></pre>
<p>USPEX的参数设置总结起来就是，先设置体系和类型，再设置种群和遗传操作，最后设置外挂的第一性原理软件，当然从官方案例拷贝一个类型的INPUT.TXT修改一下就行，不懂的参数USPEX –p xxx，就这么简单。</p>
<p>前面介绍过二元体系的变组分结构预测的结果处理，强调了凸包线的原理和作用，而此次是三元体系的变组分结构预测，还是凸包线吗？想想也是不可能，只能往三元金字塔相图那边想，预测结果最直观的展示就是打开compositionStatistic.pdf文件：</p>
<p>当然看到这个图，肯定会有点懵逼的感觉了，这个图要表达什么意思，这个Stable的结构到底是哪个了？不要着急，这个只是展示结构分布的图，具体的稳定的结构从OUTPUT.txt可以得到的：</p>
<p>这里需要抱怨一下USPEX开发者吧，这里数据并没有处理，三元体系的稳定的结构的成分为三种元素构成，前两个是整数，后一个为啥是小数了？虽然最后一位是小说看起来很别扭，但是这些结构都是我们的指路明灯，有些这些结构我们就能很有针对性和目标性的处理extended_convex_hull和extended_convex_hull_POSCARS这两个重要的文件。</p>
<p>先来看看extended_convex_hull这个文件，这个和二元体系有什么区别，其实是没多大区别的，但是二元体系里面的数据能够生动的和凸包线结合在一起，二元体系里面前面的几行的数据和OUTPUT.txt里面总结出来的稳定结构一一对应，也就是说都是凸包线上的点。而三元体系的数据有点让人摸不着头脑的感觉，看看前面几行的数据和OUTPUT.txt得到的稳定结构对应不上，只能根据OUTPUT.txt得到的稳定结构的成分来搜索。比如想找Zn1O5H10这个成分的稳定结构，直接<br><code>grep &quot;1  5 10&quot; extended_convex_hull</code><br>一下子就能extended_convex_hull找到好几个成分为Zn1O5H10的结构，当然是焓值最低的结构最稳定，那么ID为9219的结构最稳定了，既然知道了稳定的结构的ID，那么它的原子坐标信息也就好办了，直接上extended_convex_hull_POSCARS搜索一下就行：<br>grep -n EA9219 extended_convex_hull_POSCARS</p>
<p>很简单一个命令就能找到ID为9219的原子坐标信息所在的行数，那么知道行数以后，直接去extended_convex_hull_POSCARS找。</p>
<p>当然这只是一个结构的处理，OUTPUT.txt那么多稳定的结构还等待读者去处理。当然可以一个个手工去处理，也可以写一个简单脚本去处理。接下来请稍微深入的思考一下：三元体系变组分的有了这么一个初步的结果，怎么把这些结果变成paper了？下面一篇文章能够得到很好答案。<br>doi: 10.1038&#x2F;srep18347 (2015)</p>
<p>对于三元变组分结构预测，笔者还有一些需要说道一下：三元变组分搜索的计算巨大，比二元变组分计算量大的不只是一点点，并且准确率还是一个值得考虑的问题，所以一般并不建议采用这个三元体系去计算，除非计算资源很大，并不考虑投入产出的问题，存粹只是为了科研。</p>
<p>就拿Zn-O-H这三元体系计算来说，问题还是比较大的，总共计算了9339种结构，并且每种结构计算了5次，这就是差不多5W次计算，服务器跑起来至少一个月左右。再对结果进行进一步的处理，一个月左右的时间又过去了。这仅仅是一个压强下的结果，而实际上还需要计算不同压强的情况。此外有时候为了更好的处理三元体系的结果，还需要从三元体系里面找一些二元体系进行计算，这是一个庞大的工作。笔者在这里只是想强调三元体系计算变组分并不容易，如果准备三元体系计算变组分还需要做好心理准备。</p>
<p><strong>总结</strong></p>
<pre><code>案例16：变胞定组分预测SrTiO3（50 原子/单胞 ）0 GPa下稳定的结构，结构优化采用的是GULP（采用Buckingham势）。300
案例17：以最高德拜温度为目的变胞定组分预测单胞8个C原子的稳定结构，结构优化采用VASP软件包。300
案例18：三元体系Zn-O-H的变成分结构预测，结构优化还是采用GULP软件进行的。301
</code></pre>
<p>这三案例都是老朋友，前面都讲过很多次，但还是有些不一样的地方，所以这次教程比较详细的介绍了不同的地方：大体系定组分稳定结构预测、以德拜温度为目的进行定组分结构预测、计算量惊人的三元体系的变组分结构预测。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/09/18-47-21/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/09/09/18-47-21/" class="post-title-link" itemprop="url">5.1</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-09 18:47:21" itemprop="dateCreated datePublished" datetime="2023-09-09T18:47:21+08:00">2023-09-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-09-13 20:04:43" itemprop="dateModified" datetime="2023-09-13T20:04:43+08:00">2023-09-13</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>从头算分子动力学（ab initio molecular dYnamics, AIMD），又称为第一性原理分子动力学，为研究电子与原子核相互耦合系统的力学进动过程的理论方法。AIMD是在早期经验力场分子动力学基础上发展起来的理论方法。经验力场分子动力学中，针对原子核之间相互作用，均采用经验性的力场，这种力场往往是对相互作用，基于这些相互作用势场好处是计算量小，能够模拟的体系较大，模拟时长也比较长，统计数据也较多。</p>
<p>最初的AIMD为理想的Born-Oppenheimer分子动力学（BOMD），该理论将原子核-电子耦合体系的运动问题拆分为电子结构和分子动力学两部分，用密度泛函（DFT）等方法对特定原子核构型下的电子结构进行计算，得到K-S轨道及能量，在此基础上得到理想B-O势能面上原子核感受的势能和力，进而用经典力学来考察原子核在Born-Oppenheimer势能面上的运动。</p>
<p>为解决理想的BOMD所遇到计算瓶颈的问题，Reberto Car和Michele Parrinello于1985年提出了一种近似的BOMD方法- Car-Parrinello MD（简称CPMD）（Car, R., &amp; Parrinello, M，1985）。该方法首次使用了一个扩展的Lagrangian量来描述电子-原子核耦合体系的动力学问题，Lagrangian量引入了虚拟电子质量u，基于这个Lagrangian量可给出运动方程，通过原子核的经典运动来近似更新电子波函数，而不再需要每一步通过矩阵对角化对电子结构进行SCF计算，简化了电子结构计算，大幅降低了计算成本，使得AIMD在技术上首次具备了可操作性，开创了近几十年AIMD模拟的时代。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/11/18-47-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/11/18-47-24/" class="post-title-link" itemprop="url">4.2 光学性质</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-11 18:47:24" itemprop="dateCreated datePublished" datetime="2023-05-11T18:47:24+08:00">2023-05-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-10-12 15:53:27" itemprop="dateModified" datetime="2023-10-12T15:53:27+08:00">2023-10-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="介电常数"><a href="#介电常数" class="headerlink" title="介电常数"></a>介电常数</h1><p>首先进行结构优化,参考官网： <a target="_blank" rel="noopener" href="https://www.vasp.at/wiki/index.php/Dielectric_properties_of_SiC">https://www.vasp.at/wiki/index.php/Dielectric_properties_of_SiC</a></p>
<h3 id="静态介电常数："><a href="#静态介电常数：" class="headerlink" title="静态介电常数："></a>静态介电常数：</h3><p>方法1：DFPT方法;<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">IBRION</span> = <span class="number">8</span></span><br><span class="line"><span class="variable constant_">NSW</span>=<span class="number">1</span></span><br><span class="line"><span class="variable constant_">LEPSILON</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">LRPA</span>=.<span class="property">TRUE</span>.#<span class="variable constant_">RPA</span>考虑局域场效应，默认关闭，即<span class="variable constant_">IP</span>近似</span><br><span class="line"><span class="variable constant_">LPEAD</span>=.<span class="property">TRUE</span>.#有限差分法</span><br></pre></td></tr></table></figure><br>方法2：Response to finite electric fields</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">LCALCEPS</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">IBRION</span>=<span class="number">6</span></span><br><span class="line"><span class="variable constant_">NFREE</span>=<span class="number">2</span></span><br><span class="line"><span class="variable constant_">ISMEAR</span> =  <span class="number">0</span></span><br><span class="line"><span class="variable constant_">SIGMA</span>  =  <span class="number">0.01</span></span><br></pre></td></tr></table></figure>
<p> 在OUTCAR中抓取：</p>
<figure class="highlight plaintext"><figcaption><span>STATIC DIELECTRIC TENSOR (including local field effects in DFT)``` 电子贡献或者</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">```MACROSCOPIC STATIC DIELECTRIC TENSOR (including local field effects in RPA (Hartree))```</span><br><span class="line">```MACROSCOPIC STATIC DIELECTRIC TENSOR IONIC CONTRIBUTION``` 离子贡献</span><br><span class="line">```BORN EFFECTIVE CHARGES (in e, cummulative output)```</span><br><span class="line">```ELASTIC MODULI IONIC CONTR (kBar)```</span><br><span class="line">```PIEZOELECTRIC TENSOR IONIC CONTR  for field in x, y, z        (C/m^2)```</span><br><span class="line">### 频率依赖介电函数：读取WAVECAR</span><br><span class="line">IPA：</span><br><span class="line"> ```javascript  &#123;.line-numbers&#125;</span><br><span class="line"> ALGO = Exact</span><br><span class="line"> NBANDS  = 64</span><br><span class="line"> LOPTICS = .TRUE. </span><br><span class="line"> CSHIFT = 0.100</span><br><span class="line"> NEDOS = 2000  </span><br><span class="line"> #and you might try with the following</span><br><span class="line"> #LPEAD = .TRUE.</span><br></pre></td></tr></table></figure>

<p><code>frequency dependent IMAGINARY DIELECTRIC FUNCTION (independent particle, no local field effects)</code><br>and<br><code>frequency dependent      REAL DIELECTRIC FUNCTION (independent particle, no local field effects)</code></p>
<p>Note：对于光学性质的计算，也就是计算材料的介电函数，需要足够多的空带和致密的K网格点，使其达到非常好的收敛状态，我们才可以得到合理的光学性质；因此通常计算中，一般设置NBANDS为默认值（可在自洽的OUTCAR中以关键字NBANDS查找到）的2-3倍，K网格点为自洽值或适当增加。<br>使用optics.sh脚本得到介电函数的实部和虚部</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># extract image and real parts <span class="keyword">of</span> dielectric <span class="keyword">function</span> <span class="keyword">from</span> vasprun.<span class="property">xml</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;i=1&#125; /&lt;imag&gt;/,\</span></span><br><span class="line"><span class="string">               /&lt;\/imag&gt;/ \</span></span><br><span class="line"><span class="string">                &#123;a[i]=$2 ; b[i]=$3 ; c[i]=$4; d[i]=$5 ; e[i]=$6 ; f[i]=$7; g[i]=$8; i=i+1&#125; \</span></span><br><span class="line"><span class="string">    END&#123;for (j=12;j&lt;i-3;j++) print a[j],b[j],c[j],d[j],e[j],f[j],g[j]&#125;&#x27;</span> vasprun.<span class="property">xml</span> &gt; <span class="variable constant_">IMAG</span>.<span class="property">in</span></span><br><span class="line">#awk <span class="string">&#x27;BEGIN&#123;i=1&#125; /imag/,\</span></span><br><span class="line"><span class="string">#                /\/imag/ \</span></span><br><span class="line"><span class="string">#                 &#123;a[i]=$2 ; b[i]=$3 ; c[i]=$4; d[i]=$5 ; e[i]=$6 ; f[i]=$7; g[i]=$8; i=i+1&#125; \</span></span><br><span class="line"><span class="string">#     END&#123;for (j=12;j&lt;i-3;j++) print a[j],b[j],c[j],d[j],e[j],f[j],g[j]&#125;&#x27;</span> vasprun.<span class="property">xml</span> &gt; <span class="variable constant_">IMAG</span>.<span class="property">in</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN&#123;i=1&#125; /&lt;real&gt;/,\</span></span><br><span class="line"><span class="string">               /&lt;\/real&gt;/ \</span></span><br><span class="line"><span class="string">                &#123;a[i]=$2 ; b[i]=$3 ; c[i]=$4; d[i]=$5 ; e[i]=$6 ; f[i]=$7; g[i]=$8; i=i+1&#125; \</span></span><br><span class="line"><span class="string">    END&#123;for (j=12;j&lt;i-3;j++) print a[j],b[j],c[j],d[j],e[j],f[j],g[j]&#125;&#x27;</span> vasprun.<span class="property">xml</span> &gt; <span class="variable constant_">REAL</span>.<span class="property">in</span></span><br></pre></td></tr></table></figure>
<p>vaspkit处理：<br><code>vaspkit-task 711  </code></p>
<h3 id="压电常数"><a href="#压电常数" class="headerlink" title="压电常数"></a>压电常数</h3><p>上面计算完介电常数后，一般正交晶系。<br><code>grep &quot;PIEZOELECTRIC TENSOR IONIC CONTR  for field in x, y, z        (C/m^2)&quot; OUTCAR  -A10 </code><br> &amp;<br><code>grep &quot;PIEZOELECTRIC TENSOR  for field in x, y, z        (C/m^2)&quot; OUTCAR -A10 </code></p>
<h1 id="极化强度"><a href="#极化强度" class="headerlink" title="极化强度"></a>极化强度</h1><ol>
<li>极化强度计算<br>首先选取极化相FE（PhaseB, P, 铁电相）和参考相NP（PhaseA, P&#x3D;0, 中心对称相），分别以下列INCAR计算，<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="variable constant_">SYSTEM</span> = <span class="variable constant_">FE</span></span><br><span class="line"> <span class="variable constant_">ENCUT</span> = <span class="number">600</span>  #铁电极化计算建议设置高精度</span><br><span class="line"> <span class="variable constant_">EDIFF</span> = <span class="number">1E-6</span></span><br><span class="line"> <span class="variable constant_">IBRION</span> = -<span class="number">1</span></span><br><span class="line"> <span class="variable constant_">POTIM</span> = <span class="number">0.3</span></span><br><span class="line"> <span class="variable constant_">NSW</span> = <span class="number">0</span></span><br><span class="line"> <span class="variable constant_">EDIFFG</span> = -<span class="number">5E-3</span></span><br><span class="line"> <span class="variable constant_">ISMEAR</span> = <span class="number">0</span></span><br><span class="line"> <span class="variable constant_">SIGMA</span> = <span class="number">0.05</span></span><br><span class="line"> <span class="variable constant_">PREC</span> = <span class="title class_">Accurate</span></span><br><span class="line"> <span class="variable constant_">ISIF</span> = <span class="number">2</span></span><br><span class="line"> #<span class="variable constant_">NPAR</span> = <span class="number">4</span></span><br><span class="line"><span class="variable constant_">LWAVE</span> = .<span class="property">FALSE</span>.</span><br><span class="line"><span class="variable constant_">LCHARG</span> = .<span class="property">FALSE</span>.</span><br><span class="line"><span class="variable constant_">LREAL</span> = .<span class="property">FALSE</span>. </span><br><span class="line"><span class="variable constant_">LDIPOL</span> = .<span class="property">T</span>.</span><br><span class="line"><span class="variable constant_">DIPOL</span> = <span class="number">0.2</span> <span class="number">0.2</span> <span class="number">0.2</span> #不要设置在原子及迁移路径上，设置在真空层的一边/质心</span><br><span class="line"><span class="variable constant_">LCALCPOL</span> = .<span class="property">TRUE</span>. #计算铁电极化开关 </span><br><span class="line"><span class="variable constant_">IPEAD</span>=<span class="number">4</span></span><br><span class="line"><span class="variable constant_">LPEAD</span>=.<span class="property">True</span>.</span><br></pre></td></tr></table></figure></li>
<li>收集结果：grep “Total electronic dipole momen” OUTCAR &amp; grep “Ionic dipole moment” OUTCAR，离子与电子相加即可，然后用NP相-铁电相即可得到极化强度P，注意单位换算。<br>首先要理清数据单位。VASP 计算得到的 dipole moment 的单位是 e*Å，它与库仑之间换算为:<br>$1e &#x3D;  1.602176634 * 10^{-19} C$<br>$1Å &#x3D; 10^{-10} m$<br>三维体系的极化强度： 极化值除以体积。单位为 $e&#x2F;Å^2$；二维体系的极化强度：极化值除以面积。单位为 e&#x2F;Å。</li>
</ol>
<h3 id="Note："><a href="#Note：" class="headerlink" title="Note："></a>Note：</h3><p>在铁电极化计算过程中经常会出现参考相为非半导体的情况，这种情况下可以：①镜像法：以FE以NP为参照中心，建立一个-FE相（PhaseB’, 即铁电极化方向相反）。然后按照上述方法计算极化，再以FE相的极化-（-FE相）的极化值，然后除以2即得到极化强度。可以理解为1-（-1）&#x3D;2，2&#x2F;2&#x3D;1；②线性插值法：在FE和NP相中间插入一系列中间过渡相（0%（FE）,10%,20%,30%….100%(NP)），计算它们的极化，然后可以用Origin做拟合，100%时即为NP相的极化。（100%-0%）则是极化强度P。</p>
<h1 id="拉曼计算"><a href="#拉曼计算" class="headerlink" title="拉曼计算"></a>拉曼计算</h1><p>VASP中计算拉曼谱主要使用vasp_raman.py这个脚本，见github：<br>  <a target="_blank" rel="noopener" href="https://github.com/raman-sc/VASP">https://github.com/raman-sc/VASP</a></p>
<p>使用raman-sc有几个注意的地方：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/354651066">https://zhuanlan.zhihu.com/p/354651066</a></p>
<p>作者这里提供了一个算例。供大家参考链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1dTCP_0bRcRo0uIy0rBGttQ">https://pan.baidu.com/s/1dTCP_0bRcRo0uIy0rBGttQ</a><br>提取码：4vp8</p>
<ol>
<li>这个代码已经年代久远，使用python2写的，对大部分新学vasp的同学来说可能装的anaconda3，既使用的是python3，与python2代码是不兼容的，作者这里对vasp_raman.py进行了改写，方便python3环境运行这段代码。下载见附件。</li>
<li>raman.sub既提交代码的脚本，需要根据自己的软件环境进行更改，我这里给出我的提交脚本供大家参考:<br>export VASP_RAMAN_RUN&#x3D;’mpirun -np 64 &#x2F;public&#x2F;home&#x2F;wangxiaohui&#x2F;vasp&#x2F;vasp.5.4.4&#x2F;bin&#x2F;vasp_std &amp;&gt; job.out ‘意思是运行vasp的命令，找一下vasp_std所在路径</li>
</ol>
<p>python &#x2F;public&#x2F;home&#x2F;wangxiaohui&#x2F;WORKSPACE&#x2F;Ti3C2Li2&#x2F;raman&#x2F;zhenraman&#x2F;vasp_raman.py &gt; vasp_raman.out这里是运行raman.py代码的意思，既raman.py代码所在路径</p>
<ol start="3">
<li>查看raman.py代码内容得知，POSCAR.phon和OUTCAR.phon是前一步计算的结果文件，不要被作者的例子给坑了。并且POSCAR.phon，OUTCAR.phon和INCAR等文件放在同一个文件夹下。</li>
</ol>
<h3 id="按照脚本VASP需要计算两步："><a href="#按照脚本VASP需要计算两步：" class="headerlink" title="按照脚本VASP需要计算两步："></a>按照脚本VASP需要计算两步：</h3><p>第一步，计算Gamma点声子。用有限位移方法或者DFPT方法。</p>
<p>第一步结束后，执行，</p>
<p> cp POSCAR POSCAR.phon</p>
<p> cp OUTCAR OUTCAR.phon</p>
<p>第二步，计算宏观介电常数的导数。用vasp_raman.py 脚本。</p>
<p>DFPT: LEPSILON&#x3D;.TRUE.</p>
<p>频率依赖的介电矩阵: LOPTICS&#x3D;.TRUE.</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>bash</span><br><span class="line">#<span class="variable constant_">PBS</span> -l select=<span class="number">1</span>:ncpus=<span class="number">32</span>:mpiprocs=<span class="number">32</span></span><br><span class="line">#<span class="variable constant_">PBS</span> -l walltime=<span class="number">01</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">#<span class="variable constant_">PBS</span> -q debug</span><br><span class="line">#<span class="variable constant_">PBS</span> -j oe</span><br><span class="line">#<span class="variable constant_">PBS</span> -N <span class="title class_">Example</span></span><br><span class="line">#<span class="variable constant_">PBS</span> -V</span><br><span class="line"></span><br><span class="line">cd $PBS_O_WORKDIR</span><br><span class="line"></span><br><span class="line">ulimit -s unlimited  # remove limit on stack size</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">VASP_RAMAN_RUN</span>=<span class="string">&#x27;mpirun -n 12 /u/afonari/vasp.5.3.2/vasp.5.3/vasp &amp;&gt; job.out&#x27;</span>   #a按照自己路径更改</span><br><span class="line"><span class="keyword">export</span> <span class="variable constant_">VASP_RAMAN_PARAMS</span>=<span class="string">&#x27;01_10_2_0.01&#x27;</span>  #b按照自己材料更改</span><br><span class="line"></span><br><span class="line">python27 vasp_raman.<span class="property">py</span> &gt; vasp_raman.<span class="property">out</span></span><br></pre></td></tr></table></figure>

<p>a. VASP_RAMAN_RUN设置调用VASP的命令</p>
<p>b. VASP_RAMAN_PARAMS&#x3D;01_10_2_0.01</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">FIRST_MODE - 整数, 第一个计算的振动模</span><br><span class="line">LAST-MODE - 整数, 最后一个计算的振动模</span><br><span class="line">NDERIV - 整数, 有限位移的策略选择，目前只有2这一种选择</span><br><span class="line">STEPSIZE - 浮点数, 有限位移步长，单位是Angstroms，一般选默认就可以</span><br></pre></td></tr></table></figure>
<p>注意：以上这种设置格式允许我们并行计算大体系拉曼，我们可以在计算大体系的时候将Γ点的振动频率分为很多段分别计算，这样会大大提高我们计算大体系的效率。</p>
<p>在多段计算的时候。具体细节上要把每一段计算的OUTCAR.000n.-1.out和OUTCAR.000n.-1.out文件拷贝到同一个文件夹下，然后注释掉vasp_raman.py脚本中的运行VASP的命令。运行python2.7 vasp_raman.py &gt; vasp_raman.out 即可得到整段的数据。</p>
<p>vasp_raman.py文件中执行VASP的行为331行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">else: # run VASP here</span><br><span class="line">                  print &quot;[__main__]: Running VASP...&quot;</span><br><span class="line">                  os.system(VASP_RAMAN_RUN) #注释掉这一行</span><br></pre></td></tr></table></figure>
<h3 id="加展宽"><a href="#加展宽" class="headerlink" title="加展宽"></a>加展宽</h3><p>使用脚本broaden.py给出展宽谱，可以选择洛伦兹线型或者高斯线型。</p>
<p>$ python2 broaden.py result.txt<br>生成result.txt-broaden.dat文件，画图即可。</p>
<p>需要注意的是，broaden.py的第23和24行分别代表频率和强度所在列。其设置文件中对应的列。</p>
<pre><code>cm1 = hw[:,1]
int1 = hw[:,2]
</code></pre>
<h1 id="红外谱计算"><a href="#红外谱计算" class="headerlink" title="红外谱计算"></a>红外谱计算</h1><ol>
<li><p>红外谱主要是因为振动模在振动前后偶极矩发生变化，从而产生后外吸收。在振动过程中引起偶极矩改变的振动都具有红外活性。</p>
</li>
<li><p>根据上述原理，我们首先需要在计算过程中计算Gamma点的振动模，其次，我们需要计算伯恩有效电荷。</p>
</li>
</ol>
<p>有限位移方法INCAR关键参数：</p>
<p>IBRION &#x3D; 5<br>NWRITE &#x3D; 3<br>POTIM &#x3D; 0.015<br>LEPSILON &#x3D; .TRUE<br>DFPT方法INCAR关键参数：</p>
<p>IBRION &#x3D; 7<br>NWRITE &#x3D; 3<br>NSW &#x3D; 1<br>LEPSILON &#x3D; .TRUE.<br>NELMIN&#x3D;6</p>
<p>另外，建议进行k点测试直到伯恩有效常数收敛。</p>
<ol start="3">
<li><p>后处理</p>
<p> 计算得到OUTCAR，然后文件夹下运行脚本。运行结果如下：</p>
</li>
</ol>
<p> sh IR.sh </p>
<p>上面的振动模和活性是归一化以后的结果，也就是运行结果intensities&#x2F;results&#x2F;results.txt的内容。文件intensities&#x2F;results&#x2F;exact.res.txt是归一化之前的内容。</p>
<ol start="4">
<li>展宽</li>
</ol>
<p>使用脚本broaden.py给出展宽谱，可以选择洛伦兹线型或者高斯线型。</p>
<p>$ python2 broaden.py result.txt<br>生成result.txt-broaden.dat文件，画图即可。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/10/18-47-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/10/18-47-24/" class="post-title-link" itemprop="url">4.1 力学性质</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-10 18:47:24" itemprop="dateCreated datePublished" datetime="2023-05-10T18:47:24+08:00">2023-05-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-05-15 15:09:18" itemprop="dateModified" datetime="2023-05-15T15:09:18+08:00">2023-05-15</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="弹性常数"><a href="#弹性常数" class="headerlink" title="弹性常数"></a>弹性常数</h1><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>弹性常数描述了晶体对外加应变的响应的刚度。在材料的线性变形范围内（应变较小的情况下），体系的应力与应变满足胡克定律。也就是说，对于足够的小的变形，应力与应变成正比，即应力分量(S)是应变分量(E)的线性函数，三维材料的弹性刚度常数矩阵是6×6的。公式中Cij就是我们通常所说的弹性常数。因为刚度矩阵是对称矩阵，因此，弹性常数的独立张量元数目至多只有21个。<strong>对不同的晶系的晶体，因为对称性的关系，其独立的弹性常数是确定的。因此，晶系的对称性越高，独立的张量元数目越少。</strong><br><strong>立方晶系</strong> ——只有3个独立矩阵元（C11，C12，C44）<br><strong>六角晶系</strong> ——有5个独立矩阵元（C11，C12，C13，C33，C44）<br><strong>三角晶系</strong><br>a)  32，3m，-32&#x2F;m——有6个独立矩阵元（C11，C12，C13，C14，C33，C44）<br>b)  3，-3,——有8个独立矩阵元（C11，C12，C13，C14，C15，C33，C44，C45）<br><strong>四方晶系</strong><br>a) 422，4mm，-42m，4&#x2F;mmm——有6个独立矩阵元（C11，C12，C13，C33，C44，C66）<br>b) 4，-4，4&#x2F;m——有7个独立矩阵元（C11，C12，C13，C16，C33，C44，C66）<br><strong>正交晶系</strong> ——有9个独立矩阵元（C11，C12，C13，C22，C23，C33，C44，C55，C66）<br><strong>单斜晶系</strong> ——有13个独立矩阵元<br><strong>三斜晶系</strong> ——有21个独立矩阵元</p>
<h3 id="计算过程"><a href="#计算过程" class="headerlink" title="计算过程"></a>计算过程</h3><p>采用第一性原理计算弹性常数有两种方法，<strong>第一种方法是应力-应变方法，</strong> 即通过给结构施加不同应变，分别计算出所对应的应力大小，然后利用公式（1）拟合得到一次项系数，从而得到。<strong>第二种方法是能量-应变方法，</strong> 即通过给结构施加不同应变后计算出体系总能相对于基态能量变化（应变能），再利用公式（2）进行二次多项式拟合，其中二次多项式系数是晶体的某个弹性常数或者弹性常数组合。第一种方法优点是每进行一次计算可一次得到六个独立分量，缺点是为了得到准确的应力大小，必须选择更高的截断能和更密集的K格点。<strong>在同样的精度下，能量-应变法相比应力-应变方法要求的截断能和K点数目相对较少，缺点是计算应变数目有所增加。VASPKIT中弹性常数计算基于能量-应变法，目前不支持三斜晶系。</strong><br>一般计算弹性常数我们可以采用应变应力或者应变能量关系，进行拟合。或者可以直接通过VASP直接计算。</p>
<h4 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h4><p>首先介绍直接用VASP在输入文件中添加参数进行计算的方法。</p>
<ol>
<li><p>当然首先要进行结构优化，</p>
</li>
<li><p>在INCAR中添加关键参数，进行弹性常数的计算</p>
 <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">NSW</span>=<span class="number">1</span></span><br><span class="line"><span class="variable constant_">EDIFFG</span>=-<span class="number">1e-3</span></span><br><span class="line"><span class="variable constant_">ISIF</span>=<span class="number">3</span></span><br><span class="line"><span class="variable constant_">IBRION</span>=<span class="number">6</span> #计算弹性常数</span><br><span class="line"><span class="variable constant_">POTIM</span>=<span class="number">0.015</span></span><br><span class="line"><span class="variable constant_">NFREE</span> = <span class="number">4</span></span><br></pre></td></tr></table></figure></li>
<li><p>计算完成后可以查看OUTCAR得到弹性刚度矩阵。或者可以利用VASPKIT直接得到弹性常数。<br>请注意OUTCAR中的刚度矩阵是未经过处理的刚度矩阵，二维材料需要乘以C轴长度的0.01，还需要了解Voigt简标，11&gt;1 22&gt;2 33&gt;3 23&gt;4 13&gt;5 12&gt;6。然后我们通过Origin等工具绘图即可得到材料的杨氏模量，泊松比等力学性质。</p>
</li>
</ol>
<h4 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h4><p>VASPKIT和VASP计算晶体的弹性常数具体计算步骤分为：</p>
<ol>
<li><p>准备优化彻底的POSCAR文件，注意通常采用标准的惯用原胞计算弹性常数，如果不确信POSCAR文件中是否是标准的惯用原胞，可以用vaspkit-603&#x2F;604生成标准结构；</p>
</li>
<li><p>运行vaspkit 选择102生成KPOINTS，由于计算弹性常数对K-mesh要求很高，因此对于半导体（金属体）体系，生成K点的精度应不小于 0.03(0.02)×2π {\AA}^{-1}</p>
</li>
<li><p>INCAR参考设置如下；</p>
 <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Global</span> <span class="title class_">Parameters</span></span><br><span class="line"> <span class="variable constant_">ISTART</span> =  <span class="number">0</span>        </span><br><span class="line"> <span class="variable constant_">LREAL</span>  =  F      </span><br><span class="line"> <span class="variable constant_">PREC</span>   =  <span class="title class_">High</span>  （截断能设置默认值<span class="number">1.5</span>-<span class="number">2</span>倍）</span><br><span class="line"> <span class="variable constant_">LWAVE</span>  = F       </span><br><span class="line"> <span class="variable constant_">LCHARG</span> = F     </span><br><span class="line"> <span class="variable constant_">ADDGRID</span>= .<span class="property">TRUE</span>.    </span><br><span class="line"><span class="title class_">Electronic</span> <span class="title class_">Relaxation</span></span><br><span class="line"> <span class="variable constant_">ISMEAR</span> =  <span class="number">0</span>          </span><br><span class="line"> <span class="variable constant_">SIGMA</span>  =  <span class="number">0.05</span>       </span><br><span class="line"> <span class="variable constant_">NELM</span>   =  <span class="number">40</span>           </span><br><span class="line"> <span class="variable constant_">NELMIN</span> =  <span class="number">4</span>           </span><br><span class="line"> <span class="variable constant_">EDIFF</span>  =  <span class="number">1E-08</span>       </span><br><span class="line"><span class="title class_">Ionic</span> <span class="title class_">Relaxation</span></span><br><span class="line"> <span class="variable constant_">NELMIN</span> =  <span class="number">6</span>          </span><br><span class="line"> <span class="variable constant_">NSW</span>    =  <span class="number">100</span>         </span><br><span class="line"> <span class="variable constant_">IBRION</span> =  <span class="number">2</span>           </span><br><span class="line"> <span class="variable constant_">ISIF</span>   =  <span class="number">2</span>    （切记选择<span class="number">2</span>,如果选择<span class="number">3</span>会把施加应变后原胞重新优化成平衡原胞）</span><br><span class="line"> <span class="variable constant_">EDIFFG</span> = -<span class="number">1E-02</span>  </span><br></pre></td></tr></table></figure></li>
<li><p>准备VPKIT.in文件并设置第一行为1（预处理）；运行vaspkit并选择201, 将生成用于计算弹性常数文件；</p>
 <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>                    ! 设置<span class="number">1</span>将产生计算弹性常数的输入文件，<span class="number">2</span>则计算弹性常数</span><br><span class="line">3D                   ! 2D为二维体系，3D为三维体系</span><br><span class="line"><span class="number">7</span>                    ! <span class="number">7</span>个应变</span><br><span class="line">-<span class="number">0.015</span> -<span class="number">0.010</span> -<span class="number">0.005</span> <span class="number">0.000</span> <span class="number">0.005</span> <span class="number">0.010</span> <span class="number">0.015</span>  ! 应变变化范围</span><br></pre></td></tr></table></figure></li>
<li><p>批量提交vasp作业；<br>总计有9个大文件夹，分别以该空间群所需要的独立弹性常数来命名；在每个大文件夹内则是以应变强度命名的实际计算执行的文件夹，文件夹的数量可根据预处理的VPKIT.in文件的最后一行的应变设置来更改。在每一个应变文件夹内则是施加了应变的POSCAR和事先准备好的INCAR、KPOINTS和POTCAR文件的链接，可直接进行vasp计算。<br>这里通过一个简单的两重for循环命令依次序完成所需要的计算任务。<br>脚本 :</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>bash</span><br><span class="line">path=<span class="string">`pwd`</span></span><br><span class="line">#记录当前文件夹位置并定义到变量 path中，称为初始目录</span><br><span class="line">pwd</span><br><span class="line"><span class="keyword">for</span> cij <span class="keyword">in</span> <span class="string">`ls -F | grep /$`</span></span><br><span class="line">#ls -F| grep /$ 命令为返回当前文件夹中所有子目录</span><br><span class="line">#将所有子目录添加到变量cij中，并准备进行<span class="keyword">for</span>循环</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">cd $&#123;path&#125;/$cij</span><br><span class="line">#进入cij变量所代表的子目录中</span><br><span class="line">pwd</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strain_*</span><br><span class="line">#将cij代表的子目录中所有strain文件夹添加到变量s中</span><br><span class="line">#此部添加变量s的方式可更改为添加变量cij的方式，但不建议这么做</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">cd $&#123;path&#125;/$cij/$s</span><br><span class="line">#进入初始目录下变量cij和变量s组成的目录，由于<span class="keyword">for</span>循环的设置，将遍历所有可计算的strain文件夹</span><br><span class="line">pwd</span><br><span class="line"> mpirun -np <span class="number">16</span> vasp_std</span><br><span class="line"> #执行vasp计算</span><br><span class="line">cd $&#123;path&#125;</span><br><span class="line">#返回初始目录</span><br><span class="line">pwd</span><br><span class="line">done</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
<li><p>再次修改VPKIT.in文件中第一行为2（后处理），然后再次运行vaspkit并选择201，得到以下结果；</p>
</li>
<li><p>如果在计算弹性常数时希望强制固定某个体系的空间群，可在SYMMETRY.in文件第二行设置空间群，这样晶系将通过指定空间群判断并计算相应的独立弹性常数，这对于掺杂或者合金体系比较有用。</p>
</li>
</ol>
<h3 id="根据弹性常数计算和三维可视化材料力学量"><a href="#根据弹性常数计算和三维可视化材料力学量" class="headerlink" title="根据弹性常数计算和三维可视化材料力学量"></a>根据弹性常数计算和三维可视化材料力学量</h3><p>首先利用VASPKIT-204命令得到体弹性模量、杨氏模量、剪切模量及泊松比随角度的依赖关系，具体算法可参考文献【J. Phys. Condens. Matter, 28, 275201 (2016)和Comput. Phys. Commun. 181, 2102–2115 (2010)】。接下来我们以某单斜体系的弹性常数为例来演示如何进行材料力学量三维可视化。</p>
<ul>
<li>第一步新建ELASTIC_TENSOR.in并输入6x6弹性常数矩阵，注意第一行是注释行不可省略。如果是二维体系，则输入文件为ELASTIC_TENSOR_2D.in，注意二维体系弹性常数矩阵大小为3x3。 <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># comment line (<span class="keyword">in</span> <span class="title class_">GPa</span>)</span><br><span class="line">   <span class="number">228.38</span>   <span class="number">85.741</span>   <span class="number">81.503</span>        <span class="number">0</span>   -<span class="number">0.737</span>        <span class="number">0</span></span><br><span class="line">   <span class="number">85.741</span>   <span class="number">217.47</span>   <span class="number">94.201</span>        <span class="number">0</span>  -<span class="number">20.213</span>        <span class="number">0</span></span><br><span class="line">   <span class="number">81.503</span>   <span class="number">94.201</span>   <span class="number">178.81</span>        <span class="number">0</span>   -<span class="number">9.472</span>        <span class="number">0</span></span><br><span class="line">        <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span>   <span class="number">35.094</span>        <span class="number">0</span>  -<span class="number">17.851</span></span><br><span class="line">   -<span class="number">0.737</span>  -<span class="number">20.213</span>   -<span class="number">9.472</span>        <span class="number">0</span>   <span class="number">37.778</span>        <span class="number">0</span></span><br><span class="line">        <span class="number">0</span>        <span class="number">0</span>        <span class="number">0</span>  -<span class="number">17.851</span>        <span class="number">0</span>   <span class="number">42.708</span></span><br></pre></td></tr></table></figure></li>
<li>第二步运行VASPKIT 204命令得到MECHANICS_3D.dat<br>打开MECHANICS_3D.dat可看到第一行给出了每一列数据所代表的物理量，第二行给出了球坐标系下分别划分仰角θ∈[0,180]和方位角ϕ∈[0,360]的格点大小。</li>
<li>第三步从vaspkit&#x2F;examples&#x2F;angular_dependent_mechanics (VASPKIT ver. &gt;&#x3D; 1.3.2)文件夹中拷贝mechanics_3d_plot_matlab.m到当前目录，调用Matlab软件运行该脚本，得到以下信息.<br>如果我们想可视化杨氏模量，则输入2回车即可得到。</li>
<li>另外，以下两个软件也可以实现材料力学量三维可视化。<br>Elate<br>ElasticPOST</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-48-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-48-24/" class="post-title-link" itemprop="url">3.2 热输运2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:48:24" itemprop="dateCreated datePublished" datetime="2023-05-09T18:48:24+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-07-16 15:26:05" itemprop="dateModified" datetime="2023-07-16T15:26:05+08:00">2023-07-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="三阶力常数矩阵"><a href="#三阶力常数矩阵" class="headerlink" title="三阶力常数矩阵"></a>三阶力常数矩阵</h1><p>需要用到thirdorder程序。</p>
<h3 id="使用方法："><a href="#使用方法：" class="headerlink" title="使用方法："></a>使用方法：</h3><ol>
<li>准备好POSCAR,INCAR,KPOINTS,POTCAR和提交任务脚本（以sub.sh为例）；<br>其中POSCAR与二阶力常数矩阵求解时的POSCAR-unit一致，KPOINTS也与二阶一致。INCAR文件与二阶力常数求解时的有限位移法一致，其他不变。完成后运行thirdorder实现扩胞。</li>
</ol>
<p><code>~/安装目录/thirdorder_vasp.py sow 2 2 2 -12</code><br>2 2 2是扩胞倍数，要和二阶力常数矩阵保持一致或者略小。-12指的是考虑多少个近邻原子，需要测试，但是如果计算资源紧缺的时候取个-10就行了，但有风险；正值是指截断半径。之后生成成功以后会出现一堆3RD开头的文件，那些都是POSCAR，一般有几百上千个。</p>
<ol start="2">
<li>参考phonopy计算声子谱的有限位移法，需要把这些POSCAR单独计算。也就是有多少POSCAR，建立多少文件夹，分别进行多少次计算。</li>
<li><code>find job* -name vasprun.xml|sort -n|/ thirdorder_vasp.py reap a b c -d</code>  a b c和-d与前面一致。该命令可获得FORCE_CONSTANT_3RD也即是三阶力常数矩阵。</li>
</ol>
<h3 id="脚本方法"><a href="#脚本方法" class="headerlink" title="脚本方法"></a>脚本方法</h3><ul>
<li><p>测试-d参数（秦光照老师） </p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>bash</span><br><span class="line">#</span><br><span class="line"># <span class="title class_">Construct</span> the 3nd files based on the finished calculations</span><br><span class="line">#</span><br><span class="line"># <span class="title class_">Written</span> <span class="variable constant_">BY</span> <span class="variable constant_">QIN</span>, <span class="title class_">GuangZhao</span> &lt;qin.<span class="property">phys</span>@gmail.<span class="property">com</span>&gt;</span><br><span class="line"># <span class="number">2016</span>-<span class="number">11</span>-<span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">DIR</span>=<span class="string">&quot;/vol-th/home/xhaiyan/WangN/Au6S2/third241-14&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;$DIR&quot;</span> ];then</span><br><span class="line">    echo <span class="title class_">Please</span> specify the source directory.</span><br><span class="line">    exit</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="variable constant_">NAME</span> <span class="keyword">in</span> 3RD.<span class="property">POSCAR</span>.*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="variable constant_">NUM</span>=<span class="string">&quot;$&#123;NAME#3RD.POSCAR.&#125;&quot;</span>   # the number <span class="keyword">of</span> the 3nd <span class="variable constant_">POSCAR</span> file</span><br><span class="line">    <span class="variable constant_">CODE</span>=$(head -<span class="number">1</span> $NAME)       # the code <span class="keyword">of</span> the <span class="variable constant_">POSCAR</span> file</span><br><span class="line"># find the source <span class="variable constant_">POSCAR</span> file <span class="keyword">in</span> the source directory</span><br><span class="line">    <span class="variable constant_">INFO</span>=$(grep $CODE $DIR/3RD.<span class="property">POSCAR</span>.* | head -<span class="number">1</span>)</span><br><span class="line">    [ x<span class="string">&quot;$INFO&quot;</span> == x ] &amp;&amp; echo <span class="string">&quot;NOT FOUND for job-$NUM&quot;</span> &amp;&amp; <span class="keyword">continue</span></span><br><span class="line">    <span class="variable constant_">SOURCE_NUM</span>=<span class="string">&quot;$&#123;INFO%:*&#125;&quot;</span>     # the number <span class="keyword">of</span> the source <span class="variable constant_">POSCAR</span> file</span><br><span class="line">    <span class="variable constant_">SOURCE_NUM</span>=<span class="string">&quot;$&#123;SOURCE_NUM##*.&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    echo <span class="string">&quot;$DIR/job-$SOURCE_NUM/ --&gt; job-$NUM/&quot;</span></span><br><span class="line">#    diff 3RD.<span class="property">POSCAR</span>.<span class="property">$NUM</span> $DIR/3RD.<span class="property">POSCAR</span>.<span class="property">$SOURCE_NUM</span></span><br><span class="line">    rsync -a $DIR/job-$SOURCE_NUM/vasprun.<span class="property">xml</span> ./job-$NUM/</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
</li>
<li><p>针对大量POSCAR批量建立文件夹</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#<span class="variable language_">module</span> load spglib/master</span><br><span class="line">#thirdorder_vasp.<span class="property">py</span> sow <span class="number">3</span> <span class="number">3</span> <span class="number">1</span> -<span class="number">10</span></span><br><span class="line">#生成<span class="number">2</span>*<span class="number">2</span>*<span class="number">2</span>的超胞 <span class="number">0.6</span>表示截断半径为<span class="number">6</span>埃。</span><br><span class="line">#sow a b c m  abc表示生成的超胞大小，m为正数的时候表示截断半径（单位：nm）（例如<span class="number">0.6</span>，表示截断半径为<span class="number">6.0</span>埃）；为负数时表示第几近邻截断（此时应取负整数，例如-<span class="number">3</span>表示第三近邻）</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 3RD.<span class="property">POSCAR</span>.*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">s=$(echo $i| cut -d <span class="string">&quot;.&quot;</span> -f <span class="number">3</span>)</span><br><span class="line">d=job-$s</span><br><span class="line">mkdir $d</span><br><span class="line">cp $i $d/<span class="variable constant_">POSCAR</span></span><br><span class="line">cp ./<span class="variable constant_">INCAR</span> ./sub.<span class="property">sh</span> ./<span class="variable constant_">KPOINTS</span> ./<span class="variable constant_">POTCAR</span> $d</span><br><span class="line">pushd $d</span><br><span class="line">popd</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
</li>
<li><p>批量提交任务</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>sh</span><br><span class="line">root_path=<span class="string">&#x27;pwd&#x27;</span></span><br><span class="line"></span><br><span class="line">#在每个job文件夹里进行静态计算。</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">001</span>.<span class="number">.1050</span>&#125; #按顺序从job-<span class="number">001</span>到<span class="number">1050</span>做静态vasp计算,根据生成的文件夹设定</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">cd job-$i</span><br><span class="line">echo <span class="string">&quot;job-$i&quot;</span>, time </span><br><span class="line">sbatch sub.<span class="property">sh</span></span><br><span class="line">wait</span><br><span class="line">cd ..</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">#上述静态计算完成后提取三阶力常数文件</span><br><span class="line">#cd $&#123;root_path&#125;</span><br><span class="line"></span><br><span class="line">#find job* -name vasprun.<span class="property">xml</span>| sort -n| python thirdorder_vasp.<span class="property">py</span> reap <span class="number">2</span>  <span class="number">2</span>  <span class="number">1</span> -<span class="number">12</span> #最后四个数字跟你扩胞时一致</span><br></pre></td></tr></table></figure></li>
</ul>
<p>脚本赋予权限：chmod +x .sh;运行脚本：.&#x2F;sh</p>
<h1 id="ShengBTE获得热输运性质"><a href="#ShengBTE获得热输运性质" class="headerlink" title="ShengBTE获得热输运性质"></a>ShengBTE获得热输运性质</h1><h3 id="运行ShengBTE计算热输运性质"><a href="#运行ShengBTE计算热输运性质" class="headerlink" title="运行ShengBTE计算热输运性质"></a>运行ShengBTE计算热输运性质</h3><ul>
<li>获得二阶力常数计算：<br>计算流程与声子谱计算流程相同，用DFPT和有限位移法都可以。将得到的FORCE_CONSTANTS重命名为FORCE_CONSTANTS_2ND。</li>
<li>获得二阶力常数计算：见上，输出为FORCE_CONSTANTS_3RD文件。</li>
<li>准备CONTROL文件：格式如下:<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#<span class="variable constant_">CONTROL</span> <span class="keyword">for</span> <span class="title class_">ShengBTE</span></span><br><span class="line">&amp;allocations</span><br><span class="line">        nelements=<span class="number">2</span>              #元素种类</span><br><span class="line">        natoms=<span class="number">6</span>                 #原子个数</span><br><span class="line">        <span class="title function_">ngrid</span>(:)=<span class="number">20</span> <span class="number">20</span> <span class="number">5</span>         #计算网格密度</span><br><span class="line">&amp;end</span><br><span class="line">&amp;crystal</span><br><span class="line">        lfactor=<span class="number">0.1</span>              #软件长度单位换算</span><br><span class="line">        <span class="title function_">lattvec</span>(:,<span class="number">1</span>)=<span class="number">3.1613337552503711</span>    <span class="number">0.0000000000000025</span>    <span class="number">0.0000000000000000</span> #晶胞参数</span><br><span class="line">        <span class="title function_">lattvec</span>(:,<span class="number">2</span>)=-<span class="number">1.5806668776251651</span>    <span class="number">2.7377953418477841</span>    <span class="number">0.0000000000000000</span></span><br><span class="line">        <span class="title function_">lattvec</span>(:,<span class="number">3</span>)=-<span class="number">0.0000000000000000</span>    <span class="number">0.0000000000000000</span>   <span class="number">12.3318234981499426</span></span><br><span class="line">        elements= <span class="string">&quot;Mo&quot;</span> <span class="string">&quot;S&quot;</span>  #原子顺序</span><br><span class="line">        types= <span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span>  #原子个数</span><br><span class="line">       <span class="title function_">positions</span>(:,<span class="number">1</span>)= <span class="number">0.3333333449999998</span>  <span class="number">0.6666666890000030</span>  <span class="number">0.2500000000000000</span> #原子坐标，按顺序</span><br><span class="line">       <span class="title function_">positions</span>(:,<span class="number">2</span>)=<span class="number">0.6666666240000012</span>  <span class="number">0.3333333229999980</span>  <span class="number">0.7500000189999980</span></span><br><span class="line">       <span class="title function_">positions</span>(:,<span class="number">3</span>)= <span class="number">0.3333333449999998</span>  <span class="number">0.6666666890000030</span>  <span class="number">0.6230719397502427</span></span><br><span class="line">       <span class="title function_">positions</span>(:,<span class="number">4</span>)=<span class="number">0.6666666240000012</span>  <span class="number">0.3333333229999980</span>  <span class="number">0.3769280602499874</span></span><br><span class="line">       <span class="title function_">positions</span>(:,<span class="number">5</span>)=<span class="number">0.6666666240000012</span>  <span class="number">0.3333333229999980</span>  <span class="number">0.1230720067501656</span></span><br><span class="line">       <span class="title function_">positions</span>(:,<span class="number">6</span>)=<span class="number">0.3333333449999998</span>  <span class="number">0.6666666890000030</span>  <span class="number">0.8769280222497613</span></span><br><span class="line">       <span class="title function_">scell</span>(:)=<span class="number">4</span> <span class="number">4</span> <span class="number">1</span> #扩胞倍数，和前面一致</span><br><span class="line">&amp;end</span><br><span class="line">&amp;parameters</span><br><span class="line">       T=<span class="number">300</span>  #温度</span><br><span class="line">&amp;end</span><br><span class="line">&amp;flags</span><br><span class="line">      nonanalytic=.<span class="property">TRUE</span>.</span><br><span class="line">      nanowires=.<span class="property">FALSE</span>.</span><br><span class="line">      convergence=.<span class="property">TRUE</span>.  #迭代法，默认最大<span class="number">1000</span>步</span><br><span class="line">&amp;end</span><br></pre></td></tr></table></figure></li>
</ul>
<p>详细参数可参考手册。</p>
<ul>
<li>提交任务</li>
<li>获得不同温度的数据，只需要依次修改CONTROL文件的T tag。或者通过脚本：</li>
</ul>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">350.</span><span class="number">.1350</span>.<span class="number">.100</span>&#125; # 对i赋值，区间为<span class="number">300</span>到<span class="number">900</span>，每搁<span class="number">10</span>取一个数，即（<span class="number">300</span> <span class="number">310</span> <span class="number">320</span> <span class="number">330</span> ...<span class="number">.890</span> <span class="number">900</span>），可以根据自身情况自行设置</span><br><span class="line"><span class="keyword">do</span>  #开始循环</span><br><span class="line">mkdir $i #建立单一任务文件夹</span><br><span class="line">cp sub.<span class="property">sh</span> <span class="variable constant_">CONTROL</span> <span class="variable constant_">FORCE_CONSTANTS_2ND</span> <span class="variable constant_">FORCE_CONSTANTS_3RD</span> $i  </span><br><span class="line">#将二阶三阶力学常数文件和<span class="variable constant_">CONTROL</span>文件复制到单一任务文件夹</span><br><span class="line">#注意，这里的<span class="variable constant_">CONTROL</span>文件夹是删减过的</span><br><span class="line">cd $i #进入单一文件夹内</span><br><span class="line">echo \&amp;parameters &gt;&gt; <span class="variable constant_">CONTROL</span>      #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line">  echo  T= $i  &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件 </span><br><span class="line">  #温度设置 如果同时设置多个温度，同一行只会算第一个并报错。如果多次设定一个温度到同一个<span class="variable constant_">CONTROL</span>文件，只会运算最后一个。</span><br><span class="line">#echo   scalebroad=<span class="number">0.1</span>    &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line">echo \&amp;end    &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line">echo \&amp;flags  &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line">echo    nonanalytic=.<span class="property">TRUE</span>.   &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line">echo    nanowires=.<span class="property">FALSE</span>.   &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line">echo    convergence=.<span class="property">True</span>. &gt;&gt; <span class="variable constant_">CONTROL</span></span><br><span class="line">echo \&amp;end  &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line"> #这里补充<span class="variable constant_">CONTROL</span>文件用的是笨方法，如果有相应改进方法可以自行更改，简洁代码</span><br><span class="line">sbatch sub.<span class="property">sh</span>  #执行<span class="title class_">ShengBTE</span>计算，这里的执行命令应视情况而定。</span><br><span class="line">cd .. #返回初始目录</span><br><span class="line">done  #结束任务</span><br></pre></td></tr></table></figure>


<h1 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h1><ul>
<li>计算完成后，先检查收敛情况，找到T300K文件夹下的BTE.kappa,第一列代表迭代步数，一般未达到默认1000步可认为收敛正常。</li>
<li>计算完成后在当前目录下会生成T300K文件夹和一些输出文件。文件处理参见天玑算b站视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Yh411n7tx/?spm_id_from=333.788&vd_source=17084cc867ff3bb86398ff1a79b443f2">https://www.bilibili.com/video/BV1Yh411n7tx/?spm_id_from=333.788&amp;vd_source=17084cc867ff3bb86398ff1a79b443f2</a></li>
</ul>
<p>其他参考：<a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv22090733/">https://www.bilibili.com/read/cv22090733/</a></p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li><p>计算得到的热导率和文献报道有较大偏差，可能偏大或者偏小，可能的原因有：</p>
<p>1.采用的2阶力常数FORCE_CONSTANT中超胞内原子排序不是按照ucatom<em>sc_z</em>sc_y*sc_x排列；力常数文件与control文件中原胞内原子次序是否一致；</p>
<p>2.shengBTE的control文件中晶格参数单位默认nm，有转换系数的参数；</p>
<p>3.使用QE利用phonopy计算得到的FORCE_CONSTANT文件中，单位需要转换，不能直接利用shengBTE计算，vasp利用phonopy则单位正确；</p>
<ol start="4">
<li><p>3阶力常数的计算量较大，但精度要求很高，如0.0003Rh&#x2F;bohr^2量级的力的误差，也会导致最终热导率的数值出现大的偏离；如使用cp2k计算力常数，通常使用QE等平面波软件，对于超胞体系，随着扩胞，在较大的截断半径下，所需计算量非常大，使用CP2K中的QS模块也能进行第一性原理计算，具有相对较高的计算效率，但是CP2K不同于平面波的QE等，计算中仅有gamma点计算，需要采用实空间较大超胞，如果使用和QE等相同的超胞，则会导致原子受力精度不高，一般在~0.0003Rh&#x2F;bohr^2量级的误差，也会对某些体系，特别是二维体系的热导率有很大的影响。在使用cp2k进行3阶力常数大量计算之前，先进行超胞收敛测试，可以在相同的位移构型下，不断扩胞，判断力计算的变化情况和误差。用QE等计算也建议先进行k点等计算参数的收敛判断，否则会浪费大量时间，热导率计算结果却有很大偏离。</p>
</li>
<li><p>使用经验势能模型，在通过lammps进行热输运计算之前，可以先利用分子静力学软件GULP结合shengBTE模块，预判势能应用于热输运计算的准确性。但经验势能用于热输运精度和前景一般，机器势能表现更好。</p>
</li>
</ol>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/odin_linux/article/details/130084321">https://blog.csdn.net/odin_linux/article/details/130084321</a></p>
</li>
<li><p>静态计算可以各个job文件夹同时分别计算，不用按顺序来。等所有job文件夹计算完后，自行运行“find job…” 提取三阶力常数的命令。严格来说，胞的大小和三阶力常数计算的截断半径都应该进行测试，测试以所计算得到的热导率的收敛进行判断。计算资源有限无法测试的话，尽可能取大一点。Born有效电荷和介电常数的计算应该不是必要的，如果你要考虑在Gamma点附近LO-TO劈裂的话(主要针对离子晶体)，则需要进行计算。可以加上，感觉要好点。<br>二阶力常数和三阶力常数所用的超胞大小可以不统一，我看文献中有这种情形，不过一般作者采用的二阶力常数的超胞都是大于等于三阶力常数超胞的大小。<br>原文链接：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/147810223">https://zhuanlan.zhihu.com/p/147810223</a></p>
</li>
<li><p>官方网站：<a target="_blank" rel="noopener" href="https://www.shengbte.org/">https://www.shengbte.org/</a></p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-48-23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-48-23/" class="post-title-link" itemprop="url">3.1 热输运1 声子谱</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:48:23" itemprop="dateCreated datePublished" datetime="2023-05-09T18:48:23+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-06-27 09:17:58" itemprop="dateModified" datetime="2023-06-27T09:17:58+08:00">2023-06-27</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="声子谱"><a href="#声子谱" class="headerlink" title="声子谱"></a>声子谱</h1><p>声子谱的计算主要有两种方法，一种是直接法，另一种是微扰密度泛函方法（DFPT）。</p>
<ul>
<li>直接法，或称frozen-phonon方法，是通过在优化后的平衡结构中引入原子位移，计算作用在原子上的Hellmann-Feynman力，进而由动力学矩阵算出声子色散曲线。直接法的缺陷在于它要求声子波矢与原胞边界supersize<br>正交，或者原胞足够大使得Hellmann-Feynman力在原胞外可以忽略不计。这使得对于复杂系统，如对称性高的晶体、合金、超晶格等材料需要采用超原胞。超原胞的采用使计算量急剧增加，极大的限制了该方法的使用。</li>
<li>1987年，Baroni、Giannozzi和Testa提出了DFPT方法。DFPT通过计算系统能量对外场微扰的响应来求出晶格动力学性质。该方法最大的优势在于它不限定微扰的波矢与原胞边界正交，不需要超原胞也可以对任意波矢求解。Castep、Vasp等采用的是一种linear response theory 的方法（或者称为 density perturbation functional theory，DFPT），直接计算出原子的移动而导致的势场变化，再进一步构造出动力学矩阵。进而计算出声子谱。</li>
</ul>
<h2 id="DFPT计算步骤"><a href="#DFPT计算步骤" class="headerlink" title="DFPT计算步骤"></a>DFPT计算步骤</h2><ul>
<li>结构优化<br><strong>声子谱的计算需要对原胞结构做高精度的充分优化，否则很容易出现虚频；</strong> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">EDIFF</span>  = <span class="number">1E-08</span></span><br><span class="line"><span class="variable constant_">EDIFFG</span> = -<span class="number">1E-06</span> </span><br></pre></td></tr></table></figure>
可以采用分步优化，直到达到精度。然后优化后的结果：</li>
</ul>
<p> <code>$ phonopy -d --dim=&quot;4 4 1&quot; </code></p>
<p>之后会生成一堆文件，其中有  SPOSCAR 和POSCAR-00* ，分别对应不同的方法密度泛函微扰法 (DFPT) 以及有限位移法。<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">phonopy_disp.<span class="property">yaml</span>  <span class="variable constant_">POSCAR</span>-<span class="number">002</span>  <span class="variable constant_">POSCAR</span>-<span class="number">005</span>  <span class="variable constant_">POSCAR</span>-<span class="number">008</span>  <span class="variable constant_">POSCAR</span>-<span class="number">011</span>  <span class="variable constant_">POSCAR</span>-<span class="number">014</span>  <span class="variable constant_">SPOSCAR</span></span><br><span class="line"><span class="variable constant_">POSCAR</span>             <span class="variable constant_">POSCAR</span>-<span class="number">003</span>  <span class="variable constant_">POSCAR</span>-<span class="number">006</span>  <span class="variable constant_">POSCAR</span>-<span class="number">009</span>  <span class="variable constant_">POSCAR</span>-<span class="number">012</span>  <span class="variable constant_">POSCAR</span>-<span class="number">015</span></span><br><span class="line"><span class="variable constant_">POSCAR</span>-<span class="number">001</span>         <span class="variable constant_">POSCAR</span>-<span class="number">004</span>  <span class="variable constant_">POSCAR</span>-<span class="number">007</span>  <span class="variable constant_">POSCAR</span>-<span class="number">010</span>  <span class="variable constant_">POSCAR</span>-<span class="number">013</span>  <span class="variable constant_">POSCAR</span>-<span class="number">016</span></span><br><span class="line">$ cp <span class="variable constant_">POSCAR</span> <span class="variable constant_">POSCAR</span>-unitcell</span><br><span class="line">$ cp <span class="variable constant_">SPOSCAR</span> <span class="variable constant_">POSCAR</span></span><br></pre></td></tr></table></figure><br><strong>KPOINTS需适当减小，可以的话最好再进行一次收敛测试</strong><br><strong>INCAR</strong><br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">IBRION</span> =  <span class="number">8</span>            (determines the <span class="title class_">Hessian</span> matrix using <span class="variable constant_">DFPT</span>)</span><br><span class="line"><span class="variable constant_">EDIFF</span>  =  <span class="number">1E-08</span>        (<span class="variable constant_">SCF</span> energy convergence; <span class="keyword">in</span> eV) </span><br><span class="line"><span class="variable constant_">PREC</span>   =  <span class="title class_">Accurate</span>     (<span class="title class_">Precision</span> level)  </span><br><span class="line"><span class="variable constant_">ENCUT</span>  =  <span class="number">500</span>          (<span class="title class_">Cut</span>-off energy <span class="keyword">for</span> plane wave basis set, <span class="keyword">in</span> eV) </span><br><span class="line"><span class="variable constant_">IALGO</span>  =  <span class="number">38</span>           (<span class="title class_">Davidson</span> block iteration scheme)</span><br><span class="line"><span class="variable constant_">LREAL</span>  = .<span class="property">FALSE</span>.       (<span class="title class_">Projection</span> <span class="attr">operators</span>: <span class="literal">false</span>)</span><br><span class="line"><span class="variable constant_">LWAVE</span>  = .<span class="property">FLASE</span>.       (<span class="title class_">Write</span> <span class="variable constant_">WAVECAR</span> or not)</span><br><span class="line"><span class="variable constant_">LCHARG</span> = .<span class="property">FLASE</span>.       (<span class="title class_">Write</span> <span class="variable constant_">CHGCAR</span> or not) </span><br><span class="line"><span class="variable constant_">ADDGRID</span>= .<span class="property">TRUE</span>.        (<span class="title class_">Increase</span> grid; helps <span class="variable constant_">GGA</span> convergence) </span><br><span class="line"><span class="variable constant_">NSW</span>    = <span class="number">1</span></span><br></pre></td></tr></table></figure><br><strong>提交VASP计算</strong></p>
<p><strong>后处理</strong><br> <code>phonopy --fc vasprun.xml </code></p>
<p>编辑band.conf文件，该文件给出了高对称点路径的信息<br>Note:<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ATOM_NAME</span> = * *  #元素名称，顺序与<span class="variable constant_">POSCAR</span>保持一致</span><br><span class="line"><span class="variable constant_">DIM</span> = <span class="number">4</span> <span class="number">4</span> <span class="number">1</span>      #建立超胞的大小，--dim后面的</span><br><span class="line"><span class="variable constant_">BAND</span> = <span class="number">0.5</span> <span class="number">0.0</span> <span class="number">0.0</span>  <span class="number">0.0</span> <span class="number">0.0</span> <span class="number">0.0</span>  <span class="number">0.333333</span> <span class="number">0.333333</span> <span class="number">0.0</span>  <span class="number">0.5</span> <span class="number">0.0</span> <span class="number">0.0</span> #高对称点路径，每组高对称点之间用两个空格隔开</span><br><span class="line"><span class="variable constant_">FORCE_CONSTANTS</span> = <span class="variable constant_">READ</span> #表示读取力常数文件<span class="variable constant_">FORCE_CONSTANTS</span></span><br><span class="line"><span class="variable constant_">FC_SYMMETRY</span> = .<span class="property">TRUE</span>.</span><br></pre></td></tr></table></figure><br>准备mesh.conf文件，如下所示：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ATOM_NAME</span> = <span class="title class_">Si</span></span><br><span class="line"><span class="variable constant_">DIM</span> = <span class="number">2</span> <span class="number">2</span> <span class="number">2</span></span><br><span class="line"><span class="variable constant_">MP</span> = <span class="number">24</span> <span class="number">24</span> <span class="number">24</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">phonopy --dim=<span class="string">&quot;4 4 1&quot;</span> -c <span class="variable constant_">POSCAR</span>-unitcell -p -s band.<span class="property">conf</span></span><br><span class="line">(单位是<span class="title class_">THz</span>)或者</span><br><span class="line">phonopy --dim=<span class="string">&quot;4 4 1&quot;</span> --factor=<span class="number">524.147</span> -c <span class="variable constant_">POSCAR</span>-unitcell -p -s band.<span class="property">conf</span></span><br><span class="line">(单位是cm-<span class="number">1</span>)</span><br><span class="line">phonopy-bandplot  --gnuplot&gt; phono.<span class="property">dat</span></span><br><span class="line">如果上述命令不行，可以用旧版本phonopy </span><br><span class="line">bandplot --gnuplot&gt; phonon.<span class="property">dat</span></span><br><span class="line">就可以获得二阶力常数矩阵 <span class="variable constant_">FORCE_CONSTANTS</span> 和声子谱的数据</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>准备mesh.conf以计算态密度和PDOS：</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ATOM_NAME</span> = </span><br><span class="line"><span class="variable constant_">DIM</span> = <span class="number">4</span> <span class="number">4</span> <span class="number">1</span></span><br><span class="line"><span class="variable constant_">MP</span>=<span class="number">12</span> <span class="number">12</span> <span class="number">1</span></span><br><span class="line"><span class="variable constant_">PDOS</span>=<span class="number">1</span> <span class="number">2</span>, <span class="number">3</span> <span class="number">4</span>, <span class="number">5</span> <span class="number">6</span></span><br><span class="line"><span class="variable constant_">FORCE_CONSTANTS</span> = <span class="variable constant_">READ</span></span><br><span class="line"><span class="variable constant_">BAND_POINTS</span> = <span class="number">71</span></span><br></pre></td></tr></table></figure>
<p>运行命令：<code>phonopy –dim=&#39;5 5 1&#39; -c POSCAR-unitcell mesh.conf</code>或者乘上因子修改单位。<code>phonopy –dim=&#39;5 5 1&#39; --factor=524.147 -c POSCAR-unitcell mesh.conf</code><br>得到projected_dos.dat文件，拖到Origin中画图，得到声子态密度图像（从第二列数据开始，每一列对应每个原子的态密度），对比着之前计算得到的声子谱可以分析声学支与光学支之间的相互作用关系</p>
<h2 id="有限位移方法"><a href="#有限位移方法" class="headerlink" title="有限位移方法"></a>有限位移方法</h2><p>这里需要准备和 POSCAR-00* 数目一样的文件夹，并把 POSCAR-00* 复制到每个文件夹中并命名为 POSCAR 。每个文件夹内都需要准备 POTCAR 、 POSCAR 、 INCAR 、 KPOINTS 。并且分别计算。<br><strong>可用以下sh脚本快速进行：手动修改第一行文件夹数目和vasp运行文件名称。</strong></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">001</span>.<span class="number">.006</span>&#125;</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">mkdir $i</span><br><span class="line">cd $i</span><br><span class="line">cp ../<span class="variable constant_">POSCAR</span>-$i <span class="variable constant_">POSCAR</span></span><br><span class="line">cp ../&#123;<span class="variable constant_">INCAR</span>,<span class="variable constant_">KPOINTS</span>,<span class="variable constant_">POTCAR</span>,sub.<span class="property">sh</span>&#125; .</span><br><span class="line">运行提交任务命令</span><br><span class="line">cd ../</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p><strong>INCAR 可以设置为如下内容：</strong><br>INCAR设置如下(静态计算)：</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">PREC</span> = <span class="title class_">Accurate</span></span><br><span class="line"><span class="variable constant_">IBRION</span> = -<span class="number">1</span></span><br><span class="line"><span class="variable constant_">ENCUT</span> = <span class="number">500</span></span><br><span class="line"><span class="variable constant_">EDIFF</span> = <span class="number">1.0e-08</span></span><br><span class="line"><span class="variable constant_">EDIFFG</span> = -<span class="number">0.001</span></span><br><span class="line"><span class="variable constant_">ISMEAR</span> = <span class="number">0</span></span><br><span class="line"><span class="variable constant_">SIGMA</span> = <span class="number">0.05</span></span><br><span class="line"><span class="variable constant_">IALGO</span> = <span class="number">38</span></span><br><span class="line"><span class="variable constant_">LREAL</span> = .<span class="property">FALSE</span>.</span><br><span class="line"><span class="variable constant_">LWAVE</span> = .<span class="property">FALSE</span>.</span><br><span class="line"><span class="variable constant_">LCHARG</span> = .<span class="property">FALSE</span>.</span><br></pre></td></tr></table></figure>
<p><strong>KPOINTS需适当减小，可以的话最好再进行一次收敛测试</strong><br><strong>提交VASP计算</strong></p>
<p><strong>后处理</strong></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phonopy -f ./disp-*/vasprun.<span class="property">xml</span></span><br></pre></td></tr></table></figure>
<p>准备band.conf</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ATOM_NAME</span> = <span class="title class_">In</span> <span class="title class_">Se</span></span><br><span class="line"><span class="variable constant_">DIM</span> = <span class="number">4</span> <span class="number">4</span> <span class="number">1</span></span><br><span class="line"><span class="variable constant_">BAND</span> = <span class="number">0.5</span> <span class="number">0.0</span> <span class="number">0.0</span>  <span class="number">0.0</span> <span class="number">0.0</span> <span class="number">0.0</span>  <span class="number">0.333333</span> <span class="number">0.333333</span> <span class="number">0.0</span>  <span class="number">0.5</span> <span class="number">0.0</span> <span class="number">0.0</span></span><br><span class="line"><span class="variable constant_">FORCE_CONSTANTS</span> = <span class="variable constant_">WRITE</span>  #注意这里是 <span class="variable constant_">WRITE</span></span><br><span class="line"><span class="variable constant_">FC_SYMMETRY</span> = .<span class="property">TRUE</span>.</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">phonopy -c <span class="variable constant_">POSCAR</span>-unitcell band.<span class="property">conf</span> -p -s</span><br><span class="line">phonopy --factor=<span class="number">524.147</span> -c <span class="variable constant_">POSCAR</span>-unitcell -p -s band.<span class="property">conf</span></span><br><span class="line">#旧版本phonopy</span><br><span class="line">bandplot  --gnuplot&gt; phonon.<span class="property">dat</span></span><br><span class="line">就可以获得二阶力常数矩阵 <span class="variable constant_">FORCE_CONSTANTS</span> 和声子谱的数据</span><br><span class="line">#新版本phonopy</span><br><span class="line">phonopy-bandplot --gnuplot &gt; phonon.<span class="property">dat</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Mind</strong></p>
<ul>
<li>如果计算完的声子谱其他地方都好，就是在Γ点有一点点虚频，那么这个材料很可能是稳定的，只是你优化做得不够好，进一步提高优化的精度可消除这一点点虚频。</li>
<li>对于二维材料，如果在Γ点出现很小的虚频，基本可以认为这个材料是稳定的，大部分二维材料都会有此现象；尤其是VASP结合phonopy code计算二维材料的声子谱在Γ点更是容易出现虚频；使用Quantum-ESPRESSO的PWSCF和PH模块计算声子谱对于内存的需求较小一些，且对于二维材料的声子谱计算更友好一些，后期会详细介绍Quantum-ESPRESSO计算声子谱的具体步骤。</li>
<li>声子谱是表示组成材料原子的集体振动模式。如果材料的原胞包含n个原子，那么声子谱总共有3n支，其中有3条声学支，3n-3条光学支。声学支表示原胞的整体振动，光学支表示原胞内原子间的相对振动。</li>
</ul>
<p><strong>计算出的声子谱有虚频，往往表示该材料不稳定。</strong> 有些情况下，我们可以利用虚频信息使不稳定的材料变得稳定。如果声子谱的一条声学支存在虚频，主要位于Γ点和M点1&#x2F;2处（对应倒格矢的1&#x2F;4位置）。倒格矢的1&#x2F;4，对应晶格长度的4倍。我们可能需要将原胞沿上述倒格矢方向扩大四倍，进一步优化原子位置，才可能得到比较稳定的晶胞。</p>
<h1 id="消虚频"><a href="#消虚频" class="headerlink" title="消虚频"></a>消虚频</h1><ol>
<li>DFPT方法与有限位移法互换尝试。</li>
<li>扩胞，在虚频很小时可以尝试扩大扩胞倍数。</li>
<li>提高精度优化后计算声子谱。声子谱对力的精度要求特别高，所以提高精度多次优化后再计算声子谱也是可行的。</li>
<li>修改POTCAR，尝试不同的赝势方法。（不太建议，因为需改之后所有计算都需要统一成稳定构型的赝势。）</li>
<li>修改POSCAR原子坐标，再优化，再计算声子谱。<br>修改方法：对于DFPT计算的声子谱，使用<code>grep cm-1 OUTCAR</code>查看频率，寻找最大的虚频频率。然后在OUTCAR中从最后往前找到最大的虚频频率对应的坐标。<br>dx dy dz对应虚频的位移，把这些坐标与POSCAR中的坐标相加或者0.1-0.9之间的倍数，形成新的POSCAR。进行优化，再计算声子谱。</li>
<li>不排除真的算不出来没虚频的，据我所知，SnTe就没见到谁大大方方发文章谈声子谱的（算出来虚频消除不了不好意思讲）。</li>
</ol>
<h3 id="结构优化消虚频"><a href="#结构优化消虚频" class="headerlink" title="结构优化消虚频"></a>结构优化消虚频</h3><p>X, Y, Z为体系中原子的坐标，也就是POSCAR中的内容。 dx, dy,dz为虚频对应的原子振动方向上的位移。我们将（dx, dy,dz）这个位移乘以一个介于0-1之间的校正因子，然后跟POSCAR中的坐标加起来即可。以z方向为例，<strong>校正因子设为0.1，</strong> 微调后的z方向坐标为： 10.709980 + （-0.676634）0.1。<br>脚本vib_correct.py如下：<a target="_blank" rel="noopener" href="https://www.bigbrosci.com/2022/04/29/A29/">https://www.bigbrosci.com/2022/04/29/A29/</a></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># -*- <span class="attr">coding</span>: utf-<span class="number">8</span> -*-</span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">Qiang Li</span></span><br><span class="line"><span class="string">Command: python3 vib_correct.py </span></span><br><span class="line"><span class="string">This is a temporary script file.</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> ase.<span class="property">io</span> <span class="keyword">import</span> read, write</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">#获取虚频开始行</span><br><span class="line">l_position = <span class="number">0</span>  #虚频振动方向部分在<span class="variable constant_">OUTCAR</span>中的起始行数</span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;OUTCAR&#x27;</span>) <span class="keyword">as</span> <span class="attr">f_in</span>:</span><br><span class="line">    lines = f_in.<span class="title function_">readlines</span>()</span><br><span class="line">    wave_num = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> num, line <span class="keyword">in</span> <span class="title function_">enumerate</span>(lines):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;f/i&#x27;</span> <span class="keyword">in</span> <span class="attr">line</span>:</span><br><span class="line">            wave_tem = <span class="title function_">float</span>(line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">6</span>])</span><br><span class="line">            <span class="keyword">if</span> wave_tem &gt; <span class="attr">wave_num</span>: #获取最大的虚频</span><br><span class="line">                wave_num = wave_tem</span><br><span class="line">                l_position = num+<span class="number">2</span></span><br><span class="line"># <span class="variable constant_">ASE</span>读<span class="variable constant_">POSCAR</span></span><br><span class="line">model = <span class="title function_">read</span>(<span class="string">&#x27;POSCAR&#x27;</span>)</span><br><span class="line">model_positions = model.<span class="title function_">get_positions</span>()</span><br><span class="line">num_atoms = <span class="title function_">len</span>(model)</span><br><span class="line">#<span class="title function_">print</span>(model_positions)</span><br><span class="line"></span><br><span class="line"># 获取虚频对应的<span class="variable constant_">OUTCAR</span>部分 </span><br><span class="line">vib_lines = lines[<span class="attr">l_position</span>:l_position + num_atoms] #振动部分 <span class="number">7222</span>到<span class="number">7248</span>行</span><br><span class="line">#<span class="title function_">print</span>(vib_lines)</span><br><span class="line">vib_dis = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="attr">vib_lines</span>:</span><br><span class="line">    #model_positions = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[:<span class="number">3</span>]]</span><br><span class="line">    vib_infor = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">3</span>:]] # dx， dy， dz对应的那三列</span><br><span class="line">    vib_dis.<span class="title function_">append</span>(vib_infor)</span><br><span class="line">vib_dis = np.<span class="title function_">array</span>(vib_dis) #将振动部分写到一个array中。</span><br><span class="line"></span><br><span class="line"># 微调结构</span><br><span class="line">new_positions = model_positions + vib_dis * <span class="number">0.4</span> # <span class="number">0.4</span>是微调的校正因子，即虚频对应振动位移的<span class="number">0.4</span>，具体多大自己根据经验调。</span><br><span class="line">model.<span class="property">positions</span> = new_positions</span><br><span class="line"></span><br><span class="line">###保存结构</span><br><span class="line"><span class="title function_">write</span>(<span class="string">&#x27;POSCAR_new&#x27;</span>, model, vasp5=<span class="title class_">True</span>) # POSCAR_new是微调后的结构，用于下一步的计算（别忘了把POSCAR_new改成<span class="variable constant_">POSCAR</span>）。</span><br></pre></td></tr></table></figure>

<h3 id="过渡态虚频"><a href="#过渡态虚频" class="headerlink" title="过渡态虚频"></a>过渡态虚频</h3><p>如果过渡态计算的时候出现好几个虚频，自己直接写个python脚本也能实现。不过使用ASE可以很方便地获取POSCAR中原子数目，保存原子固定的信息。参考如下。</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/env python</span><br><span class="line"># -*- <span class="attr">coding</span>: utf-<span class="number">8</span> -*-</span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">Qiang Li</span></span><br><span class="line"><span class="string">Command: python3 vib_correct.py</span></span><br><span class="line"><span class="string">This is a temporary script file.</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">#获取虚频开始行</span><br><span class="line">l_position = <span class="number">0</span>  #虚频振动方向部分在<span class="variable constant_">OUTCAR</span>中的起始行数</span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;OUTCAR&#x27;</span>) <span class="keyword">as</span> <span class="attr">f_in</span>:</span><br><span class="line">    lines = f_in.<span class="title function_">readlines</span>()</span><br><span class="line">    wave_num = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> num, line <span class="keyword">in</span> <span class="title function_">enumerate</span>(lines):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;f/i&#x27;</span> <span class="keyword">in</span> <span class="attr">line</span>:</span><br><span class="line">            wave_tem = <span class="title function_">float</span>(line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">6</span>])</span><br><span class="line">            <span class="keyword">if</span> wave_tem &gt; <span class="attr">wave_num</span>: #获取最大的虚频</span><br><span class="line">                wave_num = wave_tem</span><br><span class="line">                l_position = num+<span class="number">2</span></span><br><span class="line"># 读<span class="variable constant_">POSCAR</span></span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;POSCAR&#x27;</span>) <span class="keyword">as</span> <span class="attr">f_pos</span>:</span><br><span class="line">    lines_pos = f_pos.<span class="title function_">readlines</span>()</span><br><span class="line"></span><br><span class="line"># 获取虚频对应的<span class="variable constant_">OUTCAR</span>部分    </span><br><span class="line">num_atoms = <span class="title function_">sum</span>([<span class="title function_">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> lines_pos[<span class="number">6</span>].<span class="title function_">rstrip</span>().<span class="title function_">split</span>()])</span><br><span class="line">vib_lines = lines[<span class="attr">l_position</span>:l_position + num_atoms] #振动部分 <span class="number">7222</span>到<span class="number">7248</span>行</span><br><span class="line"></span><br><span class="line">model_positions = []</span><br><span class="line">vib_dis = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="attr">vib_lines</span>:</span><br><span class="line">    position = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[:<span class="number">3</span>]]</span><br><span class="line">    vib_infor = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">3</span>:]] # dx， dy， dz对应的那三列</span><br><span class="line">    model_positions.<span class="title function_">append</span>(position)</span><br><span class="line">    vib_dis.<span class="title function_">append</span>(vib_infor)</span><br><span class="line"></span><br><span class="line"># 微调结构</span><br><span class="line">model_positions = np.<span class="title function_">array</span>(model_positions)</span><br><span class="line">vib_dis = np.<span class="title function_">array</span>(vib_dis) #将振动部分写到一个array中。</span><br><span class="line">new_positions = model_positions + vib_dis * <span class="number">0.4</span> # <span class="number">0.4</span>是微调的校正因子，即虚频对应振动位移的<span class="number">0.4</span>，具体多大自己根据经验调。</span><br><span class="line"></span><br><span class="line">###保存结构</span><br><span class="line">f_out = <span class="title function_">open</span>(<span class="string">&#x27;POSCAR_new&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f_out.<span class="title function_">writelines</span>(lines_pos[:<span class="number">8</span>])</span><br><span class="line">f_out.<span class="title function_">write</span>(<span class="string">&#x27;Cartesian\n&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="attr">new_positions</span>:</span><br><span class="line">    f_out.<span class="title function_">write</span>(<span class="string">&#x27; &#x27;</span>.<span class="title function_">join</span>([<span class="title function_">str</span>(coord) <span class="keyword">for</span> coord <span class="keyword">in</span> i]) + <span class="string">&#x27;  F  F  F\n&#x27;</span>)</span><br><span class="line">f_out.<span class="title function_">close</span>()</span><br></pre></td></tr></table></figure>

<h1 id="phonopy声子群速度"><a href="#phonopy声子群速度" class="headerlink" title="phonopy声子群速度"></a>phonopy声子群速度</h1><p>操作步骤</p>
<ol>
<li>首先对结构高精度优化后扩胞，计算得到没有虚频的声子谱；</li>
<li>对band.conf文件进行修改，并添加群速度计算相关参数<code>GROUP_VELOCITY = .TRUE.</code>和<code>GV_DELTA_Q = 0.01</code>，程序需要读取本征值和本征矢，所以必须设置 EIGENVECTORS &#x3D;.TRUE.，此外为了防止vaspkit在导出数据时报错，需要删除BAND_LABELS高对称路径名称，修改后band.conf文件内容如下；</li>
</ol>
<p>而且具体使用过程中，关于执行命令还有执行文件的tag内容还有一些可替换的关系,–gv, –group_velocity 可在执行计算命令时替代执行文件中的<code>GROUP_VELOCITY = .TRUE.</code>内容， –gv_delta_q 可在执行计算命令时替代执行文件中的(GV_DELTA_Q)内容</p>
<ol start="3">
<li>对声子谱重新进行计算，打开phonopy.yaml文件可以看到，phonopy在计算声子谱的过程中考虑到了群速度；打开band.yaml文件中也保存了有关群速度的相关信息；同时在计算声子谱中phonopy所储存的数据文件mesh.yaml和band.yaml文件中也保存了有关群速度的相关信息。</li>
<li>随后进行数据提取，以vaspkit1.12版本为例，打开vaspkit，输入<code>73</code>，打开VASP2other Interface 子功能，选择<code>739 Sort Phonon Band Structure for Phononpy</code>，运行完成即可获得group velocity相关数据以及各原子的声子谱数据；在运行过程中我们可以看到软件说明<code>find group velocity</code>并写入输出文件中。</li>
</ol>
<h1 id="格林艾森常数（Gruneisen-parameters）"><a href="#格林艾森常数（Gruneisen-parameters）" class="headerlink" title="格林艾森常数（Grüneisen parameters）"></a>格林艾森常数（Grüneisen parameters）</h1><p>为表示声子非简谐效应的参数。phonopy计算模式格林艾森参数方式见官网。<br>以NaCl为例，首先需要进行三个声子谱计算，分别是平衡体积（orig），稍小体积（minus）和稍大体积（plus）的结构，计算时改变晶格参数使得体积获得改变。</p>
<p>计算完成后获得不同体积下的原子间力常数文件FORCE_SETS 或 FORCE_CONSTANTS   （后续命令中需要添加–readfc参数）。</p>
<p>随后通过phonopy-gruneisen（旧版gruneisen）命令获得对应于声子带结构中倒易空间中的路径的模式格林艾森常数（具体设定可根据自身计算情况更改）<br><code>phonopy-gruneisen orig plus minus --dim=&quot;2 2 2&quot; --pa=&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot; --band=&quot;1/2 1/4 3/4 0 0 0 1/2 1/2 1/2 1/2 0.0 1/2&quot; -p -c POSCAR-unitcell</code><br>在倒易网格中的模式格林艾森常数（具体设定可根据自身计算情况更改）：<br><code>phonopy-gruneisen orig plus minus --dim=&quot;2 2 2&quot; --pa=&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot; --mesh=&quot;20 20 20&quot; -p -c POSCAR-unitcell --color=&quot;RB&quot;</code><br>phonopy-gruneisen 命令选项包括–dim，–mp, –mesh，–band，–pa, –primitive_axis，–readfc，–band_points，–nac，–factor，–nomeshsym，-p，-c，-s, –save，-o等，功能上均与phonopy命令相同，但除上述列出的选项外，可以在phonopy命令上使用的其它选项是不能在phonopy-gruneisen 上使用的。如有必要，可以自行修改phonopy-gruneisen代码。</p>
<p>如查看帮助，可输入<br><code>phonopy-gruneisen -h</code><br>通过 <code>phonopy-gruneisenplot </code>命令导出计算得到的数据，使用方式类似于<code>phonopy-bandplot</code>。</p>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/icehoqion/article/details/130550807">https://blog.csdn.net/icehoqion/article/details/130550807</a></p>
<h1 id="热学性质"><a href="#热学性质" class="headerlink" title="热学性质"></a>热学性质</h1><p>参考：<br><a target="_blank" rel="noopener" href="http://supersunsir.com/2020/08/01/vasp/vasp_phonopy/">http://supersunsir.com/2020/08/01/vasp/vasp_phonopy/</a></p>
<h2 id="热膨胀系数"><a href="#热膨胀系数" class="headerlink" title="热膨胀系数"></a>热膨胀系数</h2><p>我们通过准简谐近似（QHA）的方法计算热膨胀系数和等压热容等性质，</p>
<ul>
<li>首先，我们要把优化好的POSCAR加应变（比如0.96 0.97 0.98 0.99 1 1.01 1.02 1.03 1.04的缩放系数，这样就有9个结构文件），</li>
<li>然后 把每一个POSCAR都去重复步骤（2）也就是去计算每一个缩放系数声子谱。大概就是这个效果</li>
<li>最后我们通过phonopy里面的QHA模块 去得到此材料的非偕性质<code>phonopy-qha -p -s e-v.dat *00/thermal_properties.yaml</code>就可以得到很多热力学性质比如热膨胀系数，格林爱森参数，自由能，等压热容等等。</li>
</ul>
<ol>
<li>先进行高精度的晶格优化。</li>
<li>修改缩放系数为0.95-1.05新建10个POSCAR.</li>
<li>对11个POSCAR晶体进行声子谱计算</li>
<li>thermo.conf文件后处理生成11个对应的thermal_properties.yaml</li>
<li>QHA计算热膨胀系数</li>
</ol>
<p>另一个写的步骤：</p>
<ol>
<li>高精度的原胞优化</li>
<li>在此基础上施加形变（梯度可以设置为千分之一）</li>
<li>优化多个结构</li>
<li>使用DFPT方法计算每个结构的声子谱（如果结构有问题，使用phonopy –symmetry）</li>
<li>在每个文件夹中得到thermal_properties.yaml</li>
<li>运行脚本得到e-v.dat</li>
<li>运行phonopy-qha的相关命令得到各种dat文件</li>
<li>Over</li>
</ol>
<p>可以参考作者的thermo.conf文件：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">DIM</span> = <span class="number">2</span> <span class="number">2</span> <span class="number">2</span></span><br><span class="line"><span class="variable constant_">ATOM_NAME</span> = sio</span><br><span class="line"><span class="variable constant_">MP</span> = <span class="number">31</span> <span class="number">31</span> <span class="number">31</span></span><br><span class="line"><span class="variable constant_">TPROP</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">TMAX</span> = <span class="number">2000</span></span><br><span class="line"><span class="variable constant_">TSTEP</span> = <span class="number">2</span></span><br><span class="line"><span class="variable constant_">FORCE_CONSTANTS</span> = <span class="variable constant_">READ</span></span><br></pre></td></tr></table></figure><br>然后是如何写e-v.dat文件</p>
<ul>
<li>大概意思就是找到之前计算的那11个POSCAR的vasprun.xml结果文件，然后记事本打开搜索最后一个e_wo_entrp。</li>
<li>下载phonopy官方文件中Si-QHA的example，</li>
<li>解压vasprun_xmls.tar.lzma我们可以得到算例中用到的vasprun.xml文件。</li>
</ul>
<h2 id="不同温度下热力学性质计算（自由能、热容、振动熵）"><a href="#不同温度下热力学性质计算（自由能、热容、振动熵）" class="headerlink" title="不同温度下热力学性质计算（自由能、热容、振动熵）"></a>不同温度下热力学性质计算（自由能、热容、振动熵）</h2><ul>
<li><p>在DFPT或者Finite displacement方法计算声子谱的基础上，得到mesh.yaml文件</p>
</li>
<li><p>新建一个文件夹，将FORCE_CONSTANTS、POSCAR、mesh.conf放入该文件夹中（POSCAR为原胞）</p>
</li>
<li><p>得到mesh.yaml文件</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phonopy mesh.<span class="property">conf</span> -c <span class="variable constant_">POSCAR</span></span><br></pre></td></tr></table></figure>
<p>mesh.conf的内容</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ATOM_NAME</span> = <span class="title class_">Hf</span> <span class="title class_">Si</span> O</span><br><span class="line"><span class="variable constant_">DIM</span> = <span class="number">2</span> <span class="number">2</span> <span class="number">2</span></span><br><span class="line"><span class="variable constant_">MP</span> = <span class="number">13</span> <span class="number">13</span> <span class="number">13</span></span><br><span class="line"><span class="variable constant_">FORCE_CONSTANTS</span> = <span class="variable constant_">READ</span></span><br></pre></td></tr></table></figure>
<p>得到thermal_properties.yaml文件</p>
</li>
</ul>
<p><code>phonopy -c POSCAR mesh.conf  -t</code><br>得到thermal_properties.dat文件<br><code>phonopy-propplot --gnuplot thermal_properties.yaml &gt;thermal_properties.dat</code><br>将dat文件导入到Origin中画图</p>
<p>dat文件的5列数据分别为：</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">temperature[K]</span><br><span class="line"><span class="title class_">Free</span> energy [kJ/mol]</span><br><span class="line"><span class="title class_">Entropy</span> [J/K/mol]</span><br><span class="line"><span class="title class_">Heat</span> capacity [J/K/mol]</span><br><span class="line"><span class="title class_">Energy</span> [kJ/mol]</span><br></pre></td></tr></table></figure>
<h3 id="下面是能用到的各种命令"><a href="#下面是能用到的各种命令" class="headerlink" title="下面是能用到的各种命令"></a>下面是能用到的各种命令</h3><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">扩胞用</span><br><span class="line">phonopy -d --dim=<span class="string">&quot;2 2 2&quot;</span> -c <span class="variable constant_">POSCAR_UNIT</span></span><br><span class="line">查找晶格对称性</span><br><span class="line">phonopy --symmetry</span><br><span class="line">收集力常数</span><br><span class="line">phonopy --fc vasprun.<span class="property">xml</span></span><br><span class="line">得到band.<span class="property">yalm</span>文件（好像不需要这一步）</span><br><span class="line">phonopy --dim=<span class="string">&quot;2 2 2&quot;</span> -c <span class="variable constant_">POSCAR</span>-<span class="variable constant_">UNIT</span> -p band.<span class="property">conf</span></span><br><span class="line">得到thermal_properties.<span class="property">yaml</span>文件</span><br><span class="line">phonopy -c <span class="variable constant_">POSCAR</span> mesh.<span class="property">conf</span>  -t</span><br></pre></td></tr></table></figure>
<h3 id="下面是产生e-v-dat文件的脚本，需要根据自己的目录名进行修改："><a href="#下面是产生e-v-dat文件的脚本，需要根据自己的目录名进行修改：" class="headerlink" title="下面是产生e-v.dat文件的脚本，需要根据自己的目录名进行修改："></a>下面是产生e-v.dat文件的脚本，需要根据自己的目录名进行修改：</h3><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> -<span class="number">0.005</span> -<span class="number">0.004</span> -<span class="number">0.003</span> -<span class="number">0.002</span> -<span class="number">0.001</span> <span class="number">0.001</span> <span class="number">0.002</span> <span class="number">0.003</span> <span class="number">0.004</span> <span class="number">0.005</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"> cd AC_Uni$i;</span><br><span class="line"> pwd;</span><br><span class="line"> volume=<span class="string">`grep volume vasprun.xml | tail -1| awk &#x27;&#123;printf(&quot;%20.13f&quot;, $3)&#125;&#x27;`</span>;</span><br><span class="line"> energy=<span class="string">`grep &#x27;E0&#x27; OSZICAR | tail -1 | awk &#x27;&#123;printf &quot;%12.4f \t&quot;, $5&#125;&#x27;`</span>;</span><br><span class="line"> echo $&#123;volume&#125; $&#123;energy&#125; &gt;&gt; ../e-v.<span class="property">dat</span>;</span><br><span class="line"> cd ../; #<span class="title class_">Exit</span> the <span class="title class_">Strain</span> folder</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-47-25/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-47-25/" class="post-title-link" itemprop="url">2.2 AMSET</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:47:25" itemprop="dateCreated datePublished" datetime="2023-05-09T18:47:25+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-06-27 09:10:27" itemprop="dateModified" datetime="2023-06-27T09:10:27+08:00">2023-06-27</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><a target="_blank" rel="noopener" href="https://github.com/hackingmaterials/Amset">https://github.com/hackingmaterials/Amset</a><br><a target="_blank" rel="noopener" href="https://hackingmaterials.lbl.gov/amset/">https://hackingmaterials.lbl.gov/amset/</a><br><a target="_blank" rel="noopener" href="https://www.nature.com/articles/s41467-021-22440-5.pdf">https://www.nature.com/articles/s41467-021-22440-5.pdf</a></p>
<p>劳伦斯·伯克利国家实验室Alex M. Ganose和Anubhav Jain开发了一种根据第一性原理输入来计算固态半导体和绝缘体载流子散射率的有效计算方法(AMSET)。本方法扩展了现有的极性和非极性电子-声子耦合、离子化杂质和基于各向同性能带结构的压电散射机制的公式以支持高度各向异性的材料。他们通过计算23种半导体的电子传输特性来测试这个公式，包括48个大原子$CH_3NH_3PbI_3$混合钙钛矿，并将结果与实验测量结果和更详细的散射模拟进行比较。相对于实验的斯皮尔曼迁移率秩系数（rs &#x3D; 0.93）与使用恒定弛豫时间近似值（rs &#x3D; 0.52）获得的结果相比有明显提高。他们发现，他们的方法可提供与最新技术类似的精度，而计算成本约为1&#x2F;500，因此可在高通量计算工作流程中使用，以精确筛选载流子迁移率、寿命和热电功率。</p>
<ul>
<li>Inputs obtainable from first-principles calculations. The primary input for AMSET is an uniform band structure calculation.</li>
<li>Scattering rates calculated in the Born approximation using common materials properties such as phonon frequencies and dielectric constants.</li>
<li>Transport properties calculated through the Boltzmann transport equation.</li>
<li>Efficient implementation that can run on a personal laptop.</li>
</ul>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>pymatgen&#x3D;&#x3D;2023.3.23<br>scipy&#x3D;&#x3D;1.10.1<br>monty&#x3D;&#x3D;2022.9.9<br>matplotlib&#x3D;&#x3D;3.7.1<br>BoltzTraP2&#x3D;&#x3D;22.12.1<br>tqdm&#x3D;&#x3D;4.65.0<br>tabulate&#x3D;&#x3D;0.9.0<br>memory_profiler&#x3D;&#x3D;0.61.0<br>spglib&#x3D;&#x3D;2.0.2<br>click&#x3D;&#x3D;8.1.3<br>sumo&#x3D;&#x3D;2.3.6<br>h5py&#x3D;&#x3D;3.8.0<br>pyFFTW&#x3D;&#x3D;0.13.0<br>interpolation&#x3D;&#x3D;2.2.4<br>numba&#x3D;&#x3D;0.56.4</p>
<h3 id="conda-environment"><a href="#conda-environment" class="headerlink" title="conda environment"></a>conda environment</h3><p>pip install amset</p>
<h3 id="Developer-Installation"><a href="#Developer-Installation" class="headerlink" title="Developer Installation"></a>Developer Installation</h3> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone <span class="attr">https</span>:<span class="comment">//github.com/hackingmaterials/amset.git</span></span><br><span class="line">cd amset</span><br><span class="line">pip install -e .</span><br></pre></td></tr></table></figure>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h3 id="Structural-relaxation"><a href="#Structural-relaxation" class="headerlink" title="Structural relaxation:"></a>Structural relaxation:</h3><p>“tight” calculation settings<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ADDGRID</span> = <span class="title class_">True</span>  </span><br><span class="line"><span class="variable constant_">EDIFF</span> = <span class="number">1E-8</span>   </span><br><span class="line"><span class="variable constant_">EDIFFG</span> = -<span class="number">5E-4</span>  </span><br><span class="line"><span class="variable constant_">PREC</span> = <span class="title class_">Accurate</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Dense-uniform-band-structure-and-wave-function-coefficients"><a href="#Dense-uniform-band-structure-and-wave-function-coefficients" class="headerlink" title="Dense uniform band structure and wave function coefficients:"></a>Dense uniform band structure and wave function coefficients:</h3><p>2倍的K点密度，HSE06 is required，输出波函数，</p>
<figure class="highlight plaintext"><figcaption><span>wave ``` 得到</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">```wavefunction.h5 file ```</span><br><span class="line">### Elastic constants：</span><br><span class="line">&quot;tight&quot;relax   </span><br><span class="line"> ```javascript  &#123;.line-numbers&#125;  </span><br><span class="line"> NSW = 1  </span><br><span class="line"> IBRION = 6</span><br></pre></td></tr></table></figure>
<h3 id="Deformation-potentials："><a href="#Deformation-potentials：" class="headerlink" title="Deformation potentials："></a>Deformation potentials：</h3><p><code>amset deform create </code><br>single point calculation，<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">NSW</span> = <span class="number">1</span>   </span><br><span class="line"><span class="variable constant_">ICORELEVEL</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure><br><code>amset deform read undeformed def-1 def-2 def-3  </code><br>产生deformation.h5 file。</p>
<h3 id="Dielectric-constants-piezoelectric-constants-and-polar-phonon-frequency："><a href="#Dielectric-constants-piezoelectric-constants-and-polar-phonon-frequency：" class="headerlink" title="Dielectric constants, piezoelectric constants and polar-phonon frequency："></a>Dielectric constants, piezoelectric constants and polar-phonon frequency：</h3><p>DFPT方法，Note, DFPT cannot be used with hybrid exchange-correlation functionals. In these cases the LCALCEPS flag should be used in combination with  <code>IBRION = 6 </code></p>
 <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">NSW</span> = <span class="number">1</span></span><br><span class="line"><span class="variable constant_">IBRION</span> = <span class="number">8</span></span><br><span class="line"><span class="variable constant_">LEPSILON</span> = <span class="title class_">True</span></span><br></pre></td></tr></table></figure>

<p><code>amset phonon-frequency </code><br>读取DFPT的 vasprun.xml 获得 dielectric constants 和 polar phonon frequency。</p>
<h1 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h1><p>有两种方式，Python脚本<br>或者通过读取settings.yaml和输入文件加命令行运行</p>
<h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><p><code>cp path/example/Si/Si.py  .</code><br>脚本如下：</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">from</span> amset.<span class="property">core</span>.<span class="property">run</span> <span class="keyword">import</span> <span class="title class_">Runner</span></span><br><span class="line"><span class="keyword">from</span> amset.<span class="property">plot</span>.<span class="property">rates</span> <span class="keyword">import</span> <span class="title class_">RatesPlotter</span></span><br><span class="line">warnings.<span class="title function_">simplefilter</span>(<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line">settings = &#123;</span><br><span class="line">   #general settings</span><br><span class="line">   <span class="string">&quot;scattering_type&quot;</span>: [<span class="string">&quot;IMP&quot;</span>, <span class="string">&quot;ADP&quot;</span>],</span><br><span class="line">   <span class="string">&quot;doping&quot;</span>: [-<span class="number">1.99e14</span>, -<span class="number">2.20e15</span>, -<span class="number">1.72e16</span>, -<span class="number">1.86e17</span>, -<span class="number">1.46e18</span>, -<span class="number">4.39e18</span>],</span><br><span class="line">   <span class="string">&quot;temperatures&quot;</span>: [<span class="number">300</span>],</span><br><span class="line">   <span class="string">&quot;bandgap&quot;</span>: <span class="number">1.14</span>,</span><br><span class="line">   #electronic_structure settings</span><br><span class="line">   <span class="string">&quot;interpolation_factor&quot;</span>: <span class="number">50</span>,</span><br><span class="line">   #materials properties</span><br><span class="line">   <span class="string">&quot;deformation_potential&quot;</span>: <span class="string">&quot;deformation.h5&quot;</span>,</span><br><span class="line">   <span class="string">&quot;elastic_constant&quot;</span>: [</span><br><span class="line">       [<span class="number">144</span>, <span class="number">53</span>, <span class="number">53</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">       [<span class="number">53</span>, <span class="number">144</span>, <span class="number">53</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">       [<span class="number">53</span>, <span class="number">53</span>, <span class="number">144</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">       [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">75</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">       [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">75</span>, <span class="number">0</span>],</span><br><span class="line">       [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">75</span>],</span><br><span class="line">       [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">75</span>],</span><br><span class="line">   ],</span><br><span class="line">   <span class="string">&quot;static_dielectric&quot;</span>: [[<span class="number">11.7</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">11.7</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">11.7</span>]],</span><br><span class="line">   <span class="string">&quot;high_frequency_dielectric&quot;</span>: [[<span class="number">11.7</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">11.7</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">11.7</span>]],</span><br><span class="line">   #performance settings</span><br><span class="line">   <span class="string">&quot;write_mesh&quot;</span>: <span class="title class_">True</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">   runner = <span class="title class_">Runner</span>.<span class="title function_">from_vasprun</span>(<span class="string">&quot;vasprun.xml&quot;</span>, settings)</span><br><span class="line">   amset_data = runner.<span class="title function_">run</span>()</span><br><span class="line"></span><br><span class="line">   plotter = <span class="title class_">RatesPlotter</span>(amset_data)</span><br><span class="line">   plt = plotter.<span class="title function_">get_plot</span>()</span><br><span class="line">   plt.<span class="title function_">savefig</span>(<span class="string">&quot;Si_rates.png&quot;</span>, bbox_inches=<span class="string">&quot;tight&quot;</span>, dpi=<span class="number">400</span>)</span><br></pre></td></tr></table></figure>

<p>python Si.py 即可</p>
<h2 id="命令行设置"><a href="#命令行设置" class="headerlink" title="命令行设置"></a>命令行设置</h2><p>需要准备settings.yaml文件：以Si为例：</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> # general settings</span><br><span class="line"> <span class="attr">scattering_type</span>: [<span class="variable constant_">IMP</span>, <span class="variable constant_">ADP</span>]</span><br><span class="line"> <span class="attr">doping</span>: [-<span class="number">1.99e14</span>, -<span class="number">2.20e15</span>, -<span class="number">1.72e16</span>, -<span class="number">1.86e17</span>, -<span class="number">1.46e18</span>, -<span class="number">4.39e18</span>]</span><br><span class="line"> <span class="attr">temperatures</span>: [<span class="number">300</span>]</span><br><span class="line"> <span class="attr">bandgap</span>: <span class="number">1.14</span></span><br><span class="line"></span><br><span class="line"> # electronic_structure settings</span><br><span class="line"> <span class="attr">interpolation_factor</span>: <span class="number">50</span></span><br><span class="line"></span><br><span class="line"> # materials properties</span><br><span class="line"> <span class="attr">deformation_potential</span>: deformation.<span class="property">h5</span></span><br><span class="line"> <span class="attr">elastic_constant</span>:</span><br><span class="line">  - [<span class="number">144</span>,  <span class="number">53</span>,  <span class="number">53</span>,  <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">0</span>]</span><br><span class="line">  - [ <span class="number">53</span>, <span class="number">144</span>,  <span class="number">53</span>,  <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">0</span>]</span><br><span class="line">  - [ <span class="number">53</span>,  <span class="number">53</span>, <span class="number">144</span>,  <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">0</span>]</span><br><span class="line">  - [  <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">75</span>,  <span class="number">0</span>,  <span class="number">0</span>]</span><br><span class="line">  - [  <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">0</span>, <span class="number">75</span>,  <span class="number">0</span>]</span><br><span class="line">  - [  <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">0</span>, <span class="number">75</span>]</span><br><span class="line"><span class="attr">static_dielectric</span>:</span><br><span class="line">  - [<span class="number">11.7</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">  - [<span class="number">0</span>, <span class="number">11.7</span>, <span class="number">0</span>]</span><br><span class="line">  - [<span class="number">0</span>, <span class="number">0</span>, <span class="number">11.7</span>]</span><br><span class="line"><span class="attr">high_frequency_dielectric</span>:</span><br><span class="line">  - [<span class="number">11.7</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">  - [<span class="number">0</span>, <span class="number">11.7</span>, <span class="number">0</span>]</span><br><span class="line">  - [<span class="number">0</span>, <span class="number">0</span>, <span class="number">11.7</span>]</span><br><span class="line"> #performance settings</span><br><span class="line"> <span class="attr">write_mesh</span>: <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>amset run –directory path&#x2F;to&#x2F;files 运行即可<br>其他设置可以通过命令行加入：<br>amset run –interpolation-factor 20<br>画图：<br>amset plot rates mesh_99x99x99.h5</p>
<p>Output filesThe transport results will be written to <code>transport_99x99x99.json</code>. The <code>99x99x99</code> is thefinal interpolated mesh upon which scattering rates and the transport properties arecomputed.The <code>write_mesh</code> option is set to True, meaning scattering rates for all doping levelsand temperatures will be written to the <code>mesh_99x99x99.h5</code> file.</p>
<h2 id="设置相关参数："><a href="#设置相关参数：" class="headerlink" title="设置相关参数："></a>设置相关参数：</h2><h3 id="General-settings"><a href="#General-settings" class="headerlink" title="General settings"></a>General settings</h3><ol>
<li>scattering_type：Default:  <code>auto </code>；单独设置： <code>ADP,IMP,POP </code>。<br>ADP (acoustic deformation potential scattering)<br>IMP (ionized impurity scattering)<br>PIE (piezoelectric scattering)<br>POP (polar optical phonon scattering)<br>CRT (constant relaxation time)<br>MFP (mean free path scattering)</li>
<li>doping：负值代表电子，正值代表空穴<br>Default:  <code>[&#39;1.e15&#39;, &#39;1.e16&#39;, &#39;1.e17&#39;, &#39;1.e18&#39;, &#39;1.e19&#39;, &#39;1.e20&#39;, &#39;-1.e15&#39;, &#39;-1.e16&#39;, &#39;-1.e17&#39;, &#39;-1.e18&#39;, &#39;-1.e19&#39;, &#39;-1.e20&#39;] </code><br>单独设置有两种： <code>1E13,1E14,1E15,1E16,1E17,1E18,1E19,1E20 </code> 或者  <code>1E13:1E20:8 </code></li>
<li>temperatures：Default: [300]<br>单独设置：<code>300,400,500,600,700,800,900,1000</code> 或者<code>300:1000:8</code></li>
<li>interpolation_factor：Default: 10<br>控制插值密度，最终的k点等于能带计算的k点乘上插值因子。</li>
<li>wavefunction_coefficients：Default: wavefunction.h5<br>波函数系数读取的方式，产生该文件可以通过<code>amset wave</code>获得。</li>
<li>bandgap：<br>设置该参数会自动采用scissor修正，因此不能与<code>scissor</code>选项共用，且对金属不起作用。</li>
<li>scissor：<br>正值代表带隙打开，负值代表缩小，对金属无效。</li>
<li>zero_weighted_kpoints：<br>设置方式：<br>keep: Keep zero-weighted k-points in the band structure.<br>drop: Drop zero-weighted k-points, keeping only the weighted k-points.<br>prefer: Drop weighted-kpoints if zero-weighted k-points are present in the calculation (useful for cheap hybrid calculations).</li>
<li>use_projections：Default: False<br>不建议设置。该参数使用投影计算波函数交叠，往往导致差的性能，使用时设置<code>LORBIT = 11</code></li>
<li>free_carrier_screening：Default: False<br>控制是否屏蔽极化光学声子和压电散射率。这可以导致在高载流子浓度下散射率的大幅度降低。</li>
</ol>
<h3 id="Material-settings"><a href="#Material-settings" class="headerlink" title="Material settings"></a>Material settings</h3><ol start="11">
<li>high_frequency_dielectric：Required for: POP, PIE</li>
<li>static_dielectric：Required for: IMP, POP</li>
<li>elastic_constant：Required for: ADP, PIE</li>
<li>deformation_potential：Required for: ADP</li>
<li>piezoelectric_constant：Required for: PIE</li>
<li>defect_charge：Required for: IMP。Default: 1</li>
<li>pop_frequency：Required for: POP    <code>amset phonon-frequency</code>获得。</li>
<li>compensation_factor：Required for: IMP    Default: 2</li>
<li>mean_free_path：Required for: MFP</li>
<li>constant_relaxation_time：Required for: CRT  不建议和其他散射机制设置。</li>
</ol>
<h3 id="Performance-settings：控制速度和精度，一般默认。"><a href="#Performance-settings：控制速度和精度，一般默认。" class="headerlink" title="Performance settings：控制速度和精度，一般默认。"></a>Performance settings：控制速度和精度，一般默认。</h3><ol start="21">
<li>energy_cutoff：Default: 1.5</li>
<li>fd_tol：Default: 0.05. 0-1之间，越小计算K点越多。</li>
<li>dos_estep:Default: 0.01.越小越好越贵。</li>
<li>symprec：Default: 0.01。</li>
<li>nworkers：Default: -1。代表用所有的机器。其他设置代表几个。</li>
<li>cache_wavefunction：Default: True。加速计算，增加内存。如果内存不够关闭。</li>
</ol>
<h3 id="Output-settings：输出文件设置"><a href="#Output-settings：输出文件设置" class="headerlink" title="Output settings：输出文件设置"></a>Output settings：输出文件设置</h3><ol start="27">
<li>calculate_mobility：Default: True。是否计算n&#x2F;p载流子迁移率。</li>
<li>separate_scattering_mobilities：Default: True。是否计算单独的散射机制的迁移率。</li>
<li>write_mesh：Default: False。是否将全K点结果写入磁盘。对于大的interpolation_factor可以打开。</li>
<li>file_format：Default: json。输出文件的格式：json, yaml, and txt.对于write_mesh&#x3D;True不能用TXT。</li>
<li>write_input：Default: False。是否将输入设置写入<code>amset_settings</code>.yaml.</li>
<li>print_log：Default: True。是否输出日志。</li>
</ol>
<h2 id="Summary-of-scattering-rates"><a href="#Summary-of-scattering-rates" class="headerlink" title="Summary of scattering rates"></a>Summary of scattering rates</h2><table>
<thead>
<tr>
<th>Mechanism</th>
<th>Code</th>
<th>Requires</th>
<th>Type</th>
</tr>
</thead>
<tbody><tr>
<td>Acoustic deformation potential scattering</td>
<td>ADP</td>
<td>n- and p-type deformation potential, elastic constant</td>
<td>Elastic</td>
</tr>
<tr>
<td>Piezoelectric scattering</td>
<td>PIE</td>
<td>high-frequency dielectric constant, elastic constant, piezoelectric coefficient (e)</td>
<td>Elastic</td>
</tr>
<tr>
<td>Polar optical phonon scattering</td>
<td>POP</td>
<td>polar optical phonon frequency, static and high-frequency dielectric constants</td>
<td>Inelastic</td>
</tr>
<tr>
<td>Ionized impurity scattering</td>
<td>IMP</td>
<td>static dielectric constant</td>
<td>Elastic</td>
</tr>
</tbody></table>
<h1 id="其他功能"><a href="#其他功能" class="headerlink" title="其他功能"></a>其他功能</h1><p>you can use amset which relies on Fourier interpolation of the band<br>structure using BoltzTraP2. There are two options.</p>
<ul>
<li>Use <code>amset eff-mass</code>: This calculates the conductivity effective mass as defined here: <a target="_blank" rel="noopener" href="https://www.nature.com/articles/s41524-017-0013-3">https://www.nature.com/articles/s41524-017-0013-3</a></li>
<li>Use <code>amset plot band --stats vasprun.xml</code>: This calculates the effective mass in the same way as sumo but using a band structure interpolated from a uniform calculation.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-47-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-47-24/" class="post-title-link" itemprop="url">2.1 电子性质1</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:47:24" itemprop="dateCreated datePublished" datetime="2023-05-09T18:47:24+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-06-27 09:06:54" itemprop="dateModified" datetime="2023-06-27T09:06:54+08:00">2023-06-27</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="自洽计算"><a href="#自洽计算" class="headerlink" title="自洽计算"></a>自洽计算</h1><p><strong>VASP做静态自洽的目的主要是为了得到好的电子密度和波函数文件，为了使后续的性质计算可以读取电子密度和波函数，进而增加收敛速度。</strong><br>首先进行 <strong>高精度</strong> 的结构优化。然后复制文件， cp CONTCAR POSCAR 做一次自洽计算。<br>自洽计算要求有密的k网格点，在计算条件允许的情况下要求自洽的k网格点大致为优化时的2倍左右。<br>修改标签<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">IBRION</span>=-<span class="number">1</span></span><br><span class="line"><span class="variable constant_">NSW</span>=<span class="number">0</span></span><br><span class="line"><span class="variable constant_">LWAVE</span>  = .<span class="property">T</span>.        (<span class="title class_">Write</span> <span class="variable constant_">WAVECAR</span> )</span><br><span class="line"><span class="variable constant_">LCHARG</span> = .<span class="property">T</span>.        (<span class="title class_">Write</span> <span class="variable constant_">CHGCAR</span> )</span><br></pre></td></tr></table></figure><br>这一步完成后的输出文件CHGCAR即是电荷密度，导入VESTA直接查看。</p>
<h2 id="bader电荷"><a href="#bader电荷" class="headerlink" title="bader电荷"></a>bader电荷</h2><p>自洽时INCAR再加一个参数：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">IBRION</span>=-<span class="number">1</span></span><br><span class="line"><span class="variable constant_">NSW</span>=<span class="number">0</span></span><br><span class="line"><span class="variable constant_">LAECHG</span>=.<span class="property">T</span>.</span><br></pre></td></tr></table></figure></p>
<p>输出文件：<br>AECCAR0 全电子中的芯电子部分（POTCAR）<br>AECCAR1 自洽计算前的交叠原子电荷（POTCAR，bader 分析不用）<br>AECCAR2 全电子中的价电子部分（自洽计算后）<br>CHGCAR 自洽计算后赝电子</p>
<p>输入：</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chgsum.<span class="property">pl</span> <span class="title class_">AECCAR0</span> <span class="title class_">AECCAR2</span></span><br><span class="line">bader <span class="variable constant_">CHGCAR</span> -ref CHGCAR_sum</span><br></pre></td></tr></table></figure>
<p>得到两个文件：</p>
<ul>
<li><strong>BCF.dat</strong> 电荷极大值序号和坐标<br>体积内的 Bader 电荷（积分）<br>距离极大值最近的原子和距离</li>
<li><strong>ACF.dat</strong> 原子序号和坐标<br>原子电荷（极大值的电荷之后）<br>到零通量面最小距离<br>原子体积</li>
</ul>
<p>李强博士《learn vasp the hard way》<a target="_blank" rel="noopener" href="https://www.bigbrosci.com/2011/12/24/A08/">https://www.bigbrosci.com/2011/12/24/A08/</a> Bader电荷与原子电荷着色：<br><a target="_blank" rel="noopener" href="https://www.bigbrosci.com/2011/12/23/A07/">https://www.bigbrosci.com/2011/12/23/A07/</a> <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/BNzjhz8SI_HXkaEnyL29Bg">https://mp.weixin.qq.com/s/BNzjhz8SI_HXkaEnyL29Bg</a></p>
<h2 id="成键反键"><a href="#成键反键" class="headerlink" title="成键反键"></a>成键反键</h2><p>自洽时添加：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">NBANDS</span>=<span class="number">96</span></span><br><span class="line"><span class="variable constant_">ISYM</span>=-<span class="number">1</span></span><br><span class="line"><span class="variable constant_">IBRION</span>=-<span class="number">1</span></span><br><span class="line"><span class="variable constant_">NSW</span>=<span class="number">0</span></span><br><span class="line"><span class="variable constant_">LWAVE</span> = T</span><br></pre></td></tr></table></figure></p>
<p><code>vi lobsterin</code><br>原子编号改为 8 和 6<br><code>lobster &lt; lobsterin</code><br>1、删除存在的WAVECAR文件，做单点计算，计算需要保存波函数文件；<br>2、做完单点计算在当前目录下运行lobster软件；<br>3、用wxDragon软件打开COHPCAR.lobster文件。<br><a target="_blank" rel="noopener" href="https://github.com/JaGeo/LobsterPy">https://github.com/JaGeo/LobsterPy</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/470592188">https://zhuanlan.zhihu.com/p/470592188</a></p>
<h2 id="ELF电子局域函数计算"><a href="#ELF电子局域函数计算" class="headerlink" title="ELF电子局域函数计算"></a>ELF电子局域函数计算</h2><p>电子局域函数（Electron Localization Function—ELF）是研究电子结构的手段之一。用来描述以某个位置处的电子为参考，在其附近找到与他同自旋的电子的概率，可以表征这个作为参考的电子的局域化程度，也是一种描述在多电子体系中的电子对概率的方法。<br>ELF的取值范围是[0，1]。<br>ELF&#x3D;1 对应完全局域化；<br>ELF&#x3D;1&#x2F;2，对应类电子气型的成对概率；<br>ELF&#x3D;0，对应电子完全离域化。</p>
<p>计算流程：做自洽的时候在INCAR中加入：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">PREC</span>=A</span><br><span class="line"><span class="variable constant_">LELF</span>=T</span><br><span class="line"><span class="variable constant_">IBRION</span>=-<span class="number">1</span></span><br><span class="line"><span class="variable constant_">NSW</span>=<span class="number">0</span> </span><br></pre></td></tr></table></figure><br>运行vasp得到ELFCAR文件。</p>
<p>将ELFCAR拖入Vesta <a target="_blank" rel="noopener" href="http://www.jp-minerals.org/vesta/en/download.html">http://www.jp-minerals.org/vesta/en/download.html</a></p>
<p>点击 Utiltties - 2D Data Display。<br>点击Slice，确定切面和fractional coordinates。<br>导出图片：之后可以用PS工具将原子模型加入。</p>
<h2 id="费米面"><a href="#费米面" class="headerlink" title="费米面"></a>费米面</h2><p>费米面计算，这里我们以Cu为例，见vaspkit&#x2F;examples&#x2F;Cu_fermi_surface。<br>第一步，准备好POSCAR，注意一定是原胞（primitive cell ）和用于静态计算的INCAR文件；<br>第二步，运行VASPKIT，输入261命令，产生用于计算计算费米面的KPOINTS和POTCAR文件，<br>第三步，提交VASP作业；第四步，待VASP计算完成后，再次运行VASPKIT，输入262命令，生成包含费米面数据的FERMISURFACE.bxsf文件；第五步，运行XcrySDen软件。<br>发现第五条能带穿过费米面，因此我们选择Band Number 5，然后点击Selected，然后得到Cu的费米面。推荐使用FermiSurfer可视化费米面。<br>对于半导体不存在费米面，如果想可视化导带或价带中某个能级处的等能面，新建FERMI_ENERGY.in文件然后在该文件第二行（第一行为注释行）中人为指定能级大小，注意该值一定要保证穿过价带或导带。接下来调用vaspkit-252或263命令提取可视化。</p>
<h1 id="态密度"><a href="#态密度" class="headerlink" title="态密度"></a>态密度</h1><p>自洽计算之后，读取产生的CHGCAR、WAVECAR<br>上面例如bader电荷、ELF标签都关闭。<br>INCAR中修改：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ISTART</span>=<span class="number">1</span></span><br><span class="line"><span class="variable constant_">ICHARG</span>=<span class="number">11</span></span><br><span class="line"><span class="variable constant_">ISMEAR</span>=-<span class="number">5</span></span><br><span class="line"><span class="variable constant_">NEDOS</span>=<span class="number">2001</span></span><br><span class="line"><span class="variable constant_">LORBIT</span>=<span class="number">11</span></span><br></pre></td></tr></table></figure><br><strong>其他参数和自洽时保持一致。</strong><br>运行后vaspkit的111&#x2F;112&#x2F;113&#x2F;114命令处理即可得到。</p>
<h2 id="分波态密度和局域态密度"><a href="#分波态密度和局域态密度" class="headerlink" title="分波态密度和局域态密度"></a>分波态密度和局域态密度</h2><p>态密度很多分析和能带的分析结果可以一一对应，很多术语也和能带分析相通。但是因为它更直观，因此在结果讨论中用得比能带分析更广泛一些。在电子能级为准连续分布的情况下，单位能量间隔内的电子态数目，即为态密度。能态密度与能带结构密切相关，是一个重要的基本函数。固体的许多特性，如电子比热、光和X射线的吸收和发射等，都与能态密度有关。在VASP中，LORBIT&#x3D;10计算的就是LDOS，也就是每个原子的局域态密度 (local DOS)，是分解到每个原子上面的s,p,d；LORBIT&#x3D;11，计算的就是PDOS,投影态密度(projected DOS)或分波态密度(partial DOS)，不仅分解到每个原子的s,p,d,而且还进行px,py,pz分解。</p>
<p>在 <code>/vaspkit.0.72/examples/LDOS_PDOS/Partial_DOS_of_CO_on_Ni_111_surface </code>目录下启动 <code>vaspkit </code>，输入命令 <code>115 </code>选择子功能 <code>The Sum of Projected DOS for Selected Atoms and orbitals </code>。我们需要提取的是O的s，p轨道，C的s，p轨道以及表面的dxy和d3z2-r2(dz2)轨道。首先提示你选择元素（累加），第一次输入元素O，回车后提示你输入提取的轨道名（累加），第一次输入轨道s。回车后重复以上两个操作。如果想结束输入，在元素选择行直接按回车键结束输入。</p>
<p>元素行接受自由格式输入，你可以输入以下内容元素行接受自由格式输入，你可以输入以下内容<code>1-3 4 Ni</code>表示选择元素1,2,3,4和Ni元素的PDOS进行累加。轨道行只支持标准输入，如果使用了<code>LORBIT=10</code>不投影轨道，你只能选择 s p d f中的一个或多个，如果使用了<code>LORBIT=11</code>投影了轨道，你可以从s p d f和s py pz px dxy dyz dz2 dxz dx2 f-3 f-2 f-1 f0 f1 f2 f3中选择一个或多个输入。轨道行还支持输入all计算所有轨道的DOS之和。</p>
<p>比如元素行输入C O ,对应的轨道选择s px，那么提取的就是所有C和O元素的s轨道和px轨道的PDOS之和。 PDOS_USER.dat中的轨道名 为#Energy C&amp;O_s&amp;px，显而易懂。</p>
<h1 id="能带计算"><a href="#能带计算" class="headerlink" title="能带计算"></a>能带计算</h1><p>参考链接：<br><a target="_blank" rel="noopener" href="https://yh-phys.github.io/2019/10/04/vasp-band-structure-dos/">https://yh-phys.github.io/2019/10/04/vasp-band-structure-dos/</a><br>自洽计算之后，读取产生的CHGCAR、WAVECAR<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ISTART</span>=<span class="number">1</span></span><br><span class="line"><span class="variable constant_">ICHARG</span>=<span class="number">11</span></span><br></pre></td></tr></table></figure><br><strong>其他参数和自洽时保持一致。</strong></p>
<p><strong>能带计算的KPOINTS文件不同于前面，称为高对称点。</strong><br>学术之友微信公众号历史记录搜索文章《五种方法生成能带结构计算的高对称点》<br>1、<a target="_blank" rel="noopener" href="http://cryst.ehu.es/">http://cryst.ehu.es/</a><br>2、<a target="_blank" rel="noopener" href="https://www.materialscloud.org/work/tools/seekpath">https://www.materialscloud.org/work/tools/seekpath</a><br>3、<a target="_blank" rel="noopener" href="http://www.aflowlib.org/aflow-online">http://www.aflowlib.org/aflow-online</a> (已更新)<br>4、<a target="_blank" rel="noopener" href="http://pymatgen.org/">http://pymatgen.org/</a> (pymatgen)<br>5、<a target="_blank" rel="noopener" href="http://www.xcrysden.org/">http://www.xcrysden.org/</a> (XCrySDen)<br>Accurate DOS and Band-structure calculations：<br><a target="_blank" rel="noopener" href="http://cms.mpi.univie.ac.at/vasp/vasp/Accurate_DOS_Band_structure_calculations.html">http://cms.mpi.univie.ac.at/vasp/vasp/Accurate_DOS_Band_structure_calculations.html</a></p>
<p>可以通过vaspkit的303命令产生KPATH.in文件，cp KPATH.in KPOINTS即可。<br>计算完成后通过vaspkit的211命令提取能带。<br><strong>注意能带路径生成操作需在自洽计算前完成。</strong></p>
<ul>
<li><p>1.准备POSCAR，调用vaspkit- 303（体相材料）或-302（二维材料）得到KPATH.in和PRIMCELL.in文件；对于二维体系，需要检查POSCAR文件的真空层是否沿z方向，如果没有，可调用vaspkit-923或vaspkit-407强制真空层沿z方向。另外，如果需要改变识别结构对称性精度（symprec默认值为1E-5），可通过vaspkit -task 302 -symprec 1E-6实现或者在~&#x2F;.vaspkit中修改SYMPREC默认值。</p>
</li>
<li><p>2.执行cp PRIMCELL.vasp POSCAR命名。KPATH.in推荐能带路径只针对于PRIMITIVE CELL，缺少这一步，你可能得到错误的结果。如果有必要，比较KPATH.in文件中的能带路径是否与在线能带路径产生工具SeeK-Path产生的一致，包括比较PRIMCELL.vasp和HIGH_SYMMETRY_POINTS文件。需要指出的是SeeK-Path只用于体相结构能带路径的产生。自1.3.0版本，对于二维体系不需要执行cp PRIMCELL.vasp POSCAR。</p>
</li>
</ul>
<h2 id="投影电荷密度"><a href="#投影电荷密度" class="headerlink" title="投影电荷密度"></a>投影电荷密度</h2><p>复制能带结构文件，<br>vi INCAR<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">增加标签 <span class="variable constant_">LPARD</span>=.<span class="property">T</span>.</span><br><span class="line">增加标签 <span class="variable constant_">IBAND</span>=<span class="number">16</span> <span class="number">17</span></span><br><span class="line">增加标签 <span class="variable constant_">LSEPB</span>=.<span class="property">T</span>.</span><br></pre></td></tr></table></figure></p>
<ul>
<li>LPARD：它的取值为.TRUE.或.FALSE.，它的默认值是.FALSE.，当为.TRUE.时，表示读入自<br>洽收敛的 CHGCAR 和 WAVECAR 并进行 partial charge density计算。</li>
<li>IBAND：它的取值就是你想要计算的第几条能带或哪几条能带(比如要计算第 4、 5、 6 条能带，那么就设置 IBAND &#x3D; 4 5 6)，此时 NBMOD的值就是所要计算的能带的条数。</li>
<li>EINT：另一种方式指定所要计算的能带，它是指定计算某能量范围的partial charge density，一般是设置为两个实数，比如EINT&#x3D; 4.00 5.00，此时NBOMD的值设置为-2。如果只设置了一个数，那么表示计算从 EINT 到费米能级这个范围内的，此时NBOMD 的值为-3。</li>
<li>KPUSE：指定所要计算的 k 点(哪个或哪几个)。</li>
<li>LSEPB：指定是不是要把计算的partial charge density按每个带分别写到各自对应的文件</li>
<li>PARCHG.nb (设置为.TRUE.)中，还是把它们合并写到一个文件中(相当于把各个带对应的partial charge density 加起来，设置为.FALSE.)，默认值为.FALSE.。</li>
<li>LSEPK：指定是不是把要计算的partial charge density按每个k分别写到各自对应的文件PARCHG.nk (设置为.TRUE.).</li>
</ul>
<p><strong>三个方法：</strong></p>
<p><strong>1、读取自恰计算的波函数，KPOINTS文件采用特定的k点</strong></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#partial charge density</span><br><span class="line"><span class="variable constant_">LPARD</span> = .<span class="property">TRUE</span>. </span><br><span class="line"><span class="variable constant_">IBAND</span> = <span class="number">17</span> <span class="number">18</span> # 价带顶和导带底</span><br><span class="line"><span class="variable constant_">KPUSE</span> = <span class="number">1</span></span><br><span class="line"><span class="variable constant_">LSEPB</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">LSEPK</span> = .<span class="property">TRUE</span>.</span><br></pre></td></tr></table></figure>

 <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">CsPbI3</span>-cubic</span><br><span class="line"><span class="number">1</span></span><br><span class="line">r</span><br><span class="line"><span class="number">0.500000</span> <span class="number">0.500000</span> <span class="number">0.500000</span> <span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://muchong.com/html/200906/1404880.html">http://muchong.com/html/200906/1404880.html</a><br><strong>2、读取自恰计算的波函数，KPOINTS文件采用自恰计算的k点</strong><br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#partial charge density</span><br><span class="line"><span class="variable constant_">LPARD</span> = .<span class="property">TRUE</span>. </span><br><span class="line"><span class="variable constant_">IBAND</span> = <span class="number">17</span> <span class="number">18</span></span><br><span class="line"><span class="variable constant_">KPUSE</span> = <span class="number">35</span></span><br><span class="line"><span class="variable constant_">LSEPB</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">LSEPK</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">NELM</span> = <span class="number">200</span></span><br><span class="line"><span class="variable constant_">ICHARG</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure><br>在scf自恰计算OUTCAR中<br>找到对应导带底和价带顶<br>对应的k-point编号<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">CsPbI3</span>-cubic</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="title class_">Gamma</span></span><br><span class="line"><span class="number">8</span> <span class="number">8</span> <span class="number">8</span></span><br><span class="line"><span class="number">0.0</span> <span class="number">0.0</span> <span class="number">0.0</span></span><br></pre></td></tr></table></figure><br><strong>3、读取能带计算的波函数，KPOINTS文件采用能带计算的k点</strong></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#partial charge density</span><br><span class="line"><span class="variable constant_">LPARD</span> = .<span class="property">TRUE</span>. </span><br><span class="line"><span class="variable constant_">IBAND</span> = <span class="number">17</span> <span class="number">18</span></span><br><span class="line"><span class="variable constant_">KPUSE</span> = <span class="number">80</span> <span class="number">81</span></span><br><span class="line"><span class="variable constant_">LSEPB</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">LSEPK</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">NELM</span> = <span class="number">200</span></span><br><span class="line"><span class="variable constant_">ICHARG</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>KPOINTS和能带计算一样。在band能带计算OUTCAR中找到对应导带底和价带顶对应的k-point编号。</p>
<h2 id="轨道投影态密度和能带。"><a href="#轨道投影态密度和能带。" class="headerlink" title="轨道投影态密度和能带。"></a>轨道投影态密度和能带。</h2> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">LORBIT</span>=<span class="number">11</span> </span><br><span class="line"><span class="variable constant_">NEDOS</span>=<span class="number">2001</span></span><br></pre></td></tr></table></figure>
<p>提取DOS：vaspkit -task 111&#x2F;113<br>提取band：211&#x2F;212&#x2F;213&#x2F;214<br><strong>如果3D能带图不够平滑，可通过能带插值进行改善。</strong><br>VASPKIT升级到1.3.0或更新版本，在~&#x2F;.vaspkit文件中设置以下三个参数：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET_INTERPOLATED_DATA</span>      .<span class="property">TRUE</span>.     是否插值</span><br><span class="line"><span class="variable constant_">INTERPOLATION_SPACING</span>        <span class="number">0.04</span>     插值间距，决定平滑程度</span><br><span class="line"><span class="variable constant_">INTERPOLATION_METHOD</span>        <span class="string">&#x27;cubic&#x27;</span>   插值方法</span><br></pre></td></tr></table></figure></p>
<h2 id="HSE06计算电子结构："><a href="#HSE06计算电子结构：" class="headerlink" title="HSE06计算电子结构："></a>HSE06计算电子结构：</h2><ol>
<li><p>结构优化（PBE）</p>
</li>
<li><p>静态自洽scf计算（PBE）KPOINTS和POTCAR文件不变，写波函数和电荷密度</p>
</li>
<li><p>(可选）静态自洽scf计算（HSE06）KPOINTS，POSCAR和POTCAR文件不变</p>
</li>
<li><p>DOS&#x2F;band计算（HSE06）vaspkit -task 303<br>vaspkit→251→2→0.03→0.03生成KPOINTS，运行VASP<br>vaspkit-252<br><a target="_blank" rel="noopener" href="http://vaspkit.cn/index.php/29.html">http://vaspkit.cn/index.php/29.html</a></p>
</li>
<li><p>PBE优化结构</p>
</li>
<li><p>HSE自洽计算(得到波函数)</p>
</li>
<li><p>HSE能带计算&#x2F;态密度计算</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ALGO</span> = <span class="title class_">Damped</span></span><br><span class="line"><span class="variable constant_">HFSCREEN</span> = <span class="number">0.2</span></span><br><span class="line"><span class="variable constant_">LHFCALC</span> = .<span class="property">True</span>.</span><br><span class="line"><span class="variable constant_">LMAXFOCK</span> = <span class="number">4</span></span><br><span class="line"><span class="variable constant_">PRECFOCK</span> = <span class="title class_">Fast</span></span><br><span class="line"><span class="variable constant_">TIME</span> = <span class="number">0.4</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="SOC计算电子结构："><a href="#SOC计算电子结构：" class="headerlink" title="+SOC计算电子结构："></a>+SOC计算电子结构：</h2><ol>
<li>结构优化（PBE）</li>
<li>静态自洽scf计算（PBE+SOC）KPOINTS和POTCAR文件不变，写波函数和电荷密度</li>
<li>非自洽计算（PBE+SOC）<br>Spin-Orbit Coupling Calculation<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="variable constant_">ISPIN</span>  =  <span class="number">2</span></span><br><span class="line"> <span class="variable constant_">NELMIN</span> =  <span class="number">6</span>            (<span class="title class_">Min</span> electronic <span class="variable constant_">SCF</span> steps) </span><br><span class="line"> <span class="variable constant_">LSORBIT</span>    = .<span class="property">TRUE</span>.    (<span class="title class_">Activate</span> <span class="variable constant_">SOC</span>)</span><br><span class="line"> <span class="variable constant_">GGA_COMPAT</span> = .<span class="property">FALSE</span>.   (<span class="title class_">Apply</span> spherical cutoff on gradient field)</span><br><span class="line">#<span class="variable constant_">VOSKOWN</span>    =  <span class="number">1</span>        (<span class="title class_">Enhances</span> the magnetic moments and the magnetic energies)</span><br><span class="line"> <span class="variable constant_">LMAXMIX</span>    =  <span class="number">2</span>        (<span class="title class_">For</span> d elements increase <span class="variable constant_">LMAXMIX</span> to <span class="number">4</span>, <span class="attr">f</span>: <span class="variable constant_">LMAXMIX</span> = <span class="number">6</span>)</span><br><span class="line"> <span class="variable constant_">SAXIS</span>    =  <span class="number">0</span> <span class="number">0</span> <span class="number">1</span>      (<span class="title class_">Direction</span> <span class="keyword">of</span> the magnetic field)</span><br><span class="line"> #<span class="variable constant_">MAGMOM</span>   =  <span class="number">0</span> <span class="number">0</span> <span class="number">3</span>    (<span class="title class_">Set</span> <span class="variable language_">this</span> parameters manually, <span class="title class_">Local</span> magnetic moment parallel to <span class="variable constant_">SAXIS</span>, <span class="number">3</span>*<span class="variable constant_">NIONS</span>*<span class="number">1.0</span> <span class="keyword">for</span> non-collinear magnetic systems)</span><br><span class="line"> <span class="variable constant_">NBANDS</span>   =  <span class="number">32</span>         (<span class="title class_">Set</span> <span class="variable language_">this</span> parameters manually, <span class="number">2</span> * number <span class="keyword">of</span> bands <span class="keyword">of</span> collinear-run)</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="HSE06-SOC-band-structure-calculation"><a href="#HSE06-SOC-band-structure-calculation" class="headerlink" title="HSE06+SOC band structure calculation"></a>HSE06+SOC band structure calculation</h2><ul>
<li><p>Step-I: HSE06 SCF calculation with SOC (INCAR):</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#<span class="variable constant_">SOC</span>-<span class="attr">related</span>:</span><br><span class="line"><span class="variable constant_">LSORBIT</span>=.<span class="property">TRUE</span>.                </span><br><span class="line"><span class="variable constant_">SAXIS</span>= <span class="number">0</span> <span class="number">0</span> <span class="number">1</span>  </span><br><span class="line"><span class="variable constant_">ISYM</span>=<span class="number">0</span>                   </span><br><span class="line"></span><br><span class="line">#<span class="title class_">HSE06</span>-<span class="attr">related</span>:</span><br><span class="line"><span class="variable constant_">LHFCALC</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">HFSCREEN</span> = <span class="number">0.2</span></span><br><span class="line"><span class="variable constant_">ALGO</span> = <span class="title class_">Damped</span>         #<span class="title class_">Damped</span>/<span class="title class_">Normal</span>/<span class="title class_">All</span></span><br><span class="line"><span class="variable constant_">TIME</span> = <span class="number">0.4</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step-II: HSE06 NSCF calculation with SOC:</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#<span class="variable constant_">SOC</span>-<span class="attr">related</span>:</span><br><span class="line"><span class="variable constant_">LSORBIT</span>=.<span class="property">TRUE</span>.                </span><br><span class="line"><span class="variable constant_">SAXIS</span>= <span class="number">0</span> <span class="number">0</span> <span class="number">1</span>  </span><br><span class="line"><span class="variable constant_">ISYM</span>=<span class="number">0</span>                  </span><br><span class="line"></span><br><span class="line">#<span class="title class_">HSE06</span> <span class="attr">related</span>:</span><br><span class="line"><span class="variable constant_">LHFCALC</span> = .<span class="property">TRUE</span>.               </span><br><span class="line"><span class="variable constant_">HFSCREEN</span> = <span class="number">0.2</span></span><br><span class="line"><span class="variable constant_">ALGO</span> = <span class="title class_">Normal</span>                  !use <span class="title class_">Normal</span></span><br><span class="line"><span class="variable constant_">TIME</span> = <span class="number">0.4</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="能带反折叠"><a href="#能带反折叠" class="headerlink" title="能带反折叠"></a>能带反折叠</h2><h3 id="vaspkit"><a href="#vaspkit" class="headerlink" title="vaspkit:"></a>vaspkit:</h3><ol>
<li>准备POSCAR</li>
<li>运行vaspkit -task 302&#x2F;303生成KPATH.in文件</li>
<li>cp PRIMCELL.vasp POSCAR </li>
<li>运行vasp优化结构，cp CONTCAR POSCAR</li>
<li>运行vaspkit -task 400&#x2F;400生成超胞结构POSCAR，并执行cp TRANSMAT TRANSMAT.in</li>
<li>运行vasp优化含有缺陷的超胞结构，cp CONTCAR POSCAR</li>
<li>运行vaspkit -task 281生成KPOINTS文件</li>
<li>准备INCAR（静态计算，设置LWAVE &#x3D; T，适当增加NBANDS值）并执行VASP计算</li>
<li>运行vaspkit -task 282提取effective band structure(画法类似于投影能带)</li>
</ol>
<ul>
<li><strong>如果不会计算变换矩阵（TRANSMAT.in文件不存在时），可以执行cp PRIMCELL.vasp PRIMCELL.in，281</strong> ，这时vaspkit分别读入超胞基矢（POSCAR）和原胞基矢（PRIMCELL.in）计算变换矩阵并生成TRANSMAT.in文件。</li>
<li>vaspkit&#x2F;examples&#x2F;band_unfolding&#x2F;ebs.py画图。生成的ENERGY.grd，WEIGHT.grd和MOMENTUM.grd三个文件，可使用vaspkit&#x2F;examples&#x2F;band_unfolding&#x2F;ebs_k_resolved_dos_plot_matlalb.m脚本画图。</li>
</ul>
<h3 id="bandup"><a href="#bandup" class="headerlink" title="bandup:"></a>bandup:</h3><p><strong>第一步</strong>  得到超胞CHGCAR:输入文件参考BANDUP的example的第一步，提交任务之后得到CHGCAR。<br><strong>第二步</strong>  主要是为了得到超胞非自洽计算的K点路径，分别给出单胞和超胞的晶格坐标文件prim_cell_lattice.in与supercell_lattice.in。还有单胞的高对称K点路径。<br>下一步命令是bandup kpts-sc-get -no_symm_avg,这一步会生成KPOINTS_supercell.out文件后面会用到。-no_symm_avg这个标签是为了减少需要计算的k点个数，减小计算量和WAVECAR大小。<br><strong>第三步</strong>  利用前面第一步生成 CHGCAR; POSCAR POTCAR与第一步的一样，K点从第二步那个复制过来,然后提交任务得到波函数WAVECAR<br>第四步就要开始做能带反折叠了，一句命令，bandup unfold -emin -13 -emax 6 -dE 0.050  -no_symm_avg<br>会生成一个unfolded_EBS_not-symmetry_averaged.dat文件，画出来就行了。<br><a target="_blank" rel="noopener" href="https://github.com/band-unfolding/bandup">https://github.com/band-unfolding/bandup</a></p>
<p><a target="_blank" rel="noopener" href="http://staff.ustc.edu.cn/~zqj/posts/Band-unfolding-tutorial/">http://staff.ustc.edu.cn/~zqj/posts/Band-unfolding-tutorial/</a><br>可以处理能带反折叠的软件汇总：<br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/-5lN2lwxsALA-rhNQxK1dw">https://mp.weixin.qq.com/s/-5lN2lwxsALA-rhNQxK1dw</a><br><a target="_blank" rel="noopener" href="https://vaspkit.com/tutorials.html#band-unfolding">https://vaspkit.com/tutorials.html#band-unfolding</a><br><a target="_blank" rel="noopener" href="https://github.com/QuantumMaterialsModelling/bands4vasp">https://github.com/QuantumMaterialsModelling/bands4vasp</a><br><a target="_blank" rel="noopener" href="https://github.com/QuantumMaterialsModelling/UnfoldingPatch4vasp">https://github.com/QuantumMaterialsModelling/UnfoldingPatch4vasp</a></p>
<h2 id="3D能带"><a href="#3D能带" class="headerlink" title="3D能带"></a>3D能带</h2><p>__第一步__，准备好石墨烯的POSCAR和用于静态计算的INCAR文件；<br>__第二步__：运行VASPKIT并选择231生成用于3D能带计算 的KPOINTS文件。为了获得平滑的3D能带面，用于产生KPOINTS文件的分辨率值应该设置在0.005左右 ；<br>__第三步__，提交VASP作业；<br>__第四步__，待VASP计算完成后，再次运行VASPKIT，输入232或233命令。233命令可一次性输入包含价带顶的BAND.HOMO.grd和导带底的BAND.LUMO.grd文件的能带；232可以得到其它任意能带的计算数据，这里我们选择233。<br>__第五步__：运行python how_to_visual.py，绘制3D能带图(python2.7环境)。<br><strong>如果3D能带图不够平滑，可通过能带插值进行改善。</strong></p>
<h2 id="有效质量："><a href="#有效质量：" class="headerlink" title="有效质量："></a>有效质量：</h2><p>除了通过能带，也可以通过调用VASPKIT-911命令来得到带边位置，接下来我们计算K点处沿着K -&gt; Γ和K -&gt; M方向的电子及空穴载流子的有效质量；<br>第一步：准备POSCAR文件以及VPKIT.in文件，VPKIT.in文件包含以下内容；</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>                  设置为<span class="number">1</span>将会生成计算有效质量的<span class="variable constant_">KPOINTS</span>文件，<span class="number">2</span>则计算有效质量</span><br><span class="line"><span class="number">6</span>                  <span class="number">6</span>表示我们在K附近取<span class="number">6</span>个离散点用于多项式拟合</span><br><span class="line"><span class="number">0.015</span>              k-cutoff, 截断半径，典型值<span class="number">0.015</span> <span class="number">1</span>/Å</span><br><span class="line"><span class="number">2</span>                  <span class="number">2</span> 表示有两个有效质量任务</span><br><span class="line"><span class="number">0.333333</span> <span class="number">0.3333333</span>  <span class="number">0.000</span>  <span class="number">0.000</span> <span class="number">0.000</span> <span class="number">0.000</span>  K-&gt;Γ     计算K点处有效质量，沿着K指向Γ方向    </span><br><span class="line"><span class="number">0.333333</span> <span class="number">0.3333333</span>  <span class="number">0.000</span>  <span class="number">0.500</span> <span class="number">0.000</span> <span class="number">0.000</span>  K-&gt;M     计算K点处有效质量，沿着K指向M方向 </span><br></pre></td></tr></table></figure>
<p>第二步：运行vaspkit并选择912或者913产生KPOINTS，POTCAR文件及静态计算INCAR文件；<br>第三步：提交VASP作业；<br>第四步：计算完成后把VPKIT.in文件中第一行的1修改为2，然后再次运行vaspkit并选择913，得到结果：<br>为了得到可靠的有效质量计算值，括号里的精度至少要在1E-7这个量级，如果误差比较大，可以适当调整k-cutoff值，一般减少该值但不能太小。<br>手动vaspkit处理的能带：$m^∗&#x3D;3.815&#x2F;B$</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-47-23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-47-23/" class="post-title-link" itemprop="url">1.4 提高效率与准确性</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:47:23" itemprop="dateCreated datePublished" datetime="2023-05-09T18:47:23+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-06-27 09:05:33" itemprop="dateModified" datetime="2023-06-27T09:05:33+08:00">2023-06-27</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="截断能"><a href="#截断能" class="headerlink" title="截断能"></a>截断能</h1><p>截断能设置在INCAR文件的ENCUT参数。截断能（energy cutoff）指定了展开波函数用到的平面波基组（planewave basis set）所对应的截断能量。<br>参考： <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/348826693">https://zhuanlan.zhihu.com/p/348826693</a><br><strong>截断能越大，代表用来描述波函数的平面波基组越多，计算精度越高，同时计算耗时也越长。</strong><br><strong>如果没有指定ENCUT，程序将默认ENCUT&#x3D;ENMAX（注意：当PREC &#x3D; High时, ENCUT &#x3D; 1.3*ENMAX）。扩胞并不会影响ENCUT的设置。</strong></p>
<ul>
<li>测试标准<br>ENMAX在保证定性正确的基础上大幅度降低计算耗时，如果想要定量计算某些性质就需要增大截断能了。所以ENCUT测试通常从ENMAX开始测试，一般截止到 <strong>1.5*ENMAX</strong> 即可（注意：比ENMAX小的测试可能会得到错误的能量）。当体系中每个原子的能量差收敛至0.001 eV&#x2F;atom时，此ENCUT即为最终取值。</li>
</ul>
<p>简单测试：<br><code>for i in &#123;1..8&#125;; do cp 400 $((400+$i*50)); sed -i &quot;s/400/$((400+$i*50))/g&quot;  $((400+$i*50))/INCAR ; done</code> </p>
<p><strong>encut.sh脚本：</strong>  参考 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/115235135">https://zhuanlan.zhihu.com/p/115235135</a></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>bash</span><br><span class="line"></span><br><span class="line">#生成<span class="variable constant_">KPOINTS</span>文件，<span class="variable constant_">KPOINTS</span>不能与<span class="variable constant_">INCAR</span>中的<span class="variable constant_">KSPACING</span>参数共用，二选一</span><br><span class="line">cat &gt; <span class="variable constant_">KPOINTS</span> &lt;&lt;!</span><br><span class="line">A</span><br><span class="line"><span class="number">0</span></span><br><span class="line">M</span><br><span class="line"><span class="number">9</span>  <span class="number">9</span>  <span class="number">9</span></span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">#产生计算所需<span class="variable constant_">POSCAR</span></span><br><span class="line">cat &gt; <span class="variable constant_">POSCAR</span>&lt;&lt;!</span><br><span class="line"><span class="title class_">Si8</span></span><br><span class="line"><span class="number">1.0000000000</span></span><br><span class="line">    <span class="number">5.4687280000</span>        <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">5.4687280000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span>        <span class="number">5.4687280000</span></span><br><span class="line"><span class="title class_">Si</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="title class_">Direct</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.2500000000</span>        <span class="number">0.7500000000</span>        <span class="number">0.7500000000</span></span><br><span class="line">    <span class="number">0.5000000000</span>        <span class="number">0.0000000000</span>        <span class="number">0.5000000000</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">0.5000000000</span>        <span class="number">0.5000000000</span></span><br><span class="line">    <span class="number">0.5000000000</span>        <span class="number">0.5000000000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.7500000000</span>        <span class="number">0.2500000000</span>        <span class="number">0.7500000000</span></span><br><span class="line">    <span class="number">0.7500000000</span>        <span class="number">0.7500000000</span>        <span class="number">0.2500000000</span></span><br><span class="line">    <span class="number">0.2500000000</span>        <span class="number">0.2500000000</span>        <span class="number">0.2500000000</span></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq <span class="number">400</span> <span class="number">50</span> <span class="number">700</span>) #截断能从<span class="number">450</span>-<span class="number">800</span>，步数为<span class="number">50</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">#生成vasp静态计算的<span class="variable constant_">INCAR</span></span><br><span class="line">cat &gt; INCAR_static &lt;&lt;!</span><br><span class="line"><span class="title class_">Global</span> <span class="title class_">Parameters</span></span><br><span class="line">  <span class="variable constant_">ISTART</span> =  <span class="number">0</span>            (<span class="title class_">Read</span> existing wavefunction; <span class="keyword">if</span> there)</span><br><span class="line">  <span class="variable constant_">ICHARG</span> =  <span class="number">2</span>            (<span class="title class_">Non</span>-self-<span class="attr">consistent</span>: <span class="variable constant_">GGA</span>/<span class="variable constant_">LDA</span> band structures)</span><br><span class="line">  <span class="variable constant_">LREAL</span>  = .<span class="property">FALSE</span>.       (<span class="title class_">Projection</span> <span class="attr">operators</span>: automatic)</span><br><span class="line">  <span class="variable constant_">ENCUT</span>  =  $i           (<span class="title class_">Cut</span>-off energy <span class="keyword">for</span> plane wave basis set, <span class="keyword">in</span> eV)</span><br><span class="line">  <span class="variable constant_">PREC</span>   =  <span class="title class_">Accurate</span>     (<span class="title class_">Precision</span> level)  </span><br><span class="line">  <span class="variable constant_">LWAVE</span>  = .<span class="property">FALSE</span>.       (<span class="title class_">Write</span> <span class="variable constant_">WAVECAR</span> or not)</span><br><span class="line">  <span class="variable constant_">LCHARG</span> = .<span class="property">FALSE</span>.       (<span class="title class_">Write</span> <span class="variable constant_">CHGCAR</span> or not) </span><br><span class="line">  <span class="variable constant_">ADDGRID</span>= .<span class="property">TRUE</span>.        (<span class="title class_">Increase</span> grid; helps <span class="variable constant_">GGA</span> convergence)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Electronic</span> <span class="title class_">Relaxation</span></span><br><span class="line">  <span class="variable constant_">ISMEAR</span> =  -<span class="number">5</span>           (<span class="title class_">Gaussian</span> smearing; <span class="attr">metals</span>:<span class="number">1</span>)</span><br><span class="line">  #<span class="variable constant_">SIGMA</span>  =  <span class="number">0.05</span>        (<span class="title class_">Smearing</span> value <span class="keyword">in</span> eV; <span class="attr">metals</span>:<span class="number">0.2</span>)</span><br><span class="line">  <span class="variable constant_">NELM</span>   =  <span class="number">60</span>           (<span class="title class_">Max</span> electronic <span class="variable constant_">SCF</span> steps)  </span><br><span class="line">  <span class="variable constant_">NELMIN</span> =  <span class="number">4</span>            (<span class="title class_">Min</span> electronic <span class="variable constant_">SCF</span> steps)</span><br><span class="line">  <span class="variable constant_">EDIFF</span>  =  <span class="number">1E-06</span>        (<span class="variable constant_">SCF</span> energy convergence; <span class="keyword">in</span> eV)</span><br><span class="line">  <span class="variable constant_">GGA</span>  =  <span class="variable constant_">PE</span>             (<span class="title class_">PBEsol</span> exchange-correlation)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Ionic</span> <span class="title class_">Relaxation</span></span><br><span class="line">  <span class="variable constant_">ISIF</span>   =  <span class="number">2</span>            (<span class="title class_">Stress</span>/<span class="attr">relaxation</span>: <span class="number">2</span>-<span class="title class_">Ions</span>, <span class="number">3</span>-<span class="title class_">Shape</span>/<span class="title class_">Ions</span>/V，<span class="number">4</span>-<span class="title class_">Shape</span>/<span class="title class_">Ions</span>)</span><br><span class="line">  <span class="variable constant_">EDIFFG</span> = -<span class="number">0.001</span>        (<span class="title class_">Ionic</span> convergence; eV/<span class="variable constant_">AA</span>)</span><br><span class="line">  #<span class="variable constant_">KSPACING</span> = <span class="number">0.10</span></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">cp INCAR_static <span class="variable constant_">INCAR</span></span><br><span class="line">echo <span class="string">&quot;ENCUT = $i eV&quot;</span> ; time mpirun -np <span class="number">16</span> vasp_std #vasp并行运行命令，根据系统自行修改</span><br><span class="line"></span><br><span class="line">rm INCAR_static</span><br><span class="line">rm <span class="variable constant_">INCAR</span></span><br><span class="line">#提取计算得到的能量</span><br><span class="line">E=$(grep <span class="string">&quot;TOTEN&quot;</span> <span class="variable constant_">OUTCAR</span> | tail -<span class="number">1</span> | awk <span class="string">&#x27;&#123;printf &quot;%12.9f \n&quot;, $5 &#125;&#x27;</span>)</span><br><span class="line">echo $i $E &gt;&gt;encut_energy.<span class="property">out</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h1 id="K点测试"><a href="#K点测试" class="headerlink" title="K点测试"></a>K点测试</h1><p>是倒空间（动量空间）的基本构成点，只取在一个倒空间晶格向量的范围内来描述 k 。总能量计算是对布里渊区内的波函数进行积分，而积分是通过对部分特殊K点的求和完成的。因此，计算一个体系时，需要确定所用KPOINTS的大小。<br><strong>k.sh如下：</strong></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>bash</span><br><span class="line">#生成vasp静态计算的<span class="variable constant_">INCAR</span></span><br><span class="line">cat &gt; INCAR_static &lt;&lt;!</span><br><span class="line"><span class="title class_">Global</span> <span class="title class_">Parameters</span></span><br><span class="line">  <span class="variable constant_">ISTART</span> =  <span class="number">0</span>            (<span class="title class_">Read</span> existing wavefunction; <span class="keyword">if</span> there)</span><br><span class="line">  <span class="variable constant_">ICHARG</span> =  <span class="number">2</span>            (<span class="title class_">Non</span>-self-<span class="attr">consistent</span>: <span class="variable constant_">GGA</span>/<span class="variable constant_">LDA</span> band structures)</span><br><span class="line">  <span class="variable constant_">LREAL</span>  = .<span class="property">FALSE</span>.       (<span class="title class_">Projection</span> <span class="attr">operators</span>: automatic)</span><br><span class="line">  <span class="variable constant_">ENCUT</span>  =  <span class="number">500</span>           (<span class="title class_">Cut</span>-off energy <span class="keyword">for</span> plane wave basis set, <span class="keyword">in</span> eV)</span><br><span class="line">  <span class="variable constant_">PREC</span>   =  <span class="title class_">Accurate</span>     (<span class="title class_">Precision</span> level)  </span><br><span class="line">  <span class="variable constant_">LWAVE</span>  = .<span class="property">FALSE</span>.       (<span class="title class_">Write</span> <span class="variable constant_">WAVECAR</span> or not)</span><br><span class="line">  <span class="variable constant_">LCHARG</span> = .<span class="property">FALSE</span>.       (<span class="title class_">Write</span> <span class="variable constant_">CHGCAR</span> or not) </span><br><span class="line">  <span class="variable constant_">ADDGRID</span>= .<span class="property">TRUE</span>.        (<span class="title class_">Increase</span> grid; helps <span class="variable constant_">GGA</span> convergence)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Electronic</span> <span class="title class_">Relaxation</span></span><br><span class="line">  <span class="variable constant_">ISMEAR</span> =  -<span class="number">5</span>           (<span class="title class_">Gaussian</span> smearing; <span class="attr">metals</span>:<span class="number">1</span>)</span><br><span class="line">  #<span class="variable constant_">SIGMA</span>  =  <span class="number">0.05</span>        (<span class="title class_">Smearing</span> value <span class="keyword">in</span> eV; <span class="attr">metals</span>:<span class="number">0.2</span>)</span><br><span class="line">  <span class="variable constant_">NELM</span>   =  <span class="number">60</span>           (<span class="title class_">Max</span> electronic <span class="variable constant_">SCF</span> steps)  </span><br><span class="line">  <span class="variable constant_">NELMIN</span> =  <span class="number">4</span>            (<span class="title class_">Min</span> electronic <span class="variable constant_">SCF</span> steps)</span><br><span class="line">  <span class="variable constant_">EDIFF</span>  =  <span class="number">1E-06</span>        (<span class="variable constant_">SCF</span> energy convergence; <span class="keyword">in</span> eV)</span><br><span class="line">  <span class="variable constant_">GGA</span>  =  <span class="variable constant_">PE</span>             (<span class="title class_">PBEsol</span> exchange-correlation)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Ionic</span> <span class="title class_">Relaxation</span></span><br><span class="line">  <span class="variable constant_">ISIF</span>   =  <span class="number">2</span>            (<span class="title class_">Stress</span>/<span class="attr">relaxation</span>: <span class="number">2</span>-<span class="title class_">Ions</span>, <span class="number">3</span>-<span class="title class_">Shape</span>/<span class="title class_">Ions</span>/V，<span class="number">4</span>-<span class="title class_">Shape</span>/<span class="title class_">Ions</span>)</span><br><span class="line">  <span class="variable constant_">EDIFFG</span> = -<span class="number">0.001</span>        (<span class="title class_">Ionic</span> convergence; eV/<span class="variable constant_">AA</span>)</span><br><span class="line">  #<span class="variable constant_">KSPACING</span> = <span class="number">0.10</span></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">cp INCAR_static <span class="variable constant_">INCAR</span></span><br><span class="line"></span><br><span class="line">#产生计算所需<span class="variable constant_">POSCAR</span></span><br><span class="line">cat &gt; <span class="variable constant_">POSCAR</span>&lt;&lt;!</span><br><span class="line"><span class="title class_">Si8</span></span><br><span class="line"><span class="number">1.0000000000</span></span><br><span class="line">    <span class="number">5.4687280000</span>        <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">5.4687280000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span>        <span class="number">5.4687280000</span></span><br><span class="line"><span class="title class_">Si</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="title class_">Direct</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.2500000000</span>        <span class="number">0.7500000000</span>        <span class="number">0.7500000000</span></span><br><span class="line">    <span class="number">0.5000000000</span>        <span class="number">0.0000000000</span>        <span class="number">0.5000000000</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">0.5000000000</span>        <span class="number">0.5000000000</span></span><br><span class="line">    <span class="number">0.5000000000</span>        <span class="number">0.5000000000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.7500000000</span>        <span class="number">0.2500000000</span>        <span class="number">0.7500000000</span></span><br><span class="line">    <span class="number">0.7500000000</span>        <span class="number">0.7500000000</span>        <span class="number">0.2500000000</span></span><br><span class="line">    <span class="number">0.2500000000</span>        <span class="number">0.2500000000</span>        <span class="number">0.2500000000</span></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq <span class="number">6</span> <span class="number">3</span> <span class="number">15</span>) #K点从<span class="number">6</span>-<span class="number">24</span>，步数为<span class="number">3</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">#生成<span class="variable constant_">KPOINTS</span>文件，K点类型：<span class="title class_">Monkhorst</span>-<span class="title class_">Pack</span> (M) 或者 <span class="title class_">Gamma</span> (G)</span><br><span class="line">cat &gt; <span class="variable constant_">KPOINTS</span> &lt;&lt;!</span><br><span class="line"><span class="title class_">Automatic</span> mesh</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="title class_">Monkhorst</span>-<span class="title class_">Pack</span></span><br><span class="line">$i $i $i</span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;KPOINTS = $i&quot;</span> ; time mpirun -n <span class="number">16</span> vasp_std #vasp并行运行命令，根据系统自行修改</span><br><span class="line"></span><br><span class="line">rm <span class="variable constant_">KPOINTS</span></span><br><span class="line">#提取计算得到的能量</span><br><span class="line">E=$(grep <span class="string">&quot;TOTEN&quot;</span> <span class="variable constant_">OUTCAR</span> | tail -<span class="number">1</span> | awk <span class="string">&#x27;&#123;printf &quot;%12.9f \n&quot;, $5 &#125;&#x27;</span>)</span><br><span class="line">echo $i $E &gt;&gt;kpoints_energy.<span class="property">out</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h1 id="显示收敛情况的脚本"><a href="#显示收敛情况的脚本" class="headerlink" title="显示收敛情况的脚本"></a>显示收敛情况的脚本</h1><p>参考：<a target="_blank" rel="noopener" href="https://blog.shishiruqi.com/2019/08/19/paili-energyforce/">https://blog.shishiruqi.com/2019/08/19/paili-energyforce/</a></p>
<ul>
<li>简单版：</li>
</ul>
<p><code>grep F= OSZICAR |awk &#39;&#123;print $1,$5&#125;&#39;</code><br><code>grep F= OSZICAR |awk &#39;&#123;print $1,$5&#125;&#39; &gt; conv.dat</code></p>
<ul>
<li>小脚本：<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/env bash</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> *; <span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span> [ -e $i/<span class="variable constant_">OUTCAR</span> ]; then</span><br><span class="line">echo -e  $i <span class="string">&quot;\t&quot;</span> $(grep <span class="string">&#x27;  without&#x27;</span> $i/<span class="variable constant_">OUTCAR</span> |tail -n <span class="number">1</span> | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span>)</span><br><span class="line">fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
<li>复杂：<br><strong>ediff.sh如下：（安装gnuplot）</strong><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>sh</span><br><span class="line">#lipai@mail.<span class="property">ustc</span>.<span class="property">edu</span>.<span class="property">cn</span></span><br><span class="line"></span><br><span class="line">begin=$1</span><br><span class="line"><span class="keyword">if</span> [ $begin ==<span class="string">&#x27;&#x27;</span> ]; then begin=<span class="number">0</span>; fi    </span><br><span class="line">awk -v begin=$begin <span class="string">&#x27;/E0/&#123;if ( i&lt;begin  ) i++;else print $0 &#125;&#x27;</span> <span class="variable constant_">OSZICAR</span> &gt;temp.<span class="property">e</span></span><br><span class="line">    </span><br><span class="line">awk <span class="string">&#x27;/POSITION/,/drift/&#123;</span></span><br><span class="line"><span class="string">    if(NF==6) print $4,$5,$6;</span></span><br><span class="line"><span class="string">    else if($1==&quot;total&quot;) print $1 &#125;&#x27;</span> <span class="variable constant_">OUTCAR</span> &gt;temp.<span class="property">f</span></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;&#123;if($4==&quot;F&quot;||$4==&quot;T&quot;) print $4,$5,$6&#125;&#x27;</span> <span class="variable constant_">CONTCAR</span> &gt;temp.<span class="property">fix</span></span><br><span class="line">flag=<span class="string">`wc temp.fix|awk &#x27;&#123;print $1&#125;&#x27;`</span></span><br><span class="line">steps=<span class="string">`grep E0 OSZICAR |tail -1 |awk &#x27;&#123;print $1&#125;&#x27;`</span></span><br><span class="line"><span class="keyword">if</span> [ flag != <span class="string">&#x27;0&#x27;</span> ] ; then</span><br><span class="line">    <span class="keyword">if</span> [ -f temp.<span class="property">fixx</span> ] ; then rm temp.<span class="property">fixx</span> ; fi</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">`seq $steps`</span>;<span class="keyword">do</span></span><br><span class="line">        cat temp.<span class="property">fix</span> &gt;&gt;temp.<span class="property">fixx</span></span><br><span class="line">        echo &gt;&gt;temp.<span class="property">fixx</span></span><br><span class="line">    done</span><br><span class="line">    paste temp.<span class="property">f</span> temp.<span class="property">fixx</span> &gt;temp.<span class="property">ff</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">awk  <span class="string">&#x27;&#123; if($1==&quot;total&quot;) &#123;print ++i,a;a=0&#125;</span></span><br><span class="line"><span class="string">        else &#123;</span></span><br><span class="line"><span class="string">            if($4==&quot;F&quot;) x=0; else x=$1;</span></span><br><span class="line"><span class="string">            if($5==&quot;F&quot;) y=0; else y=$2;</span></span><br><span class="line"><span class="string">            if($6==&quot;F&quot;) z=0; else z=$3;</span></span><br><span class="line"><span class="string">            force=sqrt(x^2+y^2+z^2);</span></span><br><span class="line"><span class="string">            if(a&lt;force) a=force&#125; &#125;&#x27;</span> temp.<span class="property">ff</span> &gt;force.<span class="property">conv</span></span><br><span class="line"></span><br><span class="line">gnuplot &lt;&lt;<span class="variable constant_">EOF</span> </span><br><span class="line">set term dumb</span><br><span class="line">set title <span class="string">&#x27;Energy of each ionic step&#x27;</span></span><br><span class="line">set xlabel <span class="string">&#x27;Ionic steps&#x27;</span></span><br><span class="line">set ylabel <span class="string">&#x27;Energy(eV)&#x27;</span></span><br><span class="line">plot <span class="string">&#x27;temp.e&#x27;</span> u <span class="number">1</span>:<span class="number">5</span> w l  t <span class="string">&quot;Energy in eV&quot;</span></span><br><span class="line">set title <span class="string">&#x27;Max Force of each ionic step&#x27;</span></span><br><span class="line">set xlabel <span class="string">&#x27;Ionic steps&#x27;</span></span><br><span class="line">set ylabel <span class="string">&#x27;Force (eV/Angstrom)&#x27;</span></span><br><span class="line">plot <span class="string">&#x27;force.conv&#x27;</span> w l t <span class="string">&quot;Force in eV/Angstrom&quot;</span></span><br><span class="line"><span class="variable constant_">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $steps -gt <span class="number">8</span> ] ; then</span><br><span class="line">tail -<span class="number">5</span> force.<span class="property">conv</span> &gt;temp.<span class="property">fff</span></span><br><span class="line">tail -<span class="number">5</span> temp.<span class="property">e</span> &gt;temp.<span class="property">ee</span></span><br><span class="line">gnuplot &lt;&lt;<span class="variable constant_">EOF</span> </span><br><span class="line">set term dumb</span><br><span class="line">set title <span class="string">&#x27;Energy of each ionic step for the last few steps&#x27;</span></span><br><span class="line">set xlabel <span class="string">&#x27;Ionic steps&#x27;</span></span><br><span class="line">set ylabel <span class="string">&#x27;Energy(eV)&#x27;</span></span><br><span class="line">plot <span class="string">&#x27;temp.ee&#x27;</span> u <span class="number">1</span>:<span class="number">5</span> w l  t <span class="string">&quot;Energy in eV&quot;</span></span><br><span class="line">set title <span class="string">&#x27;Max Force of each ionic step for the last few steps&#x27;</span></span><br><span class="line">set xlabel <span class="string">&#x27;Ionic steps&#x27;</span></span><br><span class="line">set ylabel <span class="string">&#x27;Force (eV/Angstrom)&#x27;</span></span><br><span class="line">plot <span class="string">&#x27;temp.fff&#x27;</span> w l  t <span class="string">&quot;Force in eV/Angstrom&quot;</span></span><br><span class="line"><span class="variable constant_">EOF</span></span><br><span class="line">rm temp.<span class="property">fff</span> temp.<span class="property">ee</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">rm temp.<span class="property">e</span> temp.<span class="property">f</span> temp.<span class="property">ff</span> temp.<span class="property">fix</span> temp.<span class="property">fixx</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="批量提交任务"><a href="#批量提交任务" class="headerlink" title="批量提交任务"></a>批量提交任务</h1><p>适用于测试、有限位移法求力常数矩阵等情况。<br>简单：  <code>for i in *; do cd $i ; qsub sub4; cd $OLDPWD; done </code></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>sh</span><br><span class="line">root_path=<span class="string">&#x27;pwd&#x27;</span></span><br><span class="line"></span><br><span class="line">#在每个job文件夹里进行静态计算。</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">001</span>.<span class="number">.1316</span>&#125; #按顺序从job-<span class="number">001</span>到<span class="number">116</span>做静态vasp计算,根据生成的文件夹设定</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">cd job-$i</span><br><span class="line">echo <span class="string">&quot;job-$i&quot;</span>, time </span><br><span class="line">sbatch sub.<span class="property">sh</span></span><br><span class="line">wait</span><br><span class="line">cd ..</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h1 id="批量产生文件夹"><a href="#批量产生文件夹" class="headerlink" title="批量产生文件夹"></a>批量产生文件夹</h1><figure class="highlight plaintext"><figcaption><span>i in &#123;2..9&#125;; do cp 0.01 0.0$i -r ; done ``` #批量复制0.01文件夹复制成0.02-0.09</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">```sed &#x27;3s/0.01/0.02/g&#x27; INCAR &gt; INCAR_new```  #将INCAR中的第三行的0.01全部替换成0.02并输出位INCAR_new文件。</span><br><span class="line">```sed -i &#x27;3s/0.01/0.02/g&#x27; INCAR``` # -i表示直接对源文件进行编辑，也就是说编辑之后源文件被新文件替换掉。</span><br><span class="line">```for i in *; do sed -i &quot;3s/0.05/$i/g&quot; $i/INCAR ; done``` #将文件夹中所有的0.01替换成了文件夹序号。</span><br><span class="line"></span><br><span class="line">我们主要对KPOINTS的文件的第四行进行批量操作，将1 1 1改成 2 2 2， 3 3 3 等。复制文件夹：</span><br><span class="line">```for i in &#123;1..6&#125;; do cp ../ex03/0.01/ $&#123;i&#125;$&#123;i&#125;$&#123;i&#125; -r ; done```</span><br><span class="line">显示行号：</span><br><span class="line">```cat 333/KPOINTS  -n ```</span><br><span class="line">修改文件;</span><br><span class="line">```for i in &#123;1..6&#125;; do sed -i &#x27;4s/1 1 1/$i $i $i/g&#x27; $&#123;i&#125;$&#123;i&#125;$&#123;i&#125;/KPOINTS ; done```</span><br><span class="line"></span><br><span class="line">脚本：</span><br><span class="line"> ```javascript  &#123;.line-numbers&#125; </span><br><span class="line">for i in 3RD.POSCAR.*</span><br><span class="line">do</span><br><span class="line">s=$(echo $i| cut -d &quot;.&quot; -f 3) #代表.的3个字符</span><br><span class="line">d=job-$s</span><br><span class="line">mkdir $d</span><br><span class="line">cp $i $d/POSCAR</span><br><span class="line">cp ./INCAR ./sub.sh ./KPOINTS ./POTCAR $d</span><br><span class="line">pushd $d</span><br><span class="line">popd</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h1 id="节约机时"><a href="#节约机时" class="headerlink" title="节约机时"></a>节约机时</h1><p><strong>grep User OUTCAR 后得出的结果被空格分成了4部分，时间信息在第4部分里面。User 或者 Elapsed都可以。</strong></p>
<ul>
<li>一个合理的初始结构，可以避免很多意外的错误以及快速得到正确的结果。</li>
<li>如果你设置的收敛标准比较严格，精度比较高，则每一个离子步需要更多的电子步数，需要的时间也会随着离子步的增加成线性关系增长。</li>
<li>ENCUT和KPOINTS文件需要测试，二者越大时间越久。</li>
<li>这里我们就会需要一些其他的参数，<strong>NCORE和NPAR。</strong><br>NCORE：控制多少个核同时计算；<br>NPAR：如何把计算任务分配到计算资源上面计算。<br>它们之间的关系是：NCORE&#x3D; 计算使用的核数 &#x2F; NPAR。注意：这两个参数只能选取一个来使用:<br>NCORE&#x3D;单节点的核数，单节点的核数&#x2F;2，单节点的核数&#x2F;4…….个人使用经验是：NCORE &#x3D; 单个节点核数 &#x2F; 2 的时候，运行最省时间，设置也最方便。<br>当然NCORE也需要测试。</li>
</ul>
<h1 id="消虚频"><a href="#消虚频" class="headerlink" title="消虚频"></a>消虚频</h1><h3 id="结构优化消虚频"><a href="#结构优化消虚频" class="headerlink" title="结构优化消虚频"></a>结构优化消虚频</h3><p>X, Y, Z为体系中原子的坐标，也就是POSCAR中的内容。 dx, dy,dz为虚频对应的原子振动方向上的位移。我们将（dx, dy,dz）这个位移乘以一个介于0-1之间的校正因子，然后跟POSCAR中的坐标加起来即可。以z方向为例，<strong>校正因子设为0.1，</strong> 微调后的z方向坐标为： 10.709980 + （-0.676634）0.1。<br>脚本vib_correct.py如下：<a target="_blank" rel="noopener" href="https://www.bigbrosci.com/2022/04/29/A29/">https://www.bigbrosci.com/2022/04/29/A29/</a></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># -*- <span class="attr">coding</span>: utf-<span class="number">8</span> -*-</span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">Qiang Li</span></span><br><span class="line"><span class="string">Command: python3 vib_correct.py </span></span><br><span class="line"><span class="string">This is a temporary script file.</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> ase.<span class="property">io</span> <span class="keyword">import</span> read, write</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">#获取虚频开始行</span><br><span class="line">l_position = <span class="number">0</span>  #虚频振动方向部分在<span class="variable constant_">OUTCAR</span>中的起始行数</span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;OUTCAR&#x27;</span>) <span class="keyword">as</span> <span class="attr">f_in</span>:</span><br><span class="line">    lines = f_in.<span class="title function_">readlines</span>()</span><br><span class="line">    wave_num = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> num, line <span class="keyword">in</span> <span class="title function_">enumerate</span>(lines):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;f/i&#x27;</span> <span class="keyword">in</span> <span class="attr">line</span>:</span><br><span class="line">            wave_tem = <span class="title function_">float</span>(line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">6</span>])</span><br><span class="line">            <span class="keyword">if</span> wave_tem &gt; <span class="attr">wave_num</span>: #获取最大的虚频</span><br><span class="line">                wave_num = wave_tem</span><br><span class="line">                l_position = num+<span class="number">2</span></span><br><span class="line"># <span class="variable constant_">ASE</span>读<span class="variable constant_">POSCAR</span></span><br><span class="line">model = <span class="title function_">read</span>(<span class="string">&#x27;POSCAR&#x27;</span>)</span><br><span class="line">model_positions = model.<span class="title function_">get_positions</span>()</span><br><span class="line">num_atoms = <span class="title function_">len</span>(model)</span><br><span class="line">#<span class="title function_">print</span>(model_positions)</span><br><span class="line"></span><br><span class="line"># 获取虚频对应的<span class="variable constant_">OUTCAR</span>部分 </span><br><span class="line">vib_lines = lines[<span class="attr">l_position</span>:l_position + num_atoms] #振动部分 <span class="number">7222</span>到<span class="number">7248</span>行</span><br><span class="line">#<span class="title function_">print</span>(vib_lines)</span><br><span class="line">vib_dis = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="attr">vib_lines</span>:</span><br><span class="line">    #model_positions = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[:<span class="number">3</span>]]</span><br><span class="line">    vib_infor = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">3</span>:]] # dx， dy， dz对应的那三列</span><br><span class="line">    vib_dis.<span class="title function_">append</span>(vib_infor)</span><br><span class="line">vib_dis = np.<span class="title function_">array</span>(vib_dis) #将振动部分写到一个array中。</span><br><span class="line"></span><br><span class="line"># 微调结构</span><br><span class="line">new_positions = model_positions + vib_dis * <span class="number">0.4</span> # <span class="number">0.4</span>是微调的校正因子，即虚频对应振动位移的<span class="number">0.4</span>，具体多大自己根据经验调。</span><br><span class="line">model.<span class="property">positions</span> = new_positions</span><br><span class="line"></span><br><span class="line">###保存结构</span><br><span class="line"><span class="title function_">write</span>(<span class="string">&#x27;POSCAR_new&#x27;</span>, model, vasp5=<span class="title class_">True</span>) # POSCAR_new是微调后的结构，用于下一步的计算（别忘了把POSCAR_new改成<span class="variable constant_">POSCAR</span>）。</span><br></pre></td></tr></table></figure>

<h3 id="过渡态虚频"><a href="#过渡态虚频" class="headerlink" title="过渡态虚频"></a>过渡态虚频</h3><p>如果过渡态计算的时候出现好几个虚频，自己直接写个python脚本也能实现。不过使用ASE可以很方便地获取POSCAR中原子数目，保存原子固定的信息。参考如下。</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/env python</span><br><span class="line"># -*- <span class="attr">coding</span>: utf-<span class="number">8</span> -*-</span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">Qiang Li</span></span><br><span class="line"><span class="string">Command: python3 vib_correct.py</span></span><br><span class="line"><span class="string">This is a temporary script file.</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">#获取虚频开始行</span><br><span class="line">l_position = <span class="number">0</span>  #虚频振动方向部分在<span class="variable constant_">OUTCAR</span>中的起始行数</span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;OUTCAR&#x27;</span>) <span class="keyword">as</span> <span class="attr">f_in</span>:</span><br><span class="line">    lines = f_in.<span class="title function_">readlines</span>()</span><br><span class="line">    wave_num = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> num, line <span class="keyword">in</span> <span class="title function_">enumerate</span>(lines):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;f/i&#x27;</span> <span class="keyword">in</span> <span class="attr">line</span>:</span><br><span class="line">            wave_tem = <span class="title function_">float</span>(line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">6</span>])</span><br><span class="line">            <span class="keyword">if</span> wave_tem &gt; <span class="attr">wave_num</span>: #获取最大的虚频</span><br><span class="line">                wave_num = wave_tem</span><br><span class="line">                l_position = num+<span class="number">2</span></span><br><span class="line"># 读<span class="variable constant_">POSCAR</span></span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;POSCAR&#x27;</span>) <span class="keyword">as</span> <span class="attr">f_pos</span>:</span><br><span class="line">    lines_pos = f_pos.<span class="title function_">readlines</span>()</span><br><span class="line"></span><br><span class="line"># 获取虚频对应的<span class="variable constant_">OUTCAR</span>部分    </span><br><span class="line">num_atoms = <span class="title function_">sum</span>([<span class="title function_">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> lines_pos[<span class="number">6</span>].<span class="title function_">rstrip</span>().<span class="title function_">split</span>()])</span><br><span class="line">vib_lines = lines[<span class="attr">l_position</span>:l_position + num_atoms] #振动部分 <span class="number">7222</span>到<span class="number">7248</span>行</span><br><span class="line"></span><br><span class="line">model_positions = []</span><br><span class="line">vib_dis = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="attr">vib_lines</span>:</span><br><span class="line">    position = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[:<span class="number">3</span>]]</span><br><span class="line">    vib_infor = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">3</span>:]] # dx， dy， dz对应的那三列</span><br><span class="line">    model_positions.<span class="title function_">append</span>(position)</span><br><span class="line">    vib_dis.<span class="title function_">append</span>(vib_infor)</span><br><span class="line"></span><br><span class="line"># 微调结构</span><br><span class="line">model_positions = np.<span class="title function_">array</span>(model_positions)</span><br><span class="line">vib_dis = np.<span class="title function_">array</span>(vib_dis) #将振动部分写到一个array中。</span><br><span class="line">new_positions = model_positions + vib_dis * <span class="number">0.4</span> # <span class="number">0.4</span>是微调的校正因子，即虚频对应振动位移的<span class="number">0.4</span>，具体多大自己根据经验调。</span><br><span class="line"></span><br><span class="line">###保存结构</span><br><span class="line">f_out = <span class="title function_">open</span>(<span class="string">&#x27;POSCAR_new&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f_out.<span class="title function_">writelines</span>(lines_pos[:<span class="number">8</span>])</span><br><span class="line">f_out.<span class="title function_">write</span>(<span class="string">&#x27;Cartesian\n&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="attr">new_positions</span>:</span><br><span class="line">    f_out.<span class="title function_">write</span>(<span class="string">&#x27; &#x27;</span>.<span class="title function_">join</span>([<span class="title function_">str</span>(coord) <span class="keyword">for</span> coord <span class="keyword">in</span> i]) + <span class="string">&#x27;  F  F  F\n&#x27;</span>)</span><br><span class="line">f_out.<span class="title function_">close</span>()</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-47-22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-47-22/" class="post-title-link" itemprop="url">1.3 结构优化3</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:47:22" itemprop="dateCreated datePublished" datetime="2023-05-09T18:47:22+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-07-16 15:11:05" itemprop="dateModified" datetime="2023-07-16T15:11:05+08:00">2023-07-16</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="加压"><a href="#加压" class="headerlink" title="加压"></a>加压</h1><p>可通过施加静水压强、调整晶格常数的方法实现结构压缩</p>
<p>vi INCAR 增加标签 <code>PSTRESS=50</code><br>（单位为 0.1 GPa）</p>
<p>其他不变</p>
<h1 id="加电场"><a href="#加电场" class="headerlink" title="加电场"></a>加电场</h1><p>在vasp中根据自己所需要添加电场的场强更改INCAR中的如下参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LDIPOL=.TRUE.</span><br><span class="line">IDIPOL=1/2/3/4</span><br><span class="line">EFIELD= ？</span><br></pre></td></tr></table></figure>
<p>对于IDIPOL参数的设置，需注意：对于IDIPOL&#x3D;1-3，偶极矩将分别平行于第一、第二或第三晶格矢量的方向计算。总能量的修正计算为当前超单元中单极子&#x2F;偶极子和四极子与放置在超单元中的同一偶极子之间的能量差，对应的晶格矢量接近无穷大。此标志应用于板计算。对于IDIPOL&#x3D;4，将计算所有方向上的完整偶极矩，并将总能量的修正计算为当前超级单体中的单极&#x2F;偶极&#x2F;四极和放置在真空中的同一单极&#x2F;偶极&#x2F;四极之间的能量差，使用该标志计算孤立分子。</p>
<p>此外，EFIELD 的设置需要注意单位的换算。eV&#x2F;Å（电子伏特&#x2F;埃）计算完毕之后通过后处理软件分析所关注的性质即可。</p>
<h1 id="状态方程拟合"><a href="#状态方程拟合" class="headerlink" title="状态方程拟合"></a>状态方程拟合</h1><p>我们需要对结构进行优化才可以获取稳定的晶格参数信息。有两个方法可以实现：</p>
<p>1 Birch-Murnaghan状态方程拟合,<br>2 VASP计算中通过调节ISIF参数直接优化Bulk。<br>直接优化前面已经介绍，下面我们先讨论一下第一个方法：BM方程拟合。</p>
<p>参考：大师兄科研网：<a target="_blank" rel="noopener" href="https://www.bigbrosci.com/2018/02/02/ex33/">https://www.bigbrosci.com/2018/02/02/ex33/</a></p>
<p>科学网耿华运的博文：<a target="_blank" rel="noopener" href="https://blog.sciencenet.cn/blog-3469498-1280203.html">https://blog.sciencenet.cn/blog-3469498-1280203.html</a></p>
<p>科学网赵志强的博文，关于拟合：<a target="_blank" rel="noopener" href="https://wap.sciencenet.cn/blog-3388193-1152915.html">https://wap.sciencenet.cn/blog-3388193-1152915.html</a></p>
<p>vaspkit：<a target="_blank" rel="noopener" href="http://vaspkit.cn/index.php/48.html">http://vaspkit.cn/index.php/48.html</a></p>
<h3 id="大致流程（以大师兄提供脚本为例）"><a href="#大致流程（以大师兄提供脚本为例）" class="headerlink" title="大致流程（以大师兄提供脚本为例）"></a>大致流程（以大师兄提供脚本为例）</h3><ol>
<li><p>获得一定缩放系数的结构：<code>for i in 0.95 0.96 0.97 0.98 0.99 1.01 1.02 1.03 1.04 1.05; do cp 1.00 $i ; sed -i &quot;2s/1.0/$i/g&quot; $i/POSCAR ; done</code></p>
</li>
<li><p>分别进行结构优化:<code>for i in *; do cd $i; 提交任务命令; cd $OLDPWD; done</code></p>
</li>
<li><p>提取能量-体积以及能量-压力、压力-体积的数据:<code>for i in *; do echo -e $i &quot;\t&quot; $(grep &#39;  without&#39; $i/OUTCAR | tail -n 1| awk &#39;&#123;print $7&#125;&#39;);  done &gt; data</code></p>
</li>
<li><p>拟合能量体积曲线，获得平衡晶胞参数</p>
</li>
</ol>
<ul>
<li>这个流程可通过批量计算脚本实现，参考上面链接。另外还可以获得能量随压力的变化来模拟相变。</li>
</ul>
<h1 id="分数占据"><a href="#分数占据" class="headerlink" title="分数占据"></a>分数占据</h1><p>生成disorder或者掺杂构型的软件汇总：</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/vYar9UcYWAZgazBTgqUGEA">https://mp.weixin.qq.com/s/vYar9UcYWAZgazBTgqUGEA</a><br><a target="_blank" rel="noopener" href="https://github.com/jichunlian/disorder">https://github.com/jichunlian/disorder</a><br>supercell： <a target="_blank" rel="noopener" href="https://orex.github.io/supercell/">https://orex.github.io/supercell/</a><br>ATAT： <a target="_blank" rel="noopener" href="https://www.brown.edu/Departments/Engineering/Labs/avdw/atat/">https://www.brown.edu/Departments/Engineering/Labs/avdw/atat/</a><br>vaspkit：<a target="_blank" rel="noopener" href="https://vaspkit.com/">https://vaspkit.com/</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Keke Liu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
