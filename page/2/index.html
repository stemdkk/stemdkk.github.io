<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.16.0","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="一个小学生的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Lightchaser">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="Lightchaser">
<meta property="og:description" content="一个小学生的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Keke Liu">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Lightchaser</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Lightchaser</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">三人行，必有我师</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Keke Liu</p>
  <div class="site-description" itemprop="description">一个小学生的博客</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">41</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/stemdkk" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;stemdkk" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:257198@whut.edu.cn" title="E-Mail → mailto:257198@whut.edu.cn" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/19-49-25/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/19-49-25/" class="post-title-link" itemprop="url">3.4 非谐声子</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 19:49:25" itemprop="dateCreated datePublished" datetime="2023-05-09T19:49:25+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-29 17:26:26" itemprop="dateModified" datetime="2024-10-29T17:26:26+08:00">2024-10-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFT%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">DFT学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>ALAMODE中非谐声子计算部分采用了自洽声子计算方法。</p>
<p>具体教程：<a target="_blank" rel="noopener" href="https://alamode.readthedocs.io/en/latest/anphondir/formalism_anphon.html#self-consistent-phonon-scph-calculation">https://alamode.readthedocs.io/en/latest/anphondir/formalism_anphon.html#self-consistent-phonon-scph-calculation</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1mv411M7W7/?spm_id_from=333.999.0.0&vd_source=17084cc867ff3bb86398ff1a79b443f2">https://www.bilibili.com/video/BV1mv411M7W7/?spm_id_from=333.999.0.0&amp;vd_source=17084cc867ff3bb86398ff1a79b443f2</a></p>
<p>TDEP 是其采用技术Temperature dependent effective potential的缩写。<br>下面是开发者的网站，但是并不能下载到源代码。<a target="_blank" rel="noopener" href="http://ollehellman.github.io/page/index.html%E5%A5%BD%E6%B6%88%E6%81%AF%E6%98%AF%E7%AC%AC%E4%B8%80%E6%80%A7%E5%8E%9F%E7%90%86%E8%AE%A1%E7%AE%97%E8%BD%AF%E4%BB%B6ABINIT%E4%B8%AD%E9%9B%86%E6%88%90%E4%BA%86TDEP%E6%96%B9%E6%B3%95%EF%BC%8C%E5%AE%98%E7%BD%91user">http://ollehellman.github.io/page/index.html好消息是第一性原理计算软件ABINIT中集成了TDEP方法，官网user</a> guide&gt;a-TDEP。需要研究的可以自行研究。ABINIT官网：<a target="_blank" rel="noopener" href="https://www.abinit.org/">https://www.abinit.org/</a></p>
<p>Dynaphopy 是采用了一种基于AIMD（第一性原理分子动力学）的杂化方法的python程序包：<a target="_blank" rel="noopener" href="http://abelcarreras.github.io/DynaPhoPy/index.html">http://abelcarreras.github.io/DynaPhoPy/index.html</a><br>文中给出了参考文献，需要的自行下载。</p>
<h1 id="ALAMODE"><a href="#ALAMODE" class="headerlink" title="ALAMODE"></a>ALAMODE</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><a target="_blank" rel="noopener" href="https://alamode.readthedocs.io/en/latest/index.html#">https://alamode.readthedocs.io/en/latest/index.html#</a></p>
<h2 id="ALAMODE计算Si简谐声子谱"><a href="#ALAMODE计算Si简谐声子谱" class="headerlink" title="ALAMODE计算Si简谐声子谱"></a>ALAMODE计算Si简谐声子谱</h2><h3 id="1、利用ALM计算displacement-patterns"><a href="#1、利用ALM计算displacement-patterns" class="headerlink" title="1、利用ALM计算displacement patterns"></a>1、利用ALM计算displacement patterns</h3><p>优化后的超胞结构重命名<strong>POSCAR.orig</strong>，准备输入文件<strong>si_alm.in</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&amp;general</span><br><span class="line">  PREFIX = si222</span><br><span class="line">  MODE = suggest</span><br><span class="line">  NAT = 64; NKD = 1</span><br><span class="line">  KD = Si</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;interaction</span><br><span class="line">  NORDER = 1  # 1: harmonic, 2: cubic, ..</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;cell</span><br><span class="line">  20.406 # factor in Bohr unit</span><br><span class="line">  1.0 0.0 0.0 # a1</span><br><span class="line">  0.0 1.0 0.0 # a2</span><br><span class="line">  0.0 0.0 1.0 # a3</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;cutoff </span><br><span class="line">  Si-Si None</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;position</span><br><span class="line">  1 0.0000000000000000 0.0000000000000000 0.0000000000000000   </span><br><span class="line">  1 0.0000000000000000 0.0000000000000000 0.5000000000000000</span><br><span class="line">  1 0.0000000000000000 0.2500000000000000 0.2500000000000000</span><br><span class="line">  1 0.0000000000000000 0.2500000000000000 0.7500000000000000</span><br><span class="line">  1 0.0000000000000000 0.5000000000000000 0.0000000000000000</span><br><span class="line">  1 0.0000000000000000 0.5000000000000000 0.5000000000000000</span><br><span class="line">  1 0.0000000000000000 0.7500000000000000 0.2500000000000000</span><br></pre></td></tr></table></figure>
<p>晶格常数替代为自己的超胞结构。</p>
<p>运行ALM: <code>alm si_alm.in &gt; si_alm.log1</code>，将会生成<strong>si222.pattern_HARMONIC</strong>文件，包含坐标信息。对于Si只有一个displacement patterns。</p>
<h3 id="2、计算原子间力"><a href="#2、计算原子间力" class="headerlink" title="2、计算原子间力"></a>2、计算原子间力</h3><p>在此之前要确定位移的大小，一般简谐0.01-0.04，0.01大多可以。运行<code>python displace.py --VASP=POSCAR.orig --mag=0.01 -pf si222.pattern_HARMONIC</code></p>
<p>之后对每个结构提交计算，脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># Assume we have 20 displaced configurations for QE [disp01.pw.in,..., disp20.pw.in].</span><br><span class="line"></span><br><span class="line">for ((i=1;i&lt;=20;i++))</span><br><span class="line">do</span><br><span class="line">    num=`echo $i | awk &#x27;&#123;printf(&quot;%02d&quot;,$1)&#125;&#x27;`</span><br><span class="line">    mkdir $&#123;num&#125;</span><br><span class="line">    cd $&#123;num&#125;</span><br><span class="line">    cp ../disp$&#123;num&#125;.pw.in .</span><br><span class="line">    pw.x &lt; disp$&#123;num&#125;.pw.in &gt; disp$&#123;num&#125;.pw.out</span><br><span class="line">    cd ../</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>计算完成后，提取信息：<code>python extract.py --VASP=POSCAR.orig vasprun*.xml &gt; DFSET_harmonic</code>，生成<strong>DFSET_harmonic</strong>文件。</p>
<h3 id="3、拟合力常数"><a href="#3、拟合力常数" class="headerlink" title="3、拟合力常数"></a>3、拟合力常数</h3><p>修改1中的 <strong>si_alm.in</strong> ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&amp;general</span><br><span class="line">  PREFIX = si222</span><br><span class="line">  MODE = optimize   # &lt;-- here</span><br><span class="line">  NAT = 64; NKD = 1</span><br><span class="line">  KD = Si</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;optimize</span><br><span class="line">  DFSET = DFSET_harmonic</span><br><span class="line">/</span><br></pre></td></tr></table></figure>
<p>运行<code>alm si_alm.in &gt; si_alm.log2</code>，生成<strong>si222.fcs and si222.xml</strong></p>
<h3 id="4、计算声子谱和DOS"><a href="#4、计算声子谱和DOS" class="headerlink" title="4、计算声子谱和DOS"></a>4、计算声子谱和DOS</h3><p>准备<strong>si_phband.in</strong>文件，结构中用晶胞结构，注意&amp;cell中单位是Bohr，具体可设置如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&amp;general</span><br><span class="line">  PREFIX = si</span><br><span class="line">  MODE   = phonons</span><br><span class="line">  FCSXML = si.xml</span><br><span class="line"></span><br><span class="line">  NKD = 1; KD = Si</span><br><span class="line">  MASS = 28.085</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;cell</span><br><span class="line">  10.184247326051628 </span><br><span class="line">  0.0000000000000000    0.5071343999939496    0.5071343999939496</span><br><span class="line">  0.5071343999939496    0.0000000000000000    0.5071343999939496</span><br><span class="line">  0.5071343999939496    0.5071343999939496    0.0000000000000000</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;kpoint</span><br><span class="line">  1   # KPMODE = 1: line mode</span><br><span class="line">  G 0.0 0.0 0.0 X 0.5 0.5 0.0 51</span><br><span class="line">  X 0.5 0.5 1.0 G 0.0 0.0 0.0 51</span><br><span class="line">  G 0.0 0.0 0.0 L 0.5 0.5 0.5 51</span><br><span class="line">/</span><br></pre></td></tr></table></figure>
<p>执行<code>anphon si_phband.in &gt; si_phband.log</code>会产生<strong>si.bands</strong>文件，可以用plotband.py脚本画图。执行python plotband.py si.bands得到</p>
<p>准备si_phdos.in文件，结构中用晶胞结构，注意&amp;cell中单位是Bohr，具体可设置如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&amp;general</span><br><span class="line">  PREFIX = si</span><br><span class="line">  MODE   = phonons</span><br><span class="line">  FCSXML = si.xml</span><br><span class="line"></span><br><span class="line">  NKD = 1; KD = Si</span><br><span class="line">  MASS = 28.085</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;cell</span><br><span class="line">  10.184247326051628 </span><br><span class="line">  0.0000000000000000    0.5071343999939496    0.5071343999939496</span><br><span class="line">  0.5071343999939496    0.0000000000000000    0.5071343999939496</span><br><span class="line">  0.5071343999939496    0.5071343999939496    0.0000000000000000</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;kpoint</span><br><span class="line">  2   # KPMODE = 2: uniform mesh mode</span><br><span class="line">  20 20 20</span><br><span class="line">/</span><br></pre></td></tr></table></figure>
<p>执行<code>anphon si_phdos.in &gt; si_phdos.log</code>会产生<strong>si.dos</strong>文件，可以用plotdos.py脚本画图。执行python plotdos.py –emax 550 –nokey si.dos得到</p>
<h3 id="5-估算对热导率的立方IFCs-非简谐IFCs"><a href="#5-估算对热导率的立方IFCs-非简谐IFCs" class="headerlink" title="5. 估算对热导率的立方IFCs(非简谐IFCs)"></a>5. 估算对热导率的立方IFCs(非简谐IFCs)</h3><p>这里计算非简谐IFCs，我们把si_alm1.in复制为si_alm3.in，将NORDER &#x3D; 1改为NORDER &#x3D; 2.我们还要注意这里考虑计算三阶力常数，所以&amp;cutoff下的参数我们要再指定个截止半径，一般要求略大于第二近邻的距离（可以从si_alm1.log查看，如下图）。当然你接着用None也行，这样可能大大增加参数的数量，从而增加计算成本。</p>
<p>运行alm si_alm3.in &gt; si_alm3.log，可以看到多了si_cubic.相关文件。运行python displace.py –OpenMX&#x3D;Si.dat –mag&#x3D;0.04 -pf si_cubic.pattern_ANHARM3，可见产生了disp01.dat到disp11.dat11个OpenMX输入文件，我们准备shell脚本批量提交，shell脚本命名为pbs.sh，具体为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">for ((i=1;i&lt;=11;i++))</span><br><span class="line">do</span><br><span class="line">    num=`echo $i | awk &#x27;&#123;printf(&quot;%02d&quot;,$1)&#125;&#x27;`</span><br><span class="line">    mkdir $&#123;num&#125;</span><br><span class="line">    cd $&#123;num&#125;</span><br><span class="line">    cp ../disp$&#123;num&#125;.dat .</span><br><span class="line">    cp disp$&#123;num&#125;.dat Si.dat</span><br><span class="line">    cp ../openmx.pbs .</span><br><span class="line">    qsub openmx.pbs</span><br><span class="line">    cd ../</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h4 id="简谐计算步骤"><a href="#简谐计算步骤" class="headerlink" title="简谐计算步骤"></a>简谐计算步骤</h4><ol>
<li>输入文件： 优化后的超胞结构重命名<strong>POSCAR.orig</strong>，准备输入文件<strong>si_alm.in</strong>（其中mode：suggest）；输出：<strong>si222.pattern_HARMONIC</strong>文件，包含坐标信息。</li>
<li>displace.py对上面的.pattern文件处理，得到随机位移结构；对随机位移机构进行力的计算，生成不同vasprun.xml；extract.py处理上面vasprun.xml，生成<strong>DFSET_harmonic</strong>文件。</li>
<li><font color=red>力常数拟合输入文件：</font><strong>DFSET_harmonic</strong>文件，修改1中的 <strong>si_alm.in</strong>，其中mode改成opt, 添加下面；生成<strong>si222.fcs and si222.xml</strong>。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&amp;optimize</span><br><span class="line">  DFSET = DFSET_harmonic</span><br><span class="line">/</span><br></pre></td></tr></table></figure></li>
<li>后处理输入文件：准备<strong>phband.in</strong>文件，修改MODE   &#x3D; phonons<br>  FCSXML &#x3D; si.xml；修改kmesh格式可得到声子谱、态密度、热性质等。</li>
</ol>
<h4 id="非谐计算"><a href="#非谐计算" class="headerlink" title="非谐计算"></a>非谐计算</h4><ol>
<li>准备简谐计算得到的<strong>si222.fcs and si222.xml</strong>，AIMD得到的vasprun.xml，超胞结构。</li>
<li>displace.py 对AIMD的vasprun.xml处理，得到随机结构；对随机位移机构进行力的计算，生成不同vasprun.xml；extract.py处理上面vasprun.xml，生成<strong>DFSET_AIMD_random</strong>文件。</li>
<li><font color=red>Cross validation (CV)：</font>alm_cv.in文件中添加简谐力常数 FC2XML &#x3D; ..&#x2F;harmonic.xml，添加高阶力常数部分标签和cv相关标签，<strong>mode &#x3D; cv</strong>；得到*cvset文件；python3 cvscore.py *cvset &gt; si222.cvscore得到Minimum cvscore</li>
<li><font color=red>拟合力常数输入文件：</font>alm_opt.in中mode&#x3D;opt；修改cv相关标签；生成高阶力常数<strong>cv.fcs and cv.xml</strong>.在这一步alm 的输入文件&amp;general 部分加入 FC3_SHENGBTE&#x3D;1、 FC4_SHENGBTE&#x3D;1可输出ShengBTE格式的输入文件。</li>
<li><font color=red>SCPH计算：</font>scph.in文件中修改MODE&#x3D;SCPH和温度标签；添加&amp;scph模块，见上面例子。anphon scph.in &gt; scph.log提交，查看收敛：grep “conv” scph.log。生成输出文件：.scph_dymat、.scph_dfc2、.scph_bands。对.scph_dfc2处理得到有效二阶力常数文件，用于后续计算。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;dfc2</span><br><span class="line">DFC2--a generator of renormalized harmonic FCs from SCPH outputs.</span><br><span class="line">XML file containing original Fc2 : STo222.xml </span><br><span class="line">Output xml filename with anharmonic correction : ST0222_SCPH2-2_300K.xml</span><br><span class="line">FC2 correction file fromSCPH calculation :STo_scph2-2.scph_dfc2</span><br><span class="line">Target temperature : 300</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">New XML file STo222_SCPH2-2_300K.xml was created successfully.</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="Alamode计算高温声子色散"><a href="#Alamode计算高温声子色散" class="headerlink" title="Alamode计算高温声子色散"></a>Alamode计算高温声子色散</h2><p>Anharmonic Phonons (self-consistent phonon theory)<br>主要使用alamode软件。 版本：alamode-1.1.0</p>
<h3 id="输入文件"><a href="#输入文件" class="headerlink" title="输入文件"></a>输入文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vasprun.xml #分子动力学输出文件</span><br><span class="line">Dfile  #包含原子的力和位移</span><br><span class="line">extract_disp.py #选取结构，并计算位移</span><br><span class="line">extract_force.py #选取结构，并获得受力</span><br><span class="line">PPOSCAR #初始超胞</span><br><span class="line">alm.in #提取力常数的输入文件</span><br><span class="line">anphono.in #计算声子谱的输入文件</span><br></pre></td></tr></table></figure>
<ol>
<li>从分子动力学数据中选取一定数量的结构，并提取它们的力和计算与初始状态相比的位移，输出到<strong>Dfile</strong>文件当中</li>
</ol>
<p><code>python extract_disp.py </code><br>#运行后根据提示输入开始的步数和间隔步数<br>#例如总共1000步，从第一步开始提取，每间隔五步提取一次<br>#得到disp.dat</p>
<p><code>python extract_force.py</code> </p>
<p>方法同上得到force.dat<br>将disp.dat和force.dat文件按如下形式合并到一起</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">disp1x  disp1y  disp1z   force1x  force1y  force1z</span><br><span class="line">       ......</span><br><span class="line">       ......</span><br><span class="line">dispNx  dispNy  dispNz   forceNx  forceNy  forceNz</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>获取力常数</li>
</ol>
<p>提取四阶力常数的<strong>alm.in</strong>文件如下（使用LASSO方法）：</p>
<p>二阶力常数可以通过有限位移法提取(详见官网手册)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&amp;general</span><br><span class="line">  PREFIX = ThO2_ENET</span><br><span class="line">  MODE = optimize</span><br><span class="line">  NAT = 81; NKD = 2</span><br><span class="line">  KD = Th O</span><br><span class="line">#  PRINTSYM=1</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;interaction</span><br><span class="line">  NORDER = 5  # 1: harmonic, 2: cubic, ..</span><br><span class="line">  NBODY = 2 3 3 2 2</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;cell</span><br><span class="line">  1 # factor in Bohr unit</span><br><span class="line">  0.0000000000000   15.919498944104   15.919498944104</span><br><span class="line">  15.919498944104   0.0000000000000   15.919498944104</span><br><span class="line">  15.919498944104   15.919498944104   0.0000000000000</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;optimize</span><br><span class="line">  LMODEL= enet</span><br><span class="line">  FC2XML = ThO2_2nd.xml</span><br><span class="line">  DFSET=ThO2_dffile</span><br><span class="line"></span><br><span class="line">  CV = 0</span><br><span class="line">  L1_RATIO = 1.0</span><br><span class="line">  L1_ALPHA = 1.0e-06</span><br><span class="line">  CV_MINALPHA = 1.0e-6</span><br><span class="line">  CV_MAXALPHA = 0.02</span><br><span class="line">  CV_NALPHA = 100</span><br><span class="line"></span><br><span class="line">  STANDARDIZE = 1</span><br><span class="line">  CONV_TOL = 1.0e-9</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;cutoff </span><br><span class="line">  *-* None None 12.0 12.0 12.0</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;position</span><br><span class="line">1  0.0000000000000000  0.0000000000000000  0.0000000000000000</span><br><span class="line">1  0.3333333333333333  0.0000000000000000  0.0000000000000000</span><br><span class="line">..................</span><br></pre></td></tr></table></figure>
<p>注意晶格常数单位的转换 $1 Bohr&#x3D; 0.529177208 Angstrom$</p>
<p>在终端运行：</p>
<p>bash<br><code>alm alm.in &gt; alm.log</code><br>得到<strong>Nb.xml</strong></p>
<ol start="3">
<li>Anharmonic Phonon</li>
</ol>
<p><strong>anphono.in</strong>输入文件如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&amp;general</span><br><span class="line"> PREFIX =scph</span><br><span class="line"> MODE = SCPH</span><br><span class="line"> FCSXML =Nb.xml #forceconstant file</span><br><span class="line"></span><br><span class="line"> NKD = 1; KD = Nb</span><br><span class="line"> MASS = 92.90638</span><br><span class="line"></span><br><span class="line"> #NONANALYTIC = 0; BORNINFO = PbTe.born</span><br><span class="line"></span><br><span class="line"> TMIN = 0; TMAX = 300; DT = 100   #Temperature and step</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;scph</span><br><span class="line"> KMESH_SCPH        = 6 6 6</span><br><span class="line"> KMESH_INTERPOLATE = 6 6 6</span><br><span class="line"></span><br><span class="line"> SELF_OFFDIAG = 0</span><br><span class="line"> RESTART_SCPH = 0</span><br><span class="line"></span><br><span class="line"> MIXALPHA = 0.1</span><br><span class="line"> MAXITER = 500</span><br><span class="line"> TOL_SCPH = 1.0e-10</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;cell   ## primitive cell is best</span><br><span class="line">  6.2507550151332</span><br><span class="line">  -0.5  0.5  0.5</span><br><span class="line">   0.5 -0.5  0.5</span><br><span class="line">   0.5  0.5 -0.5</span><br><span class="line">/</span><br><span class="line"></span><br><span class="line">&amp;kpoint</span><br><span class="line">  1  # KPMODE = 1: get phonon band  2: get others properties</span><br><span class="line">  G 0.0 0.0 0.0 H 0.5 -0.5 0.5 201</span><br><span class="line">  H 0.5 -0.5 0.5 P 0.25 0.25 0.25 201</span><br><span class="line">  P 0.25 0.25 0.25 G 0.0 0.0 0.0 201</span><br><span class="line">  G 0.0 0.0 0.0  N 0.0 0.0 0.5 201</span><br><span class="line">/</span><br></pre></td></tr></table></figure>
<p>在终端运行：</p>
<p><code>anphon anphono.in &gt; anphono.log</code><br>得到<strong>scph.scph_bands</strong>，里面有不同温度下的声子谱</p>
<ol start="4">
<li>进入安装目录下的tools文件夹：make Makefile，编译df2c。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[scf1355@ln151%nc-l ah]$ ~/soft/alamode/tools/dfc2 </span><br><span class="line"> DFC2 -- a generator of renormalized harmonic FCs from SCPH outputs.</span><br><span class="line"> XML file containing original FC2 : crte2-442.xml</span><br><span class="line"> Output xml filename with anharmonic correction : crte2-new.xml</span><br><span class="line"> FC2 correction file from SCPH calculation : crte2-442.scph_dfc2</span><br><span class="line"> Target temperature : 300</span><br></pre></td></tr></table></figure></li>
</ol>
<p> 输出crte2-new.xml.利用<a target="_blank" rel="noopener" href="https://github.com/ttadano/alamode/discussions/192">https://github.com/ttadano/alamode/discussions/192</a> 中提到的脚本转换成phonopy格式。此时的力常数文件由于对称性数量不匹配，利用phonopy读取并写出FULL_FORCE_CONSTANTS。</p>
<h2 id="Alamode-to-ShengBTE"><a href="#Alamode-to-ShengBTE" class="headerlink" title="Alamode_to_ShengBTE"></a>Alamode_to_ShengBTE</h2><h3 id="Alamode计算热导率步骤"><a href="#Alamode计算热导率步骤" class="headerlink" title="Alamode计算热导率步骤"></a>Alamode计算热导率步骤</h3><ol>
<li>所有的计算都是基于密度泛函软件 VASP 来进行的。</li>
<li>首先利用第一性原理的密度泛函对晶体结构进行优化，弛豫出稳定的晶格结构，然后利用密度泛函微扰理论计算出波恩有效电荷和静态介电张量，以便用于后续求解动力学矩阵的非解析部分。 </li>
<li>随后为了获得更加精准的二阶力常数，通过差分位移的方法生成微扰结构，后利用静态密度泛函理论计算出力和位移信息，再利用最小二乘法得到所需要的二阶力常数。 </li>
<li>对于高阶力常数，本文利用分子动力学模拟得到 80 个准随机结构，对每个准随机结构的原子施加随机方向的微小位移，以便得到更加随机的结构，最后利用最小绝对收缩和选择算子的方法得到高阶力常数。 </li>
<li>结合上述已经得到的介电张量、波恩有效电荷、二阶力常数和三阶力常数作为输入，最后通过ShengBTE声子玻尔兹曼输运方程求得简谐近似下晶格热导率、声子群速度、 声子散射率等热输运系数。 </li>
<li>结合介电张量、波恩有效电荷、二阶力常数和四阶力常数作为输入进行自洽声子理论的计算，这将得到与温度相关的非谐动力学矩阵，对其进行傅里叶变换得到与温度相关的有效二阶力常数，用有效二阶力常数代替上述的二阶力常数，在此基础上求解声子玻尔兹曼输运方程求得自洽声子理论下晶格热导率、声子群速度、声子散射率等热输运系数。</li>
<li>在简谐近似下存在虚频，与实验观察到的稳定性不一致。因此，传统的基于简谐原子间力常数的玻尔兹曼输运方程解的结果不再有效，并且非谐效应在足够大的位移振幅内变得显著。在 ALAMODE 软件包中，通过有限位移法在 2×2×2 超胞中获得简谐原子间力常数 (IFCs) ，位移大小设置为 0.01Å。<br>随后，通过压缩感知晶格动力学方法训练三阶和四阶力常数。具体来说，本文首先模拟了在 300 K、时间步长为 2fs 的 4000 步的从头算分子动力学，得到了 80 个快照。为了得到准随机结构， 本文将到得到快照中的原子向随机方向移动 0.1 Å。随后，本文将获得的准随机结构在 4×4×4 的 k 点网格中进行了静态 DFT 计算，以计算 Hellmann–Feynman 力。最终，利用得到的 80 个准随机结构的位移和力组成的数据集通过最小绝对收缩和选择算子 (least absolute shrinkage and selection operator，简称 LASSO)方法训练出非谐力常数。<br>在计算中本文考虑了超胞内的所有原子间最近邻相互作用来计算简谐和三阶力常数，四阶力常数只考虑了第五最近邻内的相互作用，由于五阶和六阶力常数 对结果的影响很小，因此只考虑了次近邻相互作用。<br>本文根据 ALAMODE 软件包中采用的 SCP 理论，利用获得的简谐和非谐力常数来计算非谐声子频率。<br>声子玻尔兹曼输运方程的解是通过 ShengBTE 的修订版 FourPhonon 软件包来实现的，并建立了具有高斯涂抹 (scale broad 参数为 0.05) 的 18×18×18 的 q 点网格来模拟相关积分和声子波矢量。此外，在计算中得到了大约 2.3×105 个三声子过程和 1.2×109 个四声子过程。因此，对于三声子散射，本文采用迭代方案来求解玻尔兹曼输运方程，而通过单模弛豫时间近似(SMRTA) 来处理四声子散射过程，这是因为计算成本巨大。</li>
</ol>
<h3 id="步骤分析"><a href="#步骤分析" class="headerlink" title="步骤分析"></a>步骤分析</h3><ul>
<li>上面第3步，利用alm来算大概分为三步，mode设为suggest产生随机位移，vasp求力和能量，mode设为opt拟合二阶力常数即可。<strong>alm模块</strong>。</li>
<li>上面第4步，利用AIMD产生随机位移，vasp求力和能量，压缩感知晶格动力学方法训练三阶和四阶力常数mode设为cv，随后mode设为opt拟合高阶力常数，<strong>alm模块</strong>。最后mode设为SCPH获得变温声子谱和有效二阶力常数,<strong>anphon模块</strong>。后续运行<strong>dfc2</strong>模块生成指定温度的有效二阶力常数，用<a target="_blank" rel="noopener" href="https://github.com/ttadano/alamode/discussions/192">https://github.com/ttadano/alamode/discussions/192</a> 中提到的脚本转换成phonopy格式。</li>
<li>上面第5步，为了产生ShengBTE的力常数输入文件，在拟合高阶力常数时，alm 的输入文件&amp;general 部分加入 FC3_SHENGBTE&#x3D;1、 FC4_SHENGBTE&#x3D;1即可。如果简谐声子谱有虚频，上面的有效二阶力常数也需要，即第7步所述。</li>
<li>上面第6步见ShengBTE教程3.2节。</li>
<li>Alamode可以得到的结果包括格林艾森常数、声子群速度、三声子相空间、热导率原子贡献率和元素、变温声子谱和态密度、MSD、可视化振动模式、QHA等,<strong>anphon模块</strong>。</li>
</ul>
<h3 id="Alamode-连接-shengBTE"><a href="#Alamode-连接-shengBTE" class="headerlink" title="Alamode 连接 shengBTE"></a>Alamode 连接 shengBTE</h3><p>首先，github上安装最新版本的develop branches 或 feature&#x2F;shengbte_4ph branches</p>
<p>[<strong>3rd 4th IFCs</strong>]  </p>
<p>拟合力常数时，alm 的输入文件&amp;general 部分加入 FC3_SHENGBTE&#x3D;1、 FC4_SHENGBTE&#x3D;1即可。</p>
<hr>
<p>&amp;general</p>
<p> PREFIX &#x3D; BN-1000</p>
<p> MODE &#x3D; opt</p>
<p> NAT &#x3D; 128</p>
<p> NKD &#x3D; 2; KD &#x3D; B N</p>
<p> TOLERANCE &#x3D; 1.0e-3</p>
<p> FC3_SHENGBTE&#x3D;1</p>
<p> FC4_SHENGBTE&#x3D;1</p>
<p>&#x2F;</p>
<hr>
<p>Note：输出的文件名为：FORCE_CONSTANT_3RD、FORCE_CONSTANT_4TH，和ShengBTE的文件名差一个S，FORCE_CONSTANTS_3RD、FORCE_CONSTANTS_4TH</p>
<p>[<strong>2nd IFCs</strong>]  </p>
<p>首先通过QE的DFPT计算一个不含SCP的二阶力常数，BN.ifc2。</p>
<p>做SCPH计算，会生成计算温度点的二阶力常数SCP等效修正部分，例如BN.scph_dfc2（仅考虑四声子散射对重整化的影响），若进一步考虑三声子散射的重整化作用，文件名为BN.scph+bubble(0)_dfc2。</p>
<p>alamode&#x2F;tools&#x2F;scph_to_qefc.py    可以将SCP的修正部分与QE计算的二阶力常数相加，得到指定温度重整化后的二阶力常数。</p>
<p>Usage:</p>
<blockquote>
<p>python scph_to_qefc.py  original_QEfc2 scph_fc2_correction temperature &gt; scp_fc2</p>
<p>python scph_to_qefc.py BN.ifc2    BN.scph_dfc2    1000 &gt; espresso.ifc2</p>
</blockquote>
<h2 id="Authors-and-references"><a href="#Authors-and-references" class="headerlink" title="Authors and references"></a>Authors and references</h2><p>Weizhe Yuan <u><a href="mailto:&#x79;&#117;&#x61;&#x6e;&#x77;&#122;&#x40;&#115;&#116;&#117;&#x2e;&#104;&#x69;&#x74;&#x2e;&#x65;&#x64;&#x6e;&#46;&#x63;&#x6e;">&#x79;&#117;&#x61;&#x6e;&#x77;&#122;&#x40;&#115;&#116;&#117;&#x2e;&#104;&#x69;&#x74;&#x2e;&#x65;&#x64;&#x6e;&#46;&#x63;&#x6e;</a></u></p>
<ul>
<li>W. Yuan et al., <a target="_blank" rel="noopener" href="https://www.researchgate.net/journal/Physical-Review-B-1095-3795?_tp=eyJjb250ZXh0Ijp7ImZpcnN0UGFnZSI6ImhvbWUiLCJwYWdlIjoicHVibGljYXRpb24iLCJwcmV2aW91c1BhZ2UiOiJwcm9maWxlIiwicG9zaXRpb24iOiJwYWdlSGVhZGVyIn19">Physical Review B</a> 110, 165412 (2024).</li>
</ul>
<h2 id="注意的问题"><a href="#注意的问题" class="headerlink" title="注意的问题"></a>注意的问题</h2><ol>
<li><p>The accuracy of the anharmonic force constants can be checked by increasing the size of the training dataset. If the physical properties, such as thermal conductivity and free energy, change significantly with the size of the training dataset, it indicates that the training is insufficient. If the change is minor, your force constants may be OK.</p>
</li>
<li><p>报错：Warning: The following force constant doesn’t exist in the original file:<br>You can neglect this warning as long as the correction term (the last column) is small.<br>This warning is raised when the absolute value of the correction is larger than 1.0e-10 and the corresponding force constant does not exist in the original FCSXML file. In your case, the correction term is only slightly above the tolerance. So, it should not cause any problems hopefully.<br>When the correction term is much larger than 1.0e-10, this warning indicates a possible error in the inputs. Likely errors are the input structure is not fully symmetrized, or the numerical digits of lattice vectors and fractional coordinates are insufficient.<br>the given KMESH_INTERPOLATE is not commensurate with the supercell size of the original FCSXML.</p>
</li>
<li><p>In the current implementation of alamode, only the former choice,<br>renormalized 2FCs + conventional (old) 3FCs,<br>is supported. Another possible choice may be<br>renormalized 2FCs + renormalized 3FCs,<br>but it is not supported within alamode yet.<br>When MODE &#x3D; RTA, the anphon code only reads the 2FCs and 3FCs from given XML files. By contrast, when MODE &#x3D; SCPH, the code additionally reads the 4FCs because they are necessary to compute the renormalized 2FCs based on the self-consistent phonon theory.<br>Therefore, the second combination of<br>renormalized 2FCs + high order FCs using SCPH<br>is not possible.</p>
</li>
<li><p>I performed the SCPH calculation. It is not converged at low temperatures (0K, 100K, 200K), while it achieved convergence at high temperatures (300~1200K).A potential solution is to use a smaller MIXALPHA and a smaller DT.</p>
</li>
<li><p>I would like to use second-order, third-order, and fourth-order force constants to obtain anharmonic potentials and calculate the potential energy as a function of atomic displacement. My goal is to generate a plot similar to the one in the paper “Orbitally driven giant phonon anharmonicity in SnSe” (Nature Phys. 2015).Please use <a target="_blank" rel="noopener" href="https://github.com/ttadano/alamode/blob/develop/tools/calcpes.py">https://github.com/ttadano/alamode/blob/develop/tools/calcpes.py</a>.</p>
</li>
<li><p>now that I have obtained the renormalized force constant file xxx.xml at a finite temperature, I now want to convert the renormalized force constant file directly to FORCE_CONSTANS</p>
</li>
<li><p>How to convert a second-order force constant matrix obtained by almode to FORCE_CONSTANTS in phonopy format？</p>
<blockquote>
<p>python convert.py alamode.xml &gt; FORCE_CONSTANTS</p>
</blockquote>
</li>
</ol>
<p>Could you give me some suggestion? How shoud I covert this with phonopy?</p>
<blockquote>
<p>FULL_FORCE_CONSTANTS &#x3D; .TRUE.<br>WRITE_FORCE_CONSTANTS &#x3D; .TRUE.<br>Note: the old FORCE_CONSTANTS will be overwrited</p>
</blockquote>
<ol start="8">
<li>How small the fitting error should be?</li>
</ol>
<p>It depends on the Taylor expansion potential and displacement magnitude you choose.<br>In the standard harmonic calculation where –mag&#x3D;0.01 is used in displace.py and the all harmonic interactions are considered (cutoff &#x3D; None), the fitting error is usually less than 5% (~1–2% in most cases).<br>In the calculation of third-order force constants with –mag&#x3D;0.04, the fitting error should be small as well. Indeed, in many cases, we obtain much smaller fitting errors (&lt; 1%) than the harmonic case.<br>In the temperature-dependent effective potential method, we try to fit the harmonic potential to the displacement-force datasets sampled by ab initio molecular dynamics at finite temperature. Therefore, the fitting error tends to be much larger (&gt; 10%).</p>
<h1 id="dynaphopy"><a href="#dynaphopy" class="headerlink" title="dynaphopy"></a>dynaphopy</h1><ol>
<li>简谐声子谱的计算。<br>dynaphopy的非谐修正是在phonopy的力常数基础上进行的，需要先进行0k声子谱的计算。<br>结构优化的INCAR，力的收敛标准是E-3，大部分的文献也是在这个精度范围内。结构优化的结构是单胞，10个原子。<br>这是phonopy计算的声子谱，计算的结构为2<em>2</em>2的超胞，80个原子，在gmma点和X点有很强的虚频。这个虚频即使提高收敛精度和扩大超胞也是无法消除的。</li>
<li>AIMD计算<br>dynaphopy通过读取AIMD的计算结构进行拟合（说法不准确），需要预先准备AIMD的outcar或xdatcar。<br>AIMD的计算设置，基本参考dynaphopy的example中的设置，详细的参数涵义，都有教程介绍。<br>这里只是采用了3000步的计算，步长是2fs，能量的收敛精度是E-6，不算太高。同样是采用80个原子的超胞。大部分做非谐计算的文献，所采用的都是在80-160原子数范围内的超胞，步长多是1-2fs，总步数大概是3000-6000，总的时长是5ps-10ps。从下面的非谐声子谱结果来看，这个设置对于非谐计算是合适的？</li>
<li>dynaphopy非谐声子谱计算。<br>dynaphopy的官网如下：Dynaphopy (abelcarreras.github.io)。<br>将结构优化的原始晶胞POSCAR，phonopy输出的力常数，和AIMD的OUTCAR放在一个文件夹内。<br>设置dynaphopy的输入文件input如下：分别是输入结构文件，力常数文件，原胞和超胞与POSCAR的关系设置，band是声子谱的高对称点路径，设置方式和vasp计算PBE能带一致。<br>然后输入dynaphopy input OUTCAR -i，进入下的界面，选择6，进入非谐声子谱计算，再选择1，可以同时输出简谐声子谱和非简谐声子谱，此时会对peak进行拟合。拟合结束后，会输出声子谱。<br>一开始使用默认设置，输出的声子谱，可以看到高温声子谱虚频加重了。从@get-it 大佬处了解到，dynaphopy默认使用最大熵方法拟合，效果可能不如fftw有效。于是小弟将拟合方式改为fftw,通过指令dynaphopy input OUTCAR -i -psm 3,采用快速傅里叶变换拟合。得到300k下的声子谱，可以看到，原来gamma点和X点的虚频，已经被成功消除了。而实验上，这个材料在室温下肯定是稳定的。</li>
</ol>
<p>当然，如果想要得到更准确的声子谱，需要提高优化精度，采用更大的超胞计算力常数，AIMD需要更多的步数和更小的步长，比如dynaphopy的例子是采用0.7 fs,跑200000步。如果只是想得到一个比较合理的声子谱，适当降低精度是没问题的。比如这个计算，在24核的机器上，结构优化用时不到3小时，dfpt计算1小时，AIMD计算14小时，差不多用时一天，能够得到一个比较合适的声子谱。如果提高精度，计算用时可能会提升数倍，但是声子谱的提升可能并不会太明显。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-49-25/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-49-25/" class="post-title-link" itemprop="url">3.3 电声耦合</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:49:25" itemprop="dateCreated datePublished" datetime="2023-05-09T18:49:25+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-06-15 15:59:43" itemprop="dateModified" datetime="2024-06-15T15:59:43+08:00">2024-06-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFT%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">DFT学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="MC-电声耦合"><a href="#MC-电声耦合" class="headerlink" title="MC-电声耦合"></a>MC-电声耦合</h1><p>需要vasp6.0之后的版本,INCAR开启</p>
<p>PHON_LMC &#x3D; .TRUE.<br>IBRION &#x3D; 6</p>
<h2 id="全MC采样"><a href="#全MC采样" class="headerlink" title="全MC采样"></a>全MC采样</h2><ul>
<li><p>标签PHON_NSTRUCT设置由于MC抽样而生成的结构的数量。应该监视观测值相对于这个数量的收敛。</p>
</li>
<li><p>标签TEBEG&#x3D;0也是需要的，用于选择运行抽样的温度。</p>
</li>
<li><p>另外，PHON_LBOSE可以设置为.TRUE.或.FALSE. (默认PHON_LBOSE&#x3D;.TRUE.)，分别选择玻色-爱因斯坦统计或麦克斯韦-玻尔兹曼统计。</p>
</li>
</ul>
<p>0K的一个INCAR文件如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">System = DEFAULT</span><br><span class="line">PREC = Accurate</span><br><span class="line">ISMEAR = 0; SIGMA = 0.1;</span><br><span class="line">IBRION = 6</span><br><span class="line"></span><br><span class="line">PHON_LMC = .TRUE.</span><br><span class="line">PHON_NSTRUCT = 100</span><br><span class="line">TEBEG = 0.0</span><br></pre></td></tr></table></figure>
<p>随后生成Wycoff positions畸变的许多POSCAR，输出为POSCAR.TEBEG.NUMBER</p>
<h2 id="ZG-configuration即时采样（one-shot）"><a href="#ZG-configuration即时采样（one-shot）" class="headerlink" title="ZG configuration即时采样（one-shot）"></a>ZG configuration即时采样（one-shot）</h2><p>这种方法仅使用单一的扭曲结构，因此比完全的MC抽样快上几个数量级，同时保持了与收敛的超晶胞尺寸的完全MC抽样非常接近的准确性。例如，我们展示了对于带隙的零点重整化，准确度在ZG配置和完全MC抽样之间在5毫电子伏特之内。因此，我们建议优先使用这种方法，当很难实现超晶胞尺寸的收敛或者5毫电子伏特的精度已经足够时。</p>
<ol>
<li>输入<br>要选择ZG配置，必须在INCAR文件中设置<code>PHON_NSTRUCT=0</code>。不同温度的数量和温度列表（以K为单位）必须使用标签<code>PHON_NTLIST</code>和<code>PHON_TLIST</code>，在INCAR文件中分别提供。一个示例如下：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PHON_NTLIST = 4</span><br><span class="line">PHON_TLIST = 0.0 100.0 200.0 350.0</span><br></pre></td></tr></table></figure></li>
</ol>
<p>给出了一个温度范围为0-700K（步长为100K）的示例INCAR文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">System = DEFAULT</span><br><span class="line">PREC = Accurate</span><br><span class="line">ISMEAR = 0; SIGMA = 0.1;</span><br><span class="line">IBRION = 6</span><br><span class="line">PHON_NTLIST = 8</span><br><span class="line">PHON_TLIST = 0.0 100.0 200.0 300.0 400.0 500.0 600.0 700.0</span><br><span class="line">PHON_NSTRUCT = 0</span><br><span class="line">PHON_LMC = .TRUE.</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>输出</li>
</ol>
<p>类似于MC抽样，ZG配置方法会产生多个具有不同扭曲Wycoff位置但不变的布里渊矩阵的POSCAR文件。这些文件被标记为</p>
<p><code>POSCAR.TEMP</code><br>其中TEMP遍历由PHON_TLIST定义的所有温度。</p>
<h2 id="one-shot例子（金刚石带隙重整化）"><a href="#one-shot例子（金刚石带隙重整化）" class="headerlink" title="one-shot例子（金刚石带隙重整化）"></a>one-shot例子（金刚石带隙重整化）</h2><h3 id="输入文件"><a href="#输入文件" class="headerlink" title="输入文件"></a>输入文件</h3><p>INCAR：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">general:</span><br><span class="line"> System = cd-C</span><br><span class="line"> PREC = Accurate</span><br><span class="line"> ALGO = FAST</span><br><span class="line"> ISMEAR = 0 </span><br><span class="line"> SIGMA = 0.1;</span><br><span class="line"> IBRION = 6         #获得动力学矩阵声子计算</span><br><span class="line"> PHON_LMC = .TRUE.  #开启电声耦合计算</span><br><span class="line"> PHON_NSTRUCT = 0   #选择one-shot方法</span><br><span class="line"> PHON_NTLIST = 1    #温度点个数</span><br><span class="line"> PHON_TLIST = 0.0   #对应温度</span><br></pre></td></tr></table></figure>
<p>准备优化后的结构，需要扩胞，以保证声子准确。KPOINTS、POTCAR根据POSCAR调整。</p>
<h3 id="计算"><a href="#计算" class="headerlink" title="计算"></a>计算</h3><p>一、获得结构</p>
<p>按照超胞结构和上面的INCAR提交任务，结束后获得OUTCAR。<br>执行： <code>cp OUTCAR OUTCAR.init</code><br>新的畸变后的结构输出为POSCAR.T&#x3D;0.</p>
<p>二、计算特定位移畸变结构的电子能级</p>
<p> <code>cp POSCAR.T=0. POSCAR</code></p>
<p>INCAR 修改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> System = cd-C</span><br><span class="line">PREC = Accurate</span><br><span class="line">ALGO = FAST</span><br><span class="line">ISMEAR = 0 </span><br><span class="line">SIGMA = 0.1  #去掉PHON_标签</span><br></pre></td></tr></table></figure>
<p>执行计算，完成后<code>cp OUTCAR OUTCAR.T=0.</code></p>
<p>三、 提取ZPR</p>
<p>具有特殊位移的带隙减去没有特殊位移的带隙，就可以得到零点带隙重整的值。带隙保存在OUTCAR文件里。</p>
<p>执行例子中的脚本：<code>bash extract_zpr.sh</code>,<br>脚本内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash </span><br><span class="line"></span><br><span class="line">i=&quot;OUTCAR.T=0.&quot;</span><br><span class="line">j=&quot;OUTCAR.init&quot;</span><br><span class="line"></span><br><span class="line">homo1=`awk &#x27;/NELECT/ &#123;print $3/2&#125;&#x27; $i`</span><br><span class="line">homo2=`awk &#x27;/NELECT/ &#123;print $3/2-1&#125;&#x27; $i`</span><br><span class="line">homo3=`awk &#x27;/NELECT/ &#123;print $3/2-2&#125;&#x27; $i`</span><br><span class="line">lumo1=`awk &#x27;/NELECT/ &#123;print $3/2+var+1&#125;&#x27; $i`</span><br><span class="line">lumo2=`awk &#x27;/NELECT/ &#123;print $3/2+var+2&#125;&#x27; $i`</span><br><span class="line">lumo3=`awk &#x27;/NELECT/ &#123;print $3/2+var+3&#125;&#x27; $i`</span><br><span class="line">lumo4=`awk &#x27;/NELECT/ &#123;print $3/2+var+4&#125;&#x27; $i`</span><br><span class="line">lumo5=`awk &#x27;/NELECT/ &#123;print $3/2+var+5&#125;&#x27; $i`</span><br><span class="line">lumo6=`awk &#x27;/NELECT/ &#123;print $3/2+var+6&#125;&#x27; $i`</span><br><span class="line">e1a=`grep &quot;   $homo1  &quot; $i | head -$nkpt | sort -n -k 2 | tail -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">e1b=`grep &quot;   $homo2  &quot; $i | head -$nkpt | sort -n -k 2 | tail -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">e1c=`grep &quot;   $homo3  &quot; $i | head -$nkpt | sort -n -k 2 | tail -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">e2a=`grep &quot;   $lumo1  &quot; $i | head -$nkpt | sort -n -k 2 | head -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">e2b=`grep &quot;   $lumo2  &quot; $i | head -$nkpt | sort -n -k 2 | head -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">e2c=`grep &quot;   $lumo3  &quot; $i | head -$nkpt | sort -n -k 2 | head -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">e2d=`grep &quot;   $lumo4  &quot; $i | head -$nkpt | sort -n -k 2 | head -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">e2e=`grep &quot;   $lumo5  &quot; $i | head -$nkpt | sort -n -k 2 | head -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">e2f=`grep &quot;   $lumo6  &quot; $i | head -$nkpt | sort -n -k 2 | head -1 | awk &#x27;&#123;print $2&#125;&#x27;`   </span><br><span class="line"> </span><br><span class="line">homo_ref=`awk &#x27;/NELECT/ &#123;print $3/2&#125;&#x27; $j`</span><br><span class="line">lumo_ref=`awk &#x27;/NELECT/ &#123;print $3/2+var+1&#125;&#x27; $j`</span><br><span class="line"></span><br><span class="line">h_ref=`grep &quot;   $homo_ref  &quot; $j | head -$nkpt | sort -n -k 2 | tail -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">l_ref=`grep &quot;   $lumo_ref  &quot; $j | head -$nkpt | sort -n -k 2 | head -1 | awk &#x27;&#123;print $2&#125;&#x27;`  </span><br><span class="line"> </span><br><span class="line">echo &quot;The band gap (in eV) without zero-point vibrations is:&quot;</span><br><span class="line">echo &quot;$h_ref $l_ref&quot; |awk &#x27;&#123;print ($2-$1)&#125;&#x27;</span><br><span class="line">echo &quot;The band gap (in eV) including zero-point vibrations is:&quot;</span><br><span class="line">echo &quot;$e1a $e1b $e1c $e2a $e2b $e2c $e2d $e2e $e2f&quot; |awk &#x27;&#123;print (($4+$5+$6+$7+$8+$9)/6.0-($1+$2+$3)/3.0)&#125;&#x27;</span><br><span class="line">echo &quot;The zero-point renormalization of the band gap (in eV) is:&quot; </span><br><span class="line">echo &quot;$e1a $e1b $e1c $e2a $e2b $e2c $e2d $e2e $e2f $h_ref $l_ref&quot; |awk &#x27;&#123;print (($4+$5+$6+$7+$8+$9)/6.0-($1+$2+$3)/3.0)-($11-$10)&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">The band gap (in eV) without zero-point vibrations is:</span><br><span class="line">4.4049</span><br><span class="line">The band gap (in eV) including zero-point vibrations is:</span><br><span class="line">4.05102</span><br><span class="line">The zero-point renormalization of the band gap (in eV) is:</span><br><span class="line">-0.353883</span><br></pre></td></tr></table></figure>
<h3 id="精度"><a href="#精度" class="headerlink" title="精度"></a>精度</h3><p>精度取决于超胞大小。超胞越大越准确。</p>
<h2 id="温度依赖的带隙计算"><a href="#温度依赖的带隙计算" class="headerlink" title="温度依赖的带隙计算"></a>温度依赖的带隙计算</h2><h3 id="输入文件-1"><a href="#输入文件-1" class="headerlink" title="输入文件"></a>输入文件</h3><p>INCAR：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> System = cd-C</span><br><span class="line"> PREC = Accurate</span><br><span class="line"> ALGO = FAST</span><br><span class="line"> ISMEAR = 0 </span><br><span class="line"> SIGMA = 0.1;</span><br><span class="line"> IBRION = 6         #获得动力学矩阵声子计算</span><br><span class="line"> PHON_LMC = .TRUE.  #开启电声耦合计算</span><br><span class="line"> PHON_NSTRUCT = 0   #选择one-shot方法</span><br><span class="line">PHON_NTLIST = 8     #温度个数</span><br><span class="line">PHON_TLIST = 0.0 100.0 200.0 300.0 400.0 500.0 600.0 700.0</span><br></pre></td></tr></table></figure>
<p>准备优化后的结构，需要扩胞，以保证声子准确。KPOINTS、POTCAR根据POSCAR调整。</p>
<h3 id="计算-1"><a href="#计算-1" class="headerlink" title="计算"></a>计算</h3><p>一、 获取特定位移的结构</p>
<p>按照超胞结构和上面的INCAR提交任务，结束后获得OUTCAR。<br>执行： <code>cp OUTCAR OUTCAR.init</code><br>新的畸变后的结构输出为POSCAR.T&#x3D;0. ~ POSCAR.T&#x3D;700.</p>
<p>二、计算特定位移畸变结构的电子能级<br> <code>cp POSCAR.T=0. POSCAR</code></p>
<p>INCAR 修改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> System = cd-C</span><br><span class="line">PREC = Accurate</span><br><span class="line">ALGO = FAST</span><br><span class="line">ISMEAR = 0 </span><br><span class="line">SIGMA = 0.1  #去掉PHON_标签</span><br></pre></td></tr></table></figure>
<p>对每个温度下的结构执行计算。可通过脚本<code>run_temperature.sh</code>批量提交。<br>脚本内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># please enter your executable path here</span><br><span class="line">vasp_exec=./vasp_gam</span><br><span class="line"></span><br><span class="line">#please enter the number of processors used for VASP here</span><br><span class="line">np=8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in 0 100 200 300 400 500 600 700</span><br><span class="line">do</span><br><span class="line">   cp POSCAR.T\=$i. POSCAR</span><br><span class="line">   mpirun -np $np $vasp_exec</span><br><span class="line">   mv OUTCAR OUTCAR.T\=$i</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>三、 分析OUTCAR</p>
<p>利用脚本<code>extract_temp.sh</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">!/bin/bash </span><br><span class="line"></span><br><span class="line">if [ -f gap_vs_temp.dat ]</span><br><span class="line">then</span><br><span class="line">   rm gap_vs_temp.dat</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">touch gap_vs_temp.dat</span><br><span class="line">counter=0</span><br><span class="line"></span><br><span class="line">for temp in 0 100 200 300 400 500 600 700</span><br><span class="line">do</span><br><span class="line">   i=&quot;OUTCAR.T=$temp&quot;</span><br><span class="line"></span><br><span class="line">   homo1=`awk &#x27;/NELECT/ &#123;print $3/2&#125;&#x27; $i`</span><br><span class="line">   homo2=`awk &#x27;/NELECT/ &#123;print $3/2-1&#125;&#x27; $i`</span><br><span class="line">   homo3=`awk &#x27;/NELECT/ &#123;print $3/2-2&#125;&#x27; $i`</span><br><span class="line">   lumo1=`awk &#x27;/NELECT/ &#123;print $3/2+var+1&#125;&#x27; $i`</span><br><span class="line">   lumo2=`awk &#x27;/NELECT/ &#123;print $3/2+var+2&#125;&#x27; $i`</span><br><span class="line">   lumo3=`awk &#x27;/NELECT/ &#123;print $3/2+var+3&#125;&#x27; $i`</span><br><span class="line">   lumo4=`awk &#x27;/NELECT/ &#123;print $3/2+var+4&#125;&#x27; $i`</span><br><span class="line">   lumo5=`awk &#x27;/NELECT/ &#123;print $3/2+var+5&#125;&#x27; $i`</span><br><span class="line">   lumo6=`awk &#x27;/NELECT/ &#123;print $3/2+var+6&#125;&#x27; $i`</span><br><span class="line">   e1a=`grep &quot;^    $homo1   &quot; $i | head -$nkpt | sort -n -k 2 | tail -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">   e1b=`grep &quot;^    $homo2   &quot; $i | head -$nkpt | sort -n -k 2 | tail -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">   e1c=`grep &quot;^    $homo3   &quot; $i | head -$nkpt | sort -n -k 2 | tail -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">   e2a=`grep &quot;^    $lumo1   &quot; $i | head -$nkpt | sort -n -k 2 | head -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">   e2b=`grep &quot;^    $lumo2   &quot; $i | head -$nkpt | sort -n -k 2 | head -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">   e2c=`grep &quot;^    $lumo3   &quot; $i | head -$nkpt | sort -n -k 2 | head -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">   e2d=`grep &quot;^    $lumo4   &quot; $i | head -$nkpt | sort -n -k 2 | head -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">   e2e=`grep &quot;^    $lumo5   &quot; $i | head -$nkpt | sort -n -k 2 | head -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">   e2f=`grep &quot;^    $lumo6   &quot; $i | head -$nkpt | sort -n -k 2 | head -1 | awk &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line"></span><br><span class="line">   if [ $temp -eq &quot;0&quot; ]</span><br><span class="line">   then</span><br><span class="line">      ref=`echo &quot;$e1a $e1b $e1c $e2a $e2b $e2c $e2d $e2e $e2f&quot; |awk &#x27;&#123;print (($4+$5+$6+$7+$8+$9)/6.0-($1+$2+$3)/3.0)&#125;&#x27;`</span><br><span class="line">   fi</span><br><span class="line"></span><br><span class="line">   echo &quot;$e1a $e1b $e1c $e2a $e2b $e2c $e2d $e2e $e2f $temp $ref&quot; |awk &#x27;&#123;print $10,(($4+$5+$6+$7+$8+$9)/6.0-($1+$2+$3)/3.0)-$11&#125;&#x27; &gt;&gt; gap_vs_temp.dat</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>运行脚本后生成gap_vs_temp.dat文件，画图即可。</p>
<p>gnuplot画图：<br><code>gnuplot -e &quot;set terminal jpeg;set xlabel &#39;T (K)&#39;; set ylabel &#39;band gap&#39;; set style data lines; plot &#39;gap_vs_temp.dat&#39;, &#39;C_exp_points_offset0.dat&#39; w circles, &#39;C_exp_fit_offset0.dat&#39;&quot; &gt; gap_vs_temp.jpg</code></p>
<h2 id="包含体积效应的温度依赖带隙"><a href="#包含体积效应的温度依赖带隙" class="headerlink" title="包含体积效应的温度依赖带隙"></a>包含体积效应的温度依赖带隙</h2><p>仅考虑温度效应会低估带隙，要考虑体积效应。</p>
<p>一、准简谐近似方法获得体积变化</p>
<p>三个脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">quasi_harm_4x4x4_diamond_create_pos_and_run_vasp.sh</span><br><span class="line">quasi_harm_4x4x4_diamond_make_energy_vs_volume_plots.sh</span><br><span class="line">quasi_harm_4x4x4_diamond_obtain_fitting.sh</span><br></pre></td></tr></table></figure>


<p>对超胞结构创建不同体积的结构进行体积-能量计算：</p>
<p>运行脚本：<code>quasi_harm_4x4x4_diamond_create_pos_and_run_vasp.sh</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/bash</span><br><span class="line"></span><br><span class="line"># please enter your executable path here</span><br><span class="line">vasp_exec=./vasp_gam</span><br><span class="line"></span><br><span class="line">#please enter the number of processors used for VASP here</span><br><span class="line">np=8</span><br><span class="line"></span><br><span class="line">cp INCAR.qh INCAR</span><br><span class="line"></span><br><span class="line">for i in 6.13521592 6.27789536 6.4205748 6.56325424 6.70593368 6.84861312 6.99129256 7.133972 7.27665144 7.41933088 7.56201032 7.70468976 7.8473692 7.99004864 8.13272808</span><br><span class="line">do</span><br><span class="line">sed &quot;s/7.13397200/$&#123;i&#125;/g&quot; POSCAR.4x4x4 &gt; POSCAR_$i</span><br><span class="line">cp POSCAR_$i POSCAR</span><br><span class="line">mpirun -np 8 $vasp_exec</span><br><span class="line"></span><br><span class="line">mv OUTCAR OUTCAR_$i</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>该脚本创建15个POSCAR，体积每步变化2%,运行脚本<code>quasi_harm_4x4x4_diamond_create_pos_and_run_vasp.sh</code>提交计算。</p>
<p>二、计算完成后运行<code>quasi_harm_4x4x4_diamond_make_energy_vs_volume_plots.sh</code>数据处理。<br>脚本内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">bandshift=0</span><br><span class="line">gwrun=-1</span><br><span class="line">dgbd=-1</span><br><span class="line">val=-1</span><br><span class="line">con=-1</span><br><span class="line">gwldadiff=-1</span><br><span class="line">test=-1</span><br><span class="line">while [[ $# -gt 0 ]]</span><br><span class="line">do</span><br><span class="line">   key=&quot;$1&quot;</span><br><span class="line">   case $key in</span><br><span class="line">   esac</span><br><span class="line">   shift</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">if [ -f &quot;helpscript.perl&quot; ]; then</span><br><span class="line">   rm helpscript.perl</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &gt; helpscript.perl  &lt;&lt;EOF</span><br><span class="line">#!/bin/perl</span><br><span class="line"></span><br><span class="line">use strict;</span><br><span class="line">use warnings;</span><br><span class="line"></span><br><span class="line">my \$zahler=0;</span><br><span class="line">my @entropy=0;</span><br><span class="line">my \$ezp=0;</span><br><span class="line">my \$fhelmholtz=0;</span><br><span class="line">my \$uenergy;</span><br><span class="line">my \$kboltzmann=8.6173303*10**(-5.0);</span><br><span class="line">my \$ntemp=8;</span><br><span class="line">my \$tmax=700;</span><br><span class="line">my \$tmin=0;</span><br><span class="line">my \$tstep=100;</span><br><span class="line">for (my \$itemp=1;\$itemp&lt;=\$ntemp;\$itemp++)</span><br><span class="line">&#123;</span><br><span class="line">   \$entropy[\$itemp]=0;</span><br><span class="line">&#125;</span><br><span class="line">while (&lt;&gt;)</span><br><span class="line">&#123;</span><br><span class="line">   chomp;</span><br><span class="line">   \$_=~s/^/ /;</span><br><span class="line">   my @help=split(/[\t,\s]+/);</span><br><span class="line">   \$zahler=\$zahler+1;</span><br><span class="line">   if (\$zahler == 1) &#123;\$uenergy=\$help[1];&#125;</span><br><span class="line">   else </span><br><span class="line">   &#123;</span><br><span class="line">      my \$homega=\$help[2]/1000;</span><br><span class="line">      \$ezp=\$ezp+\$homega*0.5;</span><br><span class="line">      for (my \$itemp=1;\$itemp&lt;=\$ntemp;\$itemp++)</span><br><span class="line">      &#123;</span><br><span class="line">         my \$temp=(\$itemp-1)*\$tstep+\$tmin;</span><br><span class="line">         my \$kbt=\$kboltzmann*\$temp;</span><br><span class="line">         if (\$temp &lt; 0.0000001) </span><br><span class="line">         &#123;</span><br><span class="line">         &#125;</span><br><span class="line">         else</span><br><span class="line">         &#123;</span><br><span class="line">              \$entropy[\$itemp]=\$entropy[\$itemp]-\$kboltzmann*log(1-exp(-\$homega/\$kbt));</span><br><span class="line">              \$entropy[\$itemp]=\$entropy[\$itemp]+\$kboltzmann*\$homega/\$kbt*(1/(exp(\$homega/\$kbt)-1));</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   last if eof;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">\$ezp=\$ezp; #/ \$zahler;</span><br><span class="line"></span><br><span class="line">for (my \$itemp=1;\$itemp&lt;=\$ntemp;\$itemp++)</span><br><span class="line">&#123;</span><br><span class="line">    my \$temp=(\$itemp-1)*\$tstep+\$tmin;</span><br><span class="line">        </span><br><span class="line">    \$entropy[\$itemp]=\$entropy[\$itemp]; # / \$zahler; </span><br><span class="line">    \$fhelmholtz=\$uenergy+\$ezp-\$temp*\$entropy[\$itemp];</span><br><span class="line">    printf (&quot;%15.8e %15.8e\n&quot;,\$temp,\$fhelmholtz);</span><br><span class="line">&#125;</span><br><span class="line">printf (&quot;#NOTEMP %15.8e\n&quot;,\$uenergy);</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">rm OUTTEMP*</span><br><span class="line">first=0</span><br><span class="line">for i in OUTCAR_*; do</span><br><span class="line"></span><br><span class="line">   echo &quot;Starting $i&quot;</span><br><span class="line">   v2=$&#123;i##OUTCAR_&#125;</span><br><span class="line">   if [ -f &quot;helpfile.help&quot; ]; then</span><br><span class="line">      rm helpfile.help</span><br><span class="line">   fi</span><br><span class="line">   touch helpfile.help</span><br><span class="line">   cp OUTCAR_$v2 OUTCAR</span><br><span class="line">   awk &#x27;/free energy/&#x27; OUTCAR | tail -n 1| awk &#x27;&#123;print $5&#125;&#x27; &gt;&gt; helpfile.help</span><br><span class="line">   awk &#x27;/[0-9]* f .* THz/ &#123;print $1,$10&#125;&#x27; OUTCAR &gt;&gt; helpfile.help</span><br><span class="line">   awk &#x27;/[0-9]* f.i.*THz/ &#123;print $1,$9&#125;&#x27; OUTCAR &gt;&gt; helpfile.help</span><br><span class="line">   volume=`awk &#x27;/volume of cell/ &#123;print $5&#125;&#x27; OUTCAR | tail -n 1`</span><br><span class="line"></span><br><span class="line">   perl helpscript.perl helpfile.help &gt; hhhhelp.txt</span><br><span class="line"></span><br><span class="line">   runcount=0</span><br><span class="line">   while read line; do</span><br><span class="line">      runcount=$((runcount+1))</span><br><span class="line">      if [[ $first -eq 0 ]]; then</span><br><span class="line">         echo $line | awk -v var=&quot;$volume&quot; &#x27;&#123;print var,$2,$1&#125;&#x27; &gt; OUTTEMP_$runcount</span><br><span class="line">      else</span><br><span class="line">         echo $line | awk -v var=&quot;$volume&quot; &#x27;&#123;print var,$2&#125;&#x27; &gt;&gt; OUTTEMP_$runcount</span><br><span class="line">      fi</span><br><span class="line">   done &lt; ./hhhhelp.txt</span><br><span class="line"></span><br><span class="line">   first=1</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">for i in OUTTEMP_*; do</span><br><span class="line">   v2=$&#123;i##OUTTEMP_&#125;</span><br><span class="line">   mv OUTTEMP_$v2 OUTHELP</span><br><span class="line">   sort -n -k 1 OUTHELP &gt; OUTTEMP_$v2</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">rm helpfile.help</span><br><span class="line">rm helpscript.perl</span><br><span class="line">rm hhhhelp.txt</span><br><span class="line">rm OUTHELP</span><br></pre></td></tr></table></figure>
<p>自由能曲线保存在OUTTEMP_*.</p>
<p>运行脚本<code>quasi_harm_4x4x4_diamond_obtain_fitting.sh</code>获得温度-体积关系。<br>脚本内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">for i in OUTTEMP_*</span><br><span class="line">do</span><br><span class="line">   cp $i OUTTEMP.current</span><br><span class="line">   #extract temperature</span><br><span class="line">   temp=`head -n 1 OUTTEMP.current|awk &#x27;&#123;print $3&#125;&#x27;`</span><br><span class="line">   #do fitting</span><br><span class="line">   gnuplot -e &quot;E(V)=E0+9.0/8.0*B0*V0*((V0/V)**(2.0/3.0)-1)**2 + 9.0/16.0*B0*\</span><br><span class="line">      (B0P-4)*V0*((V0/V)**(2.0/3.0)-1.0)**3.0 + R*((V0/V)**(2.0/3.0)-1.0)**4.0;\</span><br><span class="line">      B0P = 1;B0 = 1;V0 = 720;E0 = -1150;R  = -1.0;fit E(x) &#x27;OUTTEMP.current&#x27;  u 1:2 via B0P,B0,V0,E0,R&quot; &amp;&gt; suppress_output</span><br><span class="line">   #extract volume from fit</span><br><span class="line">   a=`grep &quot;V0&quot; fit.log|grep &quot;=&quot; |tail -n 1|awk &#x27;&#123;print ($3/2.0)**(1.0/3.0)&#125;&#x27;`</span><br><span class="line">   #print temperature and volume to </span><br><span class="line">   echo &quot;temperature: $temp, a_latt: $a&quot; </span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">rm suppress_output</span><br><span class="line">rm OUTTEMP.current</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">temperature: 0.00000000e+00, a_latt: 7.18012</span><br><span class="line">temperature: 1.00000000e+02, a_latt: 7.18014</span><br><span class="line">temperature: 2.00000000e+02, a_latt: 7.18064</span><br><span class="line">temperature: 3.00000000e+02, a_latt: 7.18267</span><br><span class="line">temperature: 4.00000000e+02, a_latt: 7.18613</span><br><span class="line">temperature: 5.00000000e+02, a_latt: 7.19037</span><br><span class="line">temperature: 6.00000000e+02, a_latt: 7.19493</span><br><span class="line">temperature: 7.00000000e+02, a_latt: 7.19959</span><br><span class="line">temperature: #NOTEMP, a_latt: 7.15218</span><br></pre></td></tr></table></figure>
<p>三、 最后将QHA获得的晶胞参数，替换掉POSCAR.T&#x3D;* files中的晶胞参数。再次运行<code>run_temperature.sh</code> 和<code>extract_temp.sh.</code>获得数据画图。</p>
<ul>
<li><p>通过添加体积效应，与实验获得了更好的一致性。在这个教程中，我们只使用了一个4x4x4的单元格，因为更大的单元格已经相当耗时，但对于收敛的5x5x5单元格，两条曲线都应该与实验相比略有变差。由于在本例中使用的PBE无法充分描述电子交换和相关性，因此预计实验与理论之间会有差异。为了获得真正的优异一致性，<strong>需要使用GW近似方法</strong>。</p>
</li>
<li><p>严格来说，将体积效应添加到电子-声子相互作用的正确方法是<strong>首先为每个温度更改体积，然后为该温度计算电子-声子相互作用</strong>。在这个教程和参考文献[5]中，我们是反过来做的。因此，电子-声子相互作用只需要计算一次。在参考文献[5]中，我们观察到这两种方法给出了非常相似的结果。</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-49-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-49-24/" class="post-title-link" itemprop="url">3.2 热输运2</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:49:24" itemprop="dateCreated datePublished" datetime="2023-05-09T18:49:24+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-10-18 10:46:56" itemprop="dateModified" datetime="2024-10-18T10:46:56+08:00">2024-10-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFT%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">DFT学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="三阶力常数矩阵"><a href="#三阶力常数矩阵" class="headerlink" title="三阶力常数矩阵"></a>三阶力常数矩阵</h1><p>需要用到thirdorder程序。</p>
<h3 id="使用方法："><a href="#使用方法：" class="headerlink" title="使用方法："></a>使用方法：</h3><ol>
<li>准备好POSCAR,INCAR,KPOINTS,POTCAR和提交任务脚本（以sub.sh为例）；<br>其中POSCAR与二阶力常数矩阵求解时的POSCAR-unit一致，KPOINTS也与二阶一致。INCAR文件与二阶力常数求解时的有限位移法一致，其他不变。完成后运行thirdorder实现扩胞。</li>
</ol>
<p><code>~/安装目录/thirdorder_vasp.py sow 2 2 2 -12</code><br>2 2 2是扩胞倍数，要和二阶力常数矩阵保持一致或者略小。-12指的是考虑多少个近邻原子，需要测试，但是如果计算资源紧缺的时候取个-10就行了，但有风险；正值是指截断半径。之后生成成功以后会出现一堆3RD开头的文件，那些都是POSCAR，一般有几百上千个。</p>
<ol start="2">
<li>参考phonopy计算声子谱的有限位移法，需要把这些POSCAR单独计算。也就是有多少POSCAR，建立多少文件夹，分别进行多少次计算。</li>
<li><code>find job* -name vasprun.xml|sort -n|/ thirdorder_vasp.py reap a b c -d</code>  a b c和-d与前面一致。该命令可获得FORCE_CONSTANT_3RD也即是三阶力常数矩阵。</li>
</ol>
<h3 id="脚本方法"><a href="#脚本方法" class="headerlink" title="脚本方法"></a>脚本方法</h3><ul>
<li><p>测试-d参数（秦光照老师） </p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>bash</span><br><span class="line">#</span><br><span class="line"># <span class="title class_">Construct</span> the 3nd files based on the finished calculations</span><br><span class="line">#</span><br><span class="line"># <span class="title class_">Written</span> <span class="variable constant_">BY</span> <span class="variable constant_">QIN</span>, <span class="title class_">GuangZhao</span> &lt;qin.<span class="property">phys</span>@gmail.<span class="property">com</span>&gt;</span><br><span class="line"># <span class="number">2016</span>-<span class="number">11</span>-<span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="variable constant_">DIR</span>=<span class="string">&quot;/vol-th/home/xhaiyan/WangN/Au6S2/third241-14&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ ! -d <span class="string">&quot;$DIR&quot;</span> ];then</span><br><span class="line">    echo <span class="title class_">Please</span> specify the source directory.</span><br><span class="line">    exit</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="variable constant_">NAME</span> <span class="keyword">in</span> 3RD.<span class="property">POSCAR</span>.*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="variable constant_">NUM</span>=<span class="string">&quot;$&#123;NAME#3RD.POSCAR.&#125;&quot;</span>   # the number <span class="keyword">of</span> the 3nd <span class="variable constant_">POSCAR</span> file</span><br><span class="line">    <span class="variable constant_">CODE</span>=$(head -<span class="number">1</span> $NAME)       # the code <span class="keyword">of</span> the <span class="variable constant_">POSCAR</span> file</span><br><span class="line"># find the source <span class="variable constant_">POSCAR</span> file <span class="keyword">in</span> the source directory</span><br><span class="line">    <span class="variable constant_">INFO</span>=$(grep $CODE $DIR/3RD.<span class="property">POSCAR</span>.* | head -<span class="number">1</span>)</span><br><span class="line">    [ x<span class="string">&quot;$INFO&quot;</span> == x ] &amp;&amp; echo <span class="string">&quot;NOT FOUND for job-$NUM&quot;</span> &amp;&amp; <span class="keyword">continue</span></span><br><span class="line">    <span class="variable constant_">SOURCE_NUM</span>=<span class="string">&quot;$&#123;INFO%:*&#125;&quot;</span>     # the number <span class="keyword">of</span> the source <span class="variable constant_">POSCAR</span> file</span><br><span class="line">    <span class="variable constant_">SOURCE_NUM</span>=<span class="string">&quot;$&#123;SOURCE_NUM##*.&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    echo <span class="string">&quot;$DIR/job-$SOURCE_NUM/ --&gt; job-$NUM/&quot;</span></span><br><span class="line">#    diff 3RD.<span class="property">POSCAR</span>.<span class="property">$NUM</span> $DIR/3RD.<span class="property">POSCAR</span>.<span class="property">$SOURCE_NUM</span></span><br><span class="line">    rsync -a $DIR/job-$SOURCE_NUM/vasprun.<span class="property">xml</span> ./job-$NUM/</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
</li>
<li><p>针对大量POSCAR批量建立文件夹</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#<span class="variable language_">module</span> load spglib/master</span><br><span class="line">#thirdorder_vasp.<span class="property">py</span> sow <span class="number">3</span> <span class="number">3</span> <span class="number">1</span> -<span class="number">10</span></span><br><span class="line">#生成<span class="number">2</span>*<span class="number">2</span>*<span class="number">2</span>的超胞 <span class="number">0.6</span>表示截断半径为<span class="number">6</span>埃。</span><br><span class="line">#sow a b c m  abc表示生成的超胞大小，m为正数的时候表示截断半径（单位：nm）（例如<span class="number">0.6</span>，表示截断半径为<span class="number">6.0</span>埃）；为负数时表示第几近邻截断（此时应取负整数，例如-<span class="number">3</span>表示第三近邻）</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> 3RD.<span class="property">POSCAR</span>.*</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">s=$(echo $i| cut -d <span class="string">&quot;.&quot;</span> -f <span class="number">3</span>)</span><br><span class="line">d=job-$s</span><br><span class="line">mkdir $d</span><br><span class="line">cp $i $d/<span class="variable constant_">POSCAR</span></span><br><span class="line">cp ./<span class="variable constant_">INCAR</span> ./sub.<span class="property">sh</span> ./<span class="variable constant_">KPOINTS</span> ./<span class="variable constant_">POTCAR</span> $d</span><br><span class="line">pushd $d</span><br><span class="line">popd</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
</li>
<li><p>批量提交任务</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>sh</span><br><span class="line">root_path=<span class="string">&#x27;pwd&#x27;</span></span><br><span class="line"></span><br><span class="line">#在每个job文件夹里进行静态计算。</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">001</span>.<span class="number">.1050</span>&#125; #按顺序从job-<span class="number">001</span>到<span class="number">1050</span>做静态vasp计算,根据生成的文件夹设定</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">cd job-$i</span><br><span class="line">echo <span class="string">&quot;job-$i&quot;</span>, time </span><br><span class="line">sbatch sub.<span class="property">sh</span></span><br><span class="line">wait</span><br><span class="line">cd ..</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">#上述静态计算完成后提取三阶力常数文件</span><br><span class="line">#cd $&#123;root_path&#125;</span><br><span class="line"></span><br><span class="line">#find job* -name vasprun.<span class="property">xml</span>| sort -n| python thirdorder_vasp.<span class="property">py</span> reap <span class="number">2</span>  <span class="number">2</span>  <span class="number">1</span> -<span class="number">12</span> #最后四个数字跟你扩胞时一致</span><br></pre></td></tr></table></figure></li>
</ul>
<p>脚本赋予权限：chmod +x .sh;运行脚本：.&#x2F;sh</p>
<h1 id="ShengBTE获得热输运性质"><a href="#ShengBTE获得热输运性质" class="headerlink" title="ShengBTE获得热输运性质"></a>ShengBTE获得热输运性质</h1><h3 id="运行ShengBTE计算热输运性质"><a href="#运行ShengBTE计算热输运性质" class="headerlink" title="运行ShengBTE计算热输运性质"></a>运行ShengBTE计算热输运性质</h3><ul>
<li>获得二阶力常数计算：<br>计算流程与声子谱计算流程相同，用DFPT和有限位移法都可以。将得到的FORCE_CONSTANTS重命名为FORCE_CONSTANTS_2ND。</li>
<li>获得三阶力常数计算：见上，输出为FORCE_CONSTANTS_3RD文件。</li>
<li>准备CONTROL文件：格式如下:<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#<span class="variable constant_">CONTROL</span> <span class="keyword">for</span> <span class="title class_">ShengBTE</span></span><br><span class="line">&amp;allocations</span><br><span class="line">        nelements=<span class="number">2</span>              #元素种类</span><br><span class="line">        natoms=<span class="number">6</span>                 #原子个数</span><br><span class="line">        <span class="title function_">ngrid</span>(:)=<span class="number">20</span> <span class="number">20</span> <span class="number">5</span>         #计算网格密度</span><br><span class="line">&amp;end</span><br><span class="line">&amp;crystal</span><br><span class="line">        lfactor=<span class="number">0.1</span>              #软件长度单位换算</span><br><span class="line">        <span class="title function_">lattvec</span>(:,<span class="number">1</span>)=<span class="number">3.1613337552503711</span>    <span class="number">0.0000000000000025</span>    <span class="number">0.0000000000000000</span> #原胞晶胞参数</span><br><span class="line">        <span class="title function_">lattvec</span>(:,<span class="number">2</span>)=-<span class="number">1.5806668776251651</span>    <span class="number">2.7377953418477841</span>    <span class="number">0.0000000000000000</span></span><br><span class="line">        <span class="title function_">lattvec</span>(:,<span class="number">3</span>)=-<span class="number">0.0000000000000000</span>    <span class="number">0.0000000000000000</span>   <span class="number">12.3318234981499426</span></span><br><span class="line">        elements= <span class="string">&quot;Mo&quot;</span> <span class="string">&quot;S&quot;</span>  #原子顺序</span><br><span class="line">        types= <span class="number">1</span> <span class="number">1</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span>  #原子个数，<span class="number">2</span>代表第二种元素，<span class="number">4</span>个<span class="number">2</span>代表有<span class="number">4</span>个第二类原子</span><br><span class="line">       <span class="title function_">positions</span>(:,<span class="number">1</span>)= <span class="number">0.3333333449999998</span>  <span class="number">0.6666666890000030</span>  <span class="number">0.2500000000000000</span> #原子坐标，按顺序</span><br><span class="line">       <span class="title function_">positions</span>(:,<span class="number">2</span>)=<span class="number">0.6666666240000012</span>  <span class="number">0.3333333229999980</span>  <span class="number">0.7500000189999980</span></span><br><span class="line">       <span class="title function_">positions</span>(:,<span class="number">3</span>)= <span class="number">0.3333333449999998</span>  <span class="number">0.6666666890000030</span>  <span class="number">0.6230719397502427</span></span><br><span class="line">       <span class="title function_">positions</span>(:,<span class="number">4</span>)=<span class="number">0.6666666240000012</span>  <span class="number">0.3333333229999980</span>  <span class="number">0.3769280602499874</span></span><br><span class="line">       <span class="title function_">positions</span>(:,<span class="number">5</span>)=<span class="number">0.6666666240000012</span>  <span class="number">0.3333333229999980</span>  <span class="number">0.1230720067501656</span></span><br><span class="line">       <span class="title function_">positions</span>(:,<span class="number">6</span>)=<span class="number">0.3333333449999998</span>  <span class="number">0.6666666890000030</span>  <span class="number">0.8769280222497613</span></span><br><span class="line">       <span class="title function_">scell</span>(:)=<span class="number">4</span> <span class="number">4</span> <span class="number">1</span> #扩胞倍数，和前面一致</span><br><span class="line">&amp;end</span><br><span class="line">&amp;parameters</span><br><span class="line">       T=<span class="number">300</span>  #温度</span><br><span class="line">&amp;end</span><br><span class="line">&amp;flags</span><br><span class="line">      nonanalytic=.<span class="property">TRUE</span>.</span><br><span class="line">      nanowires=.<span class="property">FALSE</span>.</span><br><span class="line">      convergence=.<span class="property">TRUE</span>.  #迭代法，默认最大<span class="number">1000</span>步</span><br><span class="line">&amp;end</span><br></pre></td></tr></table></figure></li>
</ul>
<p>详细参数可参考手册。</p>
<ul>
<li>提交任务</li>
<li>获得不同温度的数据，只需要依次修改CONTROL文件的T tag。或者通过脚本：</li>
</ul>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">350.</span><span class="number">.1350</span>.<span class="number">.100</span>&#125; # 对i赋值，区间为<span class="number">300</span>到<span class="number">900</span>，每搁<span class="number">10</span>取一个数，即（<span class="number">300</span> <span class="number">310</span> <span class="number">320</span> <span class="number">330</span> ...<span class="number">.890</span> <span class="number">900</span>），可以根据自身情况自行设置</span><br><span class="line"><span class="keyword">do</span>  #开始循环</span><br><span class="line">mkdir $i #建立单一任务文件夹</span><br><span class="line">cp sub.<span class="property">sh</span> <span class="variable constant_">CONTROL</span> <span class="variable constant_">FORCE_CONSTANTS_2ND</span> <span class="variable constant_">FORCE_CONSTANTS_3RD</span> $i  </span><br><span class="line">#将二阶三阶力学常数文件和<span class="variable constant_">CONTROL</span>文件复制到单一任务文件夹</span><br><span class="line">#注意，这里的<span class="variable constant_">CONTROL</span>文件夹是删减过的</span><br><span class="line">cd $i #进入单一文件夹内</span><br><span class="line">echo \&amp;parameters &gt;&gt; <span class="variable constant_">CONTROL</span>      #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line">  echo  T= $i  &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件 </span><br><span class="line">  #温度设置 如果同时设置多个温度，同一行只会算第一个并报错。如果多次设定一个温度到同一个<span class="variable constant_">CONTROL</span>文件，只会运算最后一个。</span><br><span class="line">#echo   scalebroad=<span class="number">0.1</span>    &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line">echo \&amp;end    &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line">echo \&amp;flags  &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line">echo    nonanalytic=.<span class="property">TRUE</span>.   &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line">echo    nanowires=.<span class="property">FALSE</span>.   &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line">echo    convergence=.<span class="property">True</span>. &gt;&gt; <span class="variable constant_">CONTROL</span></span><br><span class="line">echo \&amp;end  &gt;&gt; <span class="variable constant_">CONTROL</span>    #补充<span class="variable constant_">CONTROL</span>文件</span><br><span class="line"> #这里补充<span class="variable constant_">CONTROL</span>文件用的是笨方法，如果有相应改进方法可以自行更改，简洁代码</span><br><span class="line">sbatch sub.<span class="property">sh</span>  #执行<span class="title class_">ShengBTE</span>计算，这里的执行命令应视情况而定。</span><br><span class="line">cd .. #返回初始目录</span><br><span class="line">done  #结束任务</span><br></pre></td></tr></table></figure>


<h2 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h2><ul>
<li>计算完成后，先检查收敛情况，找到T300K文件夹下的BTE.kappa,第一列代表迭代步数，一般未达到默认1000步可认为收敛正常。</li>
<li>计算完成后在当前目录下会生成T300K文件夹和一些输出文件。文件处理参见天玑算b站视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Yh411n7tx/?spm_id_from=333.788&vd_source=17084cc867ff3bb86398ff1a79b443f2">https://www.bilibili.com/video/BV1Yh411n7tx/?spm_id_from=333.788&amp;vd_source=17084cc867ff3bb86398ff1a79b443f2</a></li>
</ul>
<p>其他参考：<a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv22090733/">https://www.bilibili.com/read/cv22090733/</a></p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li><p>计算得到的热导率和文献报道有较大偏差，可能偏大或者偏小，可能的原因有：</p>
<p>1.采用的2阶力常数FORCE_CONSTANT中超胞内原子排序不是按照ucatom<em>sc_z</em>sc_y*sc_x排列；力常数文件与control文件中原胞内原子次序是否一致；</p>
<p>2.shengBTE的control文件中晶格参数单位默认nm，有转换系数的参数；</p>
<p>3.使用QE利用phonopy计算得到的FORCE_CONSTANT文件中，单位需要转换，不能直接利用shengBTE计算，vasp利用phonopy则单位正确；</p>
<ol start="4">
<li><p>3阶力常数的计算量较大，但精度要求很高，如0.0003Rh&#x2F;bohr^2量级的力的误差，也会导致最终热导率的数值出现大的偏离；如使用cp2k计算力常数，通常使用QE等平面波软件，对于超胞体系，随着扩胞，在较大的截断半径下，所需计算量非常大，使用CP2K中的QS模块也能进行第一性原理计算，具有相对较高的计算效率，但是CP2K不同于平面波的QE等，计算中仅有gamma点计算，需要采用实空间较大超胞，如果使用和QE等相同的超胞，则会导致原子受力精度不高，一般在~0.0003Rh&#x2F;bohr^2量级的误差，也会对某些体系，特别是二维体系的热导率有很大的影响。在使用cp2k进行3阶力常数大量计算之前，先进行超胞收敛测试，可以在相同的位移构型下，不断扩胞，判断力计算的变化情况和误差。用QE等计算也建议先进行k点等计算参数的收敛判断，否则会浪费大量时间，热导率计算结果却有很大偏离。</p>
</li>
<li><p>使用经验势能模型，在通过lammps进行热输运计算之前，可以先利用分子静力学软件GULP结合shengBTE模块，预判势能应用于热输运计算的准确性。但经验势能用于热输运精度和前景一般，机器势能表现更好。</p>
</li>
</ol>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/odin_linux/article/details/130084321">https://blog.csdn.net/odin_linux/article/details/130084321</a></p>
</li>
<li><p>静态计算可以各个job文件夹同时分别计算，不用按顺序来。等所有job文件夹计算完后，自行运行“find job…” 提取三阶力常数的命令。严格来说，胞的大小和三阶力常数计算的截断半径都应该进行测试，测试以所计算得到的热导率的收敛进行判断。计算资源有限无法测试的话，尽可能取大一点。Born有效电荷和介电常数的计算应该不是必要的，如果你要考虑在Gamma点附近LO-TO劈裂的话(主要针对离子晶体)，则需要进行计算。可以加上，感觉要好点。<br>二阶力常数和三阶力常数所用的超胞大小可以不统一，我看文献中有这种情形，不过一般作者采用的二阶力常数的超胞都是大于等于三阶力常数超胞的大小。<br>原文链接：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/147810223">https://zhuanlan.zhihu.com/p/147810223</a></p>
</li>
<li><p>官方网站：<a target="_blank" rel="noopener" href="https://www.shengbte.org/">https://www.shengbte.org/</a></p>
</li>
</ul>
<h1 id="四声子过程"><a href="#四声子过程" class="headerlink" title="四声子过程"></a>四声子过程</h1><p>除了ShengBTE的CONTROL文件中的常规输入，FourPhonon还需要四阶力常数和一些新的标签在CONTROL文件中。请检查ShengBTE网站以获取其他标签的定义。  </p>
<h2 id="并行环境"><a href="#并行环境" class="headerlink" title="并行环境"></a>并行环境</h2><p>1.1和1.0版本是为MPI并行性编写的。从1.2版本开始，支持四声子散射的迭代求解器，我们已经迁移到OpenMP，以处理该迭代求解器所需的大内存。未来我们可能会支持MPI+OpenMP混合并行性，以允许更多灵活性。确保在编译时添加-qopenmp，或者：  </p>
<p>export FFLAGS&#x3D;-qopenmp -traceback -debug -O2 -static_intel  </p>
<h2 id="四阶IFCs文件：FORCE-CONSTANTS-4TH"><a href="#四阶IFCs文件：FORCE-CONSTANTS-4TH" class="headerlink" title="四阶IFCs文件：FORCE_CONSTANTS_4TH"></a>四阶IFCs文件：FORCE_CONSTANTS_4TH</h2><p>该文件包含四阶原子间力常数矩阵，并使用稀疏描述来节省空间。要构建四阶力常数，可以参考Fourthorder的python脚本。该力常数的格式是对三阶力常数的直接扩展，包含nb个这样的矩阵块：  </p>
<ul>
<li>一行空白  </li>
<li>一个从1开始的顺序索引（从1到nb）  </li>
<li>一行表示第二个晶胞的笛卡尔坐标（单位：Å）  </li>
<li>一行表示第三个晶胞的笛卡尔坐标（单位：Å）  </li>
<li>一行表示第四个晶胞的笛卡尔坐标（单位：Å）  </li>
<li>一行表示四个相关原子的从1开始的索引，每个原子索引从1到natoms  </li>
<li>81行的力常数矩阵（单位：eV Å⁴）。开头的索引用于标记笛卡尔坐标轴。<br>该文件的一个示例：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1</span><br><span class="line">0.0000000000e+00 0.0000000000e+00 0.0000000000e+00</span><br><span class="line">0.0000000000e+00 0.0000000000e+00 0.0000000000e+00</span><br><span class="line">0.0000000000e+00 0.0000000000e+00 0.0000000000e+00</span><br><span class="line">     1      1      1      1</span><br><span class="line"> 1  1  1  1       -42.0002584218</span><br><span class="line"> 1  1  1  2         0.0000000000</span><br><span class="line"> 1  1  1  3         0.0000000000</span><br><span class="line"> 1  1  2  1         0.0000000000</span><br><span class="line"> 1  1  2  2        40.3875689003</span><br><span class="line"> 1  1  2  3         0.0000000000</span><br><span class="line"> 1  1  3  1         0.0000000000</span><br><span class="line"> 1  1  3  2         0.0000000000</span><br><span class="line"> 1  1  3  3        40.3875689003</span><br><span class="line"> 1  2  1  1         0.0000000000</span><br><span class="line"> 1  2  1  2        40.3875689003</span><br><span class="line"> 1  2  1  3         0.0000000000</span><br><span class="line"> 1  2  2  1        40.3875689003</span><br><span class="line"> 1  2  2  2         0.0000000000</span><br><span class="line"> 1  2  2  3         0.0000000000</span><br><span class="line"> 1  2  3  1         0.0000000000</span><br><span class="line"> 1  2  3  2         0.0000000000</span><br><span class="line"> 1  2  3  3         0.0000000000</span><br><span class="line"> 1  3  1  1         0.0000000000</span><br><span class="line"> 1  3  1  2         0.0000000000</span><br><span class="line"> 1  3  1  3        40.3875689003</span><br><span class="line"> 1  3  2  1         0.0000000000</span><br><span class="line"> 1  3  2  2         0.0000000000</span><br><span class="line"> 1  3  2  3         0.0000000000</span><br><span class="line"> 1  3  3  1        40.3875689003</span><br><span class="line"> 1  3  3  2         0.0000000000</span><br><span class="line"> 1  3  3  3         0.0000000000</span><br><span class="line"> 2  1  1  1         0.0000000000</span><br><span class="line"> 2  1  1  2        40.3875689003</span><br><span class="line"> 2  1  1  3         0.0000000000</span><br><span class="line"> 2  1  2  1        40.3875689003</span><br><span class="line"> 2  1  2  2         0.0000000000</span><br><span class="line"> 2  1  2  3         0.0000000000</span><br><span class="line"> 2  1  3  1         0.0000000000</span><br><span class="line"> 2  1  3  2         0.0000000000</span><br><span class="line"> 2  1  3  3         0.0000000000</span><br><span class="line"> 2  2  1  1        40.3875689003</span><br><span class="line"> 2  2  1  2         0.0000000000</span><br><span class="line"> 2  2  1  3         0.0000000000</span><br><span class="line"> 2  2  2  1         0.0000000000</span><br><span class="line"> 2  2  2  2       -42.0002584218</span><br><span class="line"> 2  2  2  3         0.0000000000</span><br><span class="line"> 2  2  3  1         0.0000000000</span><br><span class="line"> 2  2  3  2         0.0000000000</span><br><span class="line"> 2  2  3  3        40.3875689003</span><br><span class="line"> 2  3  1  1         0.0000000000</span><br><span class="line"> 2  3  1  2         0.0000000000</span><br><span class="line"> 2  3  1  3         0.0000000000</span><br><span class="line"> 2  3  2  1         0.0000000000</span><br><span class="line"> 2  3  2  2         0.0000000000</span><br><span class="line"> 2  3  2  3        40.3875689003</span><br><span class="line"> 2  3  3  1         0.0000000000</span><br><span class="line"> 2  3  3  2        40.3875689003</span><br><span class="line"> 2  3  3  3         0.0000000000</span><br><span class="line"> 3  1  1  1         0.0000000000</span><br><span class="line"> 3  1  1  2         0.0000000000</span><br><span class="line"> 3  1  1  3        40.3875689003</span><br><span class="line"> 3  1  2  1         0.0000000000</span><br><span class="line"> 3  1  2  2         0.0000000000</span><br><span class="line"> 3  1  2  3         0.0000000000</span><br><span class="line"> 3  1  3  1        40.3875689003</span><br><span class="line"> 3  1  3  2         0.0000000000</span><br><span class="line"> 3  1  3  3         0.0000000000</span><br><span class="line"> 3  2  1  1         0.0000000000</span><br><span class="line"> 3  2  1  2         0.0000000000</span><br><span class="line"> 3  2  1  3         0.0000000000</span><br><span class="line"> 3  2  2  1         0.0000000000</span><br><span class="line"> 3  2  2  2         0.0000000000</span><br><span class="line"> 3  2  2  3        40.3875689003</span><br><span class="line"> 3  2  3  1         0.0000000000</span><br><span class="line"> 3  2  3  2        40.3875689003</span><br><span class="line"> 3  2  3  3         0.0000000000</span><br><span class="line"> 3  3  1  1        40.3875689003</span><br><span class="line"> 3  3  1  2         0.0000000000</span><br><span class="line"> 3  3  1  3         0.0000000000</span><br><span class="line"> 3  3  2  1         0.0000000000</span><br><span class="line"> 3  3  2  2        40.3875689003</span><br><span class="line"> 3  3  2  3         0.0000000000</span><br><span class="line"> 3  3  3  1         0.0000000000</span><br><span class="line"> 3  3  3  2         0.0000000000</span><br><span class="line"> 3  3  3  3       -42.0002584218</span><br></pre></td></tr></table></figure>
<h2 id="CONTROL-文件设置"><a href="#CONTROL-文件设置" class="headerlink" title="CONTROL 文件设置"></a>CONTROL 文件设置</h2><p>此 CONTROL 文件包含所有用户指定的设置和参数，包括晶体结构信息、展宽因子、q 网格、温度、函数等。</p>
<h3 id="一般用法"><a href="#一般用法" class="headerlink" title="一般用法"></a>一般用法</h3><p>要启用 FourPhonon 功能，您需要添加一个新的 &amp;flags 名称列表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">four_phonon （逻辑，默认为 .false.）：计算四声子相空间和四声子散射率。</span><br><span class="line">four_phonon_iteration （逻辑，默认为 .false.）：精确计算四声子散射并求解玻尔兹曼输运方程（BTE）。这仅在 four_phonon=.true. 时有效。</span><br></pre></td></tr></table></figure>
<p>标志的实际用法<br>以下是这些标志的一些实用组合：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">onlyharmonic=.true. 和 four_phonon=.true.：仅计算四声子相空间。</span><br><span class="line">convergence=.false. 和 four_phonon=.true.：在 RTA 层面计算三声子和四声子散射的热导率；此设置将输出不同四声子通道的贡献。</span><br><span class="line">four_phonon=.true. （收敛默认值为 .true.）：使用三声子迭代方案计算热导率，但将四声子散射处理为 RTA 层面。</span><br><span class="line">four_phonon=.true. 和 four_phonon_iteration=.true.：利用 BTE 的精确解计算三声子和四声子散射的热导率。</span><br></pre></td></tr></table></figure>
<p>注意： CONTROL 文件中的所有其他参数，例如温度或 q 网格，适用于三声子和四声子过程。FourPhonon 包不支持纳米线功能。</p>
<h3 id="加速-RTA-解的采样方法"><a href="#加速-RTA-解的采样方法" class="headerlink" title="加速 RTA 解的采样方法"></a>加速 RTA 解的采样方法</h3><p>为了从散射过程样本中估计散射率，请引用 [Z. Guo 等人，npj Comput. Mater. 10, 31 (2024).] 并使用相关标签。</p>
<h4 id="参数设置"><a href="#参数设置" class="headerlink" title="参数设置"></a>参数设置</h4><h4 id="num-sample-process-3ph-和-num-sample-process-3ph-phase-space"><a href="#num-sample-process-3ph-和-num-sample-process-3ph-phase-space" class="headerlink" title="num_sample_process_3ph 和 num_sample_process_3ph_phase_space"></a>num_sample_process_3ph 和 num_sample_process_3ph_phase_space</h4><p><code>num_sample_process_3ph</code> 和 <code>num_sample_process_3ph_phase_space</code> （整数，默认值为 -1）：表示从每个模式中提取的样本数，以用于估计三声子相空间和散射率。 -1 表示不进行取样，执行严格计算。注意，当 <code>convergence=.true.</code>，即使用迭代方案计算三声子散射时，<code>num_sample_process_3ph</code> 必须为 -1，因为取样方法基于弛豫时间近似。</p>
<h4 id="num-sample-process-4ph-和-num-sample-process-4ph-phase-space"><a href="#num-sample-process-4ph-和-num-sample-process-4ph-phase-space" class="headerlink" title="num_sample_process_4ph 和 num_sample_process_4ph_phase_space"></a>num_sample_process_4ph 和 num_sample_process_4ph_phase_space</h4><p><code>num_sample_process_4ph</code> 和 <code>num_sample_process_4ph_phase_space</code> （整数，默认值为 -1）：表示从每个模式中提取的样本数，以用于估计四声子相空间和散射率。 -1 表示不进行取样，执行严格计算。注意，当 <code>four_phonon=.false.</code> 时，<code>num_sample_process_4ph</code> 和 <code>num_sample_process_4ph_phase_space</code> 必须均为 -1。</p>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>计算三声子散射率（精确计算，迭代），并在 RTA 层面采用 100,000 个样本过程计算四声子散射：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&amp;parameters</span><br><span class="line">    T=300</span><br><span class="line">    scalebroad=1</span><br><span class="line">    num_sample_process_3ph_phase_space = -1</span><br><span class="line">    num_sample_process_3ph = -1</span><br><span class="line">    num_sample_process_4ph_phase_space = 100000</span><br><span class="line">    num_sample_process_4ph = 100000         </span><br><span class="line">&amp;end</span><br></pre></td></tr></table></figure>

<h2 id="TDEP-IFCs-的输入"><a href="#TDEP-IFCs-的输入" class="headerlink" title="TDEP IFCs 的输入"></a>TDEP IFCs 的输入</h2><p>对于 TDEP 格式的谐波力常数，请使用以下描述的标签&#x2F;脚本：</p>
<p><code>tdep=.true.</code> 启用 TDEP 格式谐波 IFCs 的处理，该输入文件名应始终为 <code>infile.forceconstant</code>。如果系统是极性材料，除了常规参数（如 Born 有效电荷和介电常数）外，我们还需要用户手动输入耦合参数 (\lambda_{Ewald})，该参数在 TDEP IFCs 的末尾近似写出，如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0.675614929199219       # Coupling parameter in Ewald summation</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：输入的谐波 IFCs 是未带极性修正的裸 IFCs，以便 FourPhonon 能够处理并在内部添加修正。该模块在很大程度上依赖 TDEP 源代码，我们无法保证成功。建议用户检查处理后的频率和三声子散射率。</p>
</blockquote>
<p>对于非极性材料，我们还开发了一种脚本，将 TDEP 格式转换为 Phonopy 格式，名为 <code>tdep2phonopy.f90</code>。这样您无需激活 tdep 标志。编译 Fortran 后，运行可执行文件（以下是示例）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./tdep2phonopy outfile.forceconstant 10 10 1 2</span><br></pre></td></tr></table></figure>

<p>这将 TDEP IFCs （<code>outfile.forceconstant</code>）转换为 Phonopy 格式，构建一个来自双原子单位胞的 (10 \times 10 \times 1) 超胞。请检查转换后的声子色散。我们建议使用足够大的超胞来存储所有的第二阶 IFC 中的成对相互作用。</p>
<h3 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h3><p>计算三声子散射率（精确计算，迭代），并在 RTA 层面计算四声子散射。使用的 TDEP 格式谐波 IFCs 并应用非解析修正，Ewald 参数为 (\lambda &#x3D;0.675614929199219)。同样需要 Born 有效电荷（此处未列出），与 ShengBTE 对极性系统的处理相似。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&amp;parameters</span><br><span class="line">    T=300</span><br><span class="line">    scalebroad=0.1</span><br><span class="line">    Ewald=0.675614929199219</span><br><span class="line">&amp;end</span><br><span class="line">&amp;flags</span><br><span class="line">    tdep=.TRUE.</span><br><span class="line">    nonanalytic=.TRUE. ! 此标签现在需要明确指定</span><br><span class="line">    convergence=.TRUE.</span><br><span class="line">    four_phonon=.TRUE.</span><br><span class="line">&amp;end</span><br></pre></td></tr></table></figure>

<h2 id="TDEP-格式的-3阶-x2F-4阶-IFCs"><a href="#TDEP-格式的-3阶-x2F-4阶-IFCs" class="headerlink" title="TDEP 格式的 3阶&#x2F;4阶 IFCs"></a>TDEP 格式的 3阶&#x2F;4阶 IFCs</h2><p>对于 TDEP 格式的 3阶&#x2F;4阶 IFCs，我们开发了一个独立的脚本，将其转换为 ShengBTE 格式，名为 <code>tdep2ShengBTE.f90</code>。我们需要在同一目录下有 <code>infile.ucposcar</code>。编译 Fortran 后，运行可执行文件：</p>
<h3 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./tdep2ShengBTE 3 2 outfile.forceconstant_thirdorder</span><br></pre></td></tr></table></figure>

<p>这将 TDEP 的 3 阶 IFCs（<code>outfile.forceconstant_thirdorder</code>）转换为 ShengBTE 格式。</p>
<h2 id="Output-files"><a href="#Output-files" class="headerlink" title="Output files"></a>Output files</h2><p>Besides the routine output files from previous ShengBTE program, FourPhonon generates these output files:</p>
<ul>
<li>BTE.Numprocess_4ph: number of allowed four-phonon scattering processes, for each irreducible q point and phonon band</li>
<li>BTE.P4: phase space available for four-phonon processes, for each irreducible q point and phonon band</li>
<li>BTE.P4_total: total volume in phase space available for four-phonon processes</li>
<li>BTE.P4_plusplus*, BTE.P4_plusminus*, BTE.P4_minusminus*: similar to BTE.P4 but only includes contributions from ++&#x2F;+-&#x2F;- - processes</li>
</ul>
<p>*Note for four-phonon scatterings, there are three different channels: recombination (++), redistribution (+-) and splitting (- -) processes.</p>
<p>Under temperature-dependent directories: (the unit of scattering rates is ps−1 if not specified)</p>
<ul>
<li>BTE.WP4: weighted phase space available for four-phonon processes ([rad&#x2F;ps]$^{-5}$, 2nd column) vs angular frequency (rad&#x2F;ps, 1st column) for each irreducible q point and phonon band</li>
<li>BTE.WP4_plusplus*, BTE.WP4_plusminus*, BTE.WP4_minusminus*: similar to BTE.WP4 but only includes contributions from ++&#x2F;+-&#x2F;- - processes</li>
<li>BTE.w_3ph: three-phonon scattering rates for each irreducible q point and phonon band, this file replaces the original output BTE.w_anharmonic. Absorption and emission processes are written out into BTE.w_3ph_plus and BTE.w_3ph_minus</li>
<li>BTE.w_4ph: four-phonon scattering rates for each irreducible q point and phonon band. Similarly, we provide the contributions from different channels: BTE.w_4ph_plusplus, BTE.w_4ph_plusminus and BTE.w_4ph_minusminus</li>
<li>BTE.w_4ph_normal: four-phonon scattering rates of normal processes, for each irreducible q point and phonon band. This file has 5 columns and each one represents: angular frequency in rad&#x2F;ps, recombination channel, redistribution channel, splitting channel, overall scattering rates from normal processes</li>
<li>BTE.w_4ph_Umklapp: four-phonon scattering rates of Umklapp processes, for each irreducible q point and phonon band. The format is the same as BTE.w_4ph_normal</li>
<li>BTE.kappa*: thermal conductivity results are written out as usual</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-49-23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-49-23/" class="post-title-link" itemprop="url">3.1 热输运1 声子谱</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:49:23" itemprop="dateCreated datePublished" datetime="2023-05-09T18:49:23+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-11-18 21:06:13" itemprop="dateModified" datetime="2024-11-18T21:06:13+08:00">2024-11-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFT%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">DFT学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="声子谱"><a href="#声子谱" class="headerlink" title="声子谱"></a>声子谱</h1><p>声子谱的计算主要有两种方法，一种是直接法，另一种是微扰密度泛函方法（DFPT）。</p>
<ul>
<li>直接法，或称frozen-phonon方法，是通过在优化后的平衡结构中引入原子位移，计算作用在原子上的Hellmann-Feynman力，进而由动力学矩阵算出声子色散曲线。直接法的缺陷在于它要求声子波矢与原胞边界supersize<br>正交，或者原胞足够大使得Hellmann-Feynman力在原胞外可以忽略不计。这使得对于复杂系统，如对称性高的晶体、合金、超晶格等材料需要采用超原胞。超原胞的采用使计算量急剧增加，极大的限制了该方法的使用。</li>
<li>1987年，Baroni、Giannozzi和Testa提出了DFPT方法。DFPT通过计算系统能量对外场微扰的响应来求出晶格动力学性质。该方法最大的优势在于它不限定微扰的波矢与原胞边界正交，不需要超原胞也可以对任意波矢求解。Castep、Vasp等采用的是一种linear response theory 的方法（或者称为 density perturbation functional theory，DFPT），直接计算出原子的移动而导致的势场变化，再进一步构造出动力学矩阵。进而计算出声子谱。</li>
</ul>
<h2 id="DFPT计算步骤"><a href="#DFPT计算步骤" class="headerlink" title="DFPT计算步骤"></a>DFPT计算步骤</h2><ul>
<li>结构优化<br><strong>声子谱的计算需要对原胞结构做高精度的充分优化，否则很容易出现虚频；</strong> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">EDIFF</span>  = <span class="number">1E-08</span></span><br><span class="line"><span class="variable constant_">EDIFFG</span> = -<span class="number">1E-06</span> </span><br></pre></td></tr></table></figure>
可以采用分步优化，直到达到精度。然后优化后的结果，cp CONTCAR POSCAR：</li>
</ul>
<p> <code>$ phonopy -d --dim=&quot;4 4 1&quot; </code></p>
<p>之后会生成一堆文件，其中有  SPOSCAR 和POSCAR-00* ，分别对应不同的方法密度泛函微扰法 (DFPT) 以及有限位移法。<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ls</span><br><span class="line">phonopy_disp.<span class="property">yaml</span>  <span class="variable constant_">POSCAR</span>-<span class="number">002</span>  <span class="variable constant_">POSCAR</span>-<span class="number">005</span>  <span class="variable constant_">POSCAR</span>-<span class="number">008</span>  <span class="variable constant_">POSCAR</span>-<span class="number">011</span>  <span class="variable constant_">POSCAR</span>-<span class="number">014</span>  <span class="variable constant_">SPOSCAR</span></span><br><span class="line"><span class="variable constant_">POSCAR</span>             <span class="variable constant_">POSCAR</span>-<span class="number">003</span>  <span class="variable constant_">POSCAR</span>-<span class="number">006</span>  <span class="variable constant_">POSCAR</span>-<span class="number">009</span>  <span class="variable constant_">POSCAR</span>-<span class="number">012</span>  <span class="variable constant_">POSCAR</span>-<span class="number">015</span></span><br><span class="line"><span class="variable constant_">POSCAR</span>-<span class="number">001</span>         <span class="variable constant_">POSCAR</span>-<span class="number">004</span>  <span class="variable constant_">POSCAR</span>-<span class="number">007</span>  <span class="variable constant_">POSCAR</span>-<span class="number">010</span>  <span class="variable constant_">POSCAR</span>-<span class="number">013</span>  <span class="variable constant_">POSCAR</span>-<span class="number">016</span></span><br><span class="line">$ cp <span class="variable constant_">POSCAR</span> <span class="variable constant_">POSCAR</span>-unitcell</span><br><span class="line">$ cp <span class="variable constant_">SPOSCAR</span> <span class="variable constant_">POSCAR</span></span><br></pre></td></tr></table></figure><br><strong>KPOINTS需适当减小，可以的话最好再进行一次收敛测试</strong><br><strong>INCAR</strong><br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">IBRION</span> =  <span class="number">8</span>            (determines the <span class="title class_">Hessian</span> matrix using <span class="variable constant_">DFPT</span>)</span><br><span class="line"><span class="variable constant_">EDIFF</span>  =  <span class="number">1E-08</span>        (<span class="variable constant_">SCF</span> energy convergence; <span class="keyword">in</span> eV) </span><br><span class="line"><span class="variable constant_">PREC</span>   =  <span class="title class_">Accurate</span>     (<span class="title class_">Precision</span> level)  </span><br><span class="line"><span class="variable constant_">ENCUT</span>  =  <span class="number">500</span>          (<span class="title class_">Cut</span>-off energy <span class="keyword">for</span> plane wave basis set, <span class="keyword">in</span> eV) </span><br><span class="line"><span class="variable constant_">IALGO</span>  =  <span class="number">38</span>           (<span class="title class_">Davidson</span> block iteration scheme)</span><br><span class="line"><span class="variable constant_">LREAL</span>  = .<span class="property">FALSE</span>.       (<span class="title class_">Projection</span> <span class="attr">operators</span>: <span class="literal">false</span>)</span><br><span class="line"><span class="variable constant_">LWAVE</span>  = .<span class="property">FLASE</span>.       (<span class="title class_">Write</span> <span class="variable constant_">WAVECAR</span> or not)</span><br><span class="line"><span class="variable constant_">LCHARG</span> = .<span class="property">FLASE</span>.       (<span class="title class_">Write</span> <span class="variable constant_">CHGCAR</span> or not) </span><br><span class="line"><span class="variable constant_">ADDGRID</span>= .<span class="property">TRUE</span>.        (<span class="title class_">Increase</span> grid; helps <span class="variable constant_">GGA</span> convergence) </span><br><span class="line"><span class="variable constant_">NSW</span>    = <span class="number">1</span></span><br></pre></td></tr></table></figure><br>上面参数 IBRION &#x3D;  8   NSW    &#x3D; 1是注意修改的。<br><strong>提交VASP计算</strong></p>
<p><strong>后处理</strong><br> <code>phonopy --fc vasprun.xml </code></p>
<p>读取vasprun.xml，生成FORCE_CONSTANTS文件。</p>
<p>编辑band.conf文件，该文件给出了高对称点路径的信息<br>Note:<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ATOM_NAME</span> = * *  #元素名称，顺序与<span class="variable constant_">POSCAR</span>保持一致</span><br><span class="line"><span class="variable constant_">DIM</span> = <span class="number">4</span> <span class="number">4</span> <span class="number">1</span>      #建立超胞的大小，--dim后面的</span><br><span class="line"><span class="variable constant_">BAND</span> = <span class="number">0.5</span> <span class="number">0.0</span> <span class="number">0.0</span>  <span class="number">0.0</span> <span class="number">0.0</span> <span class="number">0.0</span>  <span class="number">0.333333</span> <span class="number">0.333333</span> <span class="number">0.0</span>  <span class="number">0.5</span> <span class="number">0.0</span> <span class="number">0.0</span> #高对称点路径，每组高对称点之间用两个空格隔开</span><br><span class="line"><span class="variable constant_">FORCE_CONSTANTS</span> = <span class="variable constant_">READ</span> #表示读取力常数文件<span class="variable constant_">FORCE_CONSTANTS</span></span><br><span class="line"><span class="variable constant_">FC_SYMMETRY</span> = .<span class="property">TRUE</span>.</span><br></pre></td></tr></table></figure><br>准备mesh.conf文件，如下所示：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ATOM_NAME</span> = <span class="title class_">Si</span></span><br><span class="line"><span class="variable constant_">DIM</span> = <span class="number">2</span> <span class="number">2</span> <span class="number">2</span></span><br><span class="line"><span class="variable constant_">MP</span> = <span class="number">24</span> <span class="number">24</span> <span class="number">24</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">phonopy --dim=<span class="string">&quot;4 4 1&quot;</span> -c <span class="variable constant_">POSCAR</span>-unitcell -p -s band.<span class="property">conf</span></span><br><span class="line">(单位是<span class="title class_">THz</span>)或者</span><br><span class="line">phonopy --dim=<span class="string">&quot;4 4 1&quot;</span> --factor=<span class="number">524.147</span> -c <span class="variable constant_">POSCAR</span>-unitcell -p -s band.<span class="property">conf</span></span><br><span class="line">(单位是cm-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>（读取band.conf、FORCE_CONSTANTS、POSCAR-unitcell，输出band.yaml、phonopy.yaml以及pdf图）<br> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">phonopy-bandplot  --gnuplot&gt; phono.dat</span><br><span class="line">如果上述命令不行，可以用旧版本phonopy </span><br><span class="line">bandplot --gnuplot&gt; phonon.dat</span><br></pre></td></tr></table></figure><br>读取band.yaml，就可以获得二阶力常数矩阵声子谱的数据，其中第一行为高对称点的坐标。</p>
<p>准备mesh.conf以计算态密度和PDOS：</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ATOM_NAME</span> = </span><br><span class="line"><span class="variable constant_">DIM</span> = <span class="number">4</span> <span class="number">4</span> <span class="number">1</span></span><br><span class="line"><span class="variable constant_">MP</span>=<span class="number">12</span> <span class="number">12</span> <span class="number">1</span></span><br><span class="line"><span class="variable constant_">PDOS</span>=<span class="number">1</span> <span class="number">2</span>, <span class="number">3</span> <span class="number">4</span>, <span class="number">5</span> <span class="number">6</span></span><br><span class="line"><span class="variable constant_">FORCE_CONSTANTS</span> = <span class="variable constant_">READ</span></span><br><span class="line"><span class="variable constant_">BAND_POINTS</span> = <span class="number">71</span></span><br></pre></td></tr></table></figure>
<p>运行命令：<code>phonopy –dim=&#39;4 4 1&#39; -c POSCAR-unitcell mesh.conf</code>或者乘上因子修改单位。<code>phonopy –dim=&#39;4 4 1&#39; --factor=524.147 -c POSCAR-unitcell mesh.conf</code><br>得到projected_dos.dat文件，拖到Origin中画图，得到声子态密度图像（从第二列数据开始，每一列对应每个原子的态密度），对比着之前计算得到的声子谱可以分析声学支与光学支之间的相互作用关系</p>
<h2 id="有限位移方法"><a href="#有限位移方法" class="headerlink" title="有限位移方法"></a>有限位移方法</h2><p>这里需要准备和 POSCAR-00* 数目一样的文件夹，并把 POSCAR-00* 复制到每个文件夹中并命名为 POSCAR 。每个文件夹内都需要准备 POTCAR 、 POSCAR 、 INCAR 、 KPOINTS 。并且分别计算。<br><strong>可用以下sh脚本快速进行：手动修改第一行文件夹数目和vasp运行文件名称。</strong></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">001</span>.<span class="number">.006</span>&#125;</span><br><span class="line"><span class="keyword">do</span> </span><br><span class="line">mkdir $i</span><br><span class="line">cd $i</span><br><span class="line">cp ../<span class="variable constant_">POSCAR</span>-$i <span class="variable constant_">POSCAR</span></span><br><span class="line">cp ../&#123;<span class="variable constant_">INCAR</span>,<span class="variable constant_">KPOINTS</span>,<span class="variable constant_">POTCAR</span>,sub.<span class="property">sh</span>&#125; .</span><br><span class="line">运行提交任务命令</span><br><span class="line">cd ../</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p><strong>INCAR 可以设置为如下内容：</strong><br>INCAR设置如下(静态计算)：</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">PREC</span> = <span class="title class_">Accurate</span></span><br><span class="line"><span class="variable constant_">IBRION</span> = -<span class="number">1</span></span><br><span class="line"><span class="variable constant_">NSW</span> = <span class="number">1</span></span><br><span class="line"><span class="variable constant_">ENCUT</span> = <span class="number">500</span></span><br><span class="line"><span class="variable constant_">EDIFF</span> = <span class="number">1.0e-08</span></span><br><span class="line"><span class="variable constant_">EDIFFG</span> = -<span class="number">0.001</span></span><br><span class="line"><span class="variable constant_">ISMEAR</span> = <span class="number">0</span></span><br><span class="line"><span class="variable constant_">SIGMA</span> = <span class="number">0.05</span></span><br><span class="line"><span class="variable constant_">IALGO</span> = <span class="number">38</span></span><br><span class="line"><span class="variable constant_">LREAL</span> = .<span class="property">FALSE</span>.</span><br><span class="line"><span class="variable constant_">LWAVE</span> = .<span class="property">FALSE</span>.</span><br><span class="line"><span class="variable constant_">LCHARG</span> = .<span class="property">FALSE</span>.</span><br></pre></td></tr></table></figure>
<p>里面IBRION &#x3D; -1  NSW &#x3D; 1注意修改</p>
<p><strong>KPOINTS需适当减小，可以的话最好再进行一次收敛测试</strong><br><strong>提交VASP计算</strong></p>
<p><strong>后处理</strong></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phonopy -f ./disp-*/vasprun.<span class="property">xml</span></span><br></pre></td></tr></table></figure>
<p>准备band.conf</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ATOM_NAME</span> = <span class="title class_">In</span> <span class="title class_">Se</span></span><br><span class="line"><span class="variable constant_">DIM</span> = <span class="number">4</span> <span class="number">4</span> <span class="number">1</span></span><br><span class="line"><span class="variable constant_">BAND</span> = <span class="number">0.5</span> <span class="number">0.0</span> <span class="number">0.0</span>  <span class="number">0.0</span> <span class="number">0.0</span> <span class="number">0.0</span>  <span class="number">0.333333</span> <span class="number">0.333333</span> <span class="number">0.0</span>  <span class="number">0.5</span> <span class="number">0.0</span> <span class="number">0.0</span></span><br><span class="line"><span class="variable constant_">FORCE_CONSTANTS</span> = <span class="variable constant_">WRITE</span>  #注意这里是 <span class="variable constant_">WRITE</span></span><br><span class="line"><span class="variable constant_">FC_SYMMETRY</span> = .<span class="property">TRUE</span>.</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">phonopy -c <span class="variable constant_">POSCAR</span>-unitcell band.<span class="property">conf</span> -p -s</span><br><span class="line">phonopy --factor=<span class="number">524.147</span> -c <span class="variable constant_">POSCAR</span>-unitcell -p -s band.<span class="property">conf</span></span><br><span class="line">#旧版本phonopy</span><br><span class="line">bandplot  --gnuplot&gt; phonon.<span class="property">dat</span></span><br><span class="line">就可以获得二阶力常数矩阵 <span class="variable constant_">FORCE_CONSTANTS</span> 和声子谱的数据</span><br><span class="line">#新版本phonopy</span><br><span class="line">phonopy-bandplot --gnuplot &gt; phonon.<span class="property">dat</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Mind</strong></p>
<ul>
<li>如果计算完的声子谱其他地方都好，就是在Γ点有一点点虚频，那么这个材料很可能是稳定的，只是你优化做得不够好，进一步提高优化的精度可消除这一点点虚频。</li>
<li>对于二维材料，如果在Γ点出现很小的虚频，基本可以认为这个材料是稳定的，大部分二维材料都会有此现象；尤其是VASP结合phonopy code计算二维材料的声子谱在Γ点更是容易出现虚频；使用Quantum-ESPRESSO的PWSCF和PH模块计算声子谱对于内存的需求较小一些，且对于二维材料的声子谱计算更友好一些，后期会详细介绍Quantum-ESPRESSO计算声子谱的具体步骤。</li>
<li>声子谱是表示组成材料原子的集体振动模式。如果材料的原胞包含n个原子，那么声子谱总共有3n支，其中有3条声学支，3n-3条光学支。声学支表示原胞的整体振动，光学支表示原胞内原子间的相对振动。</li>
</ul>
<p><strong>计算出的声子谱有虚频，往往表示该材料不稳定。</strong> 有些情况下，我们可以利用虚频信息使不稳定的材料变得稳定。如果声子谱的一条声学支存在虚频，主要位于Γ点和M点1&#x2F;2处（对应倒格矢的1&#x2F;4位置）。倒格矢的1&#x2F;4，对应晶格长度的4倍。我们可能需要将原胞沿上述倒格矢方向扩大四倍，进一步优化原子位置，才可能得到比较稳定的晶胞。</p>
<h1 id="消虚频"><a href="#消虚频" class="headerlink" title="消虚频"></a>消虚频</h1><ol>
<li>DFPT方法与有限位移法互换尝试。或者更换标准胞扩胞计算。</li>
<li>扩胞，在虚频很小时可以尝试扩大扩胞倍数。</li>
<li>提高精度优化后计算声子谱。声子谱对力的精度要求特别高，所以提高精度多次优化后再计算声子谱也是可行的。</li>
<li>修改POTCAR，尝试不同的赝势方法。（不太建议，因为需改之后所有计算都需要统一成稳定构型的赝势。不过有效）</li>
<li>修改POSCAR原子坐标，再优化，再计算声子谱。<br>修改方法：对于DFPT计算的声子谱，使用<code>grep cm-1 OUTCAR</code>查看频率，寻找最大的虚频频率。然后在OUTCAR中从最后往前找到最大的虚频频率对应的坐标。<br>dx dy dz对应虚频的位移，把这些坐标与POSCAR中的坐标相加或者0.1-0.9之间的倍数，形成新的POSCAR。进行优化，再计算声子谱。</li>
<li>不排除真的算不出来没虚频的，据我所知，SnTe就没见到谁大大方方发文章谈声子谱的（算出来虚频消除不了不好意思讲）。</li>
<li>INCAR参数对虚频的影响：ADDGRID影响很小，LREAL有影响。截断能和K点密度在收敛情况下影响小。</li>
</ol>
<h3 id="结构优化消虚频"><a href="#结构优化消虚频" class="headerlink" title="结构优化消虚频"></a>结构优化消虚频</h3><p>X, Y, Z为体系中原子的坐标，也就是POSCAR中的内容。 dx, dy,dz为虚频对应的原子振动方向上的位移。我们将（dx, dy,dz）这个位移乘以一个介于0-1之间的校正因子，然后跟POSCAR中的坐标加起来即可。以z方向为例，<strong>校正因子设为0.1，</strong> 微调后的z方向坐标为： 10.709980 + （-0.676634）0.1。<br>脚本vib_correct.py如下：<a target="_blank" rel="noopener" href="https://www.bigbrosci.com/2022/04/29/A29/">https://www.bigbrosci.com/2022/04/29/A29/</a></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># -*- <span class="attr">coding</span>: utf-<span class="number">8</span> -*-</span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">Qiang Li</span></span><br><span class="line"><span class="string">Command: python3 vib_correct.py </span></span><br><span class="line"><span class="string">This is a temporary script file.</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> ase.<span class="property">io</span> <span class="keyword">import</span> read, write</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">#获取虚频开始行</span><br><span class="line">l_position = <span class="number">0</span>  #虚频振动方向部分在<span class="variable constant_">OUTCAR</span>中的起始行数</span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;OUTCAR&#x27;</span>) <span class="keyword">as</span> <span class="attr">f_in</span>:</span><br><span class="line">    lines = f_in.<span class="title function_">readlines</span>()</span><br><span class="line">    wave_num = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> num, line <span class="keyword">in</span> <span class="title function_">enumerate</span>(lines):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;f/i&#x27;</span> <span class="keyword">in</span> <span class="attr">line</span>:</span><br><span class="line">            wave_tem = <span class="title function_">float</span>(line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">6</span>])</span><br><span class="line">            <span class="keyword">if</span> wave_tem &gt; <span class="attr">wave_num</span>: #获取最大的虚频</span><br><span class="line">                wave_num = wave_tem</span><br><span class="line">                l_position = num+<span class="number">2</span></span><br><span class="line"># <span class="variable constant_">ASE</span>读<span class="variable constant_">POSCAR</span></span><br><span class="line">model = <span class="title function_">read</span>(<span class="string">&#x27;POSCAR&#x27;</span>)</span><br><span class="line">model_positions = model.<span class="title function_">get_positions</span>()</span><br><span class="line">num_atoms = <span class="title function_">len</span>(model)</span><br><span class="line">#<span class="title function_">print</span>(model_positions)</span><br><span class="line"></span><br><span class="line"># 获取虚频对应的<span class="variable constant_">OUTCAR</span>部分 </span><br><span class="line">vib_lines = lines[<span class="attr">l_position</span>:l_position + num_atoms] #振动部分 <span class="number">7222</span>到<span class="number">7248</span>行</span><br><span class="line">#<span class="title function_">print</span>(vib_lines)</span><br><span class="line">vib_dis = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="attr">vib_lines</span>:</span><br><span class="line">    #model_positions = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[:<span class="number">3</span>]]</span><br><span class="line">    vib_infor = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">3</span>:]] # dx， dy， dz对应的那三列</span><br><span class="line">    vib_dis.<span class="title function_">append</span>(vib_infor)</span><br><span class="line">vib_dis = np.<span class="title function_">array</span>(vib_dis) #将振动部分写到一个array中。</span><br><span class="line"></span><br><span class="line"># 微调结构</span><br><span class="line">new_positions = model_positions + vib_dis * <span class="number">0.4</span> # <span class="number">0.4</span>是微调的校正因子，即虚频对应振动位移的<span class="number">0.4</span>，具体多大自己根据经验调。</span><br><span class="line">model.<span class="property">positions</span> = new_positions</span><br><span class="line"></span><br><span class="line">###保存结构</span><br><span class="line"><span class="title function_">write</span>(<span class="string">&#x27;POSCAR_new&#x27;</span>, model, vasp5=<span class="title class_">True</span>) # POSCAR_new是微调后的结构，用于下一步的计算（别忘了把POSCAR_new改成<span class="variable constant_">POSCAR</span>）。</span><br></pre></td></tr></table></figure>

<h3 id="过渡态虚频"><a href="#过渡态虚频" class="headerlink" title="过渡态虚频"></a>过渡态虚频</h3><p>如果过渡态计算的时候出现好几个虚频，自己直接写个python脚本也能实现。不过使用ASE可以很方便地获取POSCAR中原子数目，保存原子固定的信息。参考如下。</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/env python</span><br><span class="line"># -*- <span class="attr">coding</span>: utf-<span class="number">8</span> -*-</span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">Qiang Li</span></span><br><span class="line"><span class="string">Command: python3 vib_correct.py</span></span><br><span class="line"><span class="string">This is a temporary script file.</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">#获取虚频开始行</span><br><span class="line">l_position = <span class="number">0</span>  #虚频振动方向部分在<span class="variable constant_">OUTCAR</span>中的起始行数</span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;OUTCAR&#x27;</span>) <span class="keyword">as</span> <span class="attr">f_in</span>:</span><br><span class="line">    lines = f_in.<span class="title function_">readlines</span>()</span><br><span class="line">    wave_num = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> num, line <span class="keyword">in</span> <span class="title function_">enumerate</span>(lines):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;f/i&#x27;</span> <span class="keyword">in</span> <span class="attr">line</span>:</span><br><span class="line">            wave_tem = <span class="title function_">float</span>(line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">6</span>])</span><br><span class="line">            <span class="keyword">if</span> wave_tem &gt; <span class="attr">wave_num</span>: #获取最大的虚频</span><br><span class="line">                wave_num = wave_tem</span><br><span class="line">                l_position = num+<span class="number">2</span></span><br><span class="line"># 读<span class="variable constant_">POSCAR</span></span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;POSCAR&#x27;</span>) <span class="keyword">as</span> <span class="attr">f_pos</span>:</span><br><span class="line">    lines_pos = f_pos.<span class="title function_">readlines</span>()</span><br><span class="line"></span><br><span class="line"># 获取虚频对应的<span class="variable constant_">OUTCAR</span>部分    </span><br><span class="line">num_atoms = <span class="title function_">sum</span>([<span class="title function_">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> lines_pos[<span class="number">6</span>].<span class="title function_">rstrip</span>().<span class="title function_">split</span>()])</span><br><span class="line">vib_lines = lines[<span class="attr">l_position</span>:l_position + num_atoms] #振动部分 <span class="number">7222</span>到<span class="number">7248</span>行</span><br><span class="line"></span><br><span class="line">model_positions = []</span><br><span class="line">vib_dis = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="attr">vib_lines</span>:</span><br><span class="line">    position = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[:<span class="number">3</span>]]</span><br><span class="line">    vib_infor = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">3</span>:]] # dx， dy， dz对应的那三列</span><br><span class="line">    model_positions.<span class="title function_">append</span>(position)</span><br><span class="line">    vib_dis.<span class="title function_">append</span>(vib_infor)</span><br><span class="line"></span><br><span class="line"># 微调结构</span><br><span class="line">model_positions = np.<span class="title function_">array</span>(model_positions)</span><br><span class="line">vib_dis = np.<span class="title function_">array</span>(vib_dis) #将振动部分写到一个array中。</span><br><span class="line">new_positions = model_positions + vib_dis * <span class="number">0.4</span> # <span class="number">0.4</span>是微调的校正因子，即虚频对应振动位移的<span class="number">0.4</span>，具体多大自己根据经验调。</span><br><span class="line"></span><br><span class="line">###保存结构</span><br><span class="line">f_out = <span class="title function_">open</span>(<span class="string">&#x27;POSCAR_new&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f_out.<span class="title function_">writelines</span>(lines_pos[:<span class="number">8</span>])</span><br><span class="line">f_out.<span class="title function_">write</span>(<span class="string">&#x27;Cartesian\n&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="attr">new_positions</span>:</span><br><span class="line">    f_out.<span class="title function_">write</span>(<span class="string">&#x27; &#x27;</span>.<span class="title function_">join</span>([<span class="title function_">str</span>(coord) <span class="keyword">for</span> coord <span class="keyword">in</span> i]) + <span class="string">&#x27;  F  F  F\n&#x27;</span>)</span><br><span class="line">f_out.<span class="title function_">close</span>()</span><br></pre></td></tr></table></figure>

<h1 id="phonopy声子群速度"><a href="#phonopy声子群速度" class="headerlink" title="phonopy声子群速度"></a>phonopy声子群速度</h1><p>操作步骤</p>
<ol>
<li>首先对结构高精度优化后扩胞，计算得到没有虚频的声子谱；</li>
<li>对band.conf文件进行修改，并添加群速度计算相关参数<code>GROUP_VELOCITY = .TRUE.</code>和<code>GV_DELTA_Q = 0.01</code>，程序需要读取本征值和本征矢，所以必须设置 EIGENVECTORS &#x3D;.TRUE.，此外为了防止vaspkit在导出数据时报错，需要删除BAND_LABELS高对称路径名称，修改后band.conf文件内容如下；</li>
</ol>
<p>而且具体使用过程中，关于执行命令还有执行文件的tag内容还有一些可替换的关系,–gv, –group_velocity 可在执行计算命令时替代执行文件中的<code>GROUP_VELOCITY = .TRUE.</code>内容， –gv_delta_q 可在执行计算命令时替代执行文件中的(GV_DELTA_Q)内容</p>
<ol start="3">
<li>对声子谱重新进行计算，打开phonopy.yaml文件可以看到，phonopy在计算声子谱的过程中考虑到了群速度；打开band.yaml文件中也保存了有关群速度的相关信息；同时在计算声子谱中phonopy所储存的数据文件mesh.yaml和band.yaml文件中也保存了有关群速度的相关信息。</li>
<li>随后进行数据提取，以vaspkit1.12版本为例，打开vaspkit，输入<code>73</code>，打开VASP2other Interface 子功能，选择<code>739 Sort Phonon Band Structure for Phononpy</code>，运行完成即可获得group velocity相关数据以及各原子的声子谱数据；在运行过程中我们可以看到软件说明<code>find group velocity</code>并写入输出文件中。<br>1.5版本为789功能。</li>
</ol>
<h1 id="格林艾森常数（Gruneisen-parameters）"><a href="#格林艾森常数（Gruneisen-parameters）" class="headerlink" title="格林艾森常数（Grüneisen parameters）"></a>格林艾森常数（Grüneisen parameters）</h1><p>为表示声子非简谐效应的参数。phonopy计算模式格林艾森参数方式见官网。<br>以NaCl为例，首先需要进行三个声子谱计算，分别是平衡体积（orig），稍小体积（minus）和稍大体积（plus）的结构，计算时改变晶格参数使得体积获得改变。</p>
<p>计算完成后获得不同体积下的原子间力常数文件FORCE_SETS 或 FORCE_CONSTANTS   （后续命令中需要添加–readfc参数）。</p>
<p>随后通过phonopy-gruneisen（旧版gruneisen）命令获得对应于声子带结构中倒易空间中的路径的模式格林艾森常数（具体设定可根据自身计算情况更改）<br><code>phonopy-gruneisen orig plus minus --dim=&quot;2 2 2&quot; --pa=&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot; --band=&quot;1/2 1/4 3/4 0 0 0 1/2 1/2 1/2 1/2 0.0 1/2&quot; -p -c POSCAR-unitcell</code><br>在倒易网格中的模式格林艾森常数（具体设定可根据自身计算情况更改）：<br><code>phonopy-gruneisen orig plus minus --dim=&quot;2 2 2&quot; --pa=&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot; --mesh=&quot;20 20 20&quot; -p -c POSCAR-unitcell --color=&quot;RB&quot;</code><br>phonopy-gruneisen 命令选项包括–dim，–mp, –mesh，–band，–pa, –primitive_axis，–readfc，–band_points，–nac，–factor，–nomeshsym，-p，-c，-s, –save，-o等，功能上均与phonopy命令相同，但除上述列出的选项外，可以在phonopy命令上使用的其它选项是不能在phonopy-gruneisen 上使用的。如有必要，可以自行修改phonopy-gruneisen代码。</p>
<p>如查看帮助，可输入<br><code>phonopy-gruneisen -h</code><br>通过 <code>phonopy-gruneisenplot </code>命令导出计算得到的数据，使用方式类似于<code>phonopy-bandplot</code>。</p>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/icehoqion/article/details/130550807">https://blog.csdn.net/icehoqion/article/details/130550807</a></p>
<h1 id="热学性质"><a href="#热学性质" class="headerlink" title="热学性质"></a>热学性质</h1><p>参考：<br><a target="_blank" rel="noopener" href="http://supersunsir.com/2020/08/01/vasp/vasp_phonopy/">http://supersunsir.com/2020/08/01/vasp/vasp_phonopy/</a></p>
<h2 id="热膨胀系数"><a href="#热膨胀系数" class="headerlink" title="热膨胀系数"></a>热膨胀系数</h2><p>我们通过准简谐近似（QHA）的方法计算热膨胀系数和等压热容等性质，</p>
<ul>
<li>首先，我们要把优化好的POSCAR加应变（比如0.96 0.97 0.98 0.99 1 1.01 1.02 1.03 1.04的缩放系数，这样就有9个结构文件），</li>
<li>然后 把每一个POSCAR都去重复步骤（2）也就是去计算每一个缩放系数声子谱。大概就是这个效果</li>
<li>最后我们通过phonopy里面的QHA模块 去得到此材料的非偕性质<code>phonopy-qha -p -s e-v.dat *00/thermal_properties.yaml</code>就可以得到很多热力学性质比如热膨胀系数，格林爱森参数，自由能，等压热容等等。</li>
</ul>
<ol>
<li>先进行高精度的晶格优化。</li>
<li>修改缩放系数为0.95-1.05新建10个POSCAR.</li>
<li>对11个POSCAR晶体进行声子谱计算</li>
<li>thermo.conf文件后处理生成11个对应的thermal_properties.yaml</li>
<li>QHA计算热膨胀系数</li>
</ol>
<p>另一个写的步骤：</p>
<ol>
<li>高精度的原胞优化</li>
<li>在此基础上施加形变（梯度可以设置为千分之一）</li>
<li>优化多个结构</li>
<li>使用DFPT方法计算每个结构的声子谱（如果结构有问题，使用phonopy –symmetry）</li>
<li>在每个文件夹中得到thermal_properties.yaml</li>
<li>运行脚本得到e-v.dat</li>
<li>运行phonopy-qha的相关命令得到各种dat文件</li>
<li>Over</li>
</ol>
<p>可以参考作者的thermo.conf文件：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">DIM</span> = <span class="number">2</span> <span class="number">2</span> <span class="number">2</span></span><br><span class="line"><span class="variable constant_">ATOM_NAME</span> = sio</span><br><span class="line"><span class="variable constant_">MP</span> = <span class="number">31</span> <span class="number">31</span> <span class="number">31</span></span><br><span class="line"><span class="variable constant_">TPROP</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">TMAX</span> = <span class="number">2000</span></span><br><span class="line"><span class="variable constant_">TSTEP</span> = <span class="number">2</span></span><br><span class="line"><span class="variable constant_">FORCE_CONSTANTS</span> = <span class="variable constant_">READ</span></span><br></pre></td></tr></table></figure><br>然后是如何写e-v.dat文件</p>
<ul>
<li>大概意思就是找到之前计算的那11个POSCAR的vasprun.xml结果文件，然后记事本打开搜索最后一个e_wo_entrp。</li>
<li>下载phonopy官方文件中Si-QHA的example，</li>
<li>解压vasprun_xmls.tar.lzma我们可以得到算例中用到的vasprun.xml文件。</li>
</ul>
<h2 id="不同温度下热力学性质计算（自由能、热容、振动熵）"><a href="#不同温度下热力学性质计算（自由能、热容、振动熵）" class="headerlink" title="不同温度下热力学性质计算（自由能、热容、振动熵）"></a>不同温度下热力学性质计算（自由能、热容、振动熵）</h2><ul>
<li><p>在DFPT或者Finite displacement方法计算声子谱的基础上，得到mesh.yaml文件</p>
</li>
<li><p>新建一个文件夹，将FORCE_CONSTANTS、POSCAR、mesh.conf放入该文件夹中（POSCAR为原胞）</p>
</li>
<li><p>得到mesh.yaml文件</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phonopy mesh.<span class="property">conf</span> -c <span class="variable constant_">POSCAR</span></span><br></pre></td></tr></table></figure>
<p>mesh.conf的内容</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ATOM_NAME</span> = <span class="title class_">Hf</span> <span class="title class_">Si</span> O</span><br><span class="line"><span class="variable constant_">DIM</span> = <span class="number">2</span> <span class="number">2</span> <span class="number">2</span></span><br><span class="line"><span class="variable constant_">MP</span> = <span class="number">13</span> <span class="number">13</span> <span class="number">13</span></span><br><span class="line"><span class="variable constant_">FORCE_CONSTANTS</span> = <span class="variable constant_">READ</span></span><br></pre></td></tr></table></figure>
<p>得到thermal_properties.yaml文件</p>
</li>
</ul>
<p><code>phonopy -c POSCAR mesh.conf  -t</code><br>得到thermal_properties.dat文件<br><code>phonopy-propplot --gnuplot thermal_properties.yaml &gt;thermal_properties.dat</code><br>将dat文件导入到Origin中画图</p>
<p>dat文件的5列数据分别为：</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">temperature[K]</span><br><span class="line"><span class="title class_">Free</span> energy [kJ/mol]</span><br><span class="line"><span class="title class_">Entropy</span> [J/K/mol]</span><br><span class="line"><span class="title class_">Heat</span> capacity [J/K/mol]</span><br><span class="line"><span class="title class_">Energy</span> [kJ/mol]</span><br></pre></td></tr></table></figure>
<h3 id="下面是能用到的各种命令"><a href="#下面是能用到的各种命令" class="headerlink" title="下面是能用到的各种命令"></a>下面是能用到的各种命令</h3><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">扩胞用</span><br><span class="line">phonopy -d --dim=<span class="string">&quot;2 2 2&quot;</span> -c <span class="variable constant_">POSCAR_UNIT</span></span><br><span class="line">查找晶格对称性</span><br><span class="line">phonopy --symmetry</span><br><span class="line">收集力常数</span><br><span class="line">phonopy --fc vasprun.<span class="property">xml</span></span><br><span class="line">得到band.<span class="property">yalm</span>文件（好像不需要这一步）</span><br><span class="line">phonopy --dim=<span class="string">&quot;2 2 2&quot;</span> -c <span class="variable constant_">POSCAR</span>-<span class="variable constant_">UNIT</span> -p band.<span class="property">conf</span></span><br><span class="line">得到thermal_properties.<span class="property">yaml</span>文件</span><br><span class="line">phonopy -c <span class="variable constant_">POSCAR</span> mesh.<span class="property">conf</span>  -t</span><br></pre></td></tr></table></figure>
<h3 id="下面是产生e-v-dat文件的脚本，需要根据自己的目录名进行修改："><a href="#下面是产生e-v-dat文件的脚本，需要根据自己的目录名进行修改：" class="headerlink" title="下面是产生e-v.dat文件的脚本，需要根据自己的目录名进行修改："></a>下面是产生e-v.dat文件的脚本，需要根据自己的目录名进行修改：</h3><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> -<span class="number">0.005</span> -<span class="number">0.004</span> -<span class="number">0.003</span> -<span class="number">0.002</span> -<span class="number">0.001</span> <span class="number">0.001</span> <span class="number">0.002</span> <span class="number">0.003</span> <span class="number">0.004</span> <span class="number">0.005</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"> cd AC_Uni$i;</span><br><span class="line"> pwd;</span><br><span class="line"> volume=<span class="string">`grep volume vasprun.xml | tail -1| awk &#x27;&#123;printf(&quot;%20.13f&quot;, $3)&#125;&#x27;`</span>;</span><br><span class="line"> energy=<span class="string">`grep &#x27;E0&#x27; OSZICAR | tail -1 | awk &#x27;&#123;printf &quot;%12.4f \t&quot;, $5&#125;&#x27;`</span>;</span><br><span class="line"> echo $&#123;volume&#125; $&#123;energy&#125; &gt;&gt; ../e-v.<span class="property">dat</span>;</span><br><span class="line"> cd ../; #<span class="title class_">Exit</span> the <span class="title class_">Strain</span> folder</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h1 id="声子谱振动可视化"><a href="#声子谱振动可视化" class="headerlink" title="声子谱振动可视化"></a>声子谱振动可视化</h1><ol>
<li><p>上面生成band.yaml文件，利用JMOL打开。<a target="_blank" rel="noopener" href="https://jmol.sourceforge.net/">https://jmol.sourceforge.net/</a><br>或者网站：<a target="_blank" rel="noopener" href="https://henriquemiranda.github.io/phononwebsite/phonon.html">https://henriquemiranda.github.io/phononwebsite/phonon.html</a></p>
</li>
<li><p>band.conf添加标签ANIME&#x3D;0 0 0将000这个Q点的振动模式输出到anime.ascii,用v_sim软件打开即可。<a target="_blank" rel="noopener" href="https://l_sim.gitlab.io/v_sim/index.en.html">https://l_sim.gitlab.io/v_sim/index.en.html</a></p>
</li>
<li><p>运行命令 phonopy -f vasprun.xml-{001,002}得到FORSETS<br>运行phonopy –dim&#x3D;”3 3 3” –ct&#x3D;”0 0 0”得到gamma点的振动模式密度</p>
</li>
<li><p>DFPT方法得到的OUTCAR可以利用PyVibMS、JMOL</p>
</li>
<li><p>从band.yaml生成vesta读取：<a target="_blank" rel="noopener" href="https://github.com/AdityaRoy-1996/Phonopy_VESTA">https://github.com/AdityaRoy-1996/Phonopy_VESTA</a></p>
</li>
</ol>
<p>注意不要输出声子群速度，写出声子本征矢量。需要POSCAR.vesta格式。</p>
<p>从OUTCAR生成vesta读取：<a target="_blank" rel="noopener" href="https://github.com/Stanford-MCTG/VASP-plot-modes">https://github.com/Stanford-MCTG/VASP-plot-modes</a></p>
<ol start="6">
<li>其他参考：<a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv11848434/">https://www.bilibili.com/read/cv11848434/</a></li>
</ol>
<h1 id="声子谱反折叠"><a href="#声子谱反折叠" class="headerlink" title="声子谱反折叠"></a>声子谱反折叠</h1><p><a target="_blank" rel="noopener" href="https://github.com/yuzie007/upho">https://github.com/yuzie007/upho</a></p>
<h1 id="热位移"><a href="#热位移" class="headerlink" title="热位移"></a>热位移</h1><p>热学性质是根据倒易空间采样网格上的声子频率计算得出的，必须设置Mesh tag进行使用，并且必须检查它们相对于取样网格的收敛性。 通常这种计算对计算量要求不高，因此随着采样网格密度的增加，收敛性很容易达到。此外，计算时Phonopy对频率的默认单位为Thz。<br>在DFPT和冷冻声子的计算基础上，在thermal_properties.conf 中设置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TPROP = .TRUE. #进行热学性质计算</span><br><span class="line">DIM = 1 1 1 #扩胞情况</span><br><span class="line">MP = 16 16 8 #Mesh网格密度</span><br><span class="line">TMAX = 2000</span><br><span class="line">TMIN = 0</span><br><span class="line">TSTEP = 10 #温度上下限默认为100,0，step默认值为10</span><br></pre></td></tr></table></figure>

<p>计算得到thermal_properties.yaml文件：</p>
<p><code>phonopy -c POSCAR thermal_properties.conf -t</code></p>
<p>得到thermal_properties.dat文件：</p>
<p><code>phonopy-propplot --gnuplot thermal_properties.yaml &gt;thermal_properties.dat</code></p>
<p>五列数据分别为：temperature[K]、Free energy [kJ&#x2F;mol]、Entropy [J&#x2F;K&#x2F;mol]、Heat capacity [J&#x2F;K&#x2F;mol]、Energy [kJ&#x2F;mol]。</p>
<p>Phonopy官网还给出了两个参数：<br><code>PRETEND_REAL = .TRUE. </code><br>这里将虚频声子当成实声子进入计算，仅在有小虚频实作测试用；<br><code>CUTOFF_FREQUENCY = 0.1</code><br>默认值为0，将虚频声子频率视为负值，计算高于截止频率的声子。</p>
<h2 id="热位移计算"><a href="#热位移计算" class="headerlink" title="热位移计算"></a>热位移计算</h2><p>计算投影到笛卡尔轴上的均方位移与温度的函数关系。声子频率以 THz 为单位（phononopy 的默认设置），用于获得均方位移。同样需要与Mesh tag共同使用，温度设置与前述相同。新建thermal_displacements.conf用于输入tag。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TDISP = .TRUE. #进行均方位移计算</span><br><span class="line">DIM = 1 1 1 #扩胞情况</span><br><span class="line">MP = 16 16 8 #Mesh网格密度</span><br><span class="line">TMAX = 2000</span><br><span class="line">TMIN = 0</span><br><span class="line">TSTEP = 10 #温度上下限默认为100,0，step默认值为10</span><br></pre></td></tr></table></figure>

<p><code>XYZ_PROJECTION = .TRUE.</code><br>打开该tag，将对特征向量按实空间进行投影，得到不同原子在a,b,c三个轴向上的位移投影，数据存储为<code>frequency atom1_x atom1_y atom1_z atom2_x atom2_y atom2_z…</code>形式。</p>
<p><code>PROJECTION_DIRECTION = 1 1 0</code><br>打开该tag，将原子位移在指定实空间轴向上进行投影。<br>phonopy -c POSCAR thermal_displacements.conf -p -s<br>执行后，输出结果将保存在thermal_displacements.yaml中。注意，计算的原子位移为均方位移。</p>
<p>此外的两个tag：</p>
<p><code>TDISPMAT = .TRUE.</code><br>打开该tag时，将以3*3矩阵形式储存原子在六个方向上的均方位移xx, yy, zz, yz, xz, xy，结果写入thermal_displacement_matrices.yaml中。</p>
<p><code>TDISPMAT_CIF = 1273.0</code><br>该tag用于指定计算在某温度（1273K）下，原子的均方位移矩阵，结果输出在tdispmat.cif中。</p>
<h1 id="Phonopy其他功能"><a href="#Phonopy其他功能" class="headerlink" title="Phonopy其他功能"></a>Phonopy其他功能</h1><ul>
<li><code>phonopy --symmetry -c POSCAR-unit</code></li>
</ul>
<p>BPOSCAR和PPOSCAR生成，分别是标准胞和原胞，vasp格式。</p>
<ul>
<li><code>phonopy --rd 10 --dim 2 2 2 --pa auto --amplitude 0.03 -c POSCAR-unitcell</code></li>
</ul>
<p>–rd 10 代表生成10个随机位移结构，–dim 2 2 2扩胞倍数，–pa auto沿三个坐标轴投影方向，–amplitude 0.03位移幅度，-c指定对象。</p>
<p>输出”phonopy_disp.yaml” and supercells</p>
<ul>
<li><code>phonopy-load phonopy_disp_orig.yaml --rd 1000 --temperature 300</code></li>
</ul>
<p>generate 1000 supercells with displacements at 300K.</p>
<ul>
<li>New in v2.25 Symfc (symfc&#x2F;symfc) is based on fitting approach and any displacements set of atoms in supercell can be handled. For example, random displacements generated by RANDOM_DISPLACEMENTS can be used to compute force constants. To use symfc, its python module has to be installed via conda-forge or pip.</li>
</ul>
<p>New in v2.3 ALM (ttadano&#x2F;ALM) is based on fitting approach and any displacements set of atoms in supercell can be handled. For example, random displacements generated by RANDOM_DISPLACEMENTS can be used to compute force constants. To use ALM, its python module has to be installed via conda-forge or building it. The installation instruction is found here.</p>
<p>When ALM is used, please cite the paper: T. Tadano and S. Tsuneyuki, J. Phys. Soc. Jpn. 87, 041015 (2018).</p>
<p><code>FC_CALCULATOR = ALM</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-47-27/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-47-27/" class="post-title-link" itemprop="url">2.3 wannier90+wanniertools</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:47:27" itemprop="dateCreated datePublished" datetime="2023-05-09T18:47:27+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-06-05 10:49:09" itemprop="dateModified" datetime="2024-06-05T10:49:09+08:00">2024-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFT%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">DFT学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/355317202">https://zhuanlan.zhihu.com/p/355317202</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI3MzIyMjI2Nw==&mid=2247488523&idx=1&sn=90a544712f166e248993e1198eb40981&chksm=eb27cb1fdc50420921bb11d3bc8f4833c14418b0d0c0d755af6687fca024fc9d15d999ae7813&scene=21#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzI3MzIyMjI2Nw==&amp;mid=2247488523&amp;idx=1&amp;sn=90a544712f166e248993e1198eb40981&amp;chksm=eb27cb1fdc50420921bb11d3bc8f4833c14418b0d0c0d755af6687fca024fc9d15d999ae7813&amp;scene=21#wechat_redirect</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.sciencenet.cn/blog-2909108-1154273.html">https://blog.sciencenet.cn/blog-2909108-1154273.html</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/642116307">https://zhuanlan.zhihu.com/p/642116307</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/25432728">https://zhuanlan.zhihu.com/p/25432728</a></p>
<h1 id="一、安装编译"><a href="#一、安装编译" class="headerlink" title="一、安装编译"></a>一、安装编译</h1><h2 id="wannier90安装"><a href="#wannier90安装" class="headerlink" title="wannier90安装"></a>wannier90安装</h2><p>下载: <a target="_blank" rel="noopener" href="https://wannier.org/download/">https://wannier.org/download/</a></p>
<p>2.1版本是可以与VASP结合的最新版本。但是2.1版本默认安装与VASP接口并不好，主要是借助肖承诚博士写了一个Fortran的接口（<a target="_blank" rel="noopener" href="https://github.com/Chengcheng-Xiao/VASP2WAN90_v2_fix%EF%BC%89%EF%BC%8C">https://github.com/Chengcheng-Xiao/VASP2WAN90_v2_fix），</a> 需要注意的是这个接口是针对VASP 5.4.4版本的。1.2版本与VASP的接口是好的，所以1.2版本默认安装就好。对比两个版本的不同，1.2版本的主要缺点就在于不能构建向上自旋和向下自旋的能带，也就是没有自旋轨道耦合作用的铁磁和反铁磁体系。 <img src="/gra/0201.jpg" alt="0201"></p>
<h3 id="1-1-wannier90-2-1安装"><a href="#1-1-wannier90-2-1安装" class="headerlink" title="1.1 wannier90 2.1安装"></a>1.1 wannier90 2.1安装</h3><p>首先，解压安装包</p>
<p><code>tar -zxvf wannier90-2.1.0.tar.gz</code></p>
<p>其次，进入文件夹</p>
<p><code>cd wannier90-2.1.0/</code></p>
<p>然后，准备编译文件（这里老王用的是ifort，注意要检查ifort和mpiifort执行命令）</p>
<p><code>cp config/make.inc.ifort make.inc</code></p>
<p>接着，编译</p>
<p><code>make</code></p>
<p>完成后，编译库，得到libwannier.a文件</p>
<p><code>make lib</code></p>
<h3 id="1-2-VASP编译（注意以上接口VASP2WAN90-v2-fix只针对VASP-5-4-4）"><a href="#1-2-VASP编译（注意以上接口VASP2WAN90-v2-fix只针对VASP-5-4-4）" class="headerlink" title="1.2 VASP编译（注意以上接口VASP2WAN90_v2_fix只针对VASP 5.4.4）"></a>1.2 VASP编译（注意以上接口VASP2WAN90_v2_fix只针对VASP 5.4.4）</h3><p>首先拷贝VASP2WAN90_v2_fix接口文件中的mlwf.patch 到VASP代码编译目录下。然后执行如下命令。</p>
<p><code>patch -p0 &lt; mlwf.patch</code></p>
<p>接着在VASP makefile.include 文件中加入下面两行。注意路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CPP_OPTIONS+=-DVASP2WANNIER90v2</span><br><span class="line"></span><br><span class="line">LLIBS+=/path/to/your/wannier90_distro/libwannier.a</span><br></pre></td></tr></table></figure>
<p>最后编译即可</p>
<p><code>make all</code></p>
<h2 id="wannier-tools安装"><a href="#wannier-tools安装" class="headerlink" title="wannier-tools安装"></a>wannier-tools安装</h2><p>开源软件包WannierTools，是一个用于研究新型拓扑材料的软件。此代码在紧束缚模型中工作，可以由另一个软件包Wannier90生成。</p>
<p>它可以通过计算Wilson loop来帮助对给定材料的拓扑相进行分类，通过角分辨光电发射(ARPES)和红外光谱技术，可以得到表面态光谱扫描隧道显微镜(STM)实验。它还可以识别Weyl&#x2F;Dirac点和节点线结构的位置，计算闭合动量环周围的贝里相位和部分布里渊区(BZ)的贝里曲率。<br>此外，WannierTools还可以计算非磁性金属和半金属的普通磁电阻利用玻尔兹曼输运理论，计算给定磁场方向和强度下的朗道能级谱;并从超胞计算中得到展开的能谱。</p>
<p>wanniertools官方安装教程</p>
<p><a target="_blank" rel="noopener" href="http://www.wanniertools.com/installation.html">http://www.wanniertools.com/installation.html</a></p>
<h3 id="安装依赖环境"><a href="#安装依赖环境" class="headerlink" title="安装依赖环境"></a>安装依赖环境</h3><p>1、Intel编译器即oneapi（Fortran compiler (Gfortran or ifort)，MPICH version higher than 2.1.5，Lapack and Blas library, (Intel MKL recommended)）</p>
<p>2、Arpack-ng</p>
<h3 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h3><p>下载wanniertools和arpack安装包并分别解压</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unzip wannier_tools-master.zip</span><br><span class="line">tar vzxf arpack96.tar.gz</span><br></pre></td></tr></table></figure>
<p>先进入arpack，修改编译文件并编译<br>在ARmake.inc中修改编译路径，这里以实际安装路径为准</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">home = $(HOME)/ARPACK</span><br></pre></td></tr></table></figure>
<p>修改编译器，参考VASP安装时的makefile.include</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FC=f77</span><br><span class="line">FFLAGS= -O -cg89</span><br></pre></td></tr></table></figure>

<p>改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FC         = mpiifort</span><br><span class="line">FCL        = mpiifort -mkl=sequential</span><br><span class="line">FFLAGS  = -O -cg89</span><br></pre></td></tr></table></figure>

<p>然后执行make编译</p>
<p>make lib</p>
<p>直至产生libarpack_SUN4.a文件，该文件会因为不同机器不同环境而不同名称，只要确定好，然后在编译wanniertools的时候指定好就行了</p>
<p>在wanniertools的src文件夹的makefile文件中该默认值为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#ARPACK LIBRARY</span><br><span class="line"></span><br><span class="line">ARPACK=/Users/quan/work/workplace/ARPACK/libarpack MAC.a</span><br></pre></td></tr></table></figure>
<p>修改为刚刚已经生成的文件路径，这里使用的是Makefile.intel-mpi，重命名为makefile</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp Makefile.intel-mpi Makefile</span><br></pre></td></tr></table></figure>
<p>然后编译即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>

<p>最后生成wt.x文件即为安装成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -f wt.x../bin</span><br></pre></td></tr></table></figure>
<h1 id="二、计算过程-以石墨烯为例"><a href="#二、计算过程-以石墨烯为例" class="headerlink" title="二、计算过程(以石墨烯为例)"></a>二、计算过程(以石墨烯为例)</h1><h2 id="1、结构优化加自洽计算"><a href="#1、结构优化加自洽计算" class="headerlink" title="1、结构优化加自洽计算"></a>1、结构优化加自洽计算</h2><p>POSCAR为<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Surf</span>-mp-<span class="number">48</span>                             </span><br><span class="line">   <span class="number">1.00000000000000</span>     </span><br><span class="line">     <span class="number">1.2344083195740001</span>   -<span class="number">2.1380573715510001</span>    <span class="number">0.0000000000000000</span></span><br><span class="line">     <span class="number">1.2344083195740001</span>    <span class="number">2.1380573715510001</span>    <span class="number">0.0000000000000000</span></span><br><span class="line">     <span class="number">0.0000000000000000</span>    <span class="number">0.0000000000000000</span>   <span class="number">12.0000000000000000</span></span><br><span class="line">   C </span><br><span class="line">     <span class="number">2</span></span><br><span class="line"><span class="title class_">Direct</span></span><br><span class="line">  <span class="number">0.0000000000000000</span>  <span class="number">0.0000000000000000</span>  <span class="number">0.5000000000000000</span></span><br><span class="line">  <span class="number">0.3333329999917112</span>  <span class="number">0.6666670000099160</span>  <span class="number">0.5000000000000000</span></span><br></pre></td></tr></table></figure><br>INCAR为</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">SYSTEM</span>=<span class="title class_">Graphene</span></span><br><span class="line"><span class="title class_">Global</span> <span class="title class_">Parameters</span></span><br><span class="line"><span class="variable constant_">ISTART</span> =  <span class="number">0</span>            (<span class="title class_">Read</span> existing wavefunction; <span class="keyword">if</span> there)</span><br><span class="line"><span class="variable constant_">ISPIN</span>  =  <span class="number">1</span>            (<span class="title class_">Non</span>-<span class="title class_">Spin</span> polarised <span class="variable constant_">DFT</span>)</span><br><span class="line"><span class="variable constant_">ICHARG</span> =  <span class="number">2</span>           (<span class="title class_">Non</span>-self-<span class="attr">consistent</span>: <span class="variable constant_">GGA</span>/<span class="variable constant_">LDA</span> band structures)</span><br><span class="line"><span class="variable constant_">LREAL</span>  = .<span class="property">FALSE</span>.       (<span class="title class_">Projection</span> <span class="attr">operators</span>: automatic)</span><br><span class="line"><span class="variable constant_">ENCUT</span>  =  <span class="number">500</span>          (<span class="title class_">Cut</span>-off energy <span class="keyword">for</span> plane wave basis set, <span class="keyword">in</span> eV)</span><br><span class="line"><span class="variable constant_">PREC</span>   =  A            (<span class="title class_">Precision</span> level)</span><br><span class="line"><span class="variable constant_">ADDGRID</span>= .<span class="property">TRUE</span>.        (<span class="title class_">Increase</span> grid; helps <span class="variable constant_">GGA</span> convergence)</span><br><span class="line"> </span><br><span class="line"><span class="title class_">Electronic</span> <span class="title class_">Relaxation</span></span><br><span class="line"><span class="variable constant_">ALGO</span> = N</span><br><span class="line"><span class="variable constant_">ISMEAR</span> =  <span class="number">0</span>            (<span class="title class_">Gaussian</span> smearing; <span class="attr">metals</span>:<span class="number">1</span>)</span><br><span class="line"><span class="variable constant_">SIGMA</span>  =  <span class="number">0.05</span>         (<span class="title class_">Smearing</span> value <span class="keyword">in</span> eV; <span class="attr">metals</span>:<span class="number">0.2</span>)</span><br><span class="line"><span class="variable constant_">NELM</span>   =  <span class="number">90</span>           (<span class="title class_">Max</span> electronic <span class="variable constant_">SCF</span> steps)</span><br><span class="line"><span class="variable constant_">NELMIN</span> =  <span class="number">6</span>            (<span class="title class_">Min</span> electronic <span class="variable constant_">SCF</span> steps)</span><br><span class="line"><span class="variable constant_">EDIFF</span>  =  <span class="number">1E-08</span>        (<span class="variable constant_">SCF</span> energy convergence; <span class="keyword">in</span> eV)</span><br><span class="line"> </span><br><span class="line"><span class="title class_">Ionic</span> <span class="title class_">Relaxation</span></span><br><span class="line"><span class="variable constant_">NSW</span>    =  <span class="number">0</span>            (<span class="title class_">Max</span> ionic steps)</span><br><span class="line"><span class="variable constant_">IBRION</span> = -<span class="number">1</span>            (<span class="title class_">Algorithm</span>: <span class="number">0</span>-<span class="variable constant_">MD</span>; <span class="number">1</span>-<span class="title class_">Quasi</span>-<span class="title class_">New</span>; <span class="number">2</span>-<span class="variable constant_">CG</span>)</span><br><span class="line"><span class="variable constant_">ISIF</span>   =  <span class="number">3</span>            (<span class="title class_">Stress</span>/<span class="attr">relaxation</span>: <span class="number">2</span>-<span class="title class_">Ions</span>, <span class="number">3</span>-<span class="title class_">Shape</span>/<span class="title class_">Ions</span>/V, <span class="number">4</span>-<span class="title class_">Shape</span>/<span class="title class_">Ions</span>)</span><br><span class="line"><span class="variable constant_">EDIFFG</span> = -<span class="number">2E-02</span>        (<span class="title class_">Ionic</span> convergence; eV/<span class="variable constant_">AA</span>)</span><br></pre></td></tr></table></figure>
<p>加SOC在自洽计算加上<br><code>LSORBIT=T</code></p>
<h2 id="2、非自洽计算投影能带"><a href="#2、非自洽计算投影能带" class="headerlink" title="2、非自洽计算投影能带"></a>2、非自洽计算投影能带</h2><p>在自洽计算基础上，<code>cp -r scf band</code><br>修改INCAR</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ISTART =  1         </span><br><span class="line">ICHARG =  11 </span><br><span class="line">LORBIT =  10/11</span><br></pre></td></tr></table></figure>
<p>KPOINTS 改为高对称点路径。</p>
<p>画一下能带结构，然后再做一下Fatband分析，了解费米面附近能带是有哪些成分构成的。以C的pz轨道。</p>
<h2 id="3、非自洽vasp产生-win文件"><a href="#3、非自洽vasp产生-win文件" class="headerlink" title="3、非自洽vasp产生.win文件"></a>3、非自洽vasp产生.win文件</h2><p>在自洽计算基础上 <code>cp -r scf wan1</code><br>修改INCAR</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ISTART =  1         </span><br><span class="line">ICHARG =  11 </span><br><span class="line">NBANDS = 40</span><br><span class="line">LWANNIER90 = .TRUE.</span><br><span class="line">NUM_WANN = 2</span><br></pre></td></tr></table></figure>
<p><strong>注意，INCAR中使用NPAR参数会出错</strong> </p>
<p>KPOINTS、POSCAR、POTCAR不改。</p>
<p>准备好wannier90.win文件，同时在INCAR里头添加一行LWANNIER90&#x3D;.TRUE.和一行ICHARG&#x3D;11，然后再运行一遍VASP。 顺利的话，会产生 <strong>wannier90.amn, wannier90.mmn, wannier90.eig, wannier90.chk</strong> 等4个文件。wannier90.win里头的内容也有可能会被改变。包括结构信息，k点信息。有了这三个文件就可以进一步调节参数，构造wannier函数了。请注意wannier90.win里头的num_bands要和OUTCAR里头的NBANDS一致。.mmn积分矩阵和.amn布洛赫态在轨道上的尝试投影和UNK0000x.1存储实空间单胞的布洛赫态相关信息，这些文件是运行链接wannier90的DFT计算输出的结果，而gaas.win是计算参数设置文件</p>
<h2 id="4、wannier90-x计算"><a href="#4、wannier90-x计算" class="headerlink" title="4、wannier90.x计算"></a>4、wannier90.x计算</h2><p>运行wannier90主程序。<code>mpirun -np 40 wannier90.x wannier90 &amp;</code></p>
<p><strong>注意在第3步打开<code>hr_plot = T</code>，关闭<code>write_hr = true</code>；在第4步打开<code>write_hr = true</code>，关闭<code>hr_plot = T</code>。</strong></p>
<p>这里后面一个winner90代表wannier90.win的文件.win前面的部分。如果你的win文件是name.win运行的地方就可以是</p>
<p><code>wannier90.x name &amp;</code></p>
<p>运行过程中当num_bands &gt; num_wann 有个迭代过程，控制迭代步数可以通过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dis_num_iter  =  200   # 迭代1，默认200步</span><br><span class="line">num_iter      =  200   # 迭代2，默认200步</span><br></pre></td></tr></table></figure>
<p>最后会生成wannier90.chk文件，restart计算会读取这个文件。</p>
<p>加入能带部分的话第一次运行就会出来，wannier90_band.dat文件，这个可以用来和DFT结果对比。<br>构造好Wannier函数以后，仔细检查一下wannier90.wout，<br>搜索”Final State”，在这里可以看到每条Wannier轨道的展宽，由此可以检查你构造的Wannier函数是否足够局域。如果有某个Wannier函数的展宽<br>比晶格常数大许多，就表明你的Wannier函数构造不是很理想，需要不断调节投影轨道，解纠缠窗口以及Frozen窗口等。从这些轨道的中心和展宽也能<br>看出轨道之间的简并性如何，由此也可以判断所构造的Wannier函数对称性如何，这个也会影响后续的分析，特别是表面态的计算。查看wannier90.wout末尾的Final State的最后一列小于3，其结果是可以的。</p>
<h2 id="5、"><a href="#5、" class="headerlink" title="5、"></a>5、</h2><p>紧接着，你就可以开始书写WannierTools的主输入文件了，<br>目前叫input.dat，以后会改成<a target="_blank" rel="noopener" href="http://wt.in/">http://wt.in</a> (WannierTools v2.2之后)。 这里不具体介绍每一个参数，在说明文档中有详细的介绍，中文版的说明文档正在翻译中。<br>input.dat文件有模板，使用的时候直接拷贝然后加以修改。很多内容都可以直接从wannier90.win和wannier90.wout中拷<br>贝。 Bi2Se3的主输入文件input.dat可以在附件中下载得到。我们可以通过控制输入文件中的一些参数来实现我们所需要的功能。</p>
<h1 id="常见报错"><a href="#常见报错" class="headerlink" title="常见报错"></a>常见报错</h1><ol>
<li><p>首先跑接口会生成3个文件.amm .mmm .eig通过这三个文件构造wannier函数。也可以提前把.win文件准备好放进去。以上三个文件生成后运行wannier90.x会成.chk文件</p>
</li>
<li><p>Restar&#x3D;T是需要读取.chk文件的</p>
</li>
</ol>
<p>Error: restart requested but wannier90.chkfile not found</p>
<p>原因：加了restart &#x3D; plot 这个命令，但却没有wannier90.chk这个文件。Restart是需要读取wannier90.chk的。</p>
<p>解决办法：注释掉restart &#x3D; plot，然后重新运行wannier90.x wannier90 &amp;得到wannier90.chk.</p>
<ol start="3">
<li>问题：Wannier90 is running in LIBRARY MODE</li>
</ol>
<p>Setting up k-point neighbours…</p>
<p>Ignoring <num_bands> in input file</p>
<p>解决办法：尽量串行，不要并行。请再次运行 $postw90 wannier90的为输出的数据</p>
<ol start="4">
<li><p>Spinors与文件INCAR中的ISPIN的设置有关，同时存在或者同时去掉，否则影响.amn文件的形成。（自旋轨道耦合）</p>
</li>
<li><p>谨慎用use_bloch_phases&#x3D;T一般是F</p>
</li>
<li><p>问题：param_read: mismatch in wannier90.eig</p>
</li>
</ol>
<p>解决办法：每一步计算的核数要相等</p>
<ol start="7">
<li>问题：dis_windows: More states in the forze window than target WFs</li>
</ol>
<p>解决办法：把dis_windows改大点</p>
<ol start="8">
<li>Fewer projections defined than the number of wannier functions requested.</li>
</ol>
<p>投影的轨道太少</p>
<p>解决办法：增加投影的轨道</p>
<ol start="9">
<li>Kmesh_get_bvector: Not enongh bevectors found</li>
</ol>
<p>解决办法：添加kemsh_tol</p>
<ol start="10">
<li>Wanted band:1 found band:17</li>
</ol>
<p>Wanted kpoint:2 found kpoint:1</p>
<p>解决办法：常见原因是num_bands设置错误，返回band计算文件夹查看NBANDS</p>
<ol start="11">
<li>Dis_windows: Energy window contains fewer states than number sf target WFs</li>
</ol>
<p>解决办法：把dis_windows改大点</p>
<ol start="12">
<li>Dis_windows: more states in the frozen window than WFs</li>
</ol>
<p>解决办法：调节frozen window, 投影太多或者这个窗口太大涉及到别的轨道</p>
<ol start="13">
<li>Wannier 运行有两种模式一是library mode，一种是单机模式stand-alone mode</li>
</ol>
<p>解决办法：library mode是需要进行串行。</p>
<ol start="14">
<li>param_get_projection: too many projections defined</li>
</ol>
<p>解决办法：begin projections random</p>
<p>原因：num_wann 与设置投影数不匹配。</p>
<p>解决办法：不加soc：num_wann 等于每种原子投影轨道数之和</p>
<p>soc：num_wann 等于两倍的每种原子投影轨道数之和</p>
<ol start="15">
<li><p>Gnuplot的报错信息”arc_bulk.gnu”, line 26: warning: No unsable data in this plot to auto-scale axis range</p>
</li>
<li><p>param_get_projection: Problem reading m state into string</p>
</li>
</ol>
<p>解决办法：已解决Fe: s;px;py;pz;dz2;dxz;dyz;dx2-y2;dxy</p>
<p>不是Fe:s;p;d</p>
<ol start="17">
<li>能带拟合的不好可能是因为，投影的不对，还有核数和能带数的关系</li>
</ol>
<p>解决办法：太马虎了，这样的问题肯定是K点写错了</p>
<p>能带布里渊区的宽度不一样有可能是wannier里规定的K点数并没有完全计算。</p>
<ol start="18">
<li>num_iter &#x3D; 2000 #wannier center 迭代次数</li>
</ol>
<p>num_print_cycles &#x3D; 40 #wannier center 迭代每40步输出一次</p>
<ol start="19">
<li><p>dis_num_iter &#x3D; 1200 #解纠缠的迭代步数#</p>
</li>
<li><p>num_iter最小化过程中的总迭代次数。如果您希望生成投影wf而不是最大本地化的wf，则设置num_iter&#x3D;0(请参阅教程中的示例8)？默认值为100</p>
</li>
<li><p>dis_mix_ratio &#x3D; 1.d0 # 0.5&lt;dis_mix_ratio&lt;1, 默认值0.5</p>
</li>
</ol>
<p>#在解纠缠过程中，要利用混合参数进行收敛，值为0.5是“安全”的选择。使用1.0(即不混合)通常会得到更快的收敛，但可能会导致 最小化，在某些情况下是不稳定的。</p>
<p>dis_conv_tol &#x3D; 1.0E-10 # Delta &lt; 1.000E-10 over 3 iterations</p>
<ol start="22">
<li>dis_win_max &#x3D; 15</li>
</ol>
<p>dis_froz_max &#x3D; 14</p>
<p>num_wan &#x3D; 12</p>
<p>exclude_bands : 1-11,26 #在使用这个参数时，num_bands &#x3D; 总能带数减去排除在外的能带数</p>
<p>num_bands &#x3D; 14</p>
<p>#如果使用能量窗口规定想要拟合的能带区间，需要同时使用这个几个参数</p>
<ol start="23">
<li><p>wannier_plot_supercell &#x3D;2 #在一个对应于“超胞”的网格上生成WFs</p>
</li>
<li><p>wannier_plot_list &#x3D;2 #列举要画出WFs的序号，与wannier center 的序号是一致的</p>
</li>
<li><p>运行接口的情况有三种，一是选择投影能带数发生了改变，二是，需要写入wannier90.win的输入文件；三是需要在INCAR添加关键参数，输出wannier.x需要的文件。（仅仅是调节能量窗口是不需要重新运行接口的）</p>
</li>
<li><p>无没有projection是肯定没有amn的</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-47-26/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-47-26/" class="post-title-link" itemprop="url">2.2 AMSET</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:47:26" itemprop="dateCreated datePublished" datetime="2023-05-09T18:47:26+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-06-05 10:12:33" itemprop="dateModified" datetime="2024-06-05T10:12:33+08:00">2024-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFT%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">DFT学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><a target="_blank" rel="noopener" href="https://github.com/hackingmaterials/Amset">https://github.com/hackingmaterials/Amset</a><br><a target="_blank" rel="noopener" href="https://hackingmaterials.lbl.gov/amset/">https://hackingmaterials.lbl.gov/amset/</a><br><a target="_blank" rel="noopener" href="https://www.nature.com/articles/s41467-021-22440-5.pdf">https://www.nature.com/articles/s41467-021-22440-5.pdf</a></p>
<p>劳伦斯·伯克利国家实验室Alex M. Ganose和Anubhav Jain开发了一种根据第一性原理输入来计算固态半导体和绝缘体载流子散射率的有效计算方法(AMSET)。本方法扩展了现有的极性和非极性电子-声子耦合、离子化杂质和基于各向同性能带结构的压电散射机制的公式以支持高度各向异性的材料。他们通过计算23种半导体的电子传输特性来测试这个公式，包括48个大原子$CH_3NH_3PbI_3$混合钙钛矿，并将结果与实验测量结果和更详细的散射模拟进行比较。相对于实验的斯皮尔曼迁移率秩系数（rs &#x3D; 0.93）与使用恒定弛豫时间近似值（rs &#x3D; 0.52）获得的结果相比有明显提高。他们发现，他们的方法可提供与最新技术类似的精度，而计算成本约为1&#x2F;500，因此可在高通量计算工作流程中使用，以精确筛选载流子迁移率、寿命和热电功率。</p>
<ul>
<li>Inputs obtainable from first-principles calculations. The primary input for AMSET is an uniform band structure calculation.</li>
<li>Scattering rates calculated in the Born approximation using common materials properties such as phonon frequencies and dielectric constants.</li>
<li>Transport properties calculated through the Boltzmann transport equation.</li>
<li>Efficient implementation that can run on a personal laptop.</li>
</ul>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>pymatgen&#x3D;&#x3D;2023.3.23<br>scipy&#x3D;&#x3D;1.10.1<br>monty&#x3D;&#x3D;2022.9.9<br>matplotlib&#x3D;&#x3D;3.7.1<br>BoltzTraP2&#x3D;&#x3D;22.12.1<br>tqdm&#x3D;&#x3D;4.65.0<br>tabulate&#x3D;&#x3D;0.9.0<br>memory_profiler&#x3D;&#x3D;0.61.0<br>spglib&#x3D;&#x3D;2.0.2<br>click&#x3D;&#x3D;8.1.3<br>sumo&#x3D;&#x3D;2.3.6<br>h5py&#x3D;&#x3D;3.8.0<br>pyFFTW&#x3D;&#x3D;0.13.0<br>interpolation&#x3D;&#x3D;2.2.4<br>numba&#x3D;&#x3D;0.56.4</p>
<h3 id="conda-environment"><a href="#conda-environment" class="headerlink" title="conda environment"></a>conda environment</h3><p>pip install amset</p>
<h3 id="Developer-Installation"><a href="#Developer-Installation" class="headerlink" title="Developer Installation"></a>Developer Installation</h3> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone <span class="attr">https</span>:<span class="comment">//github.com/hackingmaterials/amset.git</span></span><br><span class="line">cd amset</span><br><span class="line">pip install -e .</span><br></pre></td></tr></table></figure>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h3 id="Structural-relaxation"><a href="#Structural-relaxation" class="headerlink" title="Structural relaxation:"></a>Structural relaxation:</h3><p>“tight” calculation settings<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ADDGRID</span> = <span class="title class_">True</span>  </span><br><span class="line"><span class="variable constant_">EDIFF</span> = <span class="number">1E-8</span>   </span><br><span class="line"><span class="variable constant_">EDIFFG</span> = -<span class="number">5E-4</span>  </span><br><span class="line"><span class="variable constant_">PREC</span> = <span class="title class_">Accurate</span></span><br></pre></td></tr></table></figure></p>
<h3 id="Dense-uniform-band-structure-and-wave-function-coefficients"><a href="#Dense-uniform-band-structure-and-wave-function-coefficients" class="headerlink" title="Dense uniform band structure and wave function coefficients:"></a>Dense uniform band structure and wave function coefficients:</h3><p>2倍的K点密度，HSE06 is required，输出波函数，</p>
<figure class="highlight plaintext"><figcaption><span>wave ``` 得到</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">```wavefunction.h5 file ```</span><br><span class="line">### Elastic constants：</span><br><span class="line">&quot;tight&quot;relax   </span><br><span class="line"> ```javascript  &#123;.line-numbers&#125;  </span><br><span class="line"> NSW = 1  </span><br><span class="line"> IBRION = 6</span><br></pre></td></tr></table></figure>
<h3 id="Deformation-potentials："><a href="#Deformation-potentials：" class="headerlink" title="Deformation potentials："></a>Deformation potentials：</h3><p><code>amset deform create </code><br>single point calculation，<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">NSW</span> = <span class="number">1</span>   </span><br><span class="line"><span class="variable constant_">ICORELEVEL</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure><br><code>amset deform read undeformed def-1 def-2 def-3  </code><br>产生deformation.h5 file。</p>
<h3 id="Dielectric-constants-piezoelectric-constants-and-polar-phonon-frequency："><a href="#Dielectric-constants-piezoelectric-constants-and-polar-phonon-frequency：" class="headerlink" title="Dielectric constants, piezoelectric constants and polar-phonon frequency："></a>Dielectric constants, piezoelectric constants and polar-phonon frequency：</h3><p>DFPT方法，Note, DFPT cannot be used with hybrid exchange-correlation functionals. In these cases the LCALCEPS flag should be used in combination with  <code>IBRION = 6 </code></p>
 <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">NSW</span> = <span class="number">1</span></span><br><span class="line"><span class="variable constant_">IBRION</span> = <span class="number">8</span></span><br><span class="line"><span class="variable constant_">LEPSILON</span> = <span class="title class_">True</span></span><br></pre></td></tr></table></figure>

<p><code>amset phonon-frequency </code><br>读取DFPT的 vasprun.xml 获得 dielectric constants 和 polar phonon frequency。</p>
<h1 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h1><p>有两种方式，Python脚本<br>或者通过读取settings.yaml和输入文件加命令行运行</p>
<h2 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h2><p><code>cp path/example/Si/Si.py  .</code><br>脚本如下：</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">from</span> amset.<span class="property">core</span>.<span class="property">run</span> <span class="keyword">import</span> <span class="title class_">Runner</span></span><br><span class="line"><span class="keyword">from</span> amset.<span class="property">plot</span>.<span class="property">rates</span> <span class="keyword">import</span> <span class="title class_">RatesPlotter</span></span><br><span class="line">warnings.<span class="title function_">simplefilter</span>(<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line">settings = &#123;</span><br><span class="line">   #general settings</span><br><span class="line">   <span class="string">&quot;scattering_type&quot;</span>: [<span class="string">&quot;IMP&quot;</span>, <span class="string">&quot;ADP&quot;</span>],</span><br><span class="line">   <span class="string">&quot;doping&quot;</span>: [-<span class="number">1.99e14</span>, -<span class="number">2.20e15</span>, -<span class="number">1.72e16</span>, -<span class="number">1.86e17</span>, -<span class="number">1.46e18</span>, -<span class="number">4.39e18</span>],</span><br><span class="line">   <span class="string">&quot;temperatures&quot;</span>: [<span class="number">300</span>],</span><br><span class="line">   <span class="string">&quot;bandgap&quot;</span>: <span class="number">1.14</span>,</span><br><span class="line">   #electronic_structure settings</span><br><span class="line">   <span class="string">&quot;interpolation_factor&quot;</span>: <span class="number">50</span>,</span><br><span class="line">   #materials properties</span><br><span class="line">   <span class="string">&quot;deformation_potential&quot;</span>: <span class="string">&quot;deformation.h5&quot;</span>,</span><br><span class="line">   <span class="string">&quot;elastic_constant&quot;</span>: [</span><br><span class="line">       [<span class="number">144</span>, <span class="number">53</span>, <span class="number">53</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">       [<span class="number">53</span>, <span class="number">144</span>, <span class="number">53</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">       [<span class="number">53</span>, <span class="number">53</span>, <span class="number">144</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">       [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">75</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">       [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">75</span>, <span class="number">0</span>],</span><br><span class="line">       [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">75</span>],</span><br><span class="line">       [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">75</span>],</span><br><span class="line">   ],</span><br><span class="line">   <span class="string">&quot;static_dielectric&quot;</span>: [[<span class="number">11.7</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">11.7</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">11.7</span>]],</span><br><span class="line">   <span class="string">&quot;high_frequency_dielectric&quot;</span>: [[<span class="number">11.7</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">11.7</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">11.7</span>]],</span><br><span class="line">   #performance settings</span><br><span class="line">   <span class="string">&quot;write_mesh&quot;</span>: <span class="title class_">True</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">   runner = <span class="title class_">Runner</span>.<span class="title function_">from_vasprun</span>(<span class="string">&quot;vasprun.xml&quot;</span>, settings)</span><br><span class="line">   amset_data = runner.<span class="title function_">run</span>()</span><br><span class="line"></span><br><span class="line">   plotter = <span class="title class_">RatesPlotter</span>(amset_data)</span><br><span class="line">   plt = plotter.<span class="title function_">get_plot</span>()</span><br><span class="line">   plt.<span class="title function_">savefig</span>(<span class="string">&quot;Si_rates.png&quot;</span>, bbox_inches=<span class="string">&quot;tight&quot;</span>, dpi=<span class="number">400</span>)</span><br></pre></td></tr></table></figure>

<p>python Si.py 即可</p>
<h2 id="命令行设置"><a href="#命令行设置" class="headerlink" title="命令行设置"></a>命令行设置</h2><p>需要准备settings.yaml文件：以Si为例：</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> # general settings</span><br><span class="line"> <span class="attr">scattering_type</span>: [<span class="variable constant_">IMP</span>, <span class="variable constant_">ADP</span>]</span><br><span class="line"> <span class="attr">doping</span>: [-<span class="number">1.99e14</span>, -<span class="number">2.20e15</span>, -<span class="number">1.72e16</span>, -<span class="number">1.86e17</span>, -<span class="number">1.46e18</span>, -<span class="number">4.39e18</span>]</span><br><span class="line"> <span class="attr">temperatures</span>: [<span class="number">300</span>]</span><br><span class="line"> <span class="attr">bandgap</span>: <span class="number">1.14</span></span><br><span class="line"></span><br><span class="line"> # electronic_structure settings</span><br><span class="line"> <span class="attr">interpolation_factor</span>: <span class="number">50</span></span><br><span class="line"></span><br><span class="line"> # materials properties</span><br><span class="line"> <span class="attr">deformation_potential</span>: deformation.<span class="property">h5</span></span><br><span class="line"> <span class="attr">elastic_constant</span>:</span><br><span class="line">  - [<span class="number">144</span>,  <span class="number">53</span>,  <span class="number">53</span>,  <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">0</span>]</span><br><span class="line">  - [ <span class="number">53</span>, <span class="number">144</span>,  <span class="number">53</span>,  <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">0</span>]</span><br><span class="line">  - [ <span class="number">53</span>,  <span class="number">53</span>, <span class="number">144</span>,  <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">0</span>]</span><br><span class="line">  - [  <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, <span class="number">75</span>,  <span class="number">0</span>,  <span class="number">0</span>]</span><br><span class="line">  - [  <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">0</span>, <span class="number">75</span>,  <span class="number">0</span>]</span><br><span class="line">  - [  <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">0</span>, <span class="number">75</span>]</span><br><span class="line"><span class="attr">static_dielectric</span>:</span><br><span class="line">  - [<span class="number">11.7</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">  - [<span class="number">0</span>, <span class="number">11.7</span>, <span class="number">0</span>]</span><br><span class="line">  - [<span class="number">0</span>, <span class="number">0</span>, <span class="number">11.7</span>]</span><br><span class="line"><span class="attr">high_frequency_dielectric</span>:</span><br><span class="line">  - [<span class="number">11.7</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">  - [<span class="number">0</span>, <span class="number">11.7</span>, <span class="number">0</span>]</span><br><span class="line">  - [<span class="number">0</span>, <span class="number">0</span>, <span class="number">11.7</span>]</span><br><span class="line"> #performance settings</span><br><span class="line"> <span class="attr">write_mesh</span>: <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>amset run –directory path&#x2F;to&#x2F;files 运行即可<br>其他设置可以通过命令行加入：<br>amset run –interpolation-factor 20<br>画图：<br>amset plot rates mesh_99x99x99.h5</p>
<p>Output filesThe transport results will be written to <code>transport_99x99x99.json</code>. The <code>99x99x99</code> is thefinal interpolated mesh upon which scattering rates and the transport properties arecomputed.The <code>write_mesh</code> option is set to True, meaning scattering rates for all doping levelsand temperatures will be written to the <code>mesh_99x99x99.h5</code> file.</p>
<h2 id="设置相关参数："><a href="#设置相关参数：" class="headerlink" title="设置相关参数："></a>设置相关参数：</h2><h3 id="General-settings"><a href="#General-settings" class="headerlink" title="General settings"></a>General settings</h3><ol>
<li>scattering_type：Default:  <code>auto </code>；单独设置： <code>ADP,IMP,POP </code>。<br>ADP (acoustic deformation potential scattering)<br>IMP (ionized impurity scattering)<br>PIE (piezoelectric scattering)<br>POP (polar optical phonon scattering)<br>CRT (constant relaxation time)<br>MFP (mean free path scattering)</li>
<li>doping：负值代表电子，正值代表空穴<br>Default:  <code>[&#39;1.e15&#39;, &#39;1.e16&#39;, &#39;1.e17&#39;, &#39;1.e18&#39;, &#39;1.e19&#39;, &#39;1.e20&#39;, &#39;-1.e15&#39;, &#39;-1.e16&#39;, &#39;-1.e17&#39;, &#39;-1.e18&#39;, &#39;-1.e19&#39;, &#39;-1.e20&#39;] </code><br>单独设置有两种： <code>1E13,1E14,1E15,1E16,1E17,1E18,1E19,1E20 </code> 或者  <code>1E13:1E20:8 </code></li>
<li>temperatures：Default: [300]<br>单独设置：<code>300,400,500,600,700,800,900,1000</code> 或者<code>300:1000:8</code></li>
<li>interpolation_factor：Default: 10<br>控制插值密度，最终的k点等于能带计算的k点乘上插值因子。</li>
<li>wavefunction_coefficients：Default: wavefunction.h5<br>波函数系数读取的方式，产生该文件可以通过<code>amset wave</code>获得。</li>
<li>bandgap：<br>设置该参数会自动采用scissor修正，因此不能与<code>scissor</code>选项共用，且对金属不起作用。</li>
<li>scissor：<br>正值代表带隙打开，负值代表缩小，对金属无效。</li>
<li>zero_weighted_kpoints：<br>设置方式：<br>keep: Keep zero-weighted k-points in the band structure.<br>drop: Drop zero-weighted k-points, keeping only the weighted k-points.<br>prefer: Drop weighted-kpoints if zero-weighted k-points are present in the calculation (useful for cheap hybrid calculations).</li>
<li>use_projections：Default: False<br>不建议设置。该参数使用投影计算波函数交叠，往往导致差的性能，使用时设置<code>LORBIT = 11</code></li>
<li>free_carrier_screening：Default: False<br>控制是否屏蔽极化光学声子和压电散射率。这可以导致在高载流子浓度下散射率的大幅度降低。</li>
</ol>
<h3 id="Material-settings"><a href="#Material-settings" class="headerlink" title="Material settings"></a>Material settings</h3><ol start="11">
<li>high_frequency_dielectric：Required for: POP, PIE</li>
<li>static_dielectric：Required for: IMP, POP</li>
<li>elastic_constant：Required for: ADP, PIE</li>
<li>deformation_potential：Required for: ADP</li>
<li>piezoelectric_constant：Required for: PIE</li>
<li>defect_charge：Required for: IMP。Default: 1</li>
<li>pop_frequency：Required for: POP    <code>amset phonon-frequency</code>获得。</li>
<li>compensation_factor：Required for: IMP    Default: 2</li>
<li>mean_free_path：Required for: MFP</li>
<li>constant_relaxation_time：Required for: CRT  不建议和其他散射机制设置。</li>
</ol>
<h3 id="Performance-settings：控制速度和精度，一般默认。"><a href="#Performance-settings：控制速度和精度，一般默认。" class="headerlink" title="Performance settings：控制速度和精度，一般默认。"></a>Performance settings：控制速度和精度，一般默认。</h3><ol start="21">
<li>energy_cutoff：Default: 1.5</li>
<li>fd_tol：Default: 0.05. 0-1之间，越小计算K点越多。</li>
<li>dos_estep:Default: 0.01.越小越好越贵。</li>
<li>symprec：Default: 0.01。</li>
<li>nworkers：Default: -1。代表用所有的机器。其他设置代表几个。</li>
<li>cache_wavefunction：Default: True。加速计算，增加内存。如果内存不够关闭。</li>
</ol>
<h3 id="Output-settings：输出文件设置"><a href="#Output-settings：输出文件设置" class="headerlink" title="Output settings：输出文件设置"></a>Output settings：输出文件设置</h3><ol start="27">
<li>calculate_mobility：Default: True。是否计算n&#x2F;p载流子迁移率。</li>
<li>separate_scattering_mobilities：Default: True。是否计算单独的散射机制的迁移率。</li>
<li>write_mesh：Default: False。是否将全K点结果写入磁盘。对于大的interpolation_factor可以打开。</li>
<li>file_format：Default: json。输出文件的格式：json, yaml, and txt.对于write_mesh&#x3D;True不能用TXT。</li>
<li>write_input：Default: False。是否将输入设置写入<code>amset_settings</code>.yaml.</li>
<li>print_log：Default: True。是否输出日志。</li>
</ol>
<h2 id="Summary-of-scattering-rates"><a href="#Summary-of-scattering-rates" class="headerlink" title="Summary of scattering rates"></a>Summary of scattering rates</h2><table>
<thead>
<tr>
<th>Mechanism</th>
<th>Code</th>
<th>Requires</th>
<th>Type</th>
</tr>
</thead>
<tbody><tr>
<td>Acoustic deformation potential scattering</td>
<td>ADP</td>
<td>n- and p-type deformation potential, elastic constant</td>
<td>Elastic</td>
</tr>
<tr>
<td>Piezoelectric scattering</td>
<td>PIE</td>
<td>high-frequency dielectric constant, elastic constant, piezoelectric coefficient (e)</td>
<td>Elastic</td>
</tr>
<tr>
<td>Polar optical phonon scattering</td>
<td>POP</td>
<td>polar optical phonon frequency, static and high-frequency dielectric constants</td>
<td>Inelastic</td>
</tr>
<tr>
<td>Ionized impurity scattering</td>
<td>IMP</td>
<td>static dielectric constant</td>
<td>Elastic</td>
</tr>
</tbody></table>
<h1 id="其他功能"><a href="#其他功能" class="headerlink" title="其他功能"></a>其他功能</h1><p>you can use amset which relies on Fourier interpolation of the band<br>structure using BoltzTraP2. There are two options.</p>
<ul>
<li>Use <code>amset eff-mass</code>: This calculates the conductivity effective mass as defined here: <a target="_blank" rel="noopener" href="https://www.nature.com/articles/s41524-017-0013-3">https://www.nature.com/articles/s41524-017-0013-3</a></li>
<li>Use <code>amset plot band --stats vasprun.xml</code>: This calculates the effective mass in the same way as sumo but using a band structure interpolated from a uniform calculation.</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-47-25/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-47-25/" class="post-title-link" itemprop="url">2.1 电子性质1</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:47:25" itemprop="dateCreated datePublished" datetime="2023-05-09T18:47:25+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-12-13 20:40:25" itemprop="dateModified" datetime="2024-12-13T20:40:25+08:00">2024-12-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFT%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">DFT学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="自洽计算"><a href="#自洽计算" class="headerlink" title="自洽计算"></a>自洽计算</h1><p><strong>VASP做静态自洽的目的主要是为了得到好的电子密度和波函数文件，为了使后续的性质计算可以读取电子密度和波函数，进而增加收敛速度。</strong><br>首先进行 <strong>高精度</strong> 的结构优化。然后复制文件， cp CONTCAR POSCAR 做一次自洽计算。<br>自洽计算要求有密的k网格点，在计算条件允许的情况下要求自洽的k网格点大致为优化时的2倍左右。<br>修改标签<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">IBRION</span>=-<span class="number">1</span></span><br><span class="line"><span class="variable constant_">NSW</span>=<span class="number">0</span></span><br><span class="line"><span class="variable constant_">LWAVE</span>  = .<span class="property">T</span>.        (<span class="title class_">Write</span> <span class="variable constant_">WAVECAR</span> )</span><br><span class="line"><span class="variable constant_">LCHARG</span> = .<span class="property">T</span>.        (<span class="title class_">Write</span> <span class="variable constant_">CHGCAR</span> )</span><br></pre></td></tr></table></figure><br>这一步完成后的输出文件CHGCAR即是电荷密度，导入VESTA直接查看。</p>
<h2 id="bader电荷"><a href="#bader电荷" class="headerlink" title="bader电荷"></a>bader电荷</h2><p>自洽时INCAR再加一个参数：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">IBRION</span>=-<span class="number">1</span></span><br><span class="line"><span class="variable constant_">NSW</span>=<span class="number">0</span></span><br><span class="line"><span class="variable constant_">LAECHG</span>=.<span class="property">T</span>.</span><br></pre></td></tr></table></figure></p>
<p>输出文件：<br>AECCAR0 全电子中的芯电子部分（POTCAR）<br>AECCAR1 自洽计算前的交叠原子电荷（POTCAR，bader 分析不用）<br>AECCAR2 全电子中的价电子部分（自洽计算后）<br>CHGCAR 自洽计算后赝电子</p>
<p>输入：</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chgsum.<span class="property">pl</span> <span class="title class_">AECCAR0</span> <span class="title class_">AECCAR2</span></span><br><span class="line">bader <span class="variable constant_">CHGCAR</span> -ref CHGCAR_sum</span><br></pre></td></tr></table></figure>
<p>得到两个文件：</p>
<ul>
<li><strong>BCF.dat</strong> 电荷极大值序号和坐标<br>体积内的 Bader 电荷（积分）<br>距离极大值最近的原子和距离</li>
<li><strong>ACF.dat</strong> 原子序号和坐标<br>原子电荷（极大值的电荷之后）<br>到零通量面最小距离<br>原子体积</li>
</ul>
<p>李强博士《learn vasp the hard way》<a target="_blank" rel="noopener" href="https://www.bigbrosci.com/2011/12/24/A08/">https://www.bigbrosci.com/2011/12/24/A08/</a> Bader电荷与原子电荷着色：<br><a target="_blank" rel="noopener" href="https://www.bigbrosci.com/2011/12/23/A07/">https://www.bigbrosci.com/2011/12/23/A07/</a> <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/BNzjhz8SI_HXkaEnyL29Bg">https://mp.weixin.qq.com/s/BNzjhz8SI_HXkaEnyL29Bg</a></p>
<h2 id="成键反键"><a href="#成键反键" class="headerlink" title="成键反键"></a>成键反键</h2><p>自洽时添加：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">NBANDS</span>=<span class="number">96</span></span><br><span class="line"><span class="variable constant_">ISYM</span>=-<span class="number">1</span></span><br><span class="line"><span class="variable constant_">IBRION</span>=-<span class="number">1</span></span><br><span class="line"><span class="variable constant_">NSW</span>=<span class="number">0</span></span><br><span class="line"><span class="variable constant_">LWAVE</span> = T</span><br></pre></td></tr></table></figure></p>
<p><code>vi lobsterin</code><br>原子编号改为自己的，例如</p>
<p>lobsterin：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">COHPstartEnergy  -14</span><br><span class="line">COHPendEnergy     6   </span><br><span class="line">basisSet Bunge</span><br><span class="line">basisfunctions Ga 4s 4p 3d</span><br><span class="line">basisfunctions As 4s 4p</span><br><span class="line"></span><br><span class="line">cohpbetween atom 1 and atom 2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>前两行代表提取的能量范围；第三行代表选择的基组，如果不设置(空行)就是默认基组，如果要覆盖默认基集，可使用此关键字进行覆盖。它目前支持bunge、koga和pbeVaspFit2015；第四行代表为每个元素指定所使用的基函数；最后一行代表选择一对两个原子进行键合分析。</p>
<p><code>lobster &lt; lobsterin</code></p>
<p>1、删除存在的WAVECAR文件，做单点计算，计算需要保存波函数文件；<br>2、做完单点计算在当前目录下运行lobster软件；<br>3、用wxDragon软件打开COHPCAR.lobster文件。<br>4、COHPCAR.lobster 文件包含COHP结果，第二列为pCOHP，将第二列乘-1可得-pCOHP<br><a target="_blank" rel="noopener" href="https://github.com/JaGeo/LobsterPy">https://github.com/JaGeo/LobsterPy</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/470592188">https://zhuanlan.zhihu.com/p/470592188</a></p>
<p>注：</p>
<ul>
<li>orbitalWise 这个参数一般加在cohpBetween或者cohpGenerator之后，用以把原子之间的相互作用具体分到s p d 这些轨道上，比如计算s-s, p-p, d-d之间的pCOOP, pCOHP；<br>比如：<code>cohpBetween atom 1 atom 2 orbitalWise</code></li>
</ul>
<p><code>cohpGenerator from 1.4 to 1.5 type Ga type Sr orbitalWise</code></p>
<ul>
<li><p>不要使用US-PP超软赝势，使用PAW赝势；请使用vasp_std版本，不要使用vasp_gam<br>；不支持处理对称:ISYM&#x3D;0或ISYM&#x3D;-1</p>
</li>
<li><p>由于需要把基于平面波的波函数投影到原子轨道的基函数上，所以计算的能带的数量要多于投影的基函数，VASP计算的时候，默认的NBANDS达不到要求，需要加大NBANDS，只要查看OUTCAR里面的NBANDS多少，<code>grep NBANDS OUTCAR</code>；在INCAR里面，NBANDS关键词设置成1.5倍NBANDS，足以满足计算的投影要求，在计算过程中一定要记住设置足够的NBANDS，否则会出现报错，一直不能正常算出COHP</p>
</li>
<li><p>cohpGenerator 这里通过距离或者元素类别告诉想要计算什么原子之间的COHP；<code>cohpGenerator from 1.5 to 2.3 type Fe type N orbitalwise</code>  #输出Fe-N原子对距离在1.5到2.3的所有数据之和。</p>
</li>
<li><p>gaussianSmearingWidth 高斯展宽，如果VASP中用的ISMEAR&#x3D;0，那么gaussianSmearingWidth的数值和SIGMA一样，默认值是0.2 eV，但是过大了，所以需要减小。设置格式：<code>gaussianSmearingWidth 0.05</code></p>
</li>
</ul>
<h2 id="ELF电子局域函数计算"><a href="#ELF电子局域函数计算" class="headerlink" title="ELF电子局域函数计算"></a>ELF电子局域函数计算</h2><p>电子局域函数（Electron Localization Function—ELF）是研究电子结构的手段之一。用来描述以某个位置处的电子为参考，在其附近找到与他同自旋的电子的概率，可以表征这个作为参考的电子的局域化程度，也是一种描述在多电子体系中的电子对概率的方法。<br>ELF的取值范围是[0，1]。<br>ELF&#x3D;1 对应完全局域化；<br>ELF&#x3D;1&#x2F;2，对应类电子气型的成对概率；<br>ELF&#x3D;0，对应电子完全离域化。</p>
<p>计算流程：做自洽的时候在INCAR中加入：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">PREC</span>=A</span><br><span class="line"><span class="variable constant_">LELF</span>=T</span><br><span class="line"><span class="variable constant_">IBRION</span>=-<span class="number">1</span></span><br><span class="line"><span class="variable constant_">NSW</span>=<span class="number">0</span> </span><br></pre></td></tr></table></figure><br>运行vasp得到ELFCAR文件。</p>
<p>将ELFCAR拖入Vesta <a target="_blank" rel="noopener" href="http://www.jp-minerals.org/vesta/en/download.html">http://www.jp-minerals.org/vesta/en/download.html</a></p>
<p>点击 Utiltties - 2D Data Display。<br>点击Slice，确定切面和fractional coordinates。<br>导出图片：之后可以用PS工具将原子模型加入。</p>
<h2 id="费米面"><a href="#费米面" class="headerlink" title="费米面"></a>费米面</h2><p>费米面计算，这里我们以Cu为例，见vaspkit&#x2F;examples&#x2F;Cu_fermi_surface。<br>第一步，准备好POSCAR，注意一定是原胞（primitive cell ）和用于静态计算的INCAR文件；<br>第二步，运行VASPKIT，输入261命令，产生用于计算计算费米面的KPOINTS和POTCAR文件，<br>第三步，提交VASP作业；第四步，待VASP计算完成后，再次运行VASPKIT，输入262命令，生成包含费米面数据的FERMISURFACE.bxsf文件；第五步，运行XcrySDen软件。<br>发现第五条能带穿过费米面，因此我们选择Band Number 5，然后点击Selected，然后得到Cu的费米面。推荐使用FermiSurfer可视化费米面。<br>对于半导体不存在费米面，如果想可视化导带或价带中某个能级处的等能面，新建FERMI_ENERGY.in文件然后在该文件第二行（第一行为注释行）中人为指定能级大小，注意该值一定要保证穿过价带或导带。接下来调用vaspkit-252或263命令提取可视化。</p>
<h2 id="STM模拟"><a href="#STM模拟" class="headerlink" title="STM模拟"></a>STM模拟</h2><p>参考：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/538950799">https://zhuanlan.zhihu.com/p/538950799</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/667558468">https://zhuanlan.zhihu.com/p/667558468</a></p>
<p><a target="_blank" rel="noopener" href="https://www.vasp.at/wiki/index.php/STM_of_graphite">https://www.vasp.at/wiki/index.php/STM_of_graphite</a></p>
<ol>
<li><p>首先做一个自洽计算，输出 WAVECAR 和 CHGCAR 文件。</p>
</li>
<li><p>加入一些特殊参数计算，输出我们想要的 PARCHG 文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LPARD = .TRUE.</span><br><span class="line">LSEPK = .FALSE.</span><br><span class="line">LSEPB = .FALSE.</span><br><span class="line">NBMOD = -3</span><br><span class="line">EINT = -0.1 0.1</span><br></pre></td></tr></table></figure></li>
<li><p>用p4vasp软件打开PARCHG文件或者vaspkit 后处理。由于 VASP 在对于远离原子表面时波函数的衰减指数描述不明确，所以模拟探针高度的时候不应该太高，否则会出现非物理的现象，比如 7 埃，就算比较远了。所以一般高度的选择要接近材料表面，这里选择了 0.5 埃。而原胞沿着 ab 平面重复的标准是 20 埃，也就是说原胞晶格 * 重复单元 &#x3D; 20 埃就可以。vaspkit 里选择的是 Tersoff-Hamman 方法，现在大多数模拟 STM 的都是选择这个方法。</p>
</li>
<li><p>vaspkit处理后的输出文件包括X.grd, Y.grd, STM_*.grd三个文件，可以用以下脚本画图。<br>Usage: python plot.pyimport numpy as npimport matplotlib as mpl#mpl.use(‘Agg’) #silent modefrom matplotlib import pyplot as plt<br>x_mesh&#x3D;np.loadtxt(‘X.grd’)      y_mesh&#x3D;np.loadtxt(‘Y.grd’)   v_mesh&#x3D;np.loadtxt(‘STM.grd’)<br>fig &#x3D; plt.figure()cmap &#x3D; plt.cm.get_cmap(“Greys_r”) plt.contourf(x_mesh,y_mesh,v_mesh,cmap&#x3D;cmap)<br>plt.axis(‘equal’)plt.axis(‘off’)#plt.show()plt.savefig(“STM.jpg”,dpi&#x3D;300)<br>或者用以下脚本处理后，得到data.txt文件，将该文件导入origin画图。Usage: sh get_data.shawk ‘{for(i&#x3D;1;i&lt;&#x3D;NF;i++) print $i}’ X.grd &gt;xawk ‘{for(i&#x3D;1;i&lt;&#x3D;NF;i++) print $i}’ Y.grd &gt;yawk ‘{for(i&#x3D;1;i&lt;&#x3D;NF;i++) print $i}’ STM_0.50.grd &gt;spaste x y s &gt;data.txt</p>
</li>
</ol>
<h1 id="态密度"><a href="#态密度" class="headerlink" title="态密度"></a>态密度</h1><p>自洽计算之后，读取产生的CHGCAR、WAVECAR<br>上面例如bader电荷、ELF标签都关闭。<br>INCAR中修改：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ISTART</span>=<span class="number">1</span></span><br><span class="line"><span class="variable constant_">ICHARG</span>=<span class="number">11</span></span><br><span class="line"><span class="variable constant_">ISMEAR</span>=-<span class="number">5</span></span><br><span class="line"><span class="variable constant_">NEDOS</span>=<span class="number">2001</span></span><br><span class="line"><span class="variable constant_">LORBIT</span>=<span class="number">11</span></span><br></pre></td></tr></table></figure><br><strong>其他参数和自洽时保持一致。</strong><br>运行后vaspkit的111&#x2F;112&#x2F;113&#x2F;114命令处理即可得到。</p>
<h2 id="分波态密度和局域态密度"><a href="#分波态密度和局域态密度" class="headerlink" title="分波态密度和局域态密度"></a>分波态密度和局域态密度</h2><p>态密度很多分析和能带的分析结果可以一一对应，很多术语也和能带分析相通。但是因为它更直观，因此在结果讨论中用得比能带分析更广泛一些。在电子能级为准连续分布的情况下，单位能量间隔内的电子态数目，即为态密度。能态密度与能带结构密切相关，是一个重要的基本函数。固体的许多特性，如电子比热、光和X射线的吸收和发射等，都与能态密度有关。在VASP中，LORBIT&#x3D;10计算的就是LDOS，也就是每个原子的局域态密度 (local DOS)，是分解到每个原子上面的s,p,d；LORBIT&#x3D;11，计算的就是PDOS,投影态密度(projected DOS)或分波态密度(partial DOS)，不仅分解到每个原子的s,p,d,而且还进行px,py,pz分解。</p>
<p>在 <code>/vaspkit.0.72/examples/LDOS_PDOS/Partial_DOS_of_CO_on_Ni_111_surface </code>目录下启动 <code>vaspkit </code>，输入命令 <code>115 </code>选择子功能 <code>The Sum of Projected DOS for Selected Atoms and orbitals </code>。我们需要提取的是O的s，p轨道，C的s，p轨道以及表面的dxy和d3z2-r2(dz2)轨道。首先提示你选择元素（累加），第一次输入元素O，回车后提示你输入提取的轨道名（累加），第一次输入轨道s。回车后重复以上两个操作。如果想结束输入，在元素选择行直接按回车键结束输入。</p>
<p>元素行接受自由格式输入，你可以输入以下内容元素行接受自由格式输入，你可以输入以下内容<code>1-3 4 Ni</code>表示选择元素1,2,3,4和Ni元素的PDOS进行累加。轨道行只支持标准输入，如果使用了<code>LORBIT=10</code>不投影轨道，你只能选择 s p d f中的一个或多个，如果使用了<code>LORBIT=11</code>投影了轨道，你可以从s p d f和s py pz px dxy dyz dz2 dxz dx2 f-3 f-2 f-1 f0 f1 f2 f3中选择一个或多个输入。轨道行还支持输入all计算所有轨道的DOS之和。</p>
<p>比如元素行输入C O ,对应的轨道选择s px，那么提取的就是所有C和O元素的s轨道和px轨道的PDOS之和。 PDOS_USER.dat中的轨道名 为#Energy C&amp;O_s&amp;px，显而易懂。</p>
<h2 id="电荷密度差"><a href="#电荷密度差" class="headerlink" title="电荷密度差"></a>电荷密度差</h2><p>Vaspkit 可以方便的处理 VASP 输出的电荷密度文件 (CHGCAR)，做电荷密度差分处理，VTST 脚本或者 VESTA 也可以做，但是不如 vaspkit方便灵活。<br>注：此文中讲述的功能同样适用于任何的实空间函数形式的文件处理，比如静电势差值图 (LOCPOT)，电子定域化函数差值图 (ELFCAR)，能带分解的电荷密度插值图 (PARCHG) 等等。<br>电荷密度差分（charge density difference）是研究电子结构的重要手段之一。可以直观的得到两个片段相互作用后的电子流向，原子形成分子过程中电子密度的变化、探究化学键的本质。电荷密度差分有以下几种形式：<br>（1）体系的电荷密度减去组成它的两个或几个片段的密度，也是最常见的电荷密度差分形式：</p>
<p>（2）自洽计算收敛以后体系的电荷密度减去该原子构型下每个原子的球对称的电荷密度(即初猜电荷密度)，也称为变形电荷密度(Deformation charge density)</p>
<p>（3）在某个状态的密度减去这个体系在另外一个状态的密度。比如：外加电场作用下的电荷密度减去没有外势场的电荷密度。再比如：激发态的密度减去它在基态时的密度。</p>
<p><strong>以上三种电荷密度差，无论哪一种计算都需要保证原子坐标坐标必须一致！并且保证晶胞参数和 FFT-mesh 的格点密度 (NGXF, NGYF, NGZF) 一致！</strong></p>
<p>(1) 的计算只需要优化 AB 的结构，A、B片段保持 AB 结构中原子坐标，不能再对片段进行单独优化。<br>(2) 只要优化自洽计算时候的几何结构，生成原子的球对称的电荷密度时候 (ICHARG &#x3D; 12) 保持坐标不变。<br>(3) 也需要共用其中一个状态的几何构型（比如激发态或基态的几何构型）。</p>
<h3 id="CHGCAR文件格式"><a href="#CHGCAR文件格式" class="headerlink" title="CHGCAR文件格式"></a>CHGCAR文件格式</h3><p>CHGCAR 是包含电子密度信息的格点文件，对于自旋非极化体系（ISPIN &#x3D; 1）计算只包含电荷密度，对于自旋极化体系（ISPIN &#x3D; 2）计算还包含自旋电子密度。可以用 VESTA，Jmol 等程序打开。CHGCAR 的第一部分和 POSCAR, CONTCAR 的格式是完全一样的，它包含了最终结构的晶格矢量，原子核坐标等信息。紧接着是三个数字，这三个数是实空间函数的网格密度，对应于 NGXF，NGYF，NGZF 三个变量。然后是电荷密度信息 ρ(r) * Vcell。一共有 NGXF * NGYF * NGZF 个数值。比如：下面是一个 Al2O3 晶胞的 CHGCAR 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Al2O3 Cell opt                          </span><br><span class="line">  1.00000000000000     </span><br><span class="line">    6.138452   0.000551   -0.011568</span><br><span class="line">    5.434311   2.854620   -0.011568</span><br><span class="line">  -1.324042   -0.326661   5.501689</span><br><span class="line">  O   Al</span><br><span class="line">    6     4</span><br><span class="line">Direct</span><br><span class="line">0.160314 0.160314 0.108934</span><br><span class="line">0.839686 0.839686 0.891066</span><br><span class="line">0.495028 0.495028 0.257399</span><br><span class="line">0.504972 0.504972 0.742601</span><br><span class="line">0.826429 0.826429 0.432705</span><br><span class="line">0.173571 0.173571 0.567295</span><br><span class="line">0.090130 0.090130 0.795615</span><br><span class="line">0.909870 0.909870 0.204385</span><br><span class="line">0.342109 0.342109 0.683236</span><br><span class="line">0.657891 0.657891 0.316764</span><br><span class="line">100 100   96</span><br><span class="line">0.43432567054E+01 0.44027037758E+01 0.45822813500E+01 0.48861003640E+01 0.53223812855E+01</span><br><span class="line">0.59054783755E+01 0.66583226816E+01 0.76145085758E+01 0.88190771181E+01 0.10327304760E+02</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="Vaspkit计算几个片段的电荷密度差"><a href="#Vaspkit计算几个片段的电荷密度差" class="headerlink" title="Vaspkit计算几个片段的电荷密度差"></a>Vaspkit计算几个片段的电荷密度差</h4><p>以 CO 分子吸附在 Ni(100)  表面为例：<br>步骤一：优化 CO&#x2F;Ni(100) 的结构；<br>步骤二：分别计算 Ni(100) 和 CO 的单点能 CO 和 Ni(100) 片段的坐标从 CO&#x2F;Ni(100) 的 CONTCAR 里直接截取，不要再结构优化！！计算时也要保证三次自洽计算所采用的 FFT mesh  一致（NGXF,NGYF,NGZF）<br>步骤三：用 vaspkit 314 功能做电荷差分。依次输入三个片段的 CHGCAR 路径:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">314   </span><br><span class="line">======== File Options ========</span><br><span class="line">Input the Names of Charge/Potential Files with Space: </span><br><span class="line">(e.g., to get AB-A-B, type: ~/AB/CHGCAR ./A/CHGCAR ../B/CHGCAR)</span><br><span class="line">(e.g., to get A-B, type: ~/A/CHGCAR ./B/CHGCAR)</span><br><span class="line"></span><br><span class="line">------------&gt;&gt;</span><br><span class="line">./CHGCAR ./co/CHGCAR ./slab/CHGCAR</span><br><span class="line"></span><br><span class="line">--&gt;&gt; (01) Reading Structural Parameters from ./CHGCAR File...</span><br><span class="line">--&gt;&gt; (02) Reading Charge Density From ./CHGCAR File...</span><br><span class="line">--&gt;&gt; (03) Reading Structural Parameters from ./co/CHGCAR File...</span><br><span class="line">--&gt;&gt; (04) Reading Charge Density From ./co/CHGCAR File...</span><br><span class="line">--&gt;&gt; (05) Reading Structural Parameters from ./slab/CHGCAR File...</span><br><span class="line">--&gt;&gt; (06) Reading Charge Density From ./slab/CHGCAR File...</span><br><span class="line">--&gt;&gt; (07) Written CHGDIFF.vasp File!</span><br></pre></td></tr></table></figure>
<p>生成 CHGDIFF.vasp 包含电荷密度差的信息，可以直接导入到 VESTA 里作图。<br>图片</p>
<h4 id="Vaspkit计算变形电荷密度差"><a href="#Vaspkit计算变形电荷密度差" class="headerlink" title="Vaspkit计算变形电荷密度差"></a>Vaspkit计算变形电荷密度差</h4><p>变形电荷密度差：自洽计算收敛以后体系的电荷密度减去该原子构型下每个原子的球对称的电荷密度(即初猜电荷密度)。<br>以 CO 分子为例：<br>步骤一：先自洽计算优化 CO 分子。<br>步骤二：新键文件夹，在优化好的结构基础上用 ICHARG &#x3D; 12 做非自洽计算。<br>步骤三：用 vaspkit 314 功能做电荷差分。依次输入两个 CHGCAR 路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">314   </span><br><span class="line">======================= File Options ============================</span><br><span class="line">Input the Names of Charge/Potential Files with Space: </span><br><span class="line">(e.g., to get AB-A-B, type: ~/AB/CHGCAR ./A/CHGCAR ../B/CHGCAR)</span><br><span class="line">(e.g., to get A-B, type: ~/A/CHGCAR ./B/CHGCAR)</span><br><span class="line"></span><br><span class="line">------------&gt;&gt;</span><br><span class="line">./CHGCAR ./deform/CHGCAR</span><br><span class="line"></span><br><span class="line">--&gt;&gt; (01) Reading Structural Parameters from ./CHGCAR File...</span><br><span class="line">--&gt;&gt; (02) Reading Charge Density From ./CHGCAR File...</span><br><span class="line">--&gt;&gt; (03) Reading Structural Parameters from ./deform/CHGCAR File...</span><br><span class="line">--&gt;&gt; (04) Reading Charge Density From ./deform/CHGCAR File...</span><br><span class="line">--&gt;&gt; (05) Written CHGDIFF.vasp File!</span><br></pre></td></tr></table></figure>
<p>步骤四：得到 CHGDIFF.vasp 文件，导入到 VESTA 里做图。</p>
<h4 id="Vaspkit计算外加电场下的电荷密度差"><a href="#Vaspkit计算外加电场下的电荷密度差" class="headerlink" title="Vaspkit计算外加电场下的电荷密度差"></a>Vaspkit计算外加电场下的电荷密度差</h4><p>外加电场作用下的电荷密度减去没有外势场的电荷密度。<br>以 InSe 二维单层材料为例：<br>步骤一：先优化没有外加电场的结构。<br>步骤二：在同样结构下计算外加电场下做单点自洽计算。添加关键词，EFIELD 控制电场力的大小（eV&#x2F;Angstrom）F&#x3D;qE， 对应电场的单位是 E&#x3D;F&#x2F;q， 场强单位是  V&#x2F;Angstrom</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">EFIELD = 0.05</span><br><span class="line">IDIPOL = 3</span><br><span class="line">LDIPOL = .TRUE.</span><br></pre></td></tr></table></figure>
<p>步骤三：运行 Vaspkit 314 功能做电荷差分。依次输入二个 CHGCAR 路径。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">314</span><br><span class="line">======================= File Options ============================</span><br><span class="line">Input the Names of Charge/Potential Files with Space: </span><br><span class="line">(e.g., to get AB-A-B, type: ~/AB/CHGCAR ./A/CHGCAR ../B/CHGCAR)</span><br><span class="line">(e.g., to get A-B, type: ~/A/CHGCAR ./B/CHGCAR)</span><br><span class="line"></span><br><span class="line">------------&gt;&gt;</span><br><span class="line">./CHGCAR ./noele/CHGCAR</span><br><span class="line"></span><br><span class="line">--&gt;&gt; (01) Reading Structural Parameters from ./CHGCAR File...</span><br><span class="line">--&gt;&gt; (02) Reading Charge Density From ./CHGCAR File...</span><br><span class="line">--&gt;&gt; (03) Reading Structural Parameters from ./noele/CHGCAR File...</span><br><span class="line">--&gt;&gt; (04) Reading Charge Density From ./noele/CHGCAR File...</span><br><span class="line">--&gt;&gt; (05) Written CHGDIFF.vasp File!</span><br><span class="line">步骤四：得到 CHGDIFF.vasp 文件，导入到 VESTA 里做图。</span><br></pre></td></tr></table></figure>


<h3 id="电荷密度差作图"><a href="#电荷密度差作图" class="headerlink" title="电荷密度差作图"></a>电荷密度差作图</h3><p>得到的电荷密度差文件必须作成图才便于被直观地考察，常用的图分为三类：<br>（1）3D 等值面图，isosurface.<br>（2）2D 切面图.<br>（3）1D，平面平均的数值，planar averaged charge.<br>通常这几种图可以配合使用讨论。等值面图和切面图用 VESTA 画最方便，平面平均图用 vaspkit 生成方便。得到的 CHGDIFF.vasp 用 VESTA 打开，isosurface 青色部分电荷密度减小，黄色密度电荷密度增加。注意 VESTA 对电荷密度的默认单位是 e&#x2F;Bohr3。<br>vaspkit 319 功能可以把VASP的格点文件转化成 .cube的方法，.cube 在 VMD 里作图可以得到更好看的效果：</p>
<h1 id="能带计算"><a href="#能带计算" class="headerlink" title="能带计算"></a>能带计算</h1><p>参考链接：<br><a target="_blank" rel="noopener" href="https://yh-phys.github.io/2019/10/04/vasp-band-structure-dos/">https://yh-phys.github.io/2019/10/04/vasp-band-structure-dos/</a><br>自洽计算之后，读取产生的CHGCAR、WAVECAR<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ISTART</span>=<span class="number">1</span></span><br><span class="line"><span class="variable constant_">ICHARG</span>=<span class="number">11</span></span><br></pre></td></tr></table></figure><br><strong>其他参数和自洽时保持一致。</strong></p>
<p><strong>能带计算的KPOINTS文件不同于前面，称为高对称点。</strong><br>学术之友微信公众号历史记录搜索文章《五种方法生成能带结构计算的高对称点》<br>1、<a target="_blank" rel="noopener" href="http://cryst.ehu.es/">http://cryst.ehu.es/</a><br>2、<a target="_blank" rel="noopener" href="https://www.materialscloud.org/work/tools/seekpath">https://www.materialscloud.org/work/tools/seekpath</a><br>3、<a target="_blank" rel="noopener" href="http://www.aflowlib.org/aflow-online">http://www.aflowlib.org/aflow-online</a> (已更新)<br>4、<a target="_blank" rel="noopener" href="http://pymatgen.org/">http://pymatgen.org/</a> (pymatgen)<br>5、<a target="_blank" rel="noopener" href="http://www.xcrysden.org/">http://www.xcrysden.org/</a> (XCrySDen)<br>Accurate DOS and Band-structure calculations：<br><a target="_blank" rel="noopener" href="http://cms.mpi.univie.ac.at/vasp/vasp/Accurate_DOS_Band_structure_calculations.html">http://cms.mpi.univie.ac.at/vasp/vasp/Accurate_DOS_Band_structure_calculations.html</a></p>
<p>可以通过vaspkit的303命令产生KPATH.in文件，cp KPATH.in KPOINTS即可。<br>计算完成后通过vaspkit的211命令提取能带。<br><strong>注意能带路径生成操作需在自洽计算前完成。</strong></p>
<ul>
<li><p>1.准备POSCAR，调用vaspkit- 303（体相材料）或-302（二维材料）得到KPATH.in和PRIMCELL.in文件；对于二维体系，需要检查POSCAR文件的真空层是否沿z方向，如果没有，可调用vaspkit-923或vaspkit-407强制真空层沿z方向。另外，如果需要改变识别结构对称性精度（symprec默认值为1E-5），可通过vaspkit -task 302 -symprec 1E-6实现或者在~&#x2F;.vaspkit中修改SYMPREC默认值。</p>
</li>
<li><p>2.执行cp PRIMCELL.vasp POSCAR命名。（如果PRIMCELL.vasp 和POSCAR不一样，并且要读取电荷密度和波函数，要从SCF计算保持结构一致。）KPATH.in推荐能带路径只针对于PRIMITIVE CELL，缺少这一步，你可能得到错误的结果。如果有必要，比较KPATH.in文件中的能带路径是否与在线能带路径产生工具SeeK-Path产生的一致，包括比较PRIMCELL.vasp和HIGH_SYMMETRY_POINTS文件。需要指出的是SeeK-Path只用于体相结构能带路径的产生。自1.3.0版本，对于二维体系不需要执行cp PRIMCELL.vasp POSCAR。</p>
</li>
</ul>
<h2 id="投影电荷密度"><a href="#投影电荷密度" class="headerlink" title="投影电荷密度"></a>投影电荷密度</h2><p>复制能带结构文件，<br>vi INCAR<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">增加标签 <span class="variable constant_">LPARD</span>=.<span class="property">T</span>.</span><br><span class="line">增加标签 <span class="variable constant_">IBAND</span>=<span class="number">16</span> <span class="number">17</span></span><br><span class="line">增加标签 <span class="variable constant_">LSEPB</span>=.<span class="property">T</span>.</span><br></pre></td></tr></table></figure></p>
<ul>
<li>LPARD：它的取值为.TRUE.或.FALSE.，它的默认值是.FALSE.，当为.TRUE.时，表示读入自<br>洽收敛的 CHGCAR 和 WAVECAR 并进行 partial charge density计算。</li>
<li>IBAND：它的取值就是你想要计算的第几条能带或哪几条能带(比如要计算第 4、 5、 6 条能带，那么就设置 IBAND &#x3D; 4 5 6)，此时 NBMOD的值就是所要计算的能带的条数。</li>
<li>EINT：另一种方式指定所要计算的能带，它是指定计算某能量范围的partial charge density，一般是设置为两个实数，比如EINT&#x3D; 4.00 5.00，此时NBOMD的值设置为-2。如果只设置了一个数，那么表示计算从 EINT 到费米能级这个范围内的，此时NBOMD 的值为-3。</li>
<li>KPUSE：指定所要计算的 k 点(哪个或哪几个)。</li>
<li>LSEPB：指定是不是要把计算的partial charge density按每个带分别写到各自对应的文件</li>
<li>PARCHG.nb (设置为.TRUE.)中，还是把它们合并写到一个文件中(相当于把各个带对应的partial charge density 加起来，设置为.FALSE.)，默认值为.FALSE.。</li>
<li>LSEPK：指定是不是把要计算的partial charge density按每个k分别写到各自对应的文件PARCHG.nk (设置为.TRUE.).</li>
</ul>
<p><strong>三个方法：</strong></p>
<p><strong>1、读取自恰计算的波函数，KPOINTS文件采用特定的k点</strong></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#partial charge density</span><br><span class="line"><span class="variable constant_">LPARD</span> = .<span class="property">TRUE</span>. </span><br><span class="line"><span class="variable constant_">IBAND</span> = <span class="number">17</span> <span class="number">18</span> # 价带顶和导带底</span><br><span class="line"><span class="variable constant_">KPUSE</span> = <span class="number">1</span></span><br><span class="line"><span class="variable constant_">LSEPB</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">LSEPK</span> = .<span class="property">TRUE</span>.</span><br></pre></td></tr></table></figure>

 <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">CsPbI3</span>-cubic</span><br><span class="line"><span class="number">1</span></span><br><span class="line">r</span><br><span class="line"><span class="number">0.500000</span> <span class="number">0.500000</span> <span class="number">0.500000</span> <span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://muchong.com/html/200906/1404880.html">http://muchong.com/html/200906/1404880.html</a><br><strong>2、读取自恰计算的波函数，KPOINTS文件采用自恰计算的k点</strong><br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#partial charge density</span><br><span class="line"><span class="variable constant_">LPARD</span> = .<span class="property">TRUE</span>. </span><br><span class="line"><span class="variable constant_">IBAND</span> = <span class="number">17</span> <span class="number">18</span></span><br><span class="line"><span class="variable constant_">KPUSE</span> = <span class="number">35</span></span><br><span class="line"><span class="variable constant_">LSEPB</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">LSEPK</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">NELM</span> = <span class="number">200</span></span><br><span class="line"><span class="variable constant_">ICHARG</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure><br>在scf自恰计算OUTCAR中<br>找到对应导带底和价带顶<br>对应的k-point编号<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">CsPbI3</span>-cubic</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="title class_">Gamma</span></span><br><span class="line"><span class="number">8</span> <span class="number">8</span> <span class="number">8</span></span><br><span class="line"><span class="number">0.0</span> <span class="number">0.0</span> <span class="number">0.0</span></span><br></pre></td></tr></table></figure><br><strong>3、读取能带计算的波函数，KPOINTS文件采用能带计算的k点</strong></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#partial charge density</span><br><span class="line"><span class="variable constant_">LPARD</span> = .<span class="property">TRUE</span>. </span><br><span class="line"><span class="variable constant_">IBAND</span> = <span class="number">17</span> <span class="number">18</span></span><br><span class="line"><span class="variable constant_">KPUSE</span> = <span class="number">80</span> <span class="number">81</span></span><br><span class="line"><span class="variable constant_">LSEPB</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">LSEPK</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">NELM</span> = <span class="number">200</span></span><br><span class="line"><span class="variable constant_">ICHARG</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>KPOINTS和能带计算一样。在band能带计算OUTCAR中找到对应导带底和价带顶对应的k-point编号。</p>
<h2 id="轨道投影态密度和能带。"><a href="#轨道投影态密度和能带。" class="headerlink" title="轨道投影态密度和能带。"></a>轨道投影态密度和能带。</h2> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">LORBIT</span>=<span class="number">11</span> </span><br><span class="line"><span class="variable constant_">NEDOS</span>=<span class="number">2001</span></span><br></pre></td></tr></table></figure>
<p>提取DOS：vaspkit -task 111&#x2F;113<br>提取band：211&#x2F;212&#x2F;213&#x2F;214<br><strong>如果3D能带图不够平滑，可通过能带插值进行改善。</strong><br>VASPKIT升级到1.3.0或更新版本，在~&#x2F;.vaspkit文件中设置以下三个参数：<br> <figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">GET_INTERPOLATED_DATA</span>      .<span class="property">TRUE</span>.     是否插值</span><br><span class="line"><span class="variable constant_">INTERPOLATION_SPACING</span>        <span class="number">0.04</span>     插值间距，决定平滑程度</span><br><span class="line"><span class="variable constant_">INTERPOLATION_METHOD</span>        <span class="string">&#x27;cubic&#x27;</span>   插值方法</span><br></pre></td></tr></table></figure></p>
<h2 id="HSE06计算电子结构："><a href="#HSE06计算电子结构：" class="headerlink" title="HSE06计算电子结构："></a>HSE06计算电子结构：</h2><ol>
<li><p>结构优化（PBE）</p>
</li>
<li><p>静态自洽scf计算（PBE）KPOINTS和POTCAR文件不变，写波函数和电荷密度</p>
</li>
<li><p>(可选）静态自洽scf计算（HSE06）KPOINTS，POSCAR和POTCAR文件不变</p>
</li>
<li><p>DOS&#x2F;band计算（HSE06）vaspkit -task 303<br>vaspkit→251→2→0.03→0.03生成KPOINTS，运行VASP<br>vaspkit-252<br><a target="_blank" rel="noopener" href="http://vaspkit.cn/index.php/29.html">http://vaspkit.cn/index.php/29.html</a></p>
</li>
<li><p>PBE优化结构</p>
</li>
<li><p>HSE自洽计算(得到波函数)</p>
</li>
<li><p>HSE能带计算&#x2F;态密度计算</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable constant_">ALGO</span> = <span class="title class_">Damped</span></span><br><span class="line"><span class="variable constant_">HFSCREEN</span> = <span class="number">0.2</span></span><br><span class="line"><span class="variable constant_">LHFCALC</span> = .<span class="property">True</span>.</span><br><span class="line"><span class="variable constant_">LMAXFOCK</span> = <span class="number">4</span></span><br><span class="line"><span class="variable constant_">PRECFOCK</span> = <span class="title class_">Fast</span></span><br><span class="line"><span class="variable constant_">TIME</span> = <span class="number">0.4</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="SOC计算电子结构："><a href="#SOC计算电子结构：" class="headerlink" title="+SOC计算电子结构："></a>+SOC计算电子结构：</h2><ol>
<li>结构优化（PBE）</li>
<li>静态自洽scf计算（PBE+SOC）KPOINTS和POTCAR文件不变，写波函数和电荷密度</li>
<li>非自洽计算（PBE+SOC）<br>Spin-Orbit Coupling Calculation<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="variable constant_">ISPIN</span>  =  <span class="number">2</span></span><br><span class="line"> <span class="variable constant_">NELMIN</span> =  <span class="number">6</span>            (<span class="title class_">Min</span> electronic <span class="variable constant_">SCF</span> steps) </span><br><span class="line"> <span class="variable constant_">LSORBIT</span>    = .<span class="property">TRUE</span>.    (<span class="title class_">Activate</span> <span class="variable constant_">SOC</span>)</span><br><span class="line"> <span class="variable constant_">GGA_COMPAT</span> = .<span class="property">FALSE</span>.   (<span class="title class_">Apply</span> spherical cutoff on gradient field)</span><br><span class="line">#<span class="variable constant_">VOSKOWN</span>    =  <span class="number">1</span>        (<span class="title class_">Enhances</span> the magnetic moments and the magnetic energies)</span><br><span class="line"> <span class="variable constant_">LMAXMIX</span>    =  <span class="number">2</span>        (<span class="title class_">For</span> d elements increase <span class="variable constant_">LMAXMIX</span> to <span class="number">4</span>, <span class="attr">f</span>: <span class="variable constant_">LMAXMIX</span> = <span class="number">6</span>)</span><br><span class="line"> <span class="variable constant_">SAXIS</span>    =  <span class="number">0</span> <span class="number">0</span> <span class="number">1</span>      (<span class="title class_">Direction</span> <span class="keyword">of</span> the magnetic field)</span><br><span class="line"> #<span class="variable constant_">MAGMOM</span>   =  <span class="number">0</span> <span class="number">0</span> <span class="number">3</span>    (<span class="title class_">Set</span> <span class="variable language_">this</span> parameters manually, <span class="title class_">Local</span> magnetic moment parallel to <span class="variable constant_">SAXIS</span>, <span class="number">3</span>*<span class="variable constant_">NIONS</span>*<span class="number">1.0</span> <span class="keyword">for</span> non-collinear magnetic systems)</span><br><span class="line"> <span class="variable constant_">NBANDS</span>   =  <span class="number">32</span>         (<span class="title class_">Set</span> <span class="variable language_">this</span> parameters manually, <span class="number">2</span> * number <span class="keyword">of</span> bands <span class="keyword">of</span> collinear-run)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="调节SOC强度"><a href="#调节SOC强度" class="headerlink" title="调节SOC强度"></a>调节SOC强度</h3><ol>
<li>调节自旋轨道耦合作用的大小</li>
</ol>
<p>要调优VASP中的自旋轨道耦合强度，需要修改源文件vasp_source_code_path&#x2F;src&#x2F;relativistic.F 并重新编译。如果要将强度减少一半，可以在relativistic.F的129行L●S项乘以0.5d0，如下：<br>DO I&#x3D;0,1DO J&#x3D;0,1DO M &#x3D;1,2<em>LL+1DO MP&#x3D;1,2</em>LL+1    DLLMM(LMP+MP-1,LM+M-1,J+2<em>I+1)&#x3D;DLLMM(LMP+MP-1,LM+M-1,J+2</em>I+1)+ &amp;    0.5d0<em>SUM</em>LS(M,MP,I+2*J+1,LL)   !!!line 129 relativistic.F fileEND DOEND DOEND DOEND DO</p>
<p>代码片段：可切换语言，无法单独设置文字格式</p>
<p>   注意，需要使用重新编译的vasp_ncl来运行计算。另外，最好比较0d0<em>L●S，1d0</em>L●S和vasp_std，vasp_ncl计算结果。</p>
<ol start="2">
<li>如果只想给一些元素加SOC，而其他元素不加该怎么办呢？拓扑材料计算互助群的Eurus-清华给出了VASP中给特定元素加自旋轨道耦合相互作用的方法（感谢Eurus-清华）。在原来VASP，src文件夹下的relativistic.F文件中注释掉46行的</li>
</ol>
<p>! REAL(q), PARAMETER :: INVMC2&#x3D;7.45596E-6</p>
<p>然后53行位置加入如下6-17行的内容，然后重新编译。</p>
<pre><code>  INTEGER, PARAMETER :: LMAX=3, MMAX=LMAX*2+1      COMPLEX(q) DUMMY(MMAX,MMAX,3,LMAX)      COMPLEX(q) LS(MMAX,MMAX,4,LMAX)      REAL(q) SUM, SCALE
</code></pre>
<p>! add  parameter       REAL(q), PARAMETER :: INVMC2_ORIG&#x3D;7.45596E-6      REAL(q) INVMC2! add end ! add  control      IF(ABS(Z-83).LT.1.0E-5)THEN        INVMC2&#x3D;INVMC2_ORIG      ELSE        INVMC2&#x3D;INVMC2_ORIG*0.0001      END IF! add end<br>      LS&#x3D;(0._q,0._q)      CALL SETUP_LS(1,THETA,PHI,DUMMY(1:3,1:3,1:3,1),LS(1:3,1:3,1:4,1))      CALL SETUP_LS(2,THETA,PHI,DUMMY(1:5,1:5,1:3,2),LS(1:5,1:5,1:4,2))      CALL SETUP_LS(3,THETA,PHI,DUMMY(1:7,1:7,1:3,3),LS(1:7,1:7,1:4,3))<br>原理：这样做的原理就是将除Z-83的元素外的其他元素缩小一万倍。注意：这个脚本的第12行, IF(ABS(Z-83))，表明除了83号元素打开SOC之外，其他所有的元素SOC都是相当于关闭的。如果想打开某个特定元素的SOC，就把83改成你想要的元素序号就行。<br>另外，其他元素SOC关闭方式就是将其缩小一万倍。所以使用这种方法，任然是非共线计算，如果要进行wannier90计算，只要按照正常的wannier90设置就可以。</p>
<h2 id="HSE06-SOC-band-structure-calculation"><a href="#HSE06-SOC-band-structure-calculation" class="headerlink" title="HSE06+SOC band structure calculation"></a>HSE06+SOC band structure calculation</h2><ul>
<li><p>Step-I: HSE06 SCF calculation with SOC (INCAR):</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#<span class="variable constant_">SOC</span>-<span class="attr">related</span>:</span><br><span class="line"><span class="variable constant_">LSORBIT</span>=.<span class="property">TRUE</span>.                </span><br><span class="line"><span class="variable constant_">SAXIS</span>= <span class="number">0</span> <span class="number">0</span> <span class="number">1</span>  </span><br><span class="line"><span class="variable constant_">ISYM</span>=<span class="number">0</span>                   </span><br><span class="line"></span><br><span class="line">#<span class="title class_">HSE06</span>-<span class="attr">related</span>:</span><br><span class="line"><span class="variable constant_">LHFCALC</span> = .<span class="property">TRUE</span>.</span><br><span class="line"><span class="variable constant_">HFSCREEN</span> = <span class="number">0.2</span></span><br><span class="line"><span class="variable constant_">ALGO</span> = <span class="title class_">Damped</span>         #<span class="title class_">Damped</span>/<span class="title class_">Normal</span>/<span class="title class_">All</span></span><br><span class="line"><span class="variable constant_">TIME</span> = <span class="number">0.4</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Step-II: HSE06 NSCF calculation with SOC:</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#<span class="variable constant_">SOC</span>-<span class="attr">related</span>:</span><br><span class="line"><span class="variable constant_">LSORBIT</span>=.<span class="property">TRUE</span>.                </span><br><span class="line"><span class="variable constant_">SAXIS</span>= <span class="number">0</span> <span class="number">0</span> <span class="number">1</span>  </span><br><span class="line"><span class="variable constant_">ISYM</span>=<span class="number">0</span>                  </span><br><span class="line"></span><br><span class="line">#<span class="title class_">HSE06</span> <span class="attr">related</span>:</span><br><span class="line"><span class="variable constant_">LHFCALC</span> = .<span class="property">TRUE</span>.               </span><br><span class="line"><span class="variable constant_">HFSCREEN</span> = <span class="number">0.2</span></span><br><span class="line"><span class="variable constant_">ALGO</span> = <span class="title class_">Normal</span>                  !use <span class="title class_">Normal</span></span><br><span class="line"><span class="variable constant_">TIME</span> = <span class="number">0.4</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="能带反折叠"><a href="#能带反折叠" class="headerlink" title="能带反折叠"></a>能带反折叠</h2><h3 id="vaspkit"><a href="#vaspkit" class="headerlink" title="vaspkit:"></a>vaspkit:</h3><ol>
<li>准备POSCAR</li>
<li>运行vaspkit -task 302&#x2F;303生成KPATH.in文件</li>
<li>cp PRIMCELL.vasp POSCAR </li>
<li>运行vasp优化结构，cp CONTCAR POSCAR</li>
<li>运行vaspkit -task 400&#x2F;400生成超胞结构POSCAR，并执行cp TRANSMAT TRANSMAT.in</li>
<li>运行vasp优化含有缺陷的超胞结构，cp CONTCAR POSCAR</li>
<li>运行vaspkit -task 281生成KPOINTS文件</li>
<li>准备INCAR（静态计算，设置LWAVE &#x3D; T，适当增加NBANDS值）并执行VASP计算</li>
<li>运行vaspkit -task 282提取effective band structure(画法类似于投影能带)</li>
</ol>
<ul>
<li><strong>如果不会计算变换矩阵（TRANSMAT.in文件不存在时），可以执行cp PRIMCELL.vasp PRIMCELL.in，281</strong> ，这时vaspkit分别读入超胞基矢（POSCAR）和原胞基矢（PRIMCELL.in）计算变换矩阵并生成TRANSMAT.in文件。</li>
<li>vaspkit&#x2F;examples&#x2F;band_unfolding&#x2F;ebs.py画图。生成的ENERGY.grd，WEIGHT.grd和MOMENTUM.grd三个文件，可使用vaspkit&#x2F;examples&#x2F;band_unfolding&#x2F;ebs_k_resolved_dos_plot_matlalb.m脚本画图。</li>
</ul>
<h3 id="bandup"><a href="#bandup" class="headerlink" title="bandup:"></a>bandup:</h3><p><strong>第一步</strong>  得到超胞CHGCAR:输入文件参考BANDUP的example的第一步，提交任务之后得到CHGCAR。<br><strong>第二步</strong>  主要是为了得到超胞非自洽计算的K点路径，分别给出单胞和超胞的晶格坐标文件prim_cell_lattice.in与supercell_lattice.in。还有单胞的高对称K点路径。<br>下一步命令是bandup kpts-sc-get -no_symm_avg,这一步会生成KPOINTS_supercell.out文件后面会用到。-no_symm_avg这个标签是为了减少需要计算的k点个数，减小计算量和WAVECAR大小。<br><strong>第三步</strong>  利用前面第一步生成 CHGCAR; POSCAR POTCAR与第一步的一样，K点从第二步那个复制过来,然后提交任务得到波函数WAVECAR<br>第四步就要开始做能带反折叠了，一句命令，bandup unfold -emin -13 -emax 6 -dE 0.050  -no_symm_avg<br>会生成一个unfolded_EBS_not-symmetry_averaged.dat文件，画出来就行了。<br><a target="_blank" rel="noopener" href="https://github.com/band-unfolding/bandup">https://github.com/band-unfolding/bandup</a></p>
<p><a target="_blank" rel="noopener" href="http://staff.ustc.edu.cn/~zqj/posts/Band-unfolding-tutorial/">http://staff.ustc.edu.cn/~zqj/posts/Band-unfolding-tutorial/</a><br>可以处理能带反折叠的软件汇总：<br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/-5lN2lwxsALA-rhNQxK1dw">https://mp.weixin.qq.com/s/-5lN2lwxsALA-rhNQxK1dw</a><br><a target="_blank" rel="noopener" href="https://vaspkit.com/tutorials.html#band-unfolding">https://vaspkit.com/tutorials.html#band-unfolding</a><br><a target="_blank" rel="noopener" href="https://github.com/QuantumMaterialsModelling/bands4vasp">https://github.com/QuantumMaterialsModelling/bands4vasp</a><br><a target="_blank" rel="noopener" href="https://github.com/QuantumMaterialsModelling/UnfoldingPatch4vasp">https://github.com/QuantumMaterialsModelling/UnfoldingPatch4vasp</a></p>
<h2 id="3D能带"><a href="#3D能带" class="headerlink" title="3D能带"></a>3D能带</h2><p>__第一步__，准备好石墨烯的POSCAR和用于静态计算的INCAR文件；<br>__第二步__：运行VASPKIT并选择231生成用于3D能带计算 的KPOINTS文件。为了获得平滑的3D能带面，用于产生KPOINTS文件的分辨率值应该设置在0.005左右 ；<br>__第三步__，提交VASP作业；<br>__第四步__，待VASP计算完成后，再次运行VASPKIT，输入232或233命令。233命令可一次性输入包含价带顶的BAND.HOMO.grd和导带底的BAND.LUMO.grd文件的能带；232可以得到其它任意能带的计算数据，这里我们选择233。<br>__第五步__：运行python how_to_visual.py，绘制3D能带图(python2.7环境)。<br><strong>如果3D能带图不够平滑，可通过能带插值进行改善。</strong></p>
<h2 id="有效质量："><a href="#有效质量：" class="headerlink" title="有效质量："></a>有效质量：</h2><p>除了通过能带，也可以通过调用VASPKIT-911命令来得到带边位置，接下来我们计算K点处沿着K -&gt; Γ和K -&gt; M方向的电子及空穴载流子的有效质量；<br>第一步：准备POSCAR文件以及VPKIT.in文件，VPKIT.in文件包含以下内容；</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>                  设置为<span class="number">1</span>将会生成计算有效质量的<span class="variable constant_">KPOINTS</span>文件，<span class="number">2</span>则计算有效质量</span><br><span class="line"><span class="number">6</span>                  <span class="number">6</span>表示我们在K附近取<span class="number">6</span>个离散点用于多项式拟合</span><br><span class="line"><span class="number">0.015</span>              k-cutoff, 截断半径，典型值<span class="number">0.015</span> <span class="number">1</span>/Å</span><br><span class="line"><span class="number">2</span>                  <span class="number">2</span> 表示有两个有效质量任务</span><br><span class="line"><span class="number">0.333333</span> <span class="number">0.3333333</span>  <span class="number">0.000</span>  <span class="number">0.000</span> <span class="number">0.000</span> <span class="number">0.000</span>  K-&gt;Γ     计算K点处有效质量，沿着K指向Γ方向    </span><br><span class="line"><span class="number">0.333333</span> <span class="number">0.3333333</span>  <span class="number">0.000</span>  <span class="number">0.500</span> <span class="number">0.000</span> <span class="number">0.000</span>  K-&gt;M     计算K点处有效质量，沿着K指向M方向 </span><br></pre></td></tr></table></figure>
<p>第二步：运行vaspkit并选择912或者913产生KPOINTS，POTCAR文件及静态计算INCAR文件；<br>第三步：提交VASP作业；<br>第四步：计算完成后把VPKIT.in文件中第一行的1修改为2，然后再次运行vaspkit并选择913，得到结果：<br>为了得到可靠的有效质量计算值，括号里的精度至少要在1E-7这个量级，如果误差比较大，可以适当调整k-cutoff值，一般减少该值但不能太小。<br>手动vaspkit处理的能带：$m^∗&#x3D;3.815&#x2F;B$</p>
<h2 id="GW方法"><a href="#GW方法" class="headerlink" title="GW方法"></a>GW方法</h2><p>参考：<a target="_blank" rel="noopener" href="https://www.vasp.at/wiki/index.php/Bandgap_of_Si_in_GW">https://www.vasp.at/wiki/index.php/Bandgap_of_Si_in_GW</a></p>
<p>步骤：</p>
<ol>
<li>PBE基态计算</li>
<li>获得虚拟轨道（50-100&#x2F;atom）</li>
</ol>
<p>INCAR：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ALGO = Exact</span><br><span class="line">NBANDS  = 64</span><br><span class="line">LOPTICS = .TRUE. #得到WAVEDER文件</span><br><span class="line">CSHIFT = 0.1</span><br><span class="line">NEDOS = 2000</span><br><span class="line"># you might try</span><br><span class="line">#LPEAD = .TRUE.</span><br><span class="line">   </span><br><span class="line">ISMEAR =  0</span><br><span class="line">SIGMA  =  0.05</span><br><span class="line">EDIFF  = 1E-8</span><br></pre></td></tr></table></figure>
<p>完成后：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp WAVECAR WAVECAR.DIAG</span><br><span class="line">cp WAVEDER WAVEDER.DIAG</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>GW计算<br>读取上一步<br>INCAR：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Frequency dependent dielectric tensor including</span><br><span class="line"># local field effects within the RPA (default) or</span><br><span class="line"># including changes in the DFT xc-potential (LRPA=.FALSE.).</span><br><span class="line"># N.B.: beware one first has to have done a</span><br><span class="line"># calculation with ALGO=Exact, LOPTICS=.TRUE.</span><br><span class="line"># and a reasonable number of virtual states (see above)</span><br><span class="line">ALGO = GW0 ; LSPECTRAL = .TRUE. ; NOMEGA = 50</span><br><span class="line">   </span><br><span class="line"># be sure to take the same number of bands as for</span><br><span class="line"># the LOPTICS=.TRUE. calculation, otherwise the</span><br><span class="line"># WAVEDER file is not read correctly</span><br><span class="line">NBANDS = 64</span><br><span class="line">     </span><br><span class="line"># Add this to update the quasiparticle energies</span><br><span class="line"># in the Green&#x27;s function (GW0)</span><br><span class="line">#NELM = 4</span><br><span class="line">    </span><br><span class="line">ISMEAR =  0</span><br><span class="line">SIGMA  =  0.05</span><br><span class="line">EDIFF  = 1E-8</span><br></pre></td></tr></table></figure>
在OUTCAR中quasi-particle (QP) energies.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QP shifts &lt;psi_nk| G(iteration)W_0 |psi_nk&gt;: iteration 1</span><br><span class="line"> for sc-GW calculations column KS-energies equals QP-energies in previous step</span><br><span class="line"> and V_xc(KS)=  KS-energies - (&lt;T + V_ion + V_H &gt; + &lt;T+V_H+V_ion&gt;^1  + &lt;V_x&gt;^1)</span><br><span class="line"></span><br><span class="line"> k-point   1 :       0.0000    0.0000    0.0000</span><br><span class="line">  band No.  KS-energies  QP-energies   sigma(KS)   V_xc(KS)     V^pw_x(r,r&#x27;)   Z            occupation</span><br><span class="line">  .........</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="LWANNIER90计算能带结构"><a href="#LWANNIER90计算能带结构" class="headerlink" title="LWANNIER90计算能带结构"></a>LWANNIER90计算能带结构</h3><p>重新开始第三步</p>
<p>INCAR：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ALGO = GW0 ; LSPECTRAL = .TRUE. ; NOMEGA = 50</span><br><span class="line">#LRPA = .FALSE. </span><br><span class="line">## be sure to take the same number of bands as for</span><br><span class="line">## the LOPTICS=.TRUE. calculation, otherwise the</span><br><span class="line">## WAVEDER file is not read correctly</span><br><span class="line">NBANDS = 64</span><br><span class="line">##VASP2WANNIER90</span><br><span class="line">LWANNIER90=.TRUE.</span><br></pre></td></tr></table></figure>
<p>wannier90.win:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">num_wann=8</span><br><span class="line">num_bands=8</span><br><span class="line"></span><br><span class="line">exclude_bands = 9-64</span><br><span class="line"></span><br><span class="line">Begin Projections</span><br><span class="line">Si:sp3</span><br><span class="line">End Projections</span><br><span class="line"></span><br><span class="line">dis_froz_max=9</span><br><span class="line">dis_num_iter=1000</span><br><span class="line"></span><br><span class="line">guiding_centres=true</span><br><span class="line"></span><br><span class="line"># Bandstructure plot </span><br><span class="line">#restart         =  plot</span><br><span class="line">#bands_plot      =  true</span><br><span class="line">#begin kpoint_path</span><br><span class="line">#L 0.50000  0.50000 0.5000 G 0.00000  0.00000 0.0000</span><br><span class="line">#G 0.00000  0.00000 0.0000 X 0.50000  0.00000 0.5000</span><br><span class="line">#X 0.50000  0.00000 0.5000 K 0.37500 -0.37500 0.0000</span><br><span class="line">#K 0.37500 -0.37500 0.0000 G 0.00000  0.00000 0.0000</span><br><span class="line">#end kpoint_path</span><br><span class="line">#bands_num_points 40</span><br><span class="line">#bands_plot_format gnuplot xmgrace</span><br><span class="line"></span><br><span class="line">begin unit_cell_cart</span><br><span class="line">     2.7150000     2.7150000     0.0000000</span><br><span class="line">     0.0000000     2.7150000     2.7150000</span><br><span class="line">     2.7150000     0.0000000     2.7150000</span><br><span class="line">end unit_cell_cart</span><br><span class="line"></span><br><span class="line">begin atoms_cart</span><br><span class="line">Si       0.0000000     0.0000000     0.0000000</span><br><span class="line">Si       1.3575000     1.3575000     1.3575000</span><br><span class="line">end atoms_cart</span><br><span class="line"></span><br><span class="line">mp_grid =     4     4     4</span><br><span class="line"></span><br><span class="line">begin kpoints</span><br><span class="line">     0.0000000     0.0000000     0.0000000</span><br><span class="line">     0.2500000     0.0000000     0.0000000</span><br><span class="line">     0.5000000     0.0000000     0.0000000</span><br><span class="line">     0.2500000     0.2500000     0.0000000</span><br><span class="line">     0.5000000     0.2500000     0.0000000</span><br><span class="line">    -0.2500000     0.2500000     0.0000000</span><br><span class="line">     0.5000000     0.5000000     0.0000000</span><br><span class="line">    -0.2500000     0.5000000     0.2500000</span><br><span class="line">     0.0000000     0.2500000     0.0000000</span><br><span class="line">     0.0000000     0.0000000     0.2500000</span><br><span class="line">    -0.2500000    -0.2500000    -0.2500000</span><br><span class="line">    -0.2500000     0.0000000     0.0000000</span><br><span class="line">     0.0000000    -0.2500000     0.0000000</span><br><span class="line">     0.0000000     0.0000000    -0.2500000</span><br><span class="line">     0.2500000     0.2500000     0.2500000</span><br><span class="line">     0.0000000     0.5000000     0.0000000</span><br><span class="line">     0.0000000     0.0000000     0.5000000</span><br><span class="line">    -0.5000000    -0.5000000    -0.5000000</span><br><span class="line">     0.0000000     0.2500000     0.2500000</span><br><span class="line">     0.2500000     0.0000000     0.2500000</span><br><span class="line">    -0.2500000    -0.2500000     0.0000000</span><br><span class="line">    -0.2500000     0.0000000    -0.2500000</span><br><span class="line">     0.0000000    -0.2500000    -0.2500000</span><br><span class="line">     0.0000000     0.5000000     0.2500000</span><br><span class="line">     0.2500000     0.0000000     0.5000000</span><br><span class="line">    -0.2500000    -0.2500000     0.2500000</span><br><span class="line">    -0.5000000    -0.2500000    -0.5000000</span><br><span class="line">     0.2500000     0.5000000     0.0000000</span><br><span class="line">     0.2500000    -0.2500000    -0.2500000</span><br><span class="line">    -0.5000000    -0.5000000    -0.2500000</span><br><span class="line">     0.0000000     0.2500000     0.5000000</span><br><span class="line">    -0.2500000     0.2500000    -0.2500000</span><br><span class="line">    -0.2500000    -0.5000000    -0.5000000</span><br><span class="line">     0.5000000     0.0000000     0.2500000</span><br><span class="line">    -0.5000000    -0.2500000     0.0000000</span><br><span class="line">     0.0000000    -0.5000000    -0.2500000</span><br><span class="line">    -0.2500000     0.0000000    -0.5000000</span><br><span class="line">     0.2500000     0.2500000    -0.2500000</span><br><span class="line">     0.5000000     0.2500000     0.5000000</span><br><span class="line">    -0.2500000    -0.5000000     0.0000000</span><br><span class="line">    -0.2500000     0.2500000     0.2500000</span><br><span class="line">     0.5000000     0.5000000     0.2500000</span><br><span class="line">     0.0000000    -0.2500000    -0.5000000</span><br><span class="line">     0.2500000    -0.2500000     0.2500000</span><br><span class="line">     0.2500000     0.5000000     0.5000000</span><br><span class="line">    -0.5000000     0.0000000    -0.2500000</span><br><span class="line">     0.0000000    -0.2500000     0.2500000</span><br><span class="line">     0.2500000     0.0000000    -0.2500000</span><br><span class="line">    -0.2500000    -0.2500000    -0.5000000</span><br><span class="line">     0.2500000     0.5000000     0.2500000</span><br><span class="line">     0.2500000    -0.2500000     0.0000000</span><br><span class="line">    -0.5000000    -0.2500000    -0.2500000</span><br><span class="line">     0.2500000     0.2500000     0.5000000</span><br><span class="line">     0.0000000     0.2500000    -0.2500000</span><br><span class="line">    -0.2500000    -0.5000000    -0.2500000</span><br><span class="line">     0.5000000     0.2500000     0.2500000</span><br><span class="line">    -0.2500000     0.0000000     0.2500000</span><br><span class="line">     0.0000000     0.5000000     0.5000000</span><br><span class="line">     0.5000000     0.0000000     0.5000000</span><br><span class="line">     0.2500000    -0.2500000     0.5000000</span><br><span class="line">     0.5000000     0.2500000    -0.2500000</span><br><span class="line">    -0.5000000    -0.2500000    -0.7500000</span><br><span class="line">     0.2500000    -0.5000000    -0.2500000</span><br><span class="line">    -0.2500000     0.2500000    -0.5000000</span><br><span class="line">end kpoints</span><br></pre></td></tr></table></figure>

<p>Compute Wannier functions<br>run wannier90:</p>
<p><code>wannier90.x wannier90</code></p>
<p>This run generates the wannier90 standard output (wannier90.wout) and the file wannier90.chk needed for the wannier interpolation (next step)</p>
<p>Obtain bandstructure (Wannier interpolation)<br>Uncomment the bandstructure plot flags in wannier90.win and rerun (restart) wannier90:</p>
<p><code>wannier90.x wannier90</code></p>
<p>This run generates the following bandstructure files which can be visualized using xmgrace or gnuplot:</p>
<p>wannier90_band.agr</p>
<p>wannier90_band.dat</p>
<p>wannier90_band.gnu</p>
<p>to plot the band structure using gnuplot: <code>gnuplot -persist wannier90_band.gnu</code></p>
<h3 id="Beyond-the-random-phase-approximation"><a href="#Beyond-the-random-phase-approximation" class="headerlink" title="Beyond the random-phase-approximation"></a>Beyond the random-phase-approximation</h3><p>To include local field effects beyond the random-phase-approximation in the description of the frequency dependent dielectric response function (local field effects in DFT) add the following line to your INCAR file:</p>
<p><code>LRPA = .FALSE.</code><br>and again restart from the WAVECAR and WAVEDER files from step 2.</p>
<h3 id="Beyond-G0W0-GW0"><a href="#Beyond-G0W0-GW0" class="headerlink" title="Beyond G0W0: GW0"></a>Beyond G0W0: GW0</h3><p>The most usual step beyond single-shot GW (G0W0) is to iterate the quasi-particle energies in the Greens functions. This is the socalled GW0 approximation. To have VASP do, for instance, 4 iterations of the QP-energies in G, add the following line to the INCAR file:</p>
<p><code>NELM = 4</code><br>and again restart from the WAVECAR and WAVEDER files from step 2.</p>
<p>To quickly find the QP-energy of the highest lying occupied state after 4 iterations of the QP energies in G, type:</p>
<p><code>./gap_GW.sh OUTCAR</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-47-24/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-47-24/" class="post-title-link" itemprop="url">1.5 提高效率与准确性</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:47:24" itemprop="dateCreated datePublished" datetime="2023-05-09T18:47:24+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-03-18 21:46:08" itemprop="dateModified" datetime="2025-03-18T21:46:08+08:00">2025-03-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFT%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">DFT学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="截断能"><a href="#截断能" class="headerlink" title="截断能"></a>截断能</h1><p>截断能设置在INCAR文件的ENCUT参数。截断能（energy cutoff）指定了展开波函数用到的平面波基组（planewave basis set）所对应的截断能量。<br>参考： <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/348826693">https://zhuanlan.zhihu.com/p/348826693</a><br><strong>截断能越大，代表用来描述波函数的平面波基组越多，计算精度越高，同时计算耗时也越长。</strong><br><strong>如果没有指定ENCUT，程序将默认ENCUT&#x3D;ENMAX（注意：当PREC &#x3D; High时, ENCUT &#x3D; 1.3*ENMAX）。扩胞并不会影响ENCUT的设置。</strong></p>
<ul>
<li>测试标准<br>ENMAX在保证定性正确的基础上大幅度降低计算耗时，如果想要定量计算某些性质就需要增大截断能了。所以ENCUT测试通常从ENMAX开始测试，一般截止到 <strong>1.5*ENMAX</strong> 即可（注意：比ENMAX小的测试可能会得到错误的能量）。当体系中每个原子的能量差收敛至0.001 eV&#x2F;atom时，此ENCUT即为最终取值。</li>
</ul>
<p>简单测试：<br><code>for i in &#123;1..8&#125;; do cp 400 $((400+$i*50)); sed -i &quot;s/400/$((400+$i*50))/g&quot;  $((400+$i*50))/INCAR ; done</code> </p>
<p><strong>encut.sh脚本：</strong>  参考 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/115235135">https://zhuanlan.zhihu.com/p/115235135</a></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>bash</span><br><span class="line"></span><br><span class="line">#生成<span class="variable constant_">KPOINTS</span>文件，<span class="variable constant_">KPOINTS</span>不能与<span class="variable constant_">INCAR</span>中的<span class="variable constant_">KSPACING</span>参数共用，二选一</span><br><span class="line">cat &gt; <span class="variable constant_">KPOINTS</span> &lt;&lt;!</span><br><span class="line">A</span><br><span class="line"><span class="number">0</span></span><br><span class="line">M</span><br><span class="line"><span class="number">9</span>  <span class="number">9</span>  <span class="number">9</span></span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">#产生计算所需<span class="variable constant_">POSCAR</span></span><br><span class="line">cat &gt; <span class="variable constant_">POSCAR</span>&lt;&lt;!</span><br><span class="line"><span class="title class_">Si8</span></span><br><span class="line"><span class="number">1.0000000000</span></span><br><span class="line">    <span class="number">5.4687280000</span>        <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">5.4687280000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span>        <span class="number">5.4687280000</span></span><br><span class="line"><span class="title class_">Si</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="title class_">Direct</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.2500000000</span>        <span class="number">0.7500000000</span>        <span class="number">0.7500000000</span></span><br><span class="line">    <span class="number">0.5000000000</span>        <span class="number">0.0000000000</span>        <span class="number">0.5000000000</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">0.5000000000</span>        <span class="number">0.5000000000</span></span><br><span class="line">    <span class="number">0.5000000000</span>        <span class="number">0.5000000000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.7500000000</span>        <span class="number">0.2500000000</span>        <span class="number">0.7500000000</span></span><br><span class="line">    <span class="number">0.7500000000</span>        <span class="number">0.7500000000</span>        <span class="number">0.2500000000</span></span><br><span class="line">    <span class="number">0.2500000000</span>        <span class="number">0.2500000000</span>        <span class="number">0.2500000000</span></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq <span class="number">400</span> <span class="number">50</span> <span class="number">700</span>) #截断能从<span class="number">450</span>-<span class="number">800</span>，步数为<span class="number">50</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">#生成vasp静态计算的<span class="variable constant_">INCAR</span></span><br><span class="line">cat &gt; INCAR_static &lt;&lt;!</span><br><span class="line"><span class="title class_">Global</span> <span class="title class_">Parameters</span></span><br><span class="line">  <span class="variable constant_">ISTART</span> =  <span class="number">0</span>            (<span class="title class_">Read</span> existing wavefunction; <span class="keyword">if</span> there)</span><br><span class="line">  <span class="variable constant_">ICHARG</span> =  <span class="number">2</span>            (<span class="title class_">Non</span>-self-<span class="attr">consistent</span>: <span class="variable constant_">GGA</span>/<span class="variable constant_">LDA</span> band structures)</span><br><span class="line">  <span class="variable constant_">LREAL</span>  = .<span class="property">FALSE</span>.       (<span class="title class_">Projection</span> <span class="attr">operators</span>: automatic)</span><br><span class="line">  <span class="variable constant_">ENCUT</span>  =  $i           (<span class="title class_">Cut</span>-off energy <span class="keyword">for</span> plane wave basis set, <span class="keyword">in</span> eV)</span><br><span class="line">  <span class="variable constant_">PREC</span>   =  <span class="title class_">Accurate</span>     (<span class="title class_">Precision</span> level)  </span><br><span class="line">  <span class="variable constant_">LWAVE</span>  = .<span class="property">FALSE</span>.       (<span class="title class_">Write</span> <span class="variable constant_">WAVECAR</span> or not)</span><br><span class="line">  <span class="variable constant_">LCHARG</span> = .<span class="property">FALSE</span>.       (<span class="title class_">Write</span> <span class="variable constant_">CHGCAR</span> or not) </span><br><span class="line">  <span class="variable constant_">ADDGRID</span>= .<span class="property">TRUE</span>.        (<span class="title class_">Increase</span> grid; helps <span class="variable constant_">GGA</span> convergence)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Electronic</span> <span class="title class_">Relaxation</span></span><br><span class="line">  <span class="variable constant_">ISMEAR</span> =  -<span class="number">5</span>           (<span class="title class_">Gaussian</span> smearing; <span class="attr">metals</span>:<span class="number">1</span>)</span><br><span class="line">  #<span class="variable constant_">SIGMA</span>  =  <span class="number">0.05</span>        (<span class="title class_">Smearing</span> value <span class="keyword">in</span> eV; <span class="attr">metals</span>:<span class="number">0.2</span>)</span><br><span class="line">  <span class="variable constant_">NELM</span>   =  <span class="number">60</span>           (<span class="title class_">Max</span> electronic <span class="variable constant_">SCF</span> steps)  </span><br><span class="line">  <span class="variable constant_">NELMIN</span> =  <span class="number">4</span>            (<span class="title class_">Min</span> electronic <span class="variable constant_">SCF</span> steps)</span><br><span class="line">  <span class="variable constant_">EDIFF</span>  =  <span class="number">1E-06</span>        (<span class="variable constant_">SCF</span> energy convergence; <span class="keyword">in</span> eV)</span><br><span class="line">  <span class="variable constant_">GGA</span>  =  <span class="variable constant_">PE</span>             (<span class="title class_">PBEsol</span> exchange-correlation)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Ionic</span> <span class="title class_">Relaxation</span></span><br><span class="line">  <span class="variable constant_">ISIF</span>   =  <span class="number">2</span>            (<span class="title class_">Stress</span>/<span class="attr">relaxation</span>: <span class="number">2</span>-<span class="title class_">Ions</span>, <span class="number">3</span>-<span class="title class_">Shape</span>/<span class="title class_">Ions</span>/V，<span class="number">4</span>-<span class="title class_">Shape</span>/<span class="title class_">Ions</span>)</span><br><span class="line">  <span class="variable constant_">EDIFFG</span> = -<span class="number">0.001</span>        (<span class="title class_">Ionic</span> convergence; eV/<span class="variable constant_">AA</span>)</span><br><span class="line">  #<span class="variable constant_">KSPACING</span> = <span class="number">0.10</span></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">cp INCAR_static <span class="variable constant_">INCAR</span></span><br><span class="line">echo <span class="string">&quot;ENCUT = $i eV&quot;</span> ; time mpirun -np <span class="number">16</span> vasp_std #vasp并行运行命令，根据系统自行修改</span><br><span class="line"></span><br><span class="line">rm INCAR_static</span><br><span class="line">rm <span class="variable constant_">INCAR</span></span><br><span class="line">#提取计算得到的能量</span><br><span class="line">E=$(grep <span class="string">&quot;TOTEN&quot;</span> <span class="variable constant_">OUTCAR</span> | tail -<span class="number">1</span> | awk <span class="string">&#x27;&#123;printf &quot;%12.9f \n&quot;, $5 &#125;&#x27;</span>)</span><br><span class="line">echo $i $E &gt;&gt;encut_energy.<span class="property">out</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h1 id="K点测试"><a href="#K点测试" class="headerlink" title="K点测试"></a>K点测试</h1><p>是倒空间（动量空间）的基本构成点，只取在一个倒空间晶格向量的范围内来描述 k 。总能量计算是对布里渊区内的波函数进行积分，而积分是通过对部分特殊K点的求和完成的。因此，计算一个体系时，需要确定所用KPOINTS的大小。<br><strong>k.sh如下：</strong></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>bash</span><br><span class="line">#生成vasp静态计算的<span class="variable constant_">INCAR</span></span><br><span class="line">cat &gt; INCAR_static &lt;&lt;!</span><br><span class="line"><span class="title class_">Global</span> <span class="title class_">Parameters</span></span><br><span class="line">  <span class="variable constant_">ISTART</span> =  <span class="number">0</span>            (<span class="title class_">Read</span> existing wavefunction; <span class="keyword">if</span> there)</span><br><span class="line">  <span class="variable constant_">ICHARG</span> =  <span class="number">2</span>            (<span class="title class_">Non</span>-self-<span class="attr">consistent</span>: <span class="variable constant_">GGA</span>/<span class="variable constant_">LDA</span> band structures)</span><br><span class="line">  <span class="variable constant_">LREAL</span>  = .<span class="property">FALSE</span>.       (<span class="title class_">Projection</span> <span class="attr">operators</span>: automatic)</span><br><span class="line">  <span class="variable constant_">ENCUT</span>  =  <span class="number">500</span>           (<span class="title class_">Cut</span>-off energy <span class="keyword">for</span> plane wave basis set, <span class="keyword">in</span> eV)</span><br><span class="line">  <span class="variable constant_">PREC</span>   =  <span class="title class_">Accurate</span>     (<span class="title class_">Precision</span> level)  </span><br><span class="line">  <span class="variable constant_">LWAVE</span>  = .<span class="property">FALSE</span>.       (<span class="title class_">Write</span> <span class="variable constant_">WAVECAR</span> or not)</span><br><span class="line">  <span class="variable constant_">LCHARG</span> = .<span class="property">FALSE</span>.       (<span class="title class_">Write</span> <span class="variable constant_">CHGCAR</span> or not) </span><br><span class="line">  <span class="variable constant_">ADDGRID</span>= .<span class="property">TRUE</span>.        (<span class="title class_">Increase</span> grid; helps <span class="variable constant_">GGA</span> convergence)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Electronic</span> <span class="title class_">Relaxation</span></span><br><span class="line">  <span class="variable constant_">ISMEAR</span> =  -<span class="number">5</span>           (<span class="title class_">Gaussian</span> smearing; <span class="attr">metals</span>:<span class="number">1</span>)</span><br><span class="line">  #<span class="variable constant_">SIGMA</span>  =  <span class="number">0.05</span>        (<span class="title class_">Smearing</span> value <span class="keyword">in</span> eV; <span class="attr">metals</span>:<span class="number">0.2</span>)</span><br><span class="line">  <span class="variable constant_">NELM</span>   =  <span class="number">60</span>           (<span class="title class_">Max</span> electronic <span class="variable constant_">SCF</span> steps)  </span><br><span class="line">  <span class="variable constant_">NELMIN</span> =  <span class="number">4</span>            (<span class="title class_">Min</span> electronic <span class="variable constant_">SCF</span> steps)</span><br><span class="line">  <span class="variable constant_">EDIFF</span>  =  <span class="number">1E-06</span>        (<span class="variable constant_">SCF</span> energy convergence; <span class="keyword">in</span> eV)</span><br><span class="line">  <span class="variable constant_">GGA</span>  =  <span class="variable constant_">PE</span>             (<span class="title class_">PBEsol</span> exchange-correlation)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Ionic</span> <span class="title class_">Relaxation</span></span><br><span class="line">  <span class="variable constant_">ISIF</span>   =  <span class="number">2</span>            (<span class="title class_">Stress</span>/<span class="attr">relaxation</span>: <span class="number">2</span>-<span class="title class_">Ions</span>, <span class="number">3</span>-<span class="title class_">Shape</span>/<span class="title class_">Ions</span>/V，<span class="number">4</span>-<span class="title class_">Shape</span>/<span class="title class_">Ions</span>)</span><br><span class="line">  <span class="variable constant_">EDIFFG</span> = -<span class="number">0.001</span>        (<span class="title class_">Ionic</span> convergence; eV/<span class="variable constant_">AA</span>)</span><br><span class="line">  #<span class="variable constant_">KSPACING</span> = <span class="number">0.10</span></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">cp INCAR_static <span class="variable constant_">INCAR</span></span><br><span class="line"></span><br><span class="line">#产生计算所需<span class="variable constant_">POSCAR</span></span><br><span class="line">cat &gt; <span class="variable constant_">POSCAR</span>&lt;&lt;!</span><br><span class="line"><span class="title class_">Si8</span></span><br><span class="line"><span class="number">1.0000000000</span></span><br><span class="line">    <span class="number">5.4687280000</span>        <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">5.4687280000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span>        <span class="number">5.4687280000</span></span><br><span class="line"><span class="title class_">Si</span></span><br><span class="line"><span class="number">8</span></span><br><span class="line"><span class="title class_">Direct</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.2500000000</span>        <span class="number">0.7500000000</span>        <span class="number">0.7500000000</span></span><br><span class="line">    <span class="number">0.5000000000</span>        <span class="number">0.0000000000</span>        <span class="number">0.5000000000</span></span><br><span class="line">    <span class="number">0.0000000000</span>        <span class="number">0.5000000000</span>        <span class="number">0.5000000000</span></span><br><span class="line">    <span class="number">0.5000000000</span>        <span class="number">0.5000000000</span>        <span class="number">0.0000000000</span></span><br><span class="line">    <span class="number">0.7500000000</span>        <span class="number">0.2500000000</span>        <span class="number">0.7500000000</span></span><br><span class="line">    <span class="number">0.7500000000</span>        <span class="number">0.7500000000</span>        <span class="number">0.2500000000</span></span><br><span class="line">    <span class="number">0.2500000000</span>        <span class="number">0.2500000000</span>        <span class="number">0.2500000000</span></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> $(seq <span class="number">6</span> <span class="number">3</span> <span class="number">15</span>) #K点从<span class="number">6</span>-<span class="number">24</span>，步数为<span class="number">3</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">#生成<span class="variable constant_">KPOINTS</span>文件，K点类型：<span class="title class_">Monkhorst</span>-<span class="title class_">Pack</span> (M) 或者 <span class="title class_">Gamma</span> (G)</span><br><span class="line">cat &gt; <span class="variable constant_">KPOINTS</span> &lt;&lt;!</span><br><span class="line"><span class="title class_">Automatic</span> mesh</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="title class_">Monkhorst</span>-<span class="title class_">Pack</span></span><br><span class="line">$i $i $i</span><br><span class="line"><span class="number">0</span>  <span class="number">0</span>  <span class="number">0</span></span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">echo <span class="string">&quot;KPOINTS = $i&quot;</span> ; time mpirun -n <span class="number">16</span> vasp_std #vasp并行运行命令，根据系统自行修改</span><br><span class="line"></span><br><span class="line">rm <span class="variable constant_">KPOINTS</span></span><br><span class="line">#提取计算得到的能量</span><br><span class="line">E=$(grep <span class="string">&quot;TOTEN&quot;</span> <span class="variable constant_">OUTCAR</span> | tail -<span class="number">1</span> | awk <span class="string">&#x27;&#123;printf &quot;%12.9f \n&quot;, $5 &#125;&#x27;</span>)</span><br><span class="line">echo $i $E &gt;&gt;kpoints_energy.<span class="property">out</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h1 id="显示收敛情况的脚本"><a href="#显示收敛情况的脚本" class="headerlink" title="显示收敛情况的脚本"></a>显示收敛情况的脚本</h1><p>参考：<a target="_blank" rel="noopener" href="https://blog.shishiruqi.com/2019/08/19/paili-energyforce/">https://blog.shishiruqi.com/2019/08/19/paili-energyforce/</a></p>
<ul>
<li>简单版：</li>
</ul>
<p><code>grep F= OSZICAR |awk &#39;&#123;print $1,$5&#125;&#39;</code><br><code>grep F= OSZICAR |awk &#39;&#123;print $1,$5&#125;&#39; &gt; conv.dat</code></p>
<ul>
<li>小脚本：<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/env bash</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> *; <span class="keyword">do</span></span><br><span class="line"><span class="keyword">if</span> [ -e $i/<span class="variable constant_">OUTCAR</span> ]; then</span><br><span class="line">echo -e  $i <span class="string">&quot;\t&quot;</span> $(grep <span class="string">&#x27;  without&#x27;</span> $i/<span class="variable constant_">OUTCAR</span> |tail -n <span class="number">1</span> | awk <span class="string">&#x27;&#123;print $7&#125;&#x27;</span>)</span><br><span class="line">fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure></li>
<li>复杂：<br><strong>ediff.sh如下：（安装gnuplot）</strong><figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>sh</span><br><span class="line">#lipai@mail.<span class="property">ustc</span>.<span class="property">edu</span>.<span class="property">cn</span></span><br><span class="line"></span><br><span class="line">begin=$1</span><br><span class="line"><span class="keyword">if</span> [ $begin ==<span class="string">&#x27;&#x27;</span> ]; then begin=<span class="number">0</span>; fi    </span><br><span class="line">awk -v begin=$begin <span class="string">&#x27;/E0/&#123;if ( i&lt;begin  ) i++;else print $0 &#125;&#x27;</span> <span class="variable constant_">OSZICAR</span> &gt;temp.<span class="property">e</span></span><br><span class="line">    </span><br><span class="line">awk <span class="string">&#x27;/POSITION/,/drift/&#123;</span></span><br><span class="line"><span class="string">    if(NF==6) print $4,$5,$6;</span></span><br><span class="line"><span class="string">    else if($1==&quot;total&quot;) print $1 &#125;&#x27;</span> <span class="variable constant_">OUTCAR</span> &gt;temp.<span class="property">f</span></span><br><span class="line"></span><br><span class="line">awk <span class="string">&#x27;&#123;if($4==&quot;F&quot;||$4==&quot;T&quot;) print $4,$5,$6&#125;&#x27;</span> <span class="variable constant_">CONTCAR</span> &gt;temp.<span class="property">fix</span></span><br><span class="line">flag=<span class="string">`wc temp.fix|awk &#x27;&#123;print $1&#125;&#x27;`</span></span><br><span class="line">steps=<span class="string">`grep E0 OSZICAR |tail -1 |awk &#x27;&#123;print $1&#125;&#x27;`</span></span><br><span class="line"><span class="keyword">if</span> [ flag != <span class="string">&#x27;0&#x27;</span> ] ; then</span><br><span class="line">    <span class="keyword">if</span> [ -f temp.<span class="property">fixx</span> ] ; then rm temp.<span class="property">fixx</span> ; fi</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">`seq $steps`</span>;<span class="keyword">do</span></span><br><span class="line">        cat temp.<span class="property">fix</span> &gt;&gt;temp.<span class="property">fixx</span></span><br><span class="line">        echo &gt;&gt;temp.<span class="property">fixx</span></span><br><span class="line">    done</span><br><span class="line">    paste temp.<span class="property">f</span> temp.<span class="property">fixx</span> &gt;temp.<span class="property">ff</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">awk  <span class="string">&#x27;&#123; if($1==&quot;total&quot;) &#123;print ++i,a;a=0&#125;</span></span><br><span class="line"><span class="string">        else &#123;</span></span><br><span class="line"><span class="string">            if($4==&quot;F&quot;) x=0; else x=$1;</span></span><br><span class="line"><span class="string">            if($5==&quot;F&quot;) y=0; else y=$2;</span></span><br><span class="line"><span class="string">            if($6==&quot;F&quot;) z=0; else z=$3;</span></span><br><span class="line"><span class="string">            force=sqrt(x^2+y^2+z^2);</span></span><br><span class="line"><span class="string">            if(a&lt;force) a=force&#125; &#125;&#x27;</span> temp.<span class="property">ff</span> &gt;force.<span class="property">conv</span></span><br><span class="line"></span><br><span class="line">gnuplot &lt;&lt;<span class="variable constant_">EOF</span> </span><br><span class="line">set term dumb</span><br><span class="line">set title <span class="string">&#x27;Energy of each ionic step&#x27;</span></span><br><span class="line">set xlabel <span class="string">&#x27;Ionic steps&#x27;</span></span><br><span class="line">set ylabel <span class="string">&#x27;Energy(eV)&#x27;</span></span><br><span class="line">plot <span class="string">&#x27;temp.e&#x27;</span> u <span class="number">1</span>:<span class="number">5</span> w l  t <span class="string">&quot;Energy in eV&quot;</span></span><br><span class="line">set title <span class="string">&#x27;Max Force of each ionic step&#x27;</span></span><br><span class="line">set xlabel <span class="string">&#x27;Ionic steps&#x27;</span></span><br><span class="line">set ylabel <span class="string">&#x27;Force (eV/Angstrom)&#x27;</span></span><br><span class="line">plot <span class="string">&#x27;force.conv&#x27;</span> w l t <span class="string">&quot;Force in eV/Angstrom&quot;</span></span><br><span class="line"><span class="variable constant_">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ $steps -gt <span class="number">8</span> ] ; then</span><br><span class="line">tail -<span class="number">5</span> force.<span class="property">conv</span> &gt;temp.<span class="property">fff</span></span><br><span class="line">tail -<span class="number">5</span> temp.<span class="property">e</span> &gt;temp.<span class="property">ee</span></span><br><span class="line">gnuplot &lt;&lt;<span class="variable constant_">EOF</span> </span><br><span class="line">set term dumb</span><br><span class="line">set title <span class="string">&#x27;Energy of each ionic step for the last few steps&#x27;</span></span><br><span class="line">set xlabel <span class="string">&#x27;Ionic steps&#x27;</span></span><br><span class="line">set ylabel <span class="string">&#x27;Energy(eV)&#x27;</span></span><br><span class="line">plot <span class="string">&#x27;temp.ee&#x27;</span> u <span class="number">1</span>:<span class="number">5</span> w l  t <span class="string">&quot;Energy in eV&quot;</span></span><br><span class="line">set title <span class="string">&#x27;Max Force of each ionic step for the last few steps&#x27;</span></span><br><span class="line">set xlabel <span class="string">&#x27;Ionic steps&#x27;</span></span><br><span class="line">set ylabel <span class="string">&#x27;Force (eV/Angstrom)&#x27;</span></span><br><span class="line">plot <span class="string">&#x27;temp.fff&#x27;</span> w l  t <span class="string">&quot;Force in eV/Angstrom&quot;</span></span><br><span class="line"><span class="variable constant_">EOF</span></span><br><span class="line">rm temp.<span class="property">fff</span> temp.<span class="property">ee</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">rm temp.<span class="property">e</span> temp.<span class="property">f</span> temp.<span class="property">ff</span> temp.<span class="property">fix</span> temp.<span class="property">fixx</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="批量提交任务"><a href="#批量提交任务" class="headerlink" title="批量提交任务"></a>批量提交任务</h1><p>适用于测试、有限位移法求力常数矩阵等情况。<br>简单：  <code>for i in *; do cd $i ; qsub sub4; cd $OLDPWD; done </code></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/bin/</span>sh</span><br><span class="line">root_path=<span class="string">&#x27;pwd&#x27;</span></span><br><span class="line"></span><br><span class="line">#在每个job文件夹里进行静态计算。</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;<span class="number">001</span>.<span class="number">.1316</span>&#125; #按顺序从job-<span class="number">001</span>到<span class="number">116</span>做静态vasp计算,根据生成的文件夹设定</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">cd job-$i</span><br><span class="line">echo <span class="string">&quot;job-$i&quot;</span>, time </span><br><span class="line">sbatch sub.<span class="property">sh</span></span><br><span class="line">wait</span><br><span class="line">cd ..</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h1 id="批量产生文件夹"><a href="#批量产生文件夹" class="headerlink" title="批量产生文件夹"></a>批量产生文件夹</h1><figure class="highlight plaintext"><figcaption><span>i in &#123;2..9&#125;; do cp 0.01 0.0$i -r ; done ``` #批量复制0.01文件夹复制成0.02-0.09</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">```sed &#x27;3s/0.01/0.02/g&#x27; INCAR &gt; INCAR_new```  #将INCAR中的第三行的0.01全部替换成0.02并输出位INCAR_new文件。</span><br><span class="line">```sed -i &#x27;3s/0.01/0.02/g&#x27; INCAR``` # -i表示直接对源文件进行编辑，也就是说编辑之后源文件被新文件替换掉。</span><br><span class="line">```for i in *; do sed -i &quot;3s/0.05/$i/g&quot; $i/INCAR ; done``` #将文件夹中所有的0.01替换成了文件夹序号。</span><br><span class="line"></span><br><span class="line">我们主要对KPOINTS的文件的第四行进行批量操作，将1 1 1改成 2 2 2， 3 3 3 等。复制文件夹：</span><br><span class="line">```for i in &#123;1..6&#125;; do cp ../ex03/0.01/ $&#123;i&#125;$&#123;i&#125;$&#123;i&#125; -r ; done```</span><br><span class="line">显示行号：</span><br><span class="line">```cat 333/KPOINTS  -n ```</span><br><span class="line">修改文件;</span><br><span class="line">```for i in &#123;1..6&#125;; do sed -i &#x27;4s/1 1 1/$i $i $i/g&#x27; $&#123;i&#125;$&#123;i&#125;$&#123;i&#125;/KPOINTS ; done```</span><br><span class="line"></span><br><span class="line">脚本：</span><br><span class="line"> ```javascript  &#123;.line-numbers&#125; </span><br><span class="line">for i in 3RD.POSCAR.*</span><br><span class="line">do</span><br><span class="line">s=$(echo $i| cut -d &quot;.&quot; -f 3) #代表.的3个字符</span><br><span class="line">d=job-$s</span><br><span class="line">mkdir $d</span><br><span class="line">cp $i $d/POSCAR</span><br><span class="line">cp ./INCAR ./sub.sh ./KPOINTS ./POTCAR $d</span><br><span class="line">pushd $d</span><br><span class="line">popd</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h1 id="节约机时"><a href="#节约机时" class="headerlink" title="节约机时"></a>节约机时</h1><p><strong>grep User OUTCAR 后得出的结果被空格分成了4部分，时间信息在第4部分里面。User 或者 Elapsed都可以。</strong></p>
<ul>
<li>一个合理的初始结构，可以避免很多意外的错误以及快速得到正确的结果。</li>
<li>如果你设置的收敛标准比较严格，精度比较高，则每一个离子步需要更多的电子步数，需要的时间也会随着离子步的增加成线性关系增长。</li>
<li>ENCUT和KPOINTS文件需要测试，二者越大时间越久。</li>
<li>这里我们就会需要一些其他的参数，<strong>NCORE和NPAR。</strong><br>NCORE：控制多少个核同时计算；<br>NPAR：如何把计算任务分配到计算资源上面计算。<br>它们之间的关系是：NCORE&#x3D; 计算使用的核数 &#x2F; NPAR。注意：这两个参数只能选取一个来使用:<br>NCORE&#x3D;单节点的核数，单节点的核数&#x2F;2，单节点的核数&#x2F;4…….个人使用经验是：NCORE &#x3D; 单个节点核数 &#x2F; 2 的时候，运行最省时间，设置也最方便。<br>当然NCORE也需要测试。</li>
</ul>
<h1 id="消虚频"><a href="#消虚频" class="headerlink" title="消虚频"></a>消虚频</h1><h3 id="结构优化消虚频"><a href="#结构优化消虚频" class="headerlink" title="结构优化消虚频"></a>结构优化消虚频</h3><p>X, Y, Z为体系中原子的坐标，也就是POSCAR中的内容。 dx, dy,dz为虚频对应的原子振动方向上的位移。我们将（dx, dy,dz）这个位移乘以一个介于0-1之间的校正因子，然后跟POSCAR中的坐标加起来即可。以z方向为例，<strong>校正因子设为0.1，</strong> 微调后的z方向坐标为： 10.709980 + （-0.676634）0.1。<br>脚本vib_correct.py如下：<a target="_blank" rel="noopener" href="https://www.bigbrosci.com/2022/04/29/A29/">https://www.bigbrosci.com/2022/04/29/A29/</a></p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># -*- <span class="attr">coding</span>: utf-<span class="number">8</span> -*-</span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">Qiang Li</span></span><br><span class="line"><span class="string">Command: python3 vib_correct.py </span></span><br><span class="line"><span class="string">This is a temporary script file.</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> ase.<span class="property">io</span> <span class="keyword">import</span> read, write</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">#获取虚频开始行</span><br><span class="line">l_position = <span class="number">0</span>  #虚频振动方向部分在<span class="variable constant_">OUTCAR</span>中的起始行数</span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;OUTCAR&#x27;</span>) <span class="keyword">as</span> <span class="attr">f_in</span>:</span><br><span class="line">    lines = f_in.<span class="title function_">readlines</span>()</span><br><span class="line">    wave_num = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> num, line <span class="keyword">in</span> <span class="title function_">enumerate</span>(lines):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;f/i&#x27;</span> <span class="keyword">in</span> <span class="attr">line</span>:</span><br><span class="line">            wave_tem = <span class="title function_">float</span>(line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">6</span>])</span><br><span class="line">            <span class="keyword">if</span> wave_tem &gt; <span class="attr">wave_num</span>: #获取最大的虚频</span><br><span class="line">                wave_num = wave_tem</span><br><span class="line">                l_position = num+<span class="number">2</span></span><br><span class="line"># <span class="variable constant_">ASE</span>读<span class="variable constant_">POSCAR</span></span><br><span class="line">model = <span class="title function_">read</span>(<span class="string">&#x27;POSCAR&#x27;</span>)</span><br><span class="line">model_positions = model.<span class="title function_">get_positions</span>()</span><br><span class="line">num_atoms = <span class="title function_">len</span>(model)</span><br><span class="line">#<span class="title function_">print</span>(model_positions)</span><br><span class="line"></span><br><span class="line"># 获取虚频对应的<span class="variable constant_">OUTCAR</span>部分 </span><br><span class="line">vib_lines = lines[<span class="attr">l_position</span>:l_position + num_atoms] #振动部分 <span class="number">7222</span>到<span class="number">7248</span>行</span><br><span class="line">#<span class="title function_">print</span>(vib_lines)</span><br><span class="line">vib_dis = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="attr">vib_lines</span>:</span><br><span class="line">    #model_positions = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[:<span class="number">3</span>]]</span><br><span class="line">    vib_infor = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">3</span>:]] # dx， dy， dz对应的那三列</span><br><span class="line">    vib_dis.<span class="title function_">append</span>(vib_infor)</span><br><span class="line">vib_dis = np.<span class="title function_">array</span>(vib_dis) #将振动部分写到一个array中。</span><br><span class="line"></span><br><span class="line"># 微调结构</span><br><span class="line">new_positions = model_positions + vib_dis * <span class="number">0.4</span> # <span class="number">0.4</span>是微调的校正因子，即虚频对应振动位移的<span class="number">0.4</span>，具体多大自己根据经验调。</span><br><span class="line">model.<span class="property">positions</span> = new_positions</span><br><span class="line"></span><br><span class="line">###保存结构</span><br><span class="line"><span class="title function_">write</span>(<span class="string">&#x27;POSCAR_new&#x27;</span>, model, vasp5=<span class="title class_">True</span>) # POSCAR_new是微调后的结构，用于下一步的计算（别忘了把POSCAR_new改成<span class="variable constant_">POSCAR</span>）。</span><br></pre></td></tr></table></figure>

<h3 id="过渡态虚频"><a href="#过渡态虚频" class="headerlink" title="过渡态虚频"></a>过渡态虚频</h3><p>如果过渡态计算的时候出现好几个虚频，自己直接写个python脚本也能实现。不过使用ASE可以很方便地获取POSCAR中原子数目，保存原子固定的信息。参考如下。</p>
<figure class="highlight javascript"><figcaption><span>&#123;.line-numbers&#125;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#!<span class="regexp">/usr/</span>bin/env python</span><br><span class="line"># -*- <span class="attr">coding</span>: utf-<span class="number">8</span> -*-</span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">Qiang Li</span></span><br><span class="line"><span class="string">Command: python3 vib_correct.py</span></span><br><span class="line"><span class="string">This is a temporary script file.</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">#获取虚频开始行</span><br><span class="line">l_position = <span class="number">0</span>  #虚频振动方向部分在<span class="variable constant_">OUTCAR</span>中的起始行数</span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;OUTCAR&#x27;</span>) <span class="keyword">as</span> <span class="attr">f_in</span>:</span><br><span class="line">    lines = f_in.<span class="title function_">readlines</span>()</span><br><span class="line">    wave_num = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> num, line <span class="keyword">in</span> <span class="title function_">enumerate</span>(lines):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;f/i&#x27;</span> <span class="keyword">in</span> <span class="attr">line</span>:</span><br><span class="line">            wave_tem = <span class="title function_">float</span>(line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">6</span>])</span><br><span class="line">            <span class="keyword">if</span> wave_tem &gt; <span class="attr">wave_num</span>: #获取最大的虚频</span><br><span class="line">                wave_num = wave_tem</span><br><span class="line">                l_position = num+<span class="number">2</span></span><br><span class="line"># 读<span class="variable constant_">POSCAR</span></span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;POSCAR&#x27;</span>) <span class="keyword">as</span> <span class="attr">f_pos</span>:</span><br><span class="line">    lines_pos = f_pos.<span class="title function_">readlines</span>()</span><br><span class="line"></span><br><span class="line"># 获取虚频对应的<span class="variable constant_">OUTCAR</span>部分    </span><br><span class="line">num_atoms = <span class="title function_">sum</span>([<span class="title function_">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> lines_pos[<span class="number">6</span>].<span class="title function_">rstrip</span>().<span class="title function_">split</span>()])</span><br><span class="line">vib_lines = lines[<span class="attr">l_position</span>:l_position + num_atoms] #振动部分 <span class="number">7222</span>到<span class="number">7248</span>行</span><br><span class="line"></span><br><span class="line">model_positions = []</span><br><span class="line">vib_dis = []</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="attr">vib_lines</span>:</span><br><span class="line">    position = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[:<span class="number">3</span>]]</span><br><span class="line">    vib_infor = [<span class="title function_">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> line.<span class="title function_">rstrip</span>().<span class="title function_">split</span>()[<span class="number">3</span>:]] # dx， dy， dz对应的那三列</span><br><span class="line">    model_positions.<span class="title function_">append</span>(position)</span><br><span class="line">    vib_dis.<span class="title function_">append</span>(vib_infor)</span><br><span class="line"></span><br><span class="line"># 微调结构</span><br><span class="line">model_positions = np.<span class="title function_">array</span>(model_positions)</span><br><span class="line">vib_dis = np.<span class="title function_">array</span>(vib_dis) #将振动部分写到一个array中。</span><br><span class="line">new_positions = model_positions + vib_dis * <span class="number">0.4</span> # <span class="number">0.4</span>是微调的校正因子，即虚频对应振动位移的<span class="number">0.4</span>，具体多大自己根据经验调。</span><br><span class="line"></span><br><span class="line">###保存结构</span><br><span class="line">f_out = <span class="title function_">open</span>(<span class="string">&#x27;POSCAR_new&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f_out.<span class="title function_">writelines</span>(lines_pos[:<span class="number">8</span>])</span><br><span class="line">f_out.<span class="title function_">write</span>(<span class="string">&#x27;Cartesian\n&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="attr">new_positions</span>:</span><br><span class="line">    f_out.<span class="title function_">write</span>(<span class="string">&#x27; &#x27;</span>.<span class="title function_">join</span>([<span class="title function_">str</span>(coord) <span class="keyword">for</span> coord <span class="keyword">in</span> i]) + <span class="string">&#x27;  F  F  F\n&#x27;</span>)</span><br><span class="line">f_out.<span class="title function_">close</span>()</span><br></pre></td></tr></table></figure>


<h1 id="滑移堆叠能计算"><a href="#滑移堆叠能计算" class="headerlink" title="滑移堆叠能计算"></a>滑移堆叠能计算</h1><p>该脚本是计算双层的堆叠能，滑移能类似。准备优化好的POSCAR和其他输入文件。<br>stack.sh如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># 参数设置</span><br><span class="line">slip_step_x=$(echo &quot;scale=5; 1/12&quot; | bc)  # x方向滑移步长 (1/12) scale=5 设置浮点数精度为 5 位小数</span><br><span class="line">slip_step_y=$(echo &quot;scale=5; 1/12&quot; | bc)  # y方向滑移步长 (1/12)</span><br><span class="line">slip_steps=11                             # 滑移步数（从0到11，共12步）</span><br><span class="line"></span><br><span class="line"># 循环生成滑移结构</span><br><span class="line">for i in $(seq 0 $slip_steps); do</span><br><span class="line">    for j in $(seq 0 $slip_steps); do</span><br><span class="line">        # 格式化文件夹名称（固定宽度，两位数字）</span><br><span class="line">        folder_name=$(printf &quot;slip_%02d_%02d&quot; &quot;$i&quot; &quot;$j&quot;)</span><br><span class="line">        mkdir -p &quot;$folder_name&quot;</span><br><span class="line">        </span><br><span class="line">        # 复制输入文件（排除目录）</span><br><span class="line">        find . -maxdepth 1 -type f -name &quot;[IKPs]*&quot; -exec cp &#123;&#125; &quot;$folder_name/&quot; \;   #这里排除复制文件夹</span><br><span class="line">        cp ./sub.sh &quot;$folder_name/&quot;   # 复制 sub.sh提交任务的脚本</span><br><span class="line">        find . -maxdepth 1 -type f -name &quot;vdw-*&quot; -exec cp &#123;&#125; &quot;$folder_name/&quot; \;  # 这里使用opt86b范德华修正，自行选择</span><br><span class="line">        </span><br><span class="line">        # 计算滑移量</span><br><span class="line">        slip_x=$(echo &quot;scale=5; $i * $slip_step_x&quot; | bc)</span><br><span class="line">        slip_y=$(echo &quot;scale=5; $j * $slip_step_y&quot; | bc)</span><br><span class="line">        </span><br><span class="line">        # 修改POSCAR文件</span><br><span class="line">        awk -v slip_x=&quot;$slip_x&quot; -v slip_y=&quot;$slip_y&quot; &#x27;</span><br><span class="line">        &#123;</span><br><span class="line">            if (NR &gt; 9 &amp;&amp; $3 &gt; 0.5) &#123;</span><br><span class="line">                print $1 + slip_x, $2 + slip_y, $3, $4, $5, $6</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                print $0</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;&#x27; POSCAR &gt; &quot;$folder_name/POSCAR&quot;</span><br><span class="line">    done</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &quot;滑移结构生成完成。&quot;</span><br></pre></td></tr></table></figure>

<p>解释： 由于是六方结构，所有滑移步长1&#x2F;12,可自行更改。if (NR &gt; 9 &amp;&amp; $3 &gt; 0.5)里的0.5在两层之间，大于0.5的移动，小于等于不移动。要固定晶格 ISIF &#x3D; 2，离子要优化，要固定一些原子的xy方向的坐标，防止平面间的滑移，优化z方向。</p>
<p>批量提交任务：for dir in slip_*&#x2F;; do cd “$dir”；qsub sub.sh； cd .. ；done</p>
<p>取消所有任务(slurm)：scancel -u $USER</p>
<h1 id="常用命令行"><a href="#常用命令行" class="headerlink" title="常用命令行"></a>常用命令行</h1><p><code>grep &quot;33  81&quot; -A3 FORCE_CONSTANTS | xargs echo -n| awk &#39;&#123;print $1,$2,$3+$7+$11&#125;&#39; &gt;&gt; trace.dat </code></p>
<p>计算原子间二阶力常数矩阵的迹</p>
<p><code>grep &#39;F=&#39; OSZICAR|awk &#39;&#123;print $1, &quot;\t&quot;$3,&quot;\t&quot;$9&#125;&#39; &gt;AIMD.dat</code></p>
<p>提取分子动力学温度能量数值</p>
<p><code>for i in 01 02 03 04 05;do cd $i &amp;&amp; cp CONTCAR POSCAR &amp;&amp; cd ..;done</code></p>
<p>CINEB计算重新计算</p>
<p><code>awk &#39;&#123;print $1,$2,$3+$4+$5,$6+$7+$8+$9+$10,$11&#125;&#39; PDOS &gt; pdos.dat</code></p>
<p>pdos轨道加和</p>
<p><code>grep LOOP+ OUTCAR |awk &#39;&#123;sum+=$4&#125; END &#123;print &quot;Average=&quot;,sum/NR&#125;&#39;</code></p>
<p><code>grep LOOP+ OUTCAR |awk &#39;&#123;sum+=$4&#125; END &#123;print &quot;Sum=&quot;,sum&#125;&#39;</code></p>
<p><code>grep LOOP+ OUTCAR |wc -l</code></p>
<p>提取平均离子步时间，总时间，总步数</p>
<p><code>echo -e &quot;4\n403\n49-96 121-144\n1\n&quot;|vaspkit</code></p>
<p>vaspkit命令行</p>
<p><code>for i in *; do mkdir $i &amp;&amp; cp INCAR KPOINTS POSCAR POTCAR sub.sh $i &amp;&amp; sed -i &quot;3s/0.05/$i/g&quot; $i/INCAR ; done</code></p>
<p>批量修改INCAR</p>
<p><code>sed -i &#39;5s/\&lt;0\&gt;/0.5/&#39; filename  </code><br>请将 filename 替换为您要修改的文件名。<br>5s&#x2F;&lt;0&gt;&#x2F;0.5&#x2F;：<br>5：指定要修改的行号（第 5 行）。<br>s：表示替换操作。<br>&lt;0&gt;：匹配完整的数字 0，确保只替换单独的 0。<br>0.5：要替换成的新值。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-47-23/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-47-23/" class="post-title-link" itemprop="url">1.4 过渡态</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:47:23" itemprop="dateCreated datePublished" datetime="2023-05-09T18:47:23+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-06-05 10:10:11" itemprop="dateModified" datetime="2024-06-05T10:10:11+08:00">2024-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFT%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">DFT学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li>插入的image只需要看一下有没有原子互相挨得很近，有的话调一下就行。</li>
<li>一开始计算先用IOPT&#x3D;7，比IOPT&#x3D;3快一点，然后LCLIMB&#x3D;.FALSE.;算个一二十步之后再换IOPT&#x3D;1或2，LCLIMB&#x3D;.TRUE.</li>
<li>NEB计算不需要收敛，从经验来看也极少能碰到收敛的情况。主要是找到切线力尽可能等于0的点，然后用dimer算，基本都能找到过渡态。</li>
<li>nebresult.pl没用过，看结果“forces and energy:”下面的数据的第四列应该就是切线力，正常的计算切线力是由正值变到负值，或者由负值变到正值，然后找接近于0的点。你图里的数据只有正值，因此要么初末态构型有问题，要么你要找的点在0和1两个image之间。<br>不过1号image的切线力已经很接近0了，可以尝试直接做过dimer</li>
<li>跑个一二十步之后停止计算，‘mv CONTCAR POSCAR’之后修改INCAR再继续算。脚本都是线性插值，因此初始构型一般都很不合理，上来就用IOPT&#x3D;2的话收敛慢，甚至可能出错。跑个几十步等构型相对合理一些之后，再换IOPT&#x3D;2。</li>
<li>dimer是vasp里面自带的算法，详细用法手册里有。</li>
</ol>
<p>计算步骤</p>
<ol>
<li>初末态结构优化<br>建立两个文件夹ini(初态的意思),fin(末态)，每个文件夹放入vasp计算必备的四个文件（INCAR，POSCAR，KPOINTS，POTCAR），其中的两个POSCAR对应未优化的初末态。确保两个文件夹里面除POSCAR外，其他文件完全一样。</li>
</ol>
<p>对于两个POSCAR，注意每一行的原子一一对应。若有固定位置的原子（比方做表面计算，要固定底部1-2层原子），最好让两个POSCAR里面的固定原子位置完全相同。<br>用dist.pl检查两个优化后结构(两个CONTCAR)的相似程度（每个对应原子的初末态距离的平方和，再开根号）。</p>
<p>具体命令为： dist.pl ini&#x2F;CONTCAR fin&#x2F;CONTCAR<br>若返回值小于5A，一般可以进行下一步。<br>2. 插点<br>插点的数目取决于前面dist.pl的返回值，一般插点数目可取（dist.pl返回值&#x2F;0.8）。</p>
<p>具体插点的命令： nebmake.pl ini&#x2F;CONTCAR fin&#x2F;CONTCAR N</p>
<p>最后的N表示插点数目。插入点的算法为线性插值，详情请进前面给的vtst脚本链接。我这里设置N为3，执行完命令后出现文件夹00，01，02，03，04.五个文件夹里面都有nebmake.pl产生的POSCAR。</p>
<p>00表示初态，里面放的是ini&#x2F;CONTCAR,04表示末态，放的是fin&#x2F;CONTCAR, 01、02、03是插入的点。</p>
<p>输出中提示讲初末态对应的OUTCAR复制到对应的文件夹中，以便后续数据分析。<br>检查插入点的合理性：</p>
<p>输入命令 nebmovie.pl 0</p>
<p>参数0表示用POSCAR生成xyz文件；还可取1，为用CONTCAR生成。</p>
<p>可以看到每个文件夹内多了一个后缀名为xyz的文件。将这几个xyz文件合成一个movie.xyz文件即可在VMD中动画演示。我更倾向于使用jmol(或者ovito)来查看xyz文件，不过VMD可能大家更熟悉。</p>
<p>用nebmovie.pl,没有直接生成movie.xyz是因为从官方主页下载的脚本默认当使用nebmovie.pl后面不带参数或者参数为0的时候(即使用POSCAR产生xyz)，不输出movie.xyz。 你想让脚本自动生成movie.xyz而不是自己去合并各个文件夹里面的xyz文件，需要自行修改nebmovie.pl文件。很简单，把倒数第二个if语句整个用#注释掉或者直接删掉即可。</p>
<p>也可以直接用VESTA查看01的POSCAR。</p>
<p>进一步可用命令nebavoid.pl 1,确保中间插入的点每一个原子间距都大于1A。该命令的参数1表示最小允许间距，可取小数。<br>原子间距太小说明结构有问题。要么是因为初末态POSCAR里的原子没有对应好，要么是因为nebmake.pl线性插值的方法不适用于估计反应路径路径。如果是前者，调整好对应原子，也就是CONTCAR里面相应行进行调换；如果是后者，用Materials studio之类的软件调整好结构，再放入对应文件夹。<br>3. 其它文件的准备<br>在当前目录下面放入KPOINTS，POTCAR及INCAR文件。要求KPOINTS和POTCAR与ini、fin文件夹中的一样；INCAR中的基本参数也与初末态计算的INCAR一样，另外再加入NEB计算的相关参数。<br>INCAR再多说两句。优化算法若想使用vtst的，需要如上设置IBRION&#x3D;3,POTIM&#x3D;0,IOPT设置见本文第四个图。若使用vasp自带的优化器，可以使用IBRION&#x3D;1或者3，不要取2；POTIM取合适的值（0.01-0.5范围内去尝试）。</p>
<p>这样就可以提交NEB任务了。<br>4. 后处理<br>计算过程中，可以用nebef.pl命令（不带参数）查看计算收敛情况。<br>输出中，第二列即为最大受力（force of images in the neb），第三列为相应结构的能量。</p>
<p>前面INCAR中EDIFFG设置为-0.02（一般结构优化可取-0.02，NEB计算取-0.03），表示当所有结构最大力小于0.02eV&#x2F;A时，结束计算。</p>
<p>另一个可以用来观察收敛情况的命令是nebbarrier.pl（同样不带参数）。该命令没有输出到屏幕的内容，而是生成neb.dat文件。<br>neb.dat文件第二列表示距离（即临近两结构的dist.pl的计算结果），第三列表示能量（以初态能量为参考值），第四列为力（forces along the neb）。</p>
<p>EDIFFG参数对应的力是nebef.pl输出中的force of images in the neb.</p>
<p>计算完成后，使用命令nebresult.pl.</p>
<p>nebresult.pl做的事情如其所输出表明的，完成了nebbarrier.pl, nebspline.pl, nebef.pl, nebmovie.pl, nebjmovie.pl, nebconverge.pl还有对各文件夹中的OUTCAR打包压缩。生成了很多文件。其中mep.eps是以dist.pl距离为横坐标，能量为纵坐标画出的能势垒图，如下：<br>该文件一般查看图片的软件打不开，推荐使用EPS&#x2F;PS viewer. <a target="_blank" rel="noopener" href="https://epsviewer.org/download.aspx">https://epsviewer.org/download.aspx</a></p>
<p>生成的spline.dat文件是对上面几个点的拟合曲线数据，已经有了上图，这些数据就意义不大了。</p>
<p>生成的vaspgr文件夹内是各个插点结构的收敛图（同样可用EPS&#x2F;PS viewer打开），如下vaspout1.eps是01结构收敛信息：</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/09/18-47-22/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Keke Liu">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lightchaser">
      <meta itemprop="description" content="一个小学生的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Lightchaser">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/05/09/18-47-22/" class="post-title-link" itemprop="url">1.3 结构优化3</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-09 18:47:22" itemprop="dateCreated datePublished" datetime="2023-05-09T18:47:22+08:00">2023-05-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-13 10:05:34" itemprop="dateModified" datetime="2024-09-13T10:05:34+08:00">2024-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DFT%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">DFT学习</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="加压"><a href="#加压" class="headerlink" title="加压"></a>加压</h1><p>可通过施加静水压强、调整晶格常数的方法实现结构压缩</p>
<p>vi INCAR 增加标签 <code>PSTRESS=50</code><br>（单位为 0.1 GPa）</p>
<p>其他不变</p>
<h1 id="加电场"><a href="#加电场" class="headerlink" title="加电场"></a>加电场</h1><p>在vasp中根据自己所需要添加电场的场强更改INCAR中的如下参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LDIPOL=.TRUE.</span><br><span class="line">IDIPOL=1/2/3/4</span><br><span class="line">EFIELD= ？</span><br></pre></td></tr></table></figure>
<p>对于IDIPOL参数的设置，需注意：对于IDIPOL&#x3D;1-3，偶极矩将分别平行于第一、第二或第三晶格矢量的方向计算。总能量的修正计算为当前超单元中单极子&#x2F;偶极子和四极子与放置在超单元中的同一偶极子之间的能量差，对应的晶格矢量接近无穷大。此标志应用于板计算。对于IDIPOL&#x3D;4，将计算所有方向上的完整偶极矩，并将总能量的修正计算为当前超级单体中的单极&#x2F;偶极&#x2F;四极和放置在真空中的同一单极&#x2F;偶极&#x2F;四极之间的能量差，使用该标志计算孤立分子。</p>
<p>此外，EFIELD 的设置需要注意单位的换算。eV&#x2F;Å（电子伏特&#x2F;埃）计算完毕之后通过后处理软件分析所关注的性质即可。</p>
<h1 id="状态方程拟合"><a href="#状态方程拟合" class="headerlink" title="状态方程拟合"></a>状态方程拟合</h1><p>我们需要对结构进行优化才可以获取稳定的晶格参数信息。有两个方法可以实现：</p>
<p>1 Birch-Murnaghan状态方程拟合,<br>2 VASP计算中通过调节ISIF参数直接优化Bulk。<br>直接优化前面已经介绍，下面我们先讨论一下第一个方法：BM方程拟合。</p>
<p>参考：大师兄科研网：<a target="_blank" rel="noopener" href="https://www.bigbrosci.com/2018/02/02/ex33/">https://www.bigbrosci.com/2018/02/02/ex33/</a></p>
<p>科学网耿华运的博文：<a target="_blank" rel="noopener" href="https://blog.sciencenet.cn/blog-3469498-1280203.html">https://blog.sciencenet.cn/blog-3469498-1280203.html</a></p>
<p>科学网赵志强的博文，关于拟合：<a target="_blank" rel="noopener" href="https://wap.sciencenet.cn/blog-3388193-1152915.html">https://wap.sciencenet.cn/blog-3388193-1152915.html</a></p>
<p>vaspkit：<a target="_blank" rel="noopener" href="http://vaspkit.cn/index.php/48.html">http://vaspkit.cn/index.php/48.html</a></p>
<h3 id="大致流程（以大师兄提供脚本为例）"><a href="#大致流程（以大师兄提供脚本为例）" class="headerlink" title="大致流程（以大师兄提供脚本为例）"></a>大致流程（以大师兄提供脚本为例）</h3><ol>
<li><p>获得一定缩放系数的结构：<code>for i in 0.95 0.96 0.97 0.98 0.99 1.01 1.02 1.03 1.04 1.05; do cp 1.00 $i ; sed -i &quot;2s/1.0/$i/g&quot; $i/POSCAR ; done</code></p>
</li>
<li><p>分别进行结构优化:<code>for i in *; do cd $i; 提交任务命令; cd $OLDPWD; done</code></p>
</li>
<li><p>提取能量-体积以及能量-压力、压力-体积的数据:<code>for i in *; do echo -e $i &quot;\t&quot; $(grep &#39;  without&#39; $i/OUTCAR | tail -n 1| awk &#39;&#123;print $7&#125;&#39;);  done &gt; data</code></p>
</li>
<li><p>拟合能量体积曲线，获得平衡晶胞参数</p>
</li>
</ol>
<ul>
<li>这个流程可通过批量计算脚本实现，参考上面链接。另外还可以获得能量随压力的变化来模拟相变。</li>
</ul>
<h1 id="分数占据"><a href="#分数占据" class="headerlink" title="分数占据"></a>分数占据</h1><p>生成disorder或者掺杂构型的软件汇总：</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/vYar9UcYWAZgazBTgqUGEA">https://mp.weixin.qq.com/s/vYar9UcYWAZgazBTgqUGEA</a><br><a target="_blank" rel="noopener" href="https://github.com/jichunlian/disorder">https://github.com/jichunlian/disorder</a><br>supercell： <a target="_blank" rel="noopener" href="https://orex.github.io/supercell/">https://orex.github.io/supercell/</a><br>ATAT： <a target="_blank" rel="noopener" href="https://www.brown.edu/Departments/Engineering/Labs/avdw/atat/">https://www.brown.edu/Departments/Engineering/Labs/avdw/atat/</a><br>vaspkit：<a target="_blank" rel="noopener" href="https://vaspkit.com/">https://vaspkit.com/</a></p>
<h2 id="disorder"><a href="#disorder" class="headerlink" title="disorder"></a>disorder</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ unzip disorder-main</span><br><span class="line">$ cd disorder-main</span><br><span class="line">$ make disorder (Only disorder is compilied)</span><br><span class="line">$ make supercell (Only supercell is compilied)</span><br><span class="line">$ make or make all (Both disorder and supercell are compilied)</span><br><span class="line">$ make clean (rm *.o *.mod disorder supercell)</span><br><span class="line">export PATH=$PATH:disorder_installation_path/disorder-main/bin</span><br><span class="line">(Add this to the ~/.bashrc file as you wish)</span><br></pre></td></tr></table></figure>
<p>Note: The default compiler is ifort, and you can modify the Makefile<br>in the src directory to use another compiler (e.g. gfortran).</p>
<p>需要准备两个文件SPOSCAR和INDSOD,以examples的1和2为例：</p>
<h3 id="例子1：SnxPb1-xTe"><a href="#例子1：SnxPb1-xTe" class="headerlink" title="例子1：SnxPb1-xTe"></a>例子1：SnxPb1-xTe</h3><ol>
<li>扩建超胞，保证整除<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Te Pb</span><br><span class="line">   1.0</span><br><span class="line">    13.1323995589999996    0.0000000000000000    0.0000000000000000</span><br><span class="line">     0.0000000000000000   13.1323995589999996    0.0000000000000000</span><br><span class="line">     0.0000000000000000    0.0000000000000000   13.1323995589999996</span><br><span class="line">  Te   Pb</span><br><span class="line">  32   32</span><br><span class="line">Direct</span><br><span class="line">* * *</span><br></pre></td></tr></table></figure></li>
<li>准备INDSOD文件<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&amp;input</span><br><span class="line">  nsub = 2</span><br><span class="line">  subs = 16,16</span><br><span class="line">  symb = &#x27;Sn&#x27;,&#x27;Pb&#x27; ! The quotes is unnecessary for the ifort compiler</span><br><span class="line">  site = 2</span><br><span class="line">  prec = 1D-5</span><br><span class="line">! lpro = .true.</span><br><span class="line">! lpos = .true.</span><br><span class="line">! leqa = .true.</span><br><span class="line">! lspg = .true.</span><br><span class="line">  lcfg = .false.</span><br><span class="line">/</span><br></pre></td></tr></table></figure>
官方解释：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nsub-tag:nsub = 2 ~ 5; Default: nsub = 2.该位置取代原子种类。本例中是2种。</span><br><span class="line">subs-tag：subs = integer, integer, …; Default: None。对 应的原子数目。总和加起来应该等于该位点在SPOSCAR中的数目。</span><br><span class="line">symb-tag：symb = character, character, …; Default: None。元素化学符号。空位用Kw,即汉语kong wei。本例是Sn Pb单引号。</span><br><span class="line">site-tag：site = integer; Default: 1。所取代的位置在SPOSCAR中的位置。本例是第2.</span><br><span class="line">prec-tag：prec = real; Default: 1D-5。当软件产生空间群与其他软件识别不一致时调整该参数，一般不用修改。</span><br><span class="line">lpro-tag：lpro = logical; Default: .false.是否消除重复参数。对于大体系可以打开。</span><br><span class="line">lpos、leqa、lspg、lcfg：分别控制输出文件POSCAR-X、EQAMAT、SPGMAT、CFGMAT。</span><br></pre></td></tr></table></figure></li>
<li>运行disorder。输入disorder即可。</li>
<li>输出文件：</li>
</ol>
<h1 id="ATAT软件"><a href="#ATAT软件" class="headerlink" title="ATAT软件"></a>ATAT软件</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul>
<li>什么是ATAT？</li>
</ul>
<p>其全称为 Alloy Theoretic Automated Toolkit (ATAT)<br>引用官网的一句话，ATAT is a generic name that refers to a collection of alloy theory tools developped by Axel van de Walle, in collaboration with various research groups and with various sources of financial support.</p>
<ul>
<li>如何安装ATAT：</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://brown.edu/Departments/Engineering/Labs/avdw//atat/atat3_36.tar.gz%E4%B8%8B%E8%BD%BDATAT%E6%BA%90%E7%A0%81%EF%BC%8C%E8%A7%A3%E5%8E%8B%E5%90%8E%EF%BC%8Cmake">http://brown.edu/Departments/Engineering/Labs/avdw//atat/atat3_36.tar.gz下载ATAT源码，解压后，make</a> all开始编译；之后make install进行程序和脚本定向安装；之后在home中打开.&#x2F;bashrc添加ATAT安装路径于环境变量当中（添加 export PATH&#x3D;$PATH:&#x2F;xxxx），并source .&#x2F;bashrc即可。</p>
<p>进入安装包的glue目录，里面有与各种dft软件的算例的接口设置。例如进入vasp可以看到它的接口设置脚本ezvasp，由于make install已经将它拷贝到了安装目录中，所以在bin中打开ezvasp，并设置相关可执行程序，包括赝势文件的名称和路径即可。</p>
<p>配置~&#x2F;.ezvasp.rc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/csh</span><br><span class="line">set VASPCMD=&quot;/path/vasp_std# 设置vasp可执行程序</span><br><span class="line">set POTLDA/PBE=&quot;/path/to/pot_lad&quot; # 设置为赝势实际的路径</span><br></pre></td></tr></table></figure>



<ul>
<li>ATAT能做啥？</li>
</ul>
<p>ATAT 是Walle及其合作者开发的一个利用第一性原理结合MonteCarlo模拟计算相图及热力学性能的软件包。该软件包首先采用团簇展开(cluster expansion)，用第一原理方法计算一系列构型的形成能，然后用这些能量作为Monte Carlo模拟的哈密顿量，计算材料的热力学性能和高熵合金的mcsqs建模。</p>
<h2 id="MAPs"><a href="#MAPs" class="headerlink" title="MAPs"></a>MAPs</h2><p>软件运行</p>
<p>一）运行MAPS：</p>
<ol>
<li>准备lat.in文件</li>
</ol>
<p>2）maps -d &amp; #maps命令运行，等待后面的指令</p>
<p>3）touch ready </p>
<p>#等待十几秒钟，出现“0”文件夹，是合金中比例为0的纯相结构。</p>
<p>4）此时需要利用第一性原理软件计算该结构的能量 </p>
<p>#（参见下部分和VASP软件的交互,可无需手动输入），现在手动输入能量，理解一下计算过程，假设该结构的能量已经知道，在0这个文件夹下，echo 1.1 &gt; energy, 并删除wait。继续touch ready，就会生成1这个文件夹，里面是比例为1的另一个纯相结构，echo 2.2 &gt; energy, 删除wait。touch ready，生成2这个文件夹，一直这样循环下去，直至达到相应的精度，最终停止输入touch stop。</p>
<p>二）运行MAPS与VASP交互：</p>
<p>1）需要lat.in，vasp.wrap文件 （ #vasp的INCAR参数）</p>
<p>2）其余与上面运行MAPS步骤相同，直到第4步骤计算能量，进入该文件夹，运行runstruct_vasp。</p>
<p>大概率会报错，原因有几个：</p>
<p>a. 常见为~&#x2F;.ezvasp.rc文件配置问题，赝势位置，vasp运行路径出错。</p>
<p><strong>可以看运行命令后，是否有POTCAR文件产生，如果没有，基本就是赝势位置问题，如果POTCAR文件正常，就是vasp没有运行。</strong></p>
<p>b. vasp不运行，在集群上面运行的软件，ATAT软件给了集群上面的运行办法, pollmach命令，将runstruct_vasp命令写在脚本里是可以的。</p>
<p>最终正确版本运行步骤：</p>
<p>1）准备lat.in，vasp.wrap文件，脚本文件。</p>
<p>lat.in文件</p>
<p>vasp.wrap文件</p>
<p>sub.sh文件</p>
<p>2）提交脚本文件即可</p>
<p>说明：</p>
<ul>
<li>缺少<code>.machines.rc</code>文件的提示可忽略，该文件用于跨节点的并行</li>
<li><code>maps</code>不断产生结构和构建团簇展开模型，<code>-d</code>表示使用默认参数，直接输入<code>maps</code>可查看可用参数</li>
<li><code>runstruct_vasp</code>调用<code>vasp</code>计算所产生的结构的能量，每个目录包含一个结构及其计算结果，每个目录下的<code>energy</code>文件即从vasp的计算中读取的能量</li>
<li><code>maps.log</code>中记载了现有的团簇展开模型的状态，包括对基态构型的预测和LOOCV等</li>
</ul>
<p>什么时候停止计算：</p>
<ul>
<li>团簇展开模型能够成功预测基态 (查看maps.log)</li>
<li>LOOCV足够小 (&lt;0.025 eV suggested by ATAT manual) </li>
<li>有效团簇相互作用随着团簇距离的增大而衰减</li>
</ul>
<p>以上的三个判据并不是绝对的，判断一个团簇展开模型是合理的还可以有其它方式。</p>
<p>停止计算：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ touch stop</span><br><span class="line">$ touch stoppoll</span><br></pre></td></tr></table></figure>

<p>重启计算: 与正常开始一个计算相同，如果之前的计算不是正常结束则需要删除一些文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm maps_is_running pollmach_is_running ready</span><br><span class="line">maps -d &amp;</span><br><span class="line">pollmach runstruct_vasp</span><br></pre></td></tr></table></figure>

<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><ul>
<li><p><code>corrdump -2= -3= -4=</code> 产生团簇</p>
</li>
<li><p><code>getclus</code> 查看团簇</p>
<ul>
<li>第一列为团簇的阶数，第二列为团簇直径，第三列为团簇的多重度</li>
<li><code>clusters.out</code>中有团簇格点位置的详细信息</li>
</ul>
</li>
<li><p><code>clusterexpand -e -cv energy</code> 得到团簇展开系数</p>
<ul>
<li>此时产生的ECI文件为<code>energy.eci</code>，而<code>maps</code>产生的ECI为<code>eci.out</code>，后者是形成能的团簇展开结果，前者是直接对vasp能量(即<code>energy</code>文件)的团簇展开</li>
<li>如果需要对其它性质做团簇展开，例如带隙，则可以在每个结构的目录下创建一个<code>bandgap</code>文件,其内容即为带隙的大小，然后运行<code>clusterexpand -e -cv -pa bandgap</code>以得到带隙团簇展开的系数<code>bandgap.eci</code>，其中<code>-pa</code>表示所展开的量已经是一个平均的量</li>
</ul>
</li>
</ul>
<h4 id="检查计算结果"><a href="#检查计算结果" class="headerlink" title="检查计算结果"></a>检查计算结果</h4><ul>
<li>VASP是否正常结束<ul>
<li>ATAT会自动检查一些错误(<code>checkerr_vasp</code>)</li>
<li>但如果结构优化的离子步数不够大，不会有提示，因此建议在<code>vasp.wrap</code>中将<code>NSW</code>设置大一些</li>
</ul>
</li>
<li>晶胞的应变是否很大<ul>
<li><code>checkrelax</code> (&lt;0.1 suggested by ATAT）</li>
</ul>
</li>
</ul>
<h4 id="结果可视化"><a href="#结果可视化" class="headerlink" title="结果可视化"></a>结果可视化</h4><ul>
<li><code>mapsrep</code> 会调用<code>gnuplot</code>作图并产生相应的脚本<code>mapsrep.gnu</code></li>
</ul>
<h4 id="输出文件"><a href="#输出文件" class="headerlink" title="输出文件"></a>输出文件</h4><ol>
<li><p>maps.log：开始可能的warnings:<br>’Not enough known energies to fit CE’<br>’True ground states not &#x3D; fitted ground states’<br>’New ground states predicted, see predstr.out’<br>随着结构增多:<br>’Among structures of known energy, true and predicted ground states agree.’<br>’No other ground states of xx atoms&#x2F;unit cell or less exist.’<br>最后一行有crossvalidation score (in eV&#x2F;atom)，该值要小于0.025。精确小于0.001.</p>
</li>
<li><p>fit.out:拟合的结构，一个结构一行，共6列，分别代表concentration、 energy 、fitted_energy (energy-fitted_energy)、 weight 、index</p>
</li>
<li><p>predstr.out：预测的能量，一个结构一行，共5列，分别代表concentration、 energy 、predicted_energy、index、status.其中status包括status is either<br>b for busy (being calculated),<br>e for error,<br>u for unknown (not yet calculated) or<br>g if that structure is predicted to be a ground state (g can be combined with the above).</p>
</li>
<li><p>gs.out：基态能量，一个结构一行，四列，分别是concentration、 energy、 fitted_energy、 index</p>
</li>
<li><p>gs_str.out：基态的结构，格式和str.out一样。每一个结构后面会有end和一个空行隔开。</p>
</li>
<li><p>eci.out：eci值对应的cluster在clusters.out文件。</p>
</li>
<li><p>clusters.out：对于每一个团簇，第一行是多重度 multiplicity，第二行是团簇维度cluster diameter，第三行是团簇的格点数，下一行是格点对应的坐标。最后空行隔开每一个团簇。</p>
</li>
<li><p>str.out：在每个数字文件夹下面，和晶格输入文件相似，不同是坐标写成3*3矩阵，一个位置只写一个原子。</p>
</li>
<li><p>ref_energy.out：用于计算形成能的参考能量。</p>
</li>
</ol>
<h4 id="后处理"><a href="#后处理" class="headerlink" title="后处理"></a>后处理</h4><p>一系列用于分析ATAT计算结果的python脚本，GitHub地址为：<a target="_blank" rel="noopener" href="https://github.com/xu-xi/clusterexpansion%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87">https://github.com/xu-xi/clusterexpansion可以通过</a> git clone 下载到本地服务器。用“-h”命令可以查看每个脚本的帮助文档。最常用的几个脚本是：</p>
<p>1）cv_scan.py，测试CE模型对团簇截断半径的收敛性。</p>
<p>2）lc.py，测试CE模型对训练集大小的收敛性。通常~80个构型就可以得到比较精确的团簇展开模型。</p>
<p>3）ce_plot.py，这个脚本绘制的是拟合能量-计算能量分布图，默认-p&#x3D;energy（调用的是每个数字目录下的energy文件）。energy文件是ATAT完成一个构型的DFT (relax+static) 计算后自动生成的能量文件。在实际应用中，拟合能量-计算能量分布图需要的往往不是energy而是formation energy，所以就需要编写脚本手动在每一个数字目录下生成一个形成能文件formation_energy，该值需要将目标目录下energy的值与0文件夹的energy和1文件夹的energy作线性变换得到，再写入到每一个数字目录中，读者可自行尝试。下面的脚本仅供参考，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line">import os,subprocess,numpy,argparse,sys,subprocess,math</span><br><span class="line">energy_0 = float(subprocess.check_output(&#x27;cat ./0/energy&#x27;, shell = True))</span><br><span class="line">energy_1 = float(subprocess.check_output(&#x27;cat ./1/energy&#x27;, shell = True))</span><br><span class="line">for item in os.listdir(os.getcwd()):</span><br><span class="line">    fullpath = os.path.join(os.getcwd(),item)</span><br><span class="line">    if os.path.isdir(fullpath):</span><br><span class="line">        os.chdir(fullpath)</span><br><span class="line">        if not os.path.isfile(&#x27;error&#x27;):</span><br><span class="line">            sc_atom_number = len(file(&#x27;str.out&#x27;).readlines())-6</span><br><span class="line">            # print sc_atom_number</span><br><span class="line">            energy = float(subprocess.check_output(&#x27;cat energy&#x27;, shell = True))</span><br><span class="line">            energy /= sc_atom_number</span><br><span class="line">            #energy *= 5 normalize to unit cell,5 atoms in CsPbI3</span><br><span class="line">            sc_x = float(subprocess.check_output(&#x27;corrdump -pc -l=../lat.in&#x27;,shell=True).strip().split()[0])</span><br><span class="line">            formation_energy = energy - (1 - sc_x) * energy_0 - sc_x * energy_1</span><br><span class="line">            # print formation_energy</span><br><span class="line">            with open(&#x27;formation energy&#x27;,&#x27;w&#x27;) as f:</span><br><span class="line">                f.write(&#x27;%.7f\n&#x27; % formation_energy)</span><br><span class="line">        os.chdir(&#x27;../&#x27;)</span><br></pre></td></tr></table></figure>
<p>注：这里如果报错：NameError: name ‘file’ is not defined. Did you mean: ‘filter’?将file改成open</p>
<p>得到formation_energy文件后，执行命令ce_plot.py -p&#x3D;formation_energy -s&#x3D;”formation energy”，还可以用Origin手动绘制出形成能-掺杂浓度分布图；在得到了比较精确的CE模型后，可以进行蒙特卡罗模拟，得到团簇关联函数、系综平均能量和方差随温度变化示意图。</p>
<h4 id="热力学计算"><a href="#热力学计算" class="headerlink" title="热力学计算"></a>热力学计算</h4><p>必要的输入文件：</p>
<ul>
<li><code>lat.in</code></li>
<li><code>clusters.out</code></li>
<li><code>eci.out</code></li>
<li><code>gs_str.out</code></li>
</ul>
<h5 id="emc2使用示例"><a href="#emc2使用示例" class="headerlink" title="emc2使用示例"></a><code>emc2</code>使用示例</h5><p>蒙特卡洛模拟</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emc2 -T0=300 -T1=3000 -dT=100 -cm -x=0 -keV -gs=-1 -er=30 -aq=0 -dx=1e-5 -sigdig=12</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-cm</code>表示正则系综</li>
<li><code>-x</code>其实是点团簇函数，若c表示格点的占据浓度，则x&#x3D;2c-1</li>
<li><code>-sigdig=12</code>是为了表示有足够的位数输出能量的方差以判断相变</li>
<li><code>-aq</code>和<code>-dx</code>是自动确定MC平衡步数和取样步数的算法，其原理可参考文献<a href="#ref_1">Ref.1</a>，也可以用<code>-eq</code>和<code>-n</code>来直接指定步数，需要做收敛性测试</li>
<li>主要输出文件为<code>mc.out</code>，输入<code>emc2 -h</code>可查看每一列所表示的内容</li>
<li>输出文件<code>mcsnapshot.out</code>为最后一个模拟温度下的MC快照。如果想得到某个温度下的snapshot，可以只设置T0而不设置T1和dT。  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cp</span> mcsnapshot.out str.out</span><br><span class="line">$ runstruct_vasp -nr </span><br><span class="line">$ vesta POSCAR</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="相图计算"><a href="#相图计算" class="headerlink" title="相图计算"></a>相图计算</h4><p>基本原理可参考文献<a href="#ref_1">Ref.1</a>，Martin Baker的<a target="_blank" rel="noopener" href="https://arxiv.org/abs/1907.10151">笔记</a>提供了更多的例子和细节</p>
<p>例子：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phb -dT=10 -ltep=1e-3 -er=30 -gs1=0 -gs2=1 -o=phb.out -keV -dx=1e-5</span><br></pre></td></tr></table></figure>

<h4 id="构建SQS-x2F-SQoS"><a href="#构建SQS-x2F-SQoS" class="headerlink" title="构建SQS&#x2F;SQoS"></a>构建SQS&#x2F;SQoS</h4><p>SQS&#x2F;SQoS是对无序体系的代表性结构，其中SQS假定原子完全随机的占据，而SQoS是SQS的扩展，可以考虑一定的短程有序性，其基本原理可参考相关文献<a href="#ref_2">Ref.2</a></p>
<p>必要文件：</p>
<ul>
<li>rndstr.in</li>
<li>clusters.out</li>
</ul>
<p><code>rndstr.in</code>的一个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">4.1000 0.000000 0.000000</span><br><span class="line">0.000000 4.1000 0.000000</span><br><span class="line">0.000000 0.000000 4.1000</span><br><span class="line">1.000000 0.000000 0.000000</span><br><span class="line">0.000000 1.000000 0.000000</span><br><span class="line">0.000000 0.000000 1.000000</span><br><span class="line">0.000000 0.500000 0.500000 O=0.6667,N=0.3333</span><br><span class="line">0.500000 0.000000 0.500000 O=0.6667,N=0.3333</span><br><span class="line">0.500000 0.500000 0.000000 O=0.6667,N=0.3333</span><br><span class="line">0.000000 0.000000 0.000000 Ba</span><br><span class="line">0.500000 0.500000 0.500000 Ta</span><br></pre></td></tr></table></figure>

<p>产生团簇文件<code>clusters.out</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">corrdump -l=rndstr.in -clus -noe -nop -2= -3= -4=</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<ul>
<li><code>-noe</code>和<code>-nop</code>表示忽略空团簇和点团簇</li>
<li>用<code>getclus</code>查看所产生的团簇。如果团簇数目过少，则后续产生SQS有可能很容易完全匹配团簇函数，导致SQS实际上不够随机；而如果团簇过多，则有可能导致近邻的团簇匹配得不够好，而通常近邻的团簇是更为重要的，可以通过<code>-wd</code>加上权重以避免这种情况</li>
</ul>
<p>运行<code>mcsqs -n= &amp;</code><br>说明：</p>
<ul>
<li><code>-n</code>设定SQS晶胞的原子数</li>
<li>可通过<code>-tcf</code>设定目标团簇函数（可从<code>mc.out</code>中提取），即SQoS方法</li>
<li><code>mcsqs</code>不会自动停下来，可用<code>touch stopsqs</code>停止</li>
<li>输出文件<code>mcsqs.log</code>中有对团簇函数匹配的优化记录</li>
<li>输出文件<code>bestsqs.out</code>为目前找到的最佳的SQS，可将其复制为<code>str.out</code>，然后运行<code>runstruct_vasp -nr</code>生成vasp的输入文件用于后续计算</li>
</ul>
<h2 id="MCSQS"><a href="#MCSQS" class="headerlink" title="MCSQS"></a>MCSQS</h2><p>一、原理</p>
<p>无序态的关联函数已知，因此只需要备选态的关联函数和无序态关联函数差别最小就可以，即让下方公式中的目标函数最小。</p>
<p>二、运行步骤</p>
<p>step1. 准备rndstr.in文件</p>
<p>1 1 1 90 90 90</p>
<p>1 0 0 </p>
<p>0 1 0</p>
<p>0 0 1</p>
<p>.0 .0 .0 Cr</p>
<p>.0 .5 .5 Ni&#x3D;0.333333,Fe&#x3D;.333333, Co&#x3D;.333334</p>
<p>.5 .0 .5 Ni&#x3D;0.333333,Fe&#x3D;.333333, Co&#x3D;.333334</p>
<p>.5 .5 .0 Ni&#x3D;0.333333,Fe&#x3D;.333333, Co&#x3D;.333334</p>
<p>#第一行也可以改成3*3矩阵，类似于POSCAR中晶格常数格式。这里一般不用实际的晶格常数，用1替代。</p>
<p>用1对后面的参数设置更容易。</p>
<p>step2. 运行命令<br>corrdump -l&#x3D;rndstr.in -ro -noe -nop -clus -2&#x3D;1.1<br>该命令通过读取rndstr.in文件中的结构，进而计算结构的对称性和团簇等信息，输出clusters.out文件。</p>
<p>#需要注意的是‘-2’这个参数，是用于计算关联函数的截断距离。如对于FCC构型而言，晶格常数为1，第一最近距离为2^0.5&#x2F;2&#x3D;0.71，第二距离为1，第三距离为1.5^0.5&#x3D;1.2。所以这里设置阶段距离在1和1.2之间。一般考虑‘-2’参数即可。（注：更高的-2，-3参数会产生更无序的结构，但是需要更长的时间，一般晶格常数为1，这里选取1.1就可以）</p>
<p>step3. 运行命令 mcsqs -n XX<br>该命令主要输出sqscell.out文件。XX表示体系的原子个数，该数值一定是上述结构原子的倍数，否则会出错。</p>
<p>#比如上述构型，自身CrNi有4个原子，其中Ni元素与Fe,Co构成合金，因此XX至少为12个原子。该步骤运行一下，就可以进行停止。输出文件需要关注sqscell.out文件，该文件给出了XX个原子扩胞后形成的不同晶格构型。可通过挑选，删除一些不太可能的结构，比如x,y,z三个方向长度差别过大，形成的角度较小等对VASP或后续计算不友好的结构。之后用新的sqscell.out文件运行第四步骤。</p>
<p>step4. 运行命令mcsqs -rc<br>输出bestsqs.out文件和bestcorr.out文件。其中bestsqs.out就是无序结构。</p>
<p>#通常而言没有最完美的无序结构，这个命令会一直运行下去，可以肯定的是，再一次生成的结构比上一次生成的结构要优异，所以什么时候停止取决于自身研究的精度。</p>
<h1 id="层间结合能、结合力"><a href="#层间结合能、结合力" class="headerlink" title="层间结合能、结合力"></a>层间结合能、结合力</h1><p>贴一篇文章：<a target="_blank" rel="noopener" href="https://news.sciencenet.cn/htmlpaper/2022/4/202242914585844872440.shtm">https://news.sciencenet.cn/htmlpaper/2022/4/202242914585844872440.shtm</a></p>
<h3 id="Graphite-interlayer-distance"><a href="#Graphite-interlayer-distance" class="headerlink" title="Graphite interlayer distance"></a>Graphite interlayer distance</h3><p>vasp上的教程：</p>
<p>准备graphite结构，</p>
<p>INCAR：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">IVDW = 20           </span><br><span class="line">LVDW_EWALD =.TRUE. </span><br><span class="line">NSW = 1 </span><br><span class="line">IBRION = 2</span><br><span class="line">ISIF = 4</span><br><span class="line">PREC = Accurate</span><br><span class="line">EDIFFG = 1e-5</span><br><span class="line">LWAVE = .FALSE.</span><br><span class="line">LCHARG = .FALSE.</span><br><span class="line">ISMEAR = -5</span><br><span class="line">SIGMA = 0.01</span><br><span class="line">EDIFF = 1e-6</span><br><span class="line">ALGO = Fast</span><br><span class="line">NPAR = 2</span><br></pre></td></tr></table></figure>
<p>提交脚本：<br>To run this example, execute the run.sh bash-script:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"># To run VASP this script calls $vasp_std</span><br><span class="line"># (or posibly $vasp_gam and/or $vasp_ncl).</span><br><span class="line"># These variables can be defined by sourcing vaspcmd</span><br><span class="line">. vaspcmd 2&gt; /dev/null</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># When vaspcmd is not available and $vasp_std,</span><br><span class="line"># $vasp_gam, and/or $vasp_ncl are not set as environment</span><br><span class="line"># variables, you can specify them here</span><br><span class="line">[ -z &quot;`echo $vasp_std`&quot; ] &amp;&amp; vasp_std=&quot;mpirun -np 8 /path-to-your-vasp/vasp_std&quot;</span><br><span class="line">[ -z &quot;`echo $vasp_gam`&quot; ] &amp;&amp; vasp_gam=&quot;mpirun -np 8 /path-to-your-vasp/vasp_gam&quot;</span><br><span class="line">[ -z &quot;`echo $vasp_ncl`&quot; ] &amp;&amp; vasp_ncl=&quot;mpirun -np 8 /path-to-your-vasp/vasp_ncl&quot;</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># The real work starts here</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">rm results.dat</span><br><span class="line"></span><br><span class="line">for d in 6.5 6.6 6.65 6.7 6.75 6.8 6.9 7.0</span><br><span class="line">do</span><br><span class="line">  cat&gt;POSCAR&lt;&lt;!</span><br><span class="line">graphite</span><br><span class="line">1.0</span><br><span class="line">1.22800000 -2.12695839  0.00000000</span><br><span class="line">1.22800000  2.12695839  0.00000000</span><br><span class="line">0.00000000  0.00000000  $d</span><br><span class="line">4</span><br><span class="line">direct</span><br><span class="line">   0.00000000  0.00000000  0.25000000</span><br><span class="line">   0.00000000  0.00000000  0.75000000</span><br><span class="line">   0.33333333  0.66666667  0.25000000</span><br><span class="line">   0.66666667  0.33333333  0.75000000</span><br><span class="line">!</span><br><span class="line">  $vasp_std</span><br><span class="line">  cp OUTCAR OUTCAR.$d</span><br><span class="line">  energy=$(grep &quot;free  ene&quot; OUTCAR.$d|awk &#x27;&#123;print $5&#125;&#x27;)</span><br><span class="line">  echo $d $energy &gt;&gt; results.dat </span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<p>The optimal length of the lattice vector c normal to the stacking direction is determined in a series of single point calculations with varied value of c (all other degrees of freedom are fixed at their experimental values).</p>
<p>The computed c vs. energy dependence is written in the file results.dat and can be visualized e.g. using xmgrace. The optimal value can be obtained using the attached utility (python with numpy or Numeric is needed):</p>
<p><code>./utilities/fit.py results.dat</code><br>This should yield:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">200 iterations performed</span><br><span class="line">Ch-square: 4.30305519481e-09</span><br><span class="line">---------</span><br><span class="line"></span><br><span class="line">       E0(eV):         -37.433456779</span><br><span class="line">       d0(A):  6.65603352689</span><br><span class="line">The computed value of 6.66 Å agrees well with experiment (6.71 Å).</span><br></pre></td></tr></table></figure>

<h3 id="Graphite-MBD-binding-energy"><a href="#Graphite-MBD-binding-energy" class="headerlink" title="Graphite MBD binding energy"></a>Graphite MBD binding energy</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">IVDW = 202           </span><br><span class="line">LVDWEXPANSION =.TRUE. </span><br><span class="line">NSW = 1 </span><br><span class="line">IBRION = 2</span><br><span class="line">ISIF = 4</span><br><span class="line">PREC = Accurate</span><br><span class="line">EDIFFG = 1e-5</span><br><span class="line">LWAVE = .FALSE.</span><br><span class="line">LCHARG = .FALSE.</span><br><span class="line">ISMEAR = -5</span><br><span class="line">SIGMA = 0.01</span><br><span class="line">EDIFF = 1e-6</span><br><span class="line">ALGO = Fast</span><br><span class="line">NPAR = 2</span><br></pre></td></tr></table></figure>
<p>KPOINTS</p>
<p>Graphite:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Monkhorst Pack</span><br><span class="line">0</span><br><span class="line">gamma</span><br><span class="line">16 16 8</span><br><span class="line">0 0 0</span><br></pre></td></tr></table></figure>
<p>Graphene:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Monkhorst Pack</span><br><span class="line">0</span><br><span class="line">gamma</span><br><span class="line">16 16 1</span><br><span class="line">0 0 0</span><br></pre></td></tr></table></figure>
<p>Running this example<br>To run this example, execute the run.sh bash-script:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"># To run VASP this script calls $vasp_std</span><br><span class="line"># (or posibly $vasp_gam and/or $vasp_ncl).</span><br><span class="line"># These variables can be defined by sourcing vaspcmd</span><br><span class="line">. vaspcmd 2&gt; /dev/null</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># When vaspcmd is not available and $vasp_std,</span><br><span class="line"># $vasp_gam, and/or $vasp_ncl are not set as environment</span><br><span class="line"># variables, you can specify them here</span><br><span class="line">[ -z &quot;`echo $vasp_std`&quot; ] &amp;&amp; vasp_std=&quot;mpirun -np 8 /path-to-your-vasp/vasp_std&quot;</span><br><span class="line">[ -z &quot;`echo $vasp_gam`&quot; ] &amp;&amp; vasp_gam=&quot;mpirun -np 8 /path-to-your-vasp/vasp_gam&quot;</span><br><span class="line">[ -z &quot;`echo $vasp_ncl`&quot; ] &amp;&amp; vasp_ncl=&quot;mpirun -np 8 /path-to-your-vasp/vasp_ncl&quot;</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># The real work starts here</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># Here the work starts</span><br><span class="line">rm results.dat</span><br><span class="line"></span><br><span class="line">drct=$(pwd)</span><br><span class="line"></span><br><span class="line">for i in graphene graphite</span><br><span class="line">do</span><br><span class="line">  cd $drct/$i</span><br><span class="line">  $vasp_std</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">cd $drct</span><br><span class="line"></span><br><span class="line"># obtain total energy for graphite </span><br><span class="line">en2=$(grep &quot;free  ene&quot; graphite/OUTCAR |tail -1|awk &#x27;&#123;print $5&#125;&#x27;) </span><br><span class="line"></span><br><span class="line"># obtain total energy for graphene</span><br><span class="line">en1=$(grep &quot;free  ene&quot; graphene/OUTCAR |tail -1|awk &#x27;&#123;print $5&#125;&#x27;)</span><br><span class="line"></span><br><span class="line"># compute interlayer binding energy (eV/atom)</span><br><span class="line">deltaE=$(echo print $en2/4 - $en1/2 |python)</span><br><span class="line"></span><br><span class="line">echo &quot;Binding energy (eV/atom): &quot; $deltaE &gt;results.dat</span><br></pre></td></tr></table></figure>

<p>Note that the calculation is performed in two steps (two separate single-point calculations) in which the energy for bulk graphite and for graphene are obtained. The binding energy is computed automatically and it is written in the file results.dat. (N.B.: for the latter python needs to be available.)</p>
<p>The computed value of 0.050 eV&#x2F;A is now fairly close to the RPA reference of 0.048 eV&#x2F;atom [1].</p>
<h3 id="Graphite-TS-binding-energy"><a href="#Graphite-TS-binding-energy" class="headerlink" title="Graphite TS binding energy"></a>Graphite TS binding energy</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">IVDW = 20            </span><br><span class="line">LVDW_EWALD =.TRUE. </span><br><span class="line">NSW = 1 </span><br><span class="line">IBRION = 2</span><br><span class="line">ISIF = 4</span><br><span class="line">PREC = Accurate</span><br><span class="line">EDIFFG = 1e-5</span><br><span class="line">LWAVE = .FALSE.</span><br><span class="line">LCHARG = .FALSE.</span><br><span class="line">ISMEAR = -5</span><br><span class="line">SIGMA = 0.01</span><br><span class="line">EDIFF = 1e-6</span><br><span class="line">ALGO = Fast</span><br><span class="line">NPAR = 2</span><br></pre></td></tr></table></figure>
<p>To run this example, execute the run.sh bash-script:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"># To run VASP this script calls $vasp_std</span><br><span class="line"># (or posibly $vasp_gam and/or $vasp_ncl).</span><br><span class="line"># These variables can be defined by sourcing vaspcmd</span><br><span class="line">. vaspcmd 2&gt; /dev/null</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># When vaspcmd is not available and $vasp_std,</span><br><span class="line"># $vasp_gam, and/or $vasp_ncl are not set as environment</span><br><span class="line"># variables, you can specify them here</span><br><span class="line">[ -z &quot;`echo $vasp_std`&quot; ] &amp;&amp; vasp_std=&quot;mpirun -np 8 /path-to-your-vasp/vasp_std&quot;</span><br><span class="line">[ -z &quot;`echo $vasp_gam`&quot; ] &amp;&amp; vasp_gam=&quot;mpirun -np 8 /path-to-your-vasp/vasp_gam&quot;</span><br><span class="line">[ -z &quot;`echo $vasp_ncl`&quot; ] &amp;&amp; vasp_ncl=&quot;mpirun -np 8 /path-to-your-vasp/vasp_ncl&quot;</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># The real work starts here</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line">rm results.dat</span><br><span class="line"></span><br><span class="line">drct=$(pwd)</span><br><span class="line"></span><br><span class="line">for i in graphene graphite</span><br><span class="line">do</span><br><span class="line">  cd $drct/$i</span><br><span class="line">  $vasp_std</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">cd $drct</span><br><span class="line"></span><br><span class="line"># obtain total energy for graphite </span><br><span class="line">en2=$(grep &quot;free  ene&quot; graphite/OUTCAR |tail -1|awk &#x27;&#123;print $5&#125;&#x27;) </span><br><span class="line"></span><br><span class="line"># obtain total energy for graphene</span><br><span class="line">en1=$(grep &quot;free  ene&quot; graphene/OUTCAR |tail -1|awk &#x27;&#123;print $5&#125;&#x27;)</span><br><span class="line"></span><br><span class="line"># compute interlayer binding energy (eV/atom)</span><br><span class="line">deltaE=$(echo print $en2/4 - $en1/2 |python)</span><br><span class="line"></span><br><span class="line">echo &quot;Binding energy (eV/atom): &quot; $deltaE &gt;results.dat</span><br></pre></td></tr></table></figure>

<p>Note that the calculation is performed in two steps (two separate single-point calculations) in which the energy for bulk graphite and for graphene are obtained. The binding energy is computed automatically and it is written in the file results.dat. (N.B.: for the latter python needs to be available.)</p>
<p>Even though the TS method predicts a reasonable geometry (see the Graphite interlayer distance example) it overestimates the energetics strongly: the computed binding energy of -0.083 eV&#x2F;atom is too large compared to the RPA reference of 0.048 eV&#x2F;atom. This overestimation is - at least in part - due to neglecting the many-body interactions (see example Graphite MBD binding energy).</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Keke Liu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
